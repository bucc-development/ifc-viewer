import{V as U,L as Et,B as Qe,T as cs,S as pi,P as _s,a as lt,b as ft,G as hl,M as Oe,c as Rt,F as Do,d as kf,D as Fi,C as mt,I as ss,e as r0,f as kn,g as mi,E as Rc,h as ye,R as Vf,i as Tr,j as Yf,k as is,l as Us,m as pt,n as xr,o as Ar,p as ms,q as vt,O as Wi,r as Sc,s as gi,t as Gf,W as Lo,u as Zi,v as Hi,w as $s,x as o0,Q as Ht,y as Fr,z as a0,A as Vn,H as Ln,J as xt,K as Vi,N as l0,U as Hf,X as MI,Y as NI,Z as ac,_ as Wf,$ as lc,a0 as DI,a1 as LI,a2 as UI,a3 as BI,a4 as xd,a5 as Ao,a6 as zI,a7 as kI,a8 as VI,a9 as jf,aa as YI,ab as h0,ac as ln,ad as ga,ae as GI,af as HI,ag as WI,ah as jI,ai as ZI,aj as Gp,ak as XI,al as KI,am as QI}from"./three-D6zBG5Mv.js";import{I as fi,a as Oc,b as zs,E as jt,H as hs,c as Uo,d as Xi,e as c0,f as Xn,g as Vo,h as Yo,i as Go,j as Ho,k as Wo,l as Kn,m as jo,n as Zo,o as Xo,p as Ko,q as Qo,r as qo,s as Jo,t as $o,u as ea,v as ta,w as Rr,L as u0,F as d0,x as f0,y as p0,z as m0,A as g0,B as E0,C as I0,D as b0}from"./web-ifc-CL1j-px8.js";var qI=Object.defineProperty,JI=(l,e,t)=>e in l?qI(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,We=(l,e,t)=>(JI(l,typeof e!="symbol"?e+"":e,t),t);class cl extends ss{constructor(e,t,s,i){if(super(e,t,s),We(this,"fragment"),We(this,"material"),We(this,"geometry"),Array.isArray(t)||(t=[t]),this.material=t,!e.index)throw new Error("The geometry for fragments must be indexed!");this.geometry=e,this.fragment=i;const n=e.index.count;e.groups.length||e.groups.push({start:0,count:n,materialIndex:0})}exportData(){const e=this.geometry.attributes.position.array,t=this.geometry.attributes.normal.array,s=Array.from(this.geometry.index.array),i=[];for(const a of this.geometry.groups){const h=a.materialIndex||0,{start:c,count:d}=a;i.push(c,d,h)}const n=[];if(Array.isArray(this.material))for(const a of this.material){const h=a.opacity,c=a.transparent?1:0,d=new mt(a.color).toArray();n.push(h,c,...d)}const r=Array.from(this.instanceMatrix.array);let o;return this.instanceColor!==null?o=Array.from(this.instanceColor.array):o=[],{position:e,normal:t,index:s,groups:i,materials:n,matrices:r,colors:o}}clone(e){throw new Error("Fragment meshes can't be cloned directly. Use mesh.fragment.clone instead!")}}const y0=0,$I=1,eb=2,Hp=2,Cu=1.25,Wp=1,hc=6*4+4+4,Pc=65535,tb=Math.pow(2,-24),vu=Symbol("SKIP_GENERATION");function sb(l){return l.index?l.index.count:l.attributes.position.count}function sa(l){return sb(l)/3}function ib(l,e=ArrayBuffer){return l>65535?new Uint32Array(new e(4*l)):new Uint16Array(new e(2*l))}function nb(l,e){if(!l.index){const t=l.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=ib(t,s);l.setIndex(new Rt(i,1));for(let n=0;n<t;n++)i[n]=n}}function w0(l){const e=sa(l),t=l.drawRange,s=t.start/3,i=(t.start+t.count)/3,n=Math.max(0,s),r=Math.min(e,i)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function C0(l){if(!l.groups||!l.groups.length)return w0(l);const e=[],t=new Set,s=l.drawRange,i=s.start/3,n=(s.start+s.count)/3;for(const o of l.groups){const a=o.start/3,h=(o.start+o.count)/3;t.add(Math.max(i,a)),t.add(Math.min(n,h))}const r=Array.from(t.values()).sort((o,a)=>o-a);for(let o=0;o<r.length-1;o++){const a=r[o],h=r[o+1];e.push({offset:Math.floor(a),count:Math.floor(h-a)})}return e}function rb(l){if(l.groups.length===0)return!1;const e=sa(l),t=C0(l).sort((n,r)=>n.offset-r.offset),s=t[t.length-1];s.count=Math.min(e-s.offset,s.count);let i=0;return t.forEach(({count:n})=>i+=n),e!==i}function Vt(l,e,t){return t.min.x=e[l],t.min.y=e[l+1],t.min.z=e[l+2],t.max.x=e[l+3],t.max.y=e[l+4],t.max.z=e[l+5],t}function ob(l){l[0]=l[1]=l[2]=1/0,l[3]=l[4]=l[5]=-1/0}function jp(l){let e=-1,t=-1/0;for(let s=0;s<3;s++){const i=l[s+3]-l[s];i>t&&(t=i,e=s)}return e}function Zp(l,e){e.set(l)}function Xp(l,e,t){let s,i;for(let n=0;n<3;n++){const r=n+3;s=l[n],i=e[n],t[n]=s<i?s:i,s=l[r],i=e[r],t[r]=s>i?s:i}}function Yl(l,e,t){for(let s=0;s<3;s++){const i=e[l+2*s],n=e[l+2*s+1],r=i-n,o=i+n;r<t[s]&&(t[s]=r),o>t[s+3]&&(t[s+3]=o)}}function Ea(l){const e=l[3]-l[0],t=l[4]-l[1],s=l[5]-l[2];return 2*(e*t+t*s+s*e)}function _u(l,e,t,s,i=null){let n=1/0,r=1/0,o=1/0,a=-1/0,h=-1/0,c=-1/0,d=1/0,u=1/0,f=1/0,m=-1/0,p=-1/0,g=-1/0;const E=i!==null;for(let I=e*6,v=(e+t)*6;I<v;I+=6){const b=l[I+0],C=l[I+1],F=b-C,A=b+C;F<n&&(n=F),A>a&&(a=A),E&&b<d&&(d=b),E&&b>m&&(m=b);const R=l[I+2],O=l[I+3],L=R-O,k=R+O;L<r&&(r=L),k>h&&(h=k),E&&R<u&&(u=R),E&&R>p&&(p=R);const x=l[I+4],M=l[I+5],w=x-M,G=x+M;w<o&&(o=w),G>c&&(c=G),E&&x<f&&(f=x),E&&x>g&&(g=x)}s[0]=n,s[1]=r,s[2]=o,s[3]=a,s[4]=h,s[5]=c,E&&(i[0]=d,i[1]=u,i[2]=f,i[3]=m,i[4]=p,i[5]=g)}function ab(l,e,t,s){let i=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,h=-1/0;for(let c=e*6,d=(e+t)*6;c<d;c+=6){const u=l[c+0];u<i&&(i=u),u>o&&(o=u);const f=l[c+2];f<n&&(n=f),f>a&&(a=f);const m=l[c+4];m<r&&(r=m),m>h&&(h=m)}s[0]=i,s[1]=n,s[2]=r,s[3]=o,s[4]=a,s[5]=h}function lb(l,e){ob(e);const t=l.attributes.position,s=l.index?l.index.array:null,i=sa(l),n=new Float32Array(i*6),r=t.normalized,o=t.array,a=t.offset||0;let h=3;t.isInterleavedBufferAttribute&&(h=t.data.stride);const c=["getX","getY","getZ"];for(let d=0;d<i;d++){const u=d*3,f=d*6;let m=u+0,p=u+1,g=u+2;s&&(m=s[m],p=s[p],g=s[g]),r||(m=m*h+a,p=p*h+a,g=g*h+a);for(let E=0;E<3;E++){let I,v,b;r?(I=t[c[E]](m),v=t[c[E]](p),b=t[c[E]](g)):(I=o[m+E],v=o[p+E],b=o[g+E]);let C=I;v<C&&(C=v),b<C&&(C=b);let F=I;v>F&&(F=v),b>F&&(F=b);const A=(F-C)/2,R=E*2;n[f+R+0]=C+A,n[f+R+1]=A+(Math.abs(C)+A)*tb,C<e[E]&&(e[E]=C),F>e[E+3]&&(e[E+3]=F)}}return n}const Ji=32,hb=(l,e)=>l.candidate-e.candidate,vn=new Array(Ji).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Gl=new Float32Array(6);function cb(l,e,t,s,i,n){let r=-1,o=0;if(n===y0)r=jp(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(n===$I)r=jp(l),r!==-1&&(o=ub(t,s,i,r));else if(n===eb){const a=Ea(l);let h=Cu*i;const c=s*6,d=(s+i)*6;for(let u=0;u<3;u++){const f=e[u],m=(e[u+3]-f)/Ji;if(i<Ji/4){const p=[...vn];p.length=i;let g=0;for(let I=c;I<d;I+=6,g++){const v=p[g];v.candidate=t[I+2*u],v.count=0;const{bounds:b,leftCacheBounds:C,rightCacheBounds:F}=v;for(let A=0;A<3;A++)F[A]=1/0,F[A+3]=-1/0,C[A]=1/0,C[A+3]=-1/0,b[A]=1/0,b[A+3]=-1/0;Yl(I,t,b)}p.sort(hb);let E=i;for(let I=0;I<E;I++){const v=p[I];for(;I+1<E&&p[I+1].candidate===v.candidate;)p.splice(I+1,1),E--}for(let I=c;I<d;I+=6){const v=t[I+2*u];for(let b=0;b<E;b++){const C=p[b];v>=C.candidate?Yl(I,t,C.rightCacheBounds):(Yl(I,t,C.leftCacheBounds),C.count++)}}for(let I=0;I<E;I++){const v=p[I],b=v.count,C=i-v.count,F=v.leftCacheBounds,A=v.rightCacheBounds;let R=0;b!==0&&(R=Ea(F)/a);let O=0;C!==0&&(O=Ea(A)/a);const L=Wp+Cu*(R*b+O*C);L<h&&(r=u,h=L,o=v.candidate)}}else{for(let E=0;E<Ji;E++){const I=vn[E];I.count=0,I.candidate=f+m+E*m;const v=I.bounds;for(let b=0;b<3;b++)v[b]=1/0,v[b+3]=-1/0}for(let E=c;E<d;E+=6){let I=~~((t[E+2*u]-f)/m);I>=Ji&&(I=Ji-1);const v=vn[I];v.count++,Yl(E,t,v.bounds)}const p=vn[Ji-1];Zp(p.bounds,p.rightCacheBounds);for(let E=Ji-2;E>=0;E--){const I=vn[E],v=vn[E+1];Xp(I.bounds,v.rightCacheBounds,I.rightCacheBounds)}let g=0;for(let E=0;E<Ji-1;E++){const I=vn[E],v=I.count,b=I.bounds,C=vn[E+1].rightCacheBounds;v!==0&&(g===0?Zp(b,Gl):Xp(b,Gl,Gl)),g+=v;let F=0,A=0;g!==0&&(F=Ea(Gl)/a);const R=i-g;R!==0&&(A=Ea(C)/a);const O=Wp+Cu*(F*g+A*R);O<h&&(r=u,h=O,o=I.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function ub(l,e,t,s){let i=0;for(let n=e,r=e+t;n<r;n++)i+=l[n*6+s*2];return i/t}let Hl=class{constructor(){}};function db(l,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,h=n.axis*2;for(;;){for(;r<=o&&t[r*6+h]<a;)r++;for(;r<=o&&t[o*6+h]>=a;)o--;if(r<o){for(let c=0;c<3;c++){let d=e[r*3+c];e[r*3+c]=e[o*3+c],e[o*3+c]=d}for(let c=0;c<6;c++){let d=t[r*6+c];t[r*6+c]=t[o*6+c],t[o*6+c]=d}r++,o--}else return r}}function fb(l,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,h=n.axis*2;for(;;){for(;r<=o&&t[r*6+h]<a;)r++;for(;r<=o&&t[o*6+h]>=a;)o--;if(r<o){let c=l[r];l[r]=l[o],l[o]=c;for(let d=0;d<6;d++){let u=t[r*6+d];t[r*6+d]=t[o*6+d],t[o*6+d]=u}r++,o--}else return r}}function pb(l,e){const t=(l.index?l.index.count:l.attributes.position.count)/3,s=t>2**16,i=s?4:2,n=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=s?new Uint32Array(n):new Uint16Array(n);for(let o=0,a=r.length;o<a;o++)r[o]=o;return r}function mb(l,e){const t=l.geometry,s=t.index?t.index.array:null,i=e.maxDepth,n=e.verbose,r=e.maxLeafTris,o=e.strategy,a=e.onProgress,h=sa(t),c=l._indirectBuffer;let d=!1;const u=new Float32Array(6),f=new Float32Array(6),m=lb(t,u),p=e.indirect?fb:db,g=[],E=e.indirect?w0(t):C0(t);if(E.length===1){const b=E[0],C=new Hl;C.boundingData=u,ab(m,b.offset,b.count,f),v(C,b.offset,b.count,f),g.push(C)}else for(let b of E){const C=new Hl;C.boundingData=new Float32Array(6),_u(m,b.offset,b.count,C.boundingData,f),v(C,b.offset,b.count,f),g.push(C)}return g;function I(b){a&&a(b/h)}function v(b,C,F,A=null,R=0){if(!d&&R>=i&&(d=!0,n&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),F<=r||R>=i)return I(C+F),b.offset=C,b.count=F,b;const O=cb(b.boundingData,A,m,C,F,o);if(O.axis===-1)return I(C+F),b.offset=C,b.count=F,b;const L=p(c,s,m,C,F,O);if(L===C||L===C+F)I(C+F),b.offset=C,b.count=F;else{b.splitAxis=O.axis;const k=new Hl,x=C,M=L-C;b.left=k,k.boundingData=new Float32Array(6),_u(m,x,M,k.boundingData,f),v(k,x,M,f,R+1);const w=new Hl,G=L,J=F-M;b.right=w,w.boundingData=new Float32Array(6),_u(m,G,J,w.boundingData,f),v(w,G,J,f,R+1)}return b}}function gb(l,e){const t=l.geometry;e.indirect&&(l._indirectBuffer=pb(t,e.useSharedArrayBuffer),rb(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),l._indirectBuffer||nb(t,e);const s=mb(l,e);let i,n,r;const o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<s.length;d++){const u=s[d];let f=h(u);const m=new a(hc*f);i=new Float32Array(m),n=new Uint32Array(m),r=new Uint16Array(m),c(0,u),o.push(m)}l._roots=o;return;function h(d){return d.count?1:1+h(d.left)+h(d.right)}function c(d,u){const f=d/4,m=d/2,p=!!u.count,g=u.boundingData;for(let E=0;E<6;E++)i[f+E]=g[E];if(p){const E=u.offset,I=u.count;return n[f+6]=E,r[m+14]=I,r[m+15]=Pc,d+hc}else{const E=u.left,I=u.right,v=u.splitAxis;let b;if(b=c(d+hc,E),b/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[f+6]=b/4,b=c(b,I),n[f+7]=v,b}}}let dn=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const o=e[n][t];s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}setFromPoints(e,t){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=e.dot(o);s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}};dn.prototype.setFromBox=function(){const l=new U;return function(e,t){const s=t.min,i=t.max;let n=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let a=0;a<=1;a++)for(let h=0;h<=1;h++){l.x=s.x*o+i.x*(1-o),l.y=s.y*a+i.y*(1-a),l.z=s.z*h+i.z*(1-h);const c=e.dot(l);n=Math.min(c,n),r=Math.max(c,r)}this.min=n,this.max=r}}();const Eb=function(){const l=new U,e=new U,t=new U;return function(s,i,n){const r=s.start,o=l,a=i.start,h=e;t.subVectors(r,a),l.subVectors(s.end,s.start),e.subVectors(i.end,i.start);const c=t.dot(h),d=h.dot(o),u=h.dot(h),f=t.dot(o),m=o.dot(o)*u-d*d;let p,g;m!==0?p=(c*d-f*u)/m:p=0,g=(c+p*d)/u,n.x=p,n.y=g}}(),Zf=function(){const l=new lt,e=new U,t=new U;return function(s,i,n,r){Eb(s,i,l);let o=l.x,a=l.y;if(o>=0&&o<=1&&a>=0&&a<=1){s.at(o,n),i.at(a,r);return}else if(o>=0&&o<=1){a<0?i.at(0,r):i.at(1,r),s.closestPointToPoint(r,!0,n);return}else if(a>=0&&a<=1){o<0?s.at(0,n):s.at(1,n),i.closestPointToPoint(n,!0,r);return}else{let h;o<0?h=s.start:h=s.end;let c;a<0?c=i.start:c=i.end;const d=e,u=t;if(s.closestPointToPoint(c,!0,e),i.closestPointToPoint(h,!0,t),d.distanceToSquared(c)<=u.distanceToSquared(h)){n.copy(d),r.copy(c);return}else{n.copy(h),r.copy(u);return}}}}(),Ib=function(){const l=new U,e=new U,t=new _s,s=new Et;return function(i,n){const{radius:r,center:o}=i,{a,b:h,c}=n;if(s.start=a,s.end=h,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r||(s.start=a,s.end=c,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r)||(s.start=h,s.end=c,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r))return!0;const d=n.getPlane(t);if(Math.abs(d.distanceToPoint(o))<=r){const u=d.projectPoint(o,e);if(n.containsPoint(u))return!0}return!1}}(),bb=1e-15;function Tu(l){return Math.abs(l)<bb}class Ti extends cs{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new U),this.satBounds=new Array(4).fill().map(()=>new dn),this.points=[this.a,this.b,this.c],this.sphere=new pi,this.plane=new _s,this.needsUpdate=!0}intersectsSphere(e){return Ib(e,this)}update(){const e=this.a,t=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const h=n[1],c=r[1];h.subVectors(e,t),c.setFromPoints(h,i);const d=n[2],u=r[2];d.subVectors(t,s),u.setFromPoints(d,i);const f=n[3],m=r[3];f.subVectors(s,e),m.setFromPoints(f,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}Ti.prototype.closestPointToSegment=function(){const l=new U,e=new U,t=new Et;return function(s,i=null,n=null){const{start:r,end:o}=s,a=this.points;let h,c=1/0;for(let d=0;d<3;d++){const u=(d+1)%3;t.start.copy(a[d]),t.end.copy(a[u]),Zf(t,s,l,e),h=l.distanceToSquared(e),h<c&&(c=h,i&&i.copy(l),n&&n.copy(e))}return this.closestPointToPoint(r,l),h=r.distanceToSquared(l),h<c&&(c=h,i&&i.copy(l),n&&n.copy(r)),this.closestPointToPoint(o,l),h=o.distanceToSquared(l),h<c&&(c=h,i&&i.copy(l),n&&n.copy(o)),Math.sqrt(c)}}();Ti.prototype.intersectsTriangle=function(){const l=new Ti,e=new Array(3),t=new Array(3),s=new dn,i=new dn,n=new U,r=new U,o=new U,a=new U,h=new U,c=new Et,d=new Et,u=new Et,f=new U;function m(p,g,E){const I=p.points;let v=0,b=-1;for(let C=0;C<3;C++){const{start:F,end:A}=c;F.copy(I[C]),A.copy(I[(C+1)%3]),c.delta(r);const R=Tu(g.distanceToPoint(F));if(Tu(g.normal.dot(r))&&R){E.copy(c),v=2;break}const O=g.intersectLine(c,f);if(!O&&R&&f.copy(F),(O||R)&&!Tu(f.distanceTo(A))){if(v<=1)(v===1?E.start:E.end).copy(f),R&&(b=v);else if(v>=2){(b===1?E.start:E.end).copy(f),v=2;break}if(v++,v===2&&b===-1)break}}return v}return function(p,g=null,E=!1){this.needsUpdate&&this.update(),p.isExtendedTriangle?p.needsUpdate&&p.update():(l.copy(p),l.update(),p=l);const I=this.plane,v=p.plane;if(Math.abs(I.normal.dot(v.normal))>1-1e-10){const b=this.satBounds,C=this.satAxes;t[0]=p.a,t[1]=p.b,t[2]=p.c;for(let R=0;R<4;R++){const O=b[R],L=C[R];if(s.setFromPoints(L,t),O.isSeparated(s))return!1}const F=p.satBounds,A=p.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let R=0;R<4;R++){const O=F[R],L=A[R];if(s.setFromPoints(L,e),O.isSeparated(s))return!1}for(let R=0;R<4;R++){const O=C[R];for(let L=0;L<4;L++){const k=A[L];if(n.crossVectors(O,k),s.setFromPoints(n,e),i.setFromPoints(n,t),s.isSeparated(i))return!1}}return g&&(E||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}else{const b=m(this,v,d);if(b===1&&p.containsPoint(d.end))return g&&(g.start.copy(d.end),g.end.copy(d.end)),!0;if(b!==2)return!1;const C=m(p,I,u);if(C===1&&this.containsPoint(u.end))return g&&(g.start.copy(u.end),g.end.copy(u.end)),!0;if(C!==2)return!1;if(d.delta(o),u.delta(a),o.dot(a)<0){let x=u.start;u.start=u.end,u.end=x}const F=d.start.dot(o),A=d.end.dot(o),R=u.start.dot(o),O=u.end.dot(o),L=A<R,k=F<O;return F!==O&&R!==A&&L===k?!1:(g&&(h.subVectors(d.start,u.start),h.dot(o)>0?g.start.copy(d.start):g.start.copy(u.start),h.subVectors(d.end,u.end),h.dot(o)<0?g.end.copy(d.end):g.end.copy(u.end)),!0)}}}();Ti.prototype.distanceToPoint=function(){const l=new U;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();Ti.prototype.distanceToTriangle=function(){const l=new U,e=new U,t=["a","b","c"],s=new Et,i=new Et;return function(n,r=null,o=null){const a=r||o?s:null;if(this.intersectsTriangle(n,a))return(r||o)&&(r&&a.getCenter(r),o&&a.getCenter(o)),0;let h=1/0;for(let c=0;c<3;c++){let d;const u=t[c],f=n[u];this.closestPointToPoint(f,l),d=f.distanceToSquared(l),d<h&&(h=d,r&&r.copy(l),o&&o.copy(f));const m=this[u];n.closestPointToPoint(m,l),d=m.distanceToSquared(l),d<h&&(h=d,r&&r.copy(m),o&&o.copy(l))}for(let c=0;c<3;c++){const d=t[c],u=t[(c+1)%3];s.set(this[d],this[u]);for(let f=0;f<3;f++){const m=t[f],p=t[(f+1)%3];i.set(n[m],n[p]),Zf(s,i,l,e);const g=l.distanceToSquared(e);g<h&&(h=g,r&&r.copy(l),o&&o.copy(e))}}return Math.sqrt(h)}}();class Ps{constructor(e,t,s){this.isOrientedBox=!0,this.min=new U,this.max=new U,this.matrix=new Oe,this.invMatrix=new Oe,this.points=new Array(8).fill().map(()=>new U),this.satAxes=new Array(3).fill().map(()=>new U),this.satBounds=new Array(3).fill().map(()=>new dn),this.alignedSatBounds=new Array(3).fill().map(()=>new dn),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,s){this.min.copy(e),this.max.copy(t),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Ps.prototype.update=function(){return function(){const l=this.matrix,e=this.min,t=this.max,s=this.points;for(let a=0;a<=1;a++)for(let h=0;h<=1;h++)for(let c=0;c<=1;c++){const d=1*a|2*h|4*c,u=s[d];u.x=a?t.x:e.x,u.y=h?t.y:e.y,u.z=c?t.z:e.z,u.applyMatrix4(l)}const i=this.satBounds,n=this.satAxes,r=s[0];for(let a=0;a<3;a++){const h=n[a],c=i[a],d=1<<a,u=s[d];h.subVectors(r,u),c.setFromPoints(h,s)}const o=this.alignedSatBounds;o[0].setFromPointsField(s,"x"),o[1].setFromPointsField(s,"y"),o[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Ps.prototype.intersectsBox=function(){const l=new dn;return function(e){this.needsUpdate&&this.update();const t=e.min,s=e.max,i=this.satBounds,n=this.satAxes,r=this.alignedSatBounds;if(l.min=t.x,l.max=s.x,r[0].isSeparated(l)||(l.min=t.y,l.max=s.y,r[1].isSeparated(l))||(l.min=t.z,l.max=s.z,r[2].isSeparated(l)))return!1;for(let o=0;o<3;o++){const a=n[o],h=i[o];if(l.setFromBox(a,e),h.isSeparated(l))return!1}return!0}}();Ps.prototype.intersectsTriangle=function(){const l=new Ti,e=new Array(3),t=new dn,s=new dn,i=new U;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(l.copy(n),l.update(),n=l);const r=this.satBounds,o=this.satAxes;e[0]=n.a,e[1]=n.b,e[2]=n.c;for(let d=0;d<3;d++){const u=r[d],f=o[d];if(t.setFromPoints(f,e),u.isSeparated(t))return!1}const a=n.satBounds,h=n.satAxes,c=this.points;for(let d=0;d<3;d++){const u=a[d],f=h[d];if(t.setFromPoints(f,c),u.isSeparated(t))return!1}for(let d=0;d<3;d++){const u=o[d];for(let f=0;f<4;f++){const m=h[f];if(i.crossVectors(u,m),t.setFromPoints(i,e),s.setFromPoints(i,c),t.isSeparated(s))return!1}}return!0}}();Ps.prototype.closestPointToPoint=function(){return function(l,e){return this.needsUpdate&&this.update(),e.copy(l).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();Ps.prototype.distanceToPoint=function(){const l=new U;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();Ps.prototype.distanceToBox=function(){const l=["x","y","z"],e=new Array(12).fill().map(()=>new Et),t=new Array(12).fill().map(()=>new Et),s=new U,i=new U;return function(n,r=0,o=null,a=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(o||a)&&(n.getCenter(i),this.closestPointToPoint(i,s),n.closestPointToPoint(s,i),o&&o.copy(s),a&&a.copy(i)),0;const h=r*r,c=n.min,d=n.max,u=this.points;let f=1/0;for(let p=0;p<8;p++){const g=u[p];i.copy(g).clamp(c,d);const E=g.distanceToSquared(i);if(E<f&&(f=E,o&&o.copy(g),a&&a.copy(i),E<h))return Math.sqrt(E)}let m=0;for(let p=0;p<3;p++)for(let g=0;g<=1;g++)for(let E=0;E<=1;E++){const I=(p+1)%3,v=(p+2)%3,b=g<<I|E<<v,C=1<<p|g<<I|E<<v,F=u[b],A=u[C];e[m].set(F,A);const R=l[p],O=l[I],L=l[v],k=t[m],x=k.start,M=k.end;x[R]=c[R],x[O]=g?c[O]:d[O],x[L]=E?c[L]:d[O],M[R]=d[R],M[O]=g?c[O]:d[O],M[L]=E?c[L]:d[O],m++}for(let p=0;p<=1;p++)for(let g=0;g<=1;g++)for(let E=0;E<=1;E++){i.x=p?d.x:c.x,i.y=g?d.y:c.y,i.z=E?d.z:c.z,this.closestPointToPoint(i,s);const I=i.distanceToSquared(s);if(I<f&&(f=I,o&&o.copy(s),a&&a.copy(i),I<h))return Math.sqrt(I)}for(let p=0;p<12;p++){const g=e[p];for(let E=0;E<12;E++){const I=t[E];Zf(g,I,s,i);const v=s.distanceToSquared(i);if(v<f&&(f=v,o&&o.copy(s),a&&a.copy(i),v<h))return Math.sqrt(v)}}return Math.sqrt(f)}}();let Xf=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}},yb=class extends Xf{constructor(){super(()=>new Ti)}};const ei=new yb;function Ys(l,e){return e[l+15]===65535}function Ws(l,e){return e[l+6]}function ti(l,e){return e[l+14]}function si(l){return l+8}function ii(l,e){return e[l+6]}function v0(l,e){return e[l+7]}let wb=class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=s=>{t&&e.push(t),t=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}};const Nt=new wb;let Un,Fo;const Ur=[],Wl=new Xf(()=>new Qe);function Cb(l,e,t,s,i,n){Un=Wl.getPrimitive(),Fo=Wl.getPrimitive(),Ur.push(Un,Fo),Nt.setBuffer(l._roots[e]);const r=Ad(0,l.geometry,t,s,i,n);Nt.clearBuffer(),Wl.releasePrimitive(Un),Wl.releasePrimitive(Fo),Ur.pop(),Ur.pop();const o=Ur.length;return o>0&&(Fo=Ur[o-1],Un=Ur[o-2]),r}function Ad(l,e,t,s,i=null,n=0,r=0){const{float32Array:o,uint16Array:a,uint32Array:h}=Nt;let c=l*2;if(Ys(c,a)){const d=Ws(l,h),u=ti(c,a);return Vt(l,o,Un),s(d,u,!1,r,n+l,Un)}else{let d=function(k){const{uint16Array:x,uint32Array:M}=Nt;let w=k*2;for(;!Ys(w,x);)k=si(k),w=k*2;return Ws(k,M)},u=function(k){const{uint16Array:x,uint32Array:M}=Nt;let w=k*2;for(;!Ys(w,x);)k=ii(k,M),w=k*2;return Ws(k,M)+ti(w,x)};const f=si(l),m=ii(l,h);let p=f,g=m,E,I,v,b;if(i&&(v=Un,b=Fo,Vt(p,o,v),Vt(g,o,b),E=i(v),I=i(b),I<E)){p=m,g=f;const k=E;E=I,I=k,v=b}v||(v=Un,Vt(p,o,v));const C=Ys(p*2,a),F=t(v,C,E,r+1,n+p);let A;if(F===Hp){const k=d(p),x=u(p)-k;A=s(k,x,!0,r+1,n+p,v)}else A=F&&Ad(p,e,t,s,i,n,r+1);if(A)return!0;b=Fo,Vt(g,o,b);const R=Ys(g*2,a),O=t(b,R,I,r+1,n+g);let L;if(O===Hp){const k=d(g),x=u(g)-k;L=s(k,x,!0,r+1,n+g,b)}else L=O&&Ad(g,e,t,s,i,n,r+1);return!!L}}const Ia=new U,xu=new U;function vb(l,e,t={},s=0,i=1/0){const n=s*s,r=i*i;let o=1/0,a=null;if(l.shapecast({boundsTraverseOrder:c=>(Ia.copy(e).clamp(c.min,c.max),Ia.distanceToSquared(e)),intersectsBounds:(c,d,u)=>u<o&&u<r,intersectsTriangle:(c,d)=>{c.closestPointToPoint(e,Ia);const u=e.distanceToSquared(Ia);return u<o&&(xu.copy(Ia),o=u,a=d),u<n}}),o===1/0)return null;const h=Math.sqrt(o);return t.point?t.point.copy(xu):t.point=xu.clone(),t.distance=h,t.faceIndex=a,t}const Br=new U,zr=new U,kr=new U,jl=new lt,Zl=new lt,Xl=new lt,Kp=new U,Qp=new U,qp=new U,Kl=new U;function _b(l,e,t,s,i,n){let r;return n===kf?r=l.intersectTriangle(s,t,e,!0,i):r=l.intersectTriangle(e,t,s,n!==Fi,i),r===null?null:{distance:l.origin.distanceTo(i),point:i.clone()}}function Tb(l,e,t,s,i,n,r,o,a){Br.fromBufferAttribute(e,n),zr.fromBufferAttribute(e,r),kr.fromBufferAttribute(e,o);const h=_b(l,Br,zr,kr,Kl,a);if(h){s&&(jl.fromBufferAttribute(s,n),Zl.fromBufferAttribute(s,r),Xl.fromBufferAttribute(s,o),h.uv=cs.getInterpolation(Kl,Br,zr,kr,jl,Zl,Xl,new lt)),i&&(jl.fromBufferAttribute(i,n),Zl.fromBufferAttribute(i,r),Xl.fromBufferAttribute(i,o),h.uv1=cs.getInterpolation(Kl,Br,zr,kr,jl,Zl,Xl,new lt)),t&&(Kp.fromBufferAttribute(t,n),Qp.fromBufferAttribute(t,r),qp.fromBufferAttribute(t,o),h.normal=cs.getInterpolation(Kl,Br,zr,kr,Kp,Qp,qp,new U),h.normal.dot(l.direction)>0&&h.normal.multiplyScalar(-1));const c={a:n,b:r,c:o,normal:new U,materialIndex:0};cs.getNormal(Br,zr,kr,c.normal),h.face=c,h.faceIndex=n}return h}function Mc(l,e,t,s,i){const n=s*3;let r=n+0,o=n+1,a=n+2;const h=l.index;l.index&&(r=h.getX(r),o=h.getX(o),a=h.getX(a));const{position:c,normal:d,uv:u,uv1:f}=l.attributes,m=Tb(t,c,d,u,f,r,o,a,e);return m?(m.faceIndex=s,i&&i.push(m),m):null}function $t(l,e,t,s){const i=l.a,n=l.b,r=l.c;let o=e,a=e+1,h=e+2;t&&(o=t.getX(o),a=t.getX(a),h=t.getX(h)),i.x=s.getX(o),i.y=s.getY(o),i.z=s.getZ(o),n.x=s.getX(a),n.y=s.getY(a),n.z=s.getZ(a),r.x=s.getX(h),r.y=s.getY(h),r.z=s.getZ(h)}function xb(l,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=s,h=s+i;a<h;a++)Mc(r,e,t,a,n)}function Ab(l,e,t,s,i){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let h=s,c=s+i;h<c;h++){let d;d=Mc(n,e,t,h),d&&d.distance<o&&(a=d,o=d.distance)}return a}function Fb(l,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,h=o.attributes.position;for(let c=l,d=e+l;c<d;c++){let u;if(u=c,$t(r,u*3,a,h),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}function Rb(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,h=0;const c=l._roots;for(let u=0,f=c.length;u<f;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),d(0,h),h+=n.byteLength;function d(u,f,m=!1){const p=u*2;if(o[p+15]===Pc){const g=r[u+6],E=o[p+14];let I=1/0,v=1/0,b=1/0,C=-1/0,F=-1/0,A=-1/0;for(let R=3*g,O=3*(g+E);R<O;R++){let L=s[R];const k=i.getX(L),x=i.getY(L),M=i.getZ(L);k<I&&(I=k),k>C&&(C=k),x<v&&(v=x),x>F&&(F=x),M<b&&(b=M),M>A&&(A=M)}return a[u+0]!==I||a[u+1]!==v||a[u+2]!==b||a[u+3]!==C||a[u+4]!==F||a[u+5]!==A?(a[u+0]=I,a[u+1]=v,a[u+2]=b,a[u+3]=C,a[u+4]=F,a[u+5]=A,!0):!1}else{const g=u+8,E=r[u+6],I=g+f,v=E+f;let b=m,C=!1,F=!1;e?b||(C=e.has(I),F=e.has(v),b=!C&&!F):(C=!0,F=!0);const A=b||C,R=b||F;let O=!1;A&&(O=d(g,f,b));let L=!1;R&&(L=d(E,f,b));const k=O||L;if(k)for(let x=0;x<3;x++){const M=g+x,w=E+x,G=a[M],J=a[M+3],Z=a[w],le=a[w+3];a[u+x]=G<Z?G:Z,a[u+x+3]=J>le?J:le}return k}}}const Jp=new Qe;function Yn(l,e,t,s){return Vt(l,e,Jp),t.intersectBox(Jp,s)}function Sb(l,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=s,h=s+i;a<h;a++){let c=o?o[a]:a;Mc(r,e,t,c,n)}}function Ob(l,e,t,s,i){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let h=s,c=s+i;h<c;h++){let d;d=Mc(n,e,t,r?r[h]:h),d&&d.distance<o&&(a=d,o=d.distance)}return a}function Pb(l,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,h=o.attributes.position;for(let c=l,d=e+l;c<d;c++){let u;if(u=t.resolveTriangleIndex(c),$t(r,u*3,a,h),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}const $p=new U;function Mb(l,e,t,s,i){Nt.setBuffer(l._roots[e]),Fd(0,l,t,s,i),Nt.clearBuffer()}function Fd(l,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Nt,a=l*2;if(Ys(a,r)){const h=Ws(l,o),c=ti(a,r);xb(e,t,s,h,c,i)}else{const h=si(l);Yn(h,n,s,$p)&&Fd(h,e,t,s,i);const c=ii(l,o);Yn(c,n,s,$p)&&Fd(c,e,t,s,i)}}const em=new U,Nb=["x","y","z"];function Db(l,e,t,s){Nt.setBuffer(l._roots[e]);const i=Rd(0,l,t,s);return Nt.clearBuffer(),i}function Rd(l,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=Nt;let o=l*2;if(Ys(o,n)){const a=Ws(l,r),h=ti(o,n);return Ab(e,t,s,a,h)}else{const a=v0(l,r),h=Nb[a],c=s.direction[h]>=0;let d,u;c?(d=si(l),u=ii(l,r)):(d=ii(l,r),u=si(l));const f=Yn(d,i,s,em)?Rd(d,e,t,s):null;if(f){const p=f.point[h];if(c?p<=i[u+a]:p>=i[u+a+3])return f}const m=Yn(u,i,s,em)?Rd(u,e,t,s):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}const Ql=new Qe,Vr=new Ti,Yr=new Ti,ba=new Oe,tm=new Ps,ql=new Ps;function Lb(l,e,t,s){Nt.setBuffer(l._roots[e]);const i=Sd(0,l,t,s);return Nt.clearBuffer(),i}function Sd(l,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=Nt;let a=l*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),tm.set(t.boundingBox.min,t.boundingBox.max,s),i=tm),Ys(a,r)){const h=e.geometry,c=h.index,d=h.attributes.position,u=t.index,f=t.attributes.position,m=Ws(l,o),p=ti(a,r);if(ba.copy(s).invert(),t.boundsTree)return Vt(l,n,ql),ql.matrix.copy(ba),ql.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>ql.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(s),g.b.applyMatrix4(s),g.c.applyMatrix4(s),g.needsUpdate=!0;for(let E=m*3,I=(p+m)*3;E<I;E+=3)if($t(Yr,E,c,d),Yr.needsUpdate=!0,g.intersectsTriangle(Yr))return!0;return!1}});for(let g=m*3,E=(p+m)*3;g<E;g+=3){$t(Vr,g,c,d),Vr.a.applyMatrix4(ba),Vr.b.applyMatrix4(ba),Vr.c.applyMatrix4(ba),Vr.needsUpdate=!0;for(let I=0,v=u.count;I<v;I+=3)if($t(Yr,I,u,f),Yr.needsUpdate=!0,Vr.intersectsTriangle(Yr))return!0}}else{const h=l+8,c=o[l+6];return Vt(h,n,Ql),!!(i.intersectsBox(Ql)&&Sd(h,e,t,s,i)||(Vt(c,n,Ql),i.intersectsBox(Ql)&&Sd(c,e,t,s,i)))}}const Jl=new Oe,Au=new Ps,ya=new Ps,Ub=new U,Bb=new U,zb=new U,kb=new U;function Vb(l,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Au.set(e.boundingBox.min,e.boundingBox.max,t),Au.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,h=o.index,c=e.attributes.position,d=e.index,u=ei.getPrimitive(),f=ei.getPrimitive();let m=Ub,p=Bb,g=null,E=null;i&&(g=zb,E=kb);let I=1/0,v=null,b=null;return Jl.copy(t).invert(),ya.matrix.copy(Jl),l.shapecast({boundsTraverseOrder:C=>Au.distanceToBox(C),intersectsBounds:(C,F,A)=>A<I&&A<r?(F&&(ya.min.copy(C.min),ya.max.copy(C.max),ya.needsUpdate=!0),!0):!1,intersectsRange:(C,F)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:A=>ya.distanceToBox(A),intersectsBounds:(A,R,O)=>O<I&&O<r,intersectsRange:(A,R)=>{for(let O=A,L=A+R;O<L;O++){$t(f,3*O,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let k=C,x=C+F;k<x;k++){$t(u,3*k,h,a),u.needsUpdate=!0;const M=u.distanceToTriangle(f,m,g);if(M<I&&(p.copy(m),E&&E.copy(g),I=M,v=k,b=O),M<n)return!0}}}});{const A=sa(e);for(let R=0,O=A;R<O;R++){$t(f,3*R,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let L=C,k=C+F;L<k;L++){$t(u,3*L,h,a),u.needsUpdate=!0;const x=u.distanceToTriangle(f,m,g);if(x<I&&(p.copy(m),E&&E.copy(g),I=x,v=L,b=R),x<n)return!0}}}}}),ei.releasePrimitive(u),ei.releasePrimitive(f),I===1/0?null:(s.point?s.point.copy(p):s.point=p.clone(),s.distance=I,s.faceIndex=v,i&&(i.point?i.point.copy(E):i.point=E.clone(),i.point.applyMatrix4(Jl),p.applyMatrix4(Jl),i.distance=p.sub(i.point).length(),i.faceIndex=b),s)}function Yb(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,h=0;const c=l._roots;for(let u=0,f=c.length;u<f;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),d(0,h),h+=n.byteLength;function d(u,f,m=!1){const p=u*2;if(o[p+15]===Pc){const g=r[u+6],E=o[p+14];let I=1/0,v=1/0,b=1/0,C=-1/0,F=-1/0,A=-1/0;for(let R=g,O=g+E;R<O;R++){const L=3*l.resolveTriangleIndex(R);for(let k=0;k<3;k++){let x=L+k;x=s?s[x]:x;const M=i.getX(x),w=i.getY(x),G=i.getZ(x);M<I&&(I=M),M>C&&(C=M),w<v&&(v=w),w>F&&(F=w),G<b&&(b=G),G>A&&(A=G)}}return a[u+0]!==I||a[u+1]!==v||a[u+2]!==b||a[u+3]!==C||a[u+4]!==F||a[u+5]!==A?(a[u+0]=I,a[u+1]=v,a[u+2]=b,a[u+3]=C,a[u+4]=F,a[u+5]=A,!0):!1}else{const g=u+8,E=r[u+6],I=g+f,v=E+f;let b=m,C=!1,F=!1;e?b||(C=e.has(I),F=e.has(v),b=!C&&!F):(C=!0,F=!0);const A=b||C,R=b||F;let O=!1;A&&(O=d(g,f,b));let L=!1;R&&(L=d(E,f,b));const k=O||L;if(k)for(let x=0;x<3;x++){const M=g+x,w=E+x,G=a[M],J=a[M+3],Z=a[w],le=a[w+3];a[u+x]=G<Z?G:Z,a[u+x+3]=J>le?J:le}return k}}}const sm=new U;function Gb(l,e,t,s,i){Nt.setBuffer(l._roots[e]),Od(0,l,t,s,i),Nt.clearBuffer()}function Od(l,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Nt,a=l*2;if(Ys(a,r)){const h=Ws(l,o),c=ti(a,r);Sb(e,t,s,h,c,i)}else{const h=si(l);Yn(h,n,s,sm)&&Od(h,e,t,s,i);const c=ii(l,o);Yn(c,n,s,sm)&&Od(c,e,t,s,i)}}const im=new U,Hb=["x","y","z"];function Wb(l,e,t,s){Nt.setBuffer(l._roots[e]);const i=Pd(0,l,t,s);return Nt.clearBuffer(),i}function Pd(l,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=Nt;let o=l*2;if(Ys(o,n)){const a=Ws(l,r),h=ti(o,n);return Ob(e,t,s,a,h)}else{const a=v0(l,r),h=Hb[a],c=s.direction[h]>=0;let d,u;c?(d=si(l),u=ii(l,r)):(d=ii(l,r),u=si(l));const f=Yn(d,i,s,im)?Pd(d,e,t,s):null;if(f){const p=f.point[h];if(c?p<=i[u+a]:p>=i[u+a+3])return f}const m=Yn(u,i,s,im)?Pd(u,e,t,s):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}const $l=new Qe,Gr=new Ti,Hr=new Ti,wa=new Oe,nm=new Ps,eh=new Ps;function jb(l,e,t,s){Nt.setBuffer(l._roots[e]);const i=Md(0,l,t,s);return Nt.clearBuffer(),i}function Md(l,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=Nt;let a=l*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),nm.set(t.boundingBox.min,t.boundingBox.max,s),i=nm),Ys(a,r)){const h=e.geometry,c=h.index,d=h.attributes.position,u=t.index,f=t.attributes.position,m=Ws(l,o),p=ti(a,r);if(wa.copy(s).invert(),t.boundsTree)return Vt(l,n,eh),eh.matrix.copy(wa),eh.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>eh.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(s),g.b.applyMatrix4(s),g.c.applyMatrix4(s),g.needsUpdate=!0;for(let E=m,I=p+m;E<I;E++)if($t(Hr,3*e.resolveTriangleIndex(E),c,d),Hr.needsUpdate=!0,g.intersectsTriangle(Hr))return!0;return!1}});for(let g=m,E=p+m;g<E;g++){const I=e.resolveTriangleIndex(g);$t(Gr,3*I,c,d),Gr.a.applyMatrix4(wa),Gr.b.applyMatrix4(wa),Gr.c.applyMatrix4(wa),Gr.needsUpdate=!0;for(let v=0,b=u.count;v<b;v+=3)if($t(Hr,v,u,f),Hr.needsUpdate=!0,Gr.intersectsTriangle(Hr))return!0}}else{const h=l+8,c=o[l+6];return Vt(h,n,$l),!!(i.intersectsBox($l)&&Md(h,e,t,s,i)||(Vt(c,n,$l),i.intersectsBox($l)&&Md(c,e,t,s,i)))}}const th=new Oe,Fu=new Ps,Ca=new Ps,Zb=new U,Xb=new U,Kb=new U,Qb=new U;function qb(l,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Fu.set(e.boundingBox.min,e.boundingBox.max,t),Fu.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,h=o.index,c=e.attributes.position,d=e.index,u=ei.getPrimitive(),f=ei.getPrimitive();let m=Zb,p=Xb,g=null,E=null;i&&(g=Kb,E=Qb);let I=1/0,v=null,b=null;return th.copy(t).invert(),Ca.matrix.copy(th),l.shapecast({boundsTraverseOrder:C=>Fu.distanceToBox(C),intersectsBounds:(C,F,A)=>A<I&&A<r?(F&&(Ca.min.copy(C.min),Ca.max.copy(C.max),Ca.needsUpdate=!0),!0):!1,intersectsRange:(C,F)=>{if(e.boundsTree){const A=e.boundsTree;return A.shapecast({boundsTraverseOrder:R=>Ca.distanceToBox(R),intersectsBounds:(R,O,L)=>L<I&&L<r,intersectsRange:(R,O)=>{for(let L=R,k=R+O;L<k;L++){const x=A.resolveTriangleIndex(L);$t(f,3*x,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let M=C,w=C+F;M<w;M++){const G=l.resolveTriangleIndex(M);$t(u,3*G,h,a),u.needsUpdate=!0;const J=u.distanceToTriangle(f,m,g);if(J<I&&(p.copy(m),E&&E.copy(g),I=J,v=M,b=L),J<n)return!0}}}})}else{const A=sa(e);for(let R=0,O=A;R<O;R++){$t(f,3*R,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let L=C,k=C+F;L<k;L++){const x=l.resolveTriangleIndex(L);$t(u,3*x,h,a),u.needsUpdate=!0;const M=u.distanceToTriangle(f,m,g);if(M<I&&(p.copy(m),E&&E.copy(g),I=M,v=L,b=R),M<n)return!0}}}}}),ei.releasePrimitive(u),ei.releasePrimitive(f),I===1/0?null:(s.point?s.point.copy(p):s.point=p.clone(),s.distance=I,s.faceIndex=v,i&&(i.point?i.point.copy(E):i.point=E.clone(),i.point.applyMatrix4(th),p.applyMatrix4(th),i.distance=p.sub(i.point).length(),i.faceIndex=b),s)}function Jb(){return typeof SharedArrayBuffer<"u"}const nl=new Nt.constructor,vc=new Nt.constructor,Pn=new Xf(()=>new Qe),Wr=new Qe,jr=new Qe,Ru=new Qe,Su=new Qe;let Ou=!1;function $b(l,e,t,s){if(Ou)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Ou=!0;const i=l._roots,n=e._roots;let r,o=0,a=0;const h=new Oe().copy(t).invert();for(let c=0,d=i.length;c<d;c++){nl.setBuffer(i[c]),a=0;const u=Pn.getPrimitive();Vt(0,nl.float32Array,u),u.applyMatrix4(h);for(let f=0,m=n.length;f<m&&(vc.setBuffer(n[c]),r=Ii(0,0,t,h,s,o,a,0,0,u),vc.clearBuffer(),a+=n[f].length,!r);f++);if(Pn.releasePrimitive(u),nl.clearBuffer(),o+=i[c].length,r)break}return Ou=!1,r}function Ii(l,e,t,s,i,n=0,r=0,o=0,a=0,h=null,c=!1){let d,u;c?(d=vc,u=nl):(d=nl,u=vc);const f=d.float32Array,m=d.uint32Array,p=d.uint16Array,g=u.float32Array,E=u.uint32Array,I=u.uint16Array,v=l*2,b=e*2,C=Ys(v,p),F=Ys(b,I);let A=!1;if(F&&C)c?A=i(Ws(e,E),ti(e*2,I),Ws(l,m),ti(l*2,p),a,r+e,o,n+l):A=i(Ws(l,m),ti(l*2,p),Ws(e,E),ti(e*2,I),o,n+l,a,r+e);else if(F){const R=Pn.getPrimitive();Vt(e,g,R),R.applyMatrix4(t);const O=si(l),L=ii(l,m);Vt(O,f,Wr),Vt(L,f,jr);const k=R.intersectsBox(Wr),x=R.intersectsBox(jr);A=k&&Ii(e,O,s,t,i,r,n,a,o+1,R,!c)||x&&Ii(e,L,s,t,i,r,n,a,o+1,R,!c),Pn.releasePrimitive(R)}else{const R=si(e),O=ii(e,E);Vt(R,g,Ru),Vt(O,g,Su);const L=h.intersectsBox(Ru),k=h.intersectsBox(Su);if(L&&k)A=Ii(l,R,t,s,i,n,r,o,a+1,h,c)||Ii(l,O,t,s,i,n,r,o,a+1,h,c);else if(L)if(C)A=Ii(l,R,t,s,i,n,r,o,a+1,h,c);else{const x=Pn.getPrimitive();x.copy(Ru).applyMatrix4(t);const M=si(l),w=ii(l,m);Vt(M,f,Wr),Vt(w,f,jr);const G=x.intersectsBox(Wr),J=x.intersectsBox(jr);A=G&&Ii(R,M,s,t,i,r,n,a,o+1,x,!c)||J&&Ii(R,w,s,t,i,r,n,a,o+1,x,!c),Pn.releasePrimitive(x)}else if(k)if(C)A=Ii(l,O,t,s,i,n,r,o,a+1,h,c);else{const x=Pn.getPrimitive();x.copy(Su).applyMatrix4(t);const M=si(l),w=ii(l,m);Vt(M,f,Wr),Vt(w,f,jr);const G=x.intersectsBox(Wr),J=x.intersectsBox(jr);A=G&&Ii(O,M,s,t,i,r,n,a,o+1,x,!c)||J&&Ii(O,w,s,t,i,r,n,a,o+1,x,!c),Pn.releasePrimitive(x)}}return A}const sh=new Ps,rm=new Qe;let ey=class _0{static serialize(e,t={}){t={cloneBuffers:!0,...t};const s=e.geometry,i=e._roots,n=e._indirectBuffer,r=s.getIndex();let o;return t.cloneBuffers?o={roots:i.map(a=>a.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:i,index:r.array,indirectBuffer:n},o}static deserialize(e,t,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:i,roots:n,indirectBuffer:r}=e,o=new _0(t,{...s,[vu]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const a=t.getIndex();if(a===null){const h=new Rt(e.index,1,!1);t.setIndex(h)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:y0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[vu]:!1},t),t.useSharedArrayBuffer&&!Jb())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[vu]||(gb(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Qe)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=t.indirect?i=>s[i]:i=>i}refit(e=null){return(this.indirect?Yb:Rb)(this,e)}traverse(e,t=0){const s=this._roots[t],i=new Uint32Array(s),n=new Uint16Array(s);r(0);function r(o,a=0){const h=o*2,c=n[h+15]===Pc;if(c){const d=i[o+6],u=n[h+14];e(a,c,new Float32Array(s,o*4,6),d,u)}else{const d=o+hc/4,u=i[o+6],f=i[o+7];e(a,c,new Float32Array(s,o*4,6),f)||(r(d,a+1),r(u,a+1))}}}raycast(e,t=Do){const s=this._roots,i=this.geometry,n=[],r=t.isMaterial,o=Array.isArray(t),a=i.groups,h=r?t.side:t,c=this.indirect?Gb:Mb;for(let d=0,u=s.length;d<u;d++){const f=o?t[a[d].materialIndex].side:h,m=n.length;if(c(this,d,f,e,n),o){const p=a[d].materialIndex;for(let g=m,E=n.length;g<E;g++)n[g].face.materialIndex=p}}return n}raycastFirst(e,t=Do){const s=this._roots,i=this.geometry,n=t.isMaterial,r=Array.isArray(t);let o=null;const a=i.groups,h=n?t.side:t,c=this.indirect?Wb:Db;for(let d=0,u=s.length;d<u;d++){const f=r?t[a[d].materialIndex].side:h,m=c(this,d,f,e);m!=null&&(o==null||m.distance<o.distance)&&(o=m,r&&(m.face.materialIndex=a[d].materialIndex))}return o}intersectsGeometry(e,t){let s=!1;const i=this._roots,n=this.indirect?jb:Lb;for(let r=0,o=i.length;r<o&&(s=n(this,r,e,t),!s);r++);return s}shapecast(e){const t=ei.getPrimitive(),s=this.indirect?Pb:Fb;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const d=r;r=(u,f,m,p,g)=>d(u,f,m,p,g)?!0:s(u,f,this,o,m,p,t)}else r||(o?r=(d,u,f,m)=>s(d,u,this,o,f,m,t):r=(d,u,f)=>f);let a=!1,h=0;const c=this._roots;for(let d=0,u=c.length;d<u;d++){const f=c[d];if(a=Cb(this,d,n,r,i,h),a)break;h+=f.byteLength}return ei.releasePrimitive(t),a}bvhcast(e,t,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=ei.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,h=this.indirect?m=>{const p=this.resolveTriangleIndex(m);$t(r,p*3,o,a)}:m=>{$t(r,m*3,o,a)},c=ei.getPrimitive(),d=e.geometry.index,u=e.geometry.attributes.position,f=e.indirect?m=>{const p=e.resolveTriangleIndex(m);$t(c,p*3,d,u)}:m=>{$t(c,m*3,d,u)};if(n){const m=(p,g,E,I,v,b,C,F)=>{for(let A=E,R=E+I;A<R;A++){f(A),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let O=p,L=p+g;O<L;O++)if(h(O),r.needsUpdate=!0,n(r,c,O,A,v,b,C,F))return!0}return!1};if(i){const p=i;i=function(g,E,I,v,b,C,F,A){return p(g,E,I,v,b,C,F,A)?!0:m(g,E,I,v,b,C,F,A)}}else i=m}return $b(this,e,t,i)}intersectsBox(e,t){return sh.set(e.min,e.max,t),sh.needsUpdate=!0,this.shapecast({intersectsBounds:s=>sh.intersectsBox(s),intersectsTriangle:s=>sh.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,s={},i={},n=0,r=1/0){return(this.indirect?qb:Vb)(this,e,t,s,i,n,r)}closestPointToPoint(e,t={},s=0,i=1/0){return vb(this,e,t,s,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Vt(0,new Float32Array(t),rm),e.union(rm)}),e}};function om(l,e,t){return l===null||(l.point.applyMatrix4(e.matrixWorld),l.distance=l.point.distanceTo(t.ray.origin),l.object=e,l.distance<t.near||l.distance>t.far)?null:l}const Pu=new Vf,am=new Oe,ty=ye.prototype.raycast;function sy(l,e){if(this.geometry.boundsTree){if(this.material===void 0)return;am.copy(this.matrixWorld).invert(),Pu.copy(l.ray).applyMatrix4(am);const t=this.geometry.boundsTree;if(l.firstHitOnly===!0){const s=om(t.raycastFirst(Pu,this.material),this,l);s&&e.push(s)}else{const s=t.raycast(Pu,this.material);for(let i=0,n=s.length;i<n;i++){const r=om(s[i],this,l);r&&e.push(r)}}}else ty.call(this,l,e)}function iy(l){return this.boundsTree=new ey(this,l),this.boundsTree}function ny(){this.boundsTree=null}const T0=class Nd{static apply(e){Nd.initialized||(ft.prototype.computeBoundsTree=iy,ft.prototype.disposeBoundsTree=ny,ye.prototype.raycast=sy,Nd.initialized=!0),e.boundsTree||e.computeBoundsTree()}static dispose(e){e&&e.disposeBoundsTree&&e.disposeBoundsTree()}};We(T0,"initialized",!1);let lm=T0,wr=class x0{constructor(e,t,s){We(this,"ids",new Set),We(this,"itemToInstances",new Map),We(this,"instanceToItem",new Map),We(this,"hiddenItems",new Set),We(this,"id"),We(this,"mesh"),We(this,"capacity",0),We(this,"capacityOffset",10),We(this,"group"),We(this,"_originalColors",new Map),We(this,"_settingVisibility",!1),this.mesh=new cl(e,t,s,this),this.id=this.mesh.uuid,this.capacity=s,this.mesh.count=0,this.mesh.geometry.index.count&&lm.apply(this.mesh.geometry)}get uniqueVertices(){const e=[],t=this.mesh.geometry.getAttribute("position");if(!t)return e;const s=new Set;for(let i=0;i<t.count;i++){const n=t.getX(i),r=t.getY(i),o=t.getZ(i),a=`${n},${r},${o}`;s.has(a)||(s.add(a),e.push(new U(n,r,o)))}return e}dispose(e=!0){if(this.clear(),this.group=void 0,this._originalColors.clear(),this.mesh){if(e){for(const t of this.mesh.material)t.dispose();this.mesh.material=[],lm.dispose(this.mesh.geometry),this.mesh.geometry&&this.mesh.geometry.dispose(),this.mesh.geometry=null}this.mesh.removeFromParent(),this.mesh.userData={},this.mesh.dispose(),this.mesh.fragment=null,this.mesh=null}}get(e){const t=this.getInstancesIDs(e);if(!t)throw new Error("Item not found!");const s=[],i=[];for(const r of t){const o=new Oe;if(this.mesh.getMatrixAt(r,o),s.push(o),this.mesh.instanceColor){const a=new mt;this.mesh.getColorAt(r,a),i.push(a)}}const n=i.length?i:void 0;return{id:e,transforms:s,colors:n}}getItemID(e){return this.instanceToItem.get(e)||null}getInstancesIDs(e){return this.itemToInstances.get(e)||null}update(){this.mesh.instanceColor&&(this.mesh.instanceColor.needsUpdate=!0),this.mesh.instanceMatrix.needsUpdate=!0}add(e){var t;let s=0;for(const n of e)s+=n.transforms.length;const i=this.mesh.count+s;if(i>this.capacity){const n=i+this.capacityOffset,r=new cl(this.mesh.geometry,this.mesh.material,n,this);r.count=this.mesh.count,this.capacity=n;const o=this.mesh;(t=o.parent)==null||t.add(r),o.removeFromParent(),this.mesh=r;const a=new Oe;for(let h=0;h<o.instanceMatrix.count;h++)o.getMatrixAt(h,a),r.setMatrixAt(h,a);if(o.instanceColor){const h=new mt;for(let c=0;c<o.instanceColor.count;c++)o.getColorAt(c,h),r.setColorAt(c,h)}o.dispose()}for(let n=0;n<e.length;n++){const{transforms:r,colors:o,id:a}=e[n];this.itemToInstances.has(a)||this.itemToInstances.set(a,new Set);const h=this.itemToInstances.get(a);this.ids.add(a);for(let c=0;c<r.length;c++){const d=r[c],u=this.mesh.count;if(this.mesh.setMatrixAt(u,d),o){const f=o[c];this.mesh.setColorAt(u,f)}h.add(u),this.instanceToItem.set(u,a),this.mesh.count++}}this.update()}remove(e){if(this.mesh.count!==0){for(const t of e){const s=this.itemToInstances.get(t);if(s===void 0)throw new Error("Instances not found!");for(const i of s){if(this.mesh.count===0)throw new Error("Error with mesh count!");this.putLast(i),this.instanceToItem.delete(i),this.mesh.count--}this.itemToInstances.delete(t),this.ids.delete(t)}this.update()}}clear(){this.hiddenItems.clear(),this.ids.clear(),this.instanceToItem.clear(),this.itemToInstances.clear(),this.mesh.count=0}setVisibility(e,t=this.ids){if(!this._settingVisibility){if(this._settingVisibility=!0,e)for(const s of t){if(!this.ids.has(s)||!this.hiddenItems.has(s))continue;const i=this.itemToInstances.get(s);if(!i)throw new Error("Instances not found!");for(const n of new Set(i))this.mesh.count++,this.putLast(n);this.hiddenItems.delete(s)}else for(const s of t){if(!this.ids.has(s)||this.hiddenItems.has(s))continue;const i=this.itemToInstances.get(s);if(!i)throw new Error("Instances not found!");for(const n of new Set(i))this.putLast(n),this.mesh.count--;this.hiddenItems.add(s)}this.update(),this._settingVisibility=!1}}setColor(e,t=this.ids,s=!1){if(!this.mesh.instanceColor)throw new Error("This fragment doesn't have color per instance!");for(const i of t){if(!this.ids.has(i))continue;const n=this.itemToInstances.get(i);if(!n)throw new Error("Instances not found!");const r=this._originalColors.has(i);r||this._originalColors.set(i,new Map);const o=this._originalColors.get(i);for(const a of new Set(n)){if(!r){const h=new mt;this.mesh.getColorAt(a,h),o.set(a,h)}this.mesh.setColorAt(a,e),s&&o.set(a,e)}}this.mesh.instanceColor.needsUpdate=!0}resetColor(e=this.ids){if(!this.mesh.instanceColor)throw new Error("This fragment doesn't have color per instance!");for(const t of e){if(!this.ids.has(t))continue;const s=this.itemToInstances.get(t);if(!s)throw new Error("Instances not found!");const i=this._originalColors.get(t);if(i)for(const n of new Set(s)){const r=i.get(n);if(!r)throw new Error("Original color not found!");this.mesh.setColorAt(n,r)}}this.mesh.instanceColor.needsUpdate=!0}applyTransform(e,t){const s=new Oe;for(const i of e){const n=this.getInstancesIDs(i);if(n!==null)for(const r of n)this.mesh.getMatrixAt(r,s),s.premultiply(t),this.mesh.setMatrixAt(r,s)}this.update()}exportData(){const e=this.mesh.exportData(),t=Array.from(this.ids),s=this.id;return{...e,ids:t,id:s}}clone(e=this.ids){const t=new x0(this.mesh.geometry,this.mesh.material,this.capacity),s=[];for(const i of e){const n=this.getInstancesIDs(i);if(n===null)continue;const r=[],o=[];for(const a of n){const h=new Oe,c=new mt;this.mesh.getMatrixAt(a,h),this.mesh.getColorAt(a,c),r.push(h),o.push(c)}s.push({id:i,transforms:r,colors:o})}return t.add(s),t}putLast(e){if(this.mesh.count===0)return;const t=this.instanceToItem.get(e),s=this.mesh.count-1;if(s===e)return;const i=this.instanceToItem.get(s);if(t===void 0||i===void 0)throw new Error("Keys not found");if(t!==i){const o=this.itemToInstances.get(t),a=this.itemToInstances.get(i);if(!o||!a)throw new Error("Instances not found");if(!o.has(e)||!a.has(s))throw new Error("Malformed fragment structure");o.delete(e),a.delete(s),o.add(s),a.add(e),this.instanceToItem.set(e,i),this.instanceToItem.set(s,t)}const n=new Oe,r=new Oe;if(this.mesh.getMatrixAt(e,n),this.mesh.getMatrixAt(s,r),this.mesh.setMatrixAt(e,r),this.mesh.setMatrixAt(s,n),this.mesh.instanceColor!==null){const o=new mt,a=new mt;this.mesh.getColorAt(e,o),this.mesh.getColorAt(s,a),this.mesh.setColorAt(e,a),this.mesh.setColorAt(s,o);const h=this._originalColors.get(t);if(h){const d=h.get(e);d&&(h.delete(e),h.set(s,d))}const c=this._originalColors.get(i);if(c){const d=c.get(s);d&&(c.delete(s),c.set(e,d))}}}};const Mu=2,Yi=4,hn=4,Xs=4,Mn=new Int32Array(2),hm=new Float32Array(Mn.buffer),cm=new Float64Array(Mn.buffer),ih=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Dd;(function(l){l[l.UTF8_BYTES=1]="UTF8_BYTES",l[l.UTF16_STRING=2]="UTF16_STRING"})(Dd||(Dd={}));let ul=class A0{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new A0(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Mn[0]=this.readInt32(e),hm[0]}readFloat64(e){return Mn[ih?0:1]=this.readInt32(e),Mn[ih?1:0]=this.readInt32(e+4),cm[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){hm[0]=t,this.writeInt32(e,Mn[0])}writeFloat64(e,t){cm[0]=t,this.writeInt32(e,Mn[ih?0:1]),this.writeInt32(e+4,Mn[ih?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Yi+hn)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<hn;t++)e+=String.fromCharCode(this.readInt8(this.position_+Yi+t));return e}__offset(e,t){const s=e-this.readInt32(e);return t<this.readInt16(s)?this.readInt16(s+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const s=this.readInt32(e);e+=Yi;const i=this.bytes_.subarray(e,e+s);return t===Dd.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Yi}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=hn)throw new Error("FlatBuffers: file identifier must be length "+hn);for(let t=0;t<hn;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Yi+t))return!1;return!0}createScalarList(e,t){const s=[];for(let i=0;i<t;++i){const n=e(i);n!==null&&s.push(n)}return s}createObjList(e,t){const s=[];for(let i=0;i<t;++i){const n=e(i);n!==null&&s.push(n.unpack())}return s}},Kf=class F0{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let t;e?t=e:t=1024,this.bb=ul.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const s=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<s+e+t;){const i=this.bb.capacity();this.bb=F0.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(s)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,s){(this.force_defaults||t!=s)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,s){(this.force_defaults||t!=s)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,s){(this.force_defaults||t!=s)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,s){(this.force_defaults||t!==s)&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,s){(this.force_defaults||t!=s)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,s){(this.force_defaults||t!=s)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,s){(this.force_defaults||t!=s)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,s){t!=s&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const s=t<<1,i=ul.allocate(s);return i.setPosition(s-t),i.bytes().set(e.bytes(),s-t),i}addOffset(e){this.prep(Yi,0),this.writeInt32(this.offset()-e+Yi)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const s=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const i=2;this.addInt16(e-this.object_start);const n=(s+i)*Mu;this.addInt16(n);let r=0;const o=this.space;e:for(t=0;t<this.vtables.length;t++){const a=this.bb.capacity()-this.vtables[t];if(n==this.bb.readInt16(a)){for(let h=Mu;h<n;h+=Mu)if(this.bb.readInt16(o+h)!=this.bb.readInt16(a+h))continue e;r=this.vtables[t];break}}return r?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,r-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,s){const i=s?Xs:0;if(t){const n=t;if(this.prep(this.minalign,Yi+hn+i),n.length!=hn)throw new Error("FlatBuffers: file identifier must be length "+hn);for(let r=hn-1;r>=0;r--)this.writeInt8(n.charCodeAt(r))}this.prep(this.minalign,Yi+i),this.addOffset(e),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const s=this.bb.capacity()-e,i=s-this.bb.readInt32(s);if(!(t<this.bb.readInt16(i)&&this.bb.readInt16(i+t)!=0))throw new Error("FlatBuffers: field "+t+" must be set")}startVector(e,t,s){this.notNested(),this.vector_num_elems=t,this.prep(Yi,e*t),this.prep(s,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(e==null)return 0;let t;e instanceof Uint8Array?t=e:t=this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let s=0,i=this.space,n=this.bb.bytes();s<t.length;s++)n[i++]=t[s];return this.endVector()}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let s=0;s<e.length;++s){const i=e[s];if(i!==null)t.push(this.createObjectOffset(i));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}},cc=class cr{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCivilCurve(e,t){return(t||new cr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCivilCurve(e,t){return e.setPosition(e.position()+Xs),(t||new cr).__init(e.readInt32(e.position())+e.position(),e)}points(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}pointsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}pointsArray(){const e=this.bb.__offset(this.bb_pos,4);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}data(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startCivilCurve(e){e.startObject(2)}static addPoints(e,t){e.addFieldOffset(0,t,0)}static createPointsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startPointsVector(e,t){e.startVector(4,t,4)}static addData(e,t){e.addFieldOffset(1,t,0)}static endCivilCurve(e){return e.endObject()}static createCivilCurve(e,t,s){return cr.startCivilCurve(e),cr.addPoints(e,t),cr.addData(e,s),cr.endCivilCurve(e)}},R0=class $i{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsAlignment(e,t){return(t||new $i).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsAlignment(e,t){return e.setPosition(e.position()+Xs),(t||new $i).__init(e.readInt32(e.position())+e.position(),e)}vertical(e,t){const s=this.bb.__offset(this.bb_pos,4);return s?(t||new cc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}verticalLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}horizontal(e,t){const s=this.bb.__offset(this.bb_pos,6);return s?(t||new cc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}horizontalLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}absolute(e,t){const s=this.bb.__offset(this.bb_pos,8);return s?(t||new cc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}absoluteLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}initialPk(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat32(this.bb_pos+e):0}static startAlignment(e){e.startObject(4)}static addVertical(e,t){e.addFieldOffset(0,t,0)}static createVerticalVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startVerticalVector(e,t){e.startVector(4,t,4)}static addHorizontal(e,t){e.addFieldOffset(1,t,0)}static createHorizontalVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startHorizontalVector(e,t){e.startVector(4,t,4)}static addAbsolute(e,t){e.addFieldOffset(2,t,0)}static createAbsoluteVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startAbsoluteVector(e,t){e.startVector(4,t,4)}static addInitialPk(e,t){e.addFieldFloat32(3,t,0)}static endAlignment(e){return e.endObject()}static createAlignment(e,t,s,i,n){return $i.startAlignment(e),$i.addVertical(e,t),$i.addHorizontal(e,s),$i.addAbsolute(e,i),$i.addInitialPk(e,n),$i.endAlignment(e)}},S0=class ur{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCivilData(e,t){return(t||new ur).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCivilData(e,t){return e.setPosition(e.position()+Xs),(t||new ur).__init(e.readInt32(e.position())+e.position(),e)}alignments(e,t){const s=this.bb.__offset(this.bb_pos,4);return s?(t||new R0).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}alignmentsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}coordinationMatrix(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}coordinationMatrixLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}coordinationMatrixArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startCivilData(e){e.startObject(2)}static addAlignments(e,t){e.addFieldOffset(0,t,0)}static createAlignmentsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startAlignmentsVector(e,t){e.startVector(4,t,4)}static addCoordinationMatrix(e,t){e.addFieldOffset(1,t,0)}static createCoordinationMatrixVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startCoordinationMatrixVector(e,t){e.startVector(4,t,4)}static endCivilData(e){return e.endObject()}static createCivilData(e,t,s){return ur.startCivilData(e),ur.addAlignments(e,t),ur.addCoordinationMatrix(e,s),ur.endCivilData(e)}},Ld=class fs{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFragment(e,t){return(t||new fs).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFragment(e,t){return e.setPosition(e.position()+Xs),(t||new fs).__init(e.readInt32(e.position())+e.position(),e)}position(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}positionLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}positionArray(){const e=this.bb.__offset(this.bb_pos,4);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}normal(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}normalLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}normalArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}index(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}indexLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}indexArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}groups(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}groupsLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}groupsArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}materials(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}materialsLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}materialsArray(){const e=this.bb.__offset(this.bb_pos,12);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}matrices(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}matricesLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}matricesArray(){const e=this.bb.__offset(this.bb_pos,14);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}colors(e){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}colorsLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}colorsArray(){const e=this.bb.__offset(this.bb_pos,16);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsSize(e){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsSizeLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsSizeArray(){const e=this.bb.__offset(this.bb_pos,18);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}ids(e){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}idsLength(){const e=this.bb.__offset(this.bb_pos,20);return e?this.bb.__vector_len(this.bb_pos+e):0}idsArray(){const e=this.bb.__offset(this.bb_pos,20);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}id(e){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__string(this.bb_pos+t,e):null}capacity(){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.readUint32(this.bb_pos+e):0}capacityOffset(){const e=this.bb.__offset(this.bb_pos,26);return e?this.bb.readUint32(this.bb_pos+e):0}static startFragment(e){e.startObject(12)}static addPosition(e,t){e.addFieldOffset(0,t,0)}static createPositionVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startPositionVector(e,t){e.startVector(4,t,4)}static addNormal(e,t){e.addFieldOffset(1,t,0)}static createNormalVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startNormalVector(e,t){e.startVector(4,t,4)}static addIndex(e,t){e.addFieldOffset(2,t,0)}static createIndexVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startIndexVector(e,t){e.startVector(4,t,4)}static addGroups(e,t){e.addFieldOffset(3,t,0)}static createGroupsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startGroupsVector(e,t){e.startVector(4,t,4)}static addMaterials(e,t){e.addFieldOffset(4,t,0)}static createMaterialsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startMaterialsVector(e,t){e.startVector(4,t,4)}static addMatrices(e,t){e.addFieldOffset(5,t,0)}static createMatricesVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startMatricesVector(e,t){e.startVector(4,t,4)}static addColors(e,t){e.addFieldOffset(6,t,0)}static createColorsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startColorsVector(e,t){e.startVector(4,t,4)}static addItemsSize(e,t){e.addFieldOffset(7,t,0)}static createItemsSizeVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsSizeVector(e,t){e.startVector(4,t,4)}static addIds(e,t){e.addFieldOffset(8,t,0)}static createIdsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startIdsVector(e,t){e.startVector(4,t,4)}static addId(e,t){e.addFieldOffset(9,t,0)}static addCapacity(e,t){e.addFieldInt32(10,t,0)}static addCapacityOffset(e,t){e.addFieldInt32(11,t,0)}static endFragment(e){return e.endObject()}static createFragment(e,t,s,i,n,r,o,a,h,c,d,u,f){return fs.startFragment(e),fs.addPosition(e,t),fs.addNormal(e,s),fs.addIndex(e,i),fs.addGroups(e,n),fs.addMaterials(e,r),fs.addMatrices(e,o),fs.addColors(e,a),fs.addItemsSize(e,h),fs.addIds(e,c),fs.addId(e,d),fs.addCapacity(e,u),fs.addCapacityOffset(e,f),fs.endFragment(e)}},Nu=class Ud{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFragmentsGroup(e,t){return(t||new Ud).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFragmentsGroup(e,t){return e.setPosition(e.position()+Xs),(t||new Ud).__init(e.readInt32(e.position())+e.position(),e)}items(e,t){const s=this.bb.__offset(this.bb_pos,4);return s?(t||new Ld).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}itemsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}civil(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new S0).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}coordinationMatrix(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}coordinationMatrixLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}coordinationMatrixArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}ids(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}idsLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}idsArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsKeys(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsKeysLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsKeysArray(){const e=this.bb.__offset(this.bb_pos,12);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsKeysIndices(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsKeysIndicesLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsKeysIndicesArray(){const e=this.bb.__offset(this.bb_pos,14);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsRels(e){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsRelsLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsRelsArray(){const e=this.bb.__offset(this.bb_pos,16);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsRelsIndices(e){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsRelsIndicesLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsRelsIndicesArray(){const e=this.bb.__offset(this.bb_pos,18);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}fragmentKeys(e){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__string(this.bb_pos+t,e):null}id(e){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__string(this.bb_pos+t,e):null}name(e){const t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}ifcName(e){const t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}ifcDescription(e){const t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}ifcSchema(e){const t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}maxExpressId(){const e=this.bb.__offset(this.bb_pos,32);return e?this.bb.readUint32(this.bb_pos+e):0}boundingBox(e){const t=this.bb.__offset(this.bb_pos,34);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}boundingBoxLength(){const e=this.bb.__offset(this.bb_pos,34);return e?this.bb.__vector_len(this.bb_pos+e):0}boundingBoxArray(){const e=this.bb.__offset(this.bb_pos,34);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}opaqueGeometriesIds(e){const t=this.bb.__offset(this.bb_pos,36);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+e*4):0}opaqueGeometriesIdsLength(){const e=this.bb.__offset(this.bb_pos,36);return e?this.bb.__vector_len(this.bb_pos+e):0}opaqueGeometriesIdsArray(){const e=this.bb.__offset(this.bb_pos,36);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}transparentGeometriesIds(e){const t=this.bb.__offset(this.bb_pos,38);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+e*4):0}transparentGeometriesIdsLength(){const e=this.bb.__offset(this.bb_pos,38);return e?this.bb.__vector_len(this.bb_pos+e):0}transparentGeometriesIdsArray(){const e=this.bb.__offset(this.bb_pos,38);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startFragmentsGroup(e){e.startObject(18)}static addItems(e,t){e.addFieldOffset(0,t,0)}static createItemsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startItemsVector(e,t){e.startVector(4,t,4)}static addCivil(e,t){e.addFieldOffset(1,t,0)}static addCoordinationMatrix(e,t){e.addFieldOffset(2,t,0)}static createCoordinationMatrixVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startCoordinationMatrixVector(e,t){e.startVector(4,t,4)}static addIds(e,t){e.addFieldOffset(3,t,0)}static createIdsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startIdsVector(e,t){e.startVector(4,t,4)}static addItemsKeys(e,t){e.addFieldOffset(4,t,0)}static createItemsKeysVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsKeysVector(e,t){e.startVector(4,t,4)}static addItemsKeysIndices(e,t){e.addFieldOffset(5,t,0)}static createItemsKeysIndicesVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsKeysIndicesVector(e,t){e.startVector(4,t,4)}static addItemsRels(e,t){e.addFieldOffset(6,t,0)}static createItemsRelsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsRelsVector(e,t){e.startVector(4,t,4)}static addItemsRelsIndices(e,t){e.addFieldOffset(7,t,0)}static createItemsRelsIndicesVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsRelsIndicesVector(e,t){e.startVector(4,t,4)}static addFragmentKeys(e,t){e.addFieldOffset(8,t,0)}static addId(e,t){e.addFieldOffset(9,t,0)}static addName(e,t){e.addFieldOffset(10,t,0)}static addIfcName(e,t){e.addFieldOffset(11,t,0)}static addIfcDescription(e,t){e.addFieldOffset(12,t,0)}static addIfcSchema(e,t){e.addFieldOffset(13,t,0)}static addMaxExpressId(e,t){e.addFieldInt32(14,t,0)}static addBoundingBox(e,t){e.addFieldOffset(15,t,0)}static createBoundingBoxVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startBoundingBoxVector(e,t){e.startVector(4,t,4)}static addOpaqueGeometriesIds(e,t){e.addFieldOffset(16,t,0)}static createOpaqueGeometriesIdsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startOpaqueGeometriesIdsVector(e,t){e.startVector(4,t,4)}static addTransparentGeometriesIds(e,t){e.addFieldOffset(17,t,0)}static createTransparentGeometriesIdsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startTransparentGeometriesIdsVector(e,t){e.startVector(4,t,4)}static endFragmentsGroup(e){return e.endObject()}static finishFragmentsGroupBuffer(e,t){e.finish(t)}static finishSizePrefixedFragmentsGroupBuffer(e,t){e.finish(t,void 0,!0)}},ry=class{constructor(){We(this,"version",1),We(this,"fragmentIDSeparator","|")}import(e){const t=new ul(e),s=Nu.getRootAsFragmentsGroup(t),i=this.constructFragmentGroup(s),n=s.itemsLength();for(let r=0;r<n;r++){const o=s.items(r);if(!o)continue;const a=this.constructGeometry(o),h=this.constructMaterials(o),c=o.capacity(),d=new wr(a,h,c);d.capacityOffset=o.capacityOffset(),this.setInstances(o,d),this.setID(o,d),i.items.push(d),i.add(d.mesh)}return i}export(e){const t=new Kf(1024),s=[],i=Nu,n=Ld;let r=null;if(e.civilData){const X=[],j=R0,be=S0;for(const[He,Xe]of e.civilData.alignments){const{absolute:Se,horizontal:_e,vertical:Le}=Xe,Ge=this.saveCivilCurves(_e,t),Ze=this.saveCivilCurves(Le,t),$e=this.saveCivilCurves(Se,t),_=j.createHorizontalVector(t,Ge),$=j.createVerticalVector(t,Ze),Q=j.createAbsoluteVector(t,$e);j.startAlignment(t),j.addHorizontal(t,_),j.addVertical(t,$),j.addAbsolute(t,Q),j.addInitialPk(t,Xe.initialKP);const N=j.endAlignment(t);X.push(N)}const fe=be.createAlignmentsVector(t,X),ue=be.createCoordinationMatrixVector(t,e.coordinationMatrix.elements);be.startCivilData(t),be.addAlignments(t,fe),be.addCoordinationMatrix(t,ue),r=be.endCivilData(t)}for(const X of e.items){const j=X.exportData(),be=[];for(const $ of X.ids){const Q=X.getInstancesIDs($);if(!Q)throw new Error("Instances not found!");be.push(Q.size)}const fe=n.createPositionVector(t,j.position),ue=n.createNormalVector(t,j.normal),He=n.createIndexVector(t,j.index),Xe=n.createGroupsVector(t,j.groups),Se=n.createMaterialsVector(t,j.materials),_e=n.createMatricesVector(t,j.matrices),Le=n.createColorsVector(t,j.colors),Ge=n.createIdsVector(t,j.ids),Ze=n.createItemsSizeVector(t,be),$e=t.createString(j.id);n.startFragment(t),n.addPosition(t,fe),n.addNormal(t,ue),n.addIndex(t,He),n.addGroups(t,Xe),n.addMaterials(t,Se),n.addMatrices(t,_e),n.addColors(t,Le),n.addIds(t,Ge),n.addItemsSize(t,Ze),n.addId(t,$e),n.addCapacity(t,X.capacity),n.addCapacityOffset(t,X.capacityOffset);const _=Ld.endFragment(t);s.push(_)}const o=i.createItemsVector(t,s),a=i.createCoordinationMatrixVector(t,e.coordinationMatrix.elements);let h="";for(const X of e.keyFragments.values())h.length&&(h+=this.fragmentIDSeparator),h+=X;const c=t.createString(h),d=[],u=[],f=[],m=[],p=[];let g=0,E=0;for(const[X,[j,be]]of e.data){d.push(g),f.push(E),p.push(X);for(const fe of j)u.push(fe);for(const fe of be)m.push(fe);g+=j.length,E+=be.length}const I=[],v=[];for(const[X,j]of e.geometryIDs.opaque)I.push(X,j);for(const[X,j]of e.geometryIDs.transparent)v.push(X,j);const b=t.createString(e.uuid),C=t.createString(e.name),F=t.createString(e.ifcMetadata.name),A=t.createString(e.ifcMetadata.description),R=t.createString(e.ifcMetadata.schema),O=i.createItemsKeysIndicesVector(t,d),L=i.createItemsKeysVector(t,u),k=i.createItemsRelsIndicesVector(t,f),x=i.createItemsRelsVector(t,m),M=i.createIdsVector(t,p),w=i.createOpaqueGeometriesIdsVector(t,I),G=i.createTransparentGeometriesIdsVector(t,v),{min:J,max:Z}=e.boundingBox,le=[J.x,J.y,J.z,Z.x,Z.y,Z.z],ee=i.createBoundingBoxVector(t,le);i.startFragmentsGroup(t),i.addId(t,b),i.addName(t,C),i.addIfcName(t,F),i.addIfcDescription(t,A),i.addIfcSchema(t,R),i.addMaxExpressId(t,e.ifcMetadata.maxExpressID),i.addItems(t,o),i.addFragmentKeys(t,c),i.addIds(t,M),i.addItemsKeysIndices(t,O),i.addItemsKeys(t,L),i.addItemsRelsIndices(t,k),i.addItemsRels(t,x),i.addCoordinationMatrix(t,a),i.addBoundingBox(t,ee),i.addOpaqueGeometriesIds(t,w),i.addTransparentGeometriesIds(t,G),r!==null&&i.addCivil(t,r);const xe=Nu.endFragmentsGroup(t);return t.finish(xe),t.asUint8Array()}setID(e,t){const s=e.id();s&&(t.id=s,t.mesh.uuid=s)}setInstances(e,t){const s=e.matricesArray(),i=e.colorsArray(),n=e.idsArray(),r=e.itemsSizeArray();if(!s||!n||!r)throw new Error("Error: Can't load empty fragment!");const o=[];let a=0;for(let h=0;h<r.length;h++){const c=n[h],d=r[h],u=[],f=[];for(let p=0;p<d;p++){const g=a*16,E=s.subarray(g,g+17),I=new Oe().fromArray(E);if(u.push(I),i){const v=a*3,[b,C,F]=i.subarray(v,v+4),A=new mt(b,C,F);f.push(A)}a++}const m=f.length?f:void 0;o.push({id:c,transforms:u,colors:m})}t.add(o)}constructMaterials(e){const t=e.materialsArray(),s=[];if(!t)return s;for(let i=0;i<t.length;i+=5){const n=t[i],r=!!t[i+1],o=t[i+2],a=t[i+3],h=t[i+4],c=new mt(o,a,h),d=new kn({color:c,opacity:n,transparent:r});s.push(d)}return s}constructFragmentGroup(e){const t=new ia,s=e.civil();if(s){const A=s.coordinationMatrixArray(),R=new Oe;A&&R.fromArray(A),t.civilData={alignments:new Map,coordinationMatrix:R};const O=s.alignmentsLength();for(let L=0;L<O;L++){const k=new mi({color:16777215}),x=new Dc,M=s.alignments(L);if(!M)throw new Error("Alignment not found!");const w=M.horizontalLength();x.horizontal=this.constructCivilCurves(M,x,"horizontal",w,k);const G=M.verticalLength();x.vertical=this.constructCivilCurves(M,x,"vertical",G,k);const J=M.horizontalLength();x.absolute=this.constructCivilCurves(M,x,"absolute",J,k),x.initialKP=M.initialPk(),t.civilData.alignments.set(L,x)}}t.uuid=e.id()||t.uuid,t.name=e.name()||"",t.ifcMetadata={name:e.ifcName()||"",description:e.ifcDescription()||"",schema:e.ifcSchema()||"IFC2X3",maxExpressID:e.maxExpressId()||0};const i=new Oe().elements,n=e.coordinationMatrixArray()||i,r=e.idsArray()||new Uint32Array,o=e.itemsKeysIndicesArray()||new Uint32Array,a=e.itemsKeysArray()||new Uint32Array,h=e.itemsRelsArray()||new Uint32Array,c=e.itemsRelsIndicesArray()||new Uint32Array,d=(e.fragmentKeys()||"").split(this.fragmentIDSeparator);this.setGroupData(t,r,o,a,0),this.setGroupData(t,r,c,h,1);const u=e.opaqueGeometriesIdsArray()||new Uint32Array,f=e.transparentGeometriesIdsArray()||new Uint32Array,m=new Map;for(let A=0;A<u.length-1;A+=2){const R=u[A],O=u[A+1];m.set(R,O)}const p=new Map;for(let A=0;A<f.length-1;A+=2){const R=f[A],O=f[A+1];p.set(R,O)}t.geometryIDs={opaque:m,transparent:p};const g=e.boundingBoxArray()||[0,0,0,0,0,0],[E,I,v,b,C,F]=g;t.boundingBox.min.set(E,I,v),t.boundingBox.max.set(b,C,F);for(let A=0;A<d.length;A++)t.keyFragments.set(A,d[A]);return n.length===16&&t.coordinationMatrix.fromArray(n),t}setGroupData(e,t,s,i,n){for(let r=0;r<s.length;r++){const o=t[r],a=s[r],h=s[r+1]||i.length,c=[];for(let u=a;u<h;u++)c.push(i[u]);e.data.has(o)||e.data.set(o,[[],[]]);const d=e.data.get(o);d&&(d[n]=c)}}constructGeometry(e){const t=e.positionArray()||new Float32Array,s=e.normalArray()||new Float32Array,i=e.indexArray(),n=e.groupsArray();if(!i)throw new Error("Index not found!");const r=new ft;if(r.setIndex(Array.from(i)),r.setAttribute("position",new Rt(t,3)),r.setAttribute("normal",new Rt(s,3)),n)for(let o=0;o<n.length;o+=3){const a=n[o],h=n[o+1],c=n[o+2];r.addGroup(a,h,c)}return r}constructCivilCurves(e,t,s,i,n){const r=[];for(let o=0;o<i;o++){const a=e[s](o);if(!a)throw new Error("Curve not found!");const h=a.pointsArray();if(h===null)throw new Error("Curve points not found!");let c={};const d=a.data();d&&(c=JSON.parse(d));const u=new Rc,f=new Rt(h,3);u.setAttribute("position",f);const m=[];for(let g=0;g<h.length/3-1;g++)m.push(g,g+1);u.setIndex(m);const p=new Lc(o,c,t,u,n);r.push(p.curve)}return r}saveCivilCurves(e,t){const s=cc,i=[];for(const n of e){const r=n.mesh.geometry.attributes.position.array,o=s.createPointsVector(t,r),a=t.createString(JSON.stringify(n.data));s.startCivilCurve(t),s.addPoints(t,o),s.addData(t,a);const h=s.endCivilCurve(t);i.push(h)}return i}},uc=class dr{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCivilCurve(e,t){return(t||new dr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCivilCurve(e,t){return e.setPosition(e.position()+Xs),(t||new dr).__init(e.readInt32(e.position())+e.position(),e)}points(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}pointsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}pointsArray(){const e=this.bb.__offset(this.bb_pos,4);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}data(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startCivilCurve(e){e.startObject(2)}static addPoints(e,t){e.addFieldOffset(0,t,0)}static createPointsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startPointsVector(e,t){e.startVector(4,t,4)}static addData(e,t){e.addFieldOffset(1,t,0)}static endCivilCurve(e){return e.endObject()}static createCivilCurve(e,t,s){return dr.startCivilCurve(e),dr.addPoints(e,t),dr.addData(e,s),dr.endCivilCurve(e)}},O0=class en{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsAlignment(e,t){return(t||new en).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsAlignment(e,t){return e.setPosition(e.position()+Xs),(t||new en).__init(e.readInt32(e.position())+e.position(),e)}vertical(e,t){const s=this.bb.__offset(this.bb_pos,4);return s?(t||new uc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}verticalLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}horizontal(e,t){const s=this.bb.__offset(this.bb_pos,6);return s?(t||new uc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}horizontalLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}absolute(e,t){const s=this.bb.__offset(this.bb_pos,8);return s?(t||new uc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}absoluteLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}initialPk(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat32(this.bb_pos+e):0}static startAlignment(e){e.startObject(4)}static addVertical(e,t){e.addFieldOffset(0,t,0)}static createVerticalVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startVerticalVector(e,t){e.startVector(4,t,4)}static addHorizontal(e,t){e.addFieldOffset(1,t,0)}static createHorizontalVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startHorizontalVector(e,t){e.startVector(4,t,4)}static addAbsolute(e,t){e.addFieldOffset(2,t,0)}static createAbsoluteVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startAbsoluteVector(e,t){e.startVector(4,t,4)}static addInitialPk(e,t){e.addFieldFloat32(3,t,0)}static endAlignment(e){return e.endObject()}static createAlignment(e,t,s,i,n){return en.startAlignment(e),en.addVertical(e,t),en.addHorizontal(e,s),en.addAbsolute(e,i),en.addInitialPk(e,n),en.endAlignment(e)}},P0=class fr{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCivilData(e,t){return(t||new fr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCivilData(e,t){return e.setPosition(e.position()+Xs),(t||new fr).__init(e.readInt32(e.position())+e.position(),e)}alignments(e,t){const s=this.bb.__offset(this.bb_pos,4);return s?(t||new O0).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}alignmentsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}coordinationMatrix(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}coordinationMatrixLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}coordinationMatrixArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startCivilData(e){e.startObject(2)}static addAlignments(e,t){e.addFieldOffset(0,t,0)}static createAlignmentsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startAlignmentsVector(e,t){e.startVector(4,t,4)}static addCoordinationMatrix(e,t){e.addFieldOffset(1,t,0)}static createCoordinationMatrixVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startCoordinationMatrixVector(e,t){e.startVector(4,t,4)}static endCivilData(e){return e.endObject()}static createCivilData(e,t,s){return fr.startCivilData(e),fr.addAlignments(e,t),fr.addCoordinationMatrix(e,s),fr.endCivilData(e)}};class Jt{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFragment(e,t){return(t||new Jt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFragment(e,t){return e.setPosition(e.position()+Xs),(t||new Jt).__init(e.readInt32(e.position())+e.position(),e)}position(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}positionLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}positionArray(){const e=this.bb.__offset(this.bb_pos,4);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}normal(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}normalLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}normalArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}index(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}indexLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}indexArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}groups(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}groupsLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}groupsArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}materials(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}materialsLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}materialsArray(){const e=this.bb.__offset(this.bb_pos,12);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}matrices(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}matricesLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}matricesArray(){const e=this.bb.__offset(this.bb_pos,14);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}colors(e){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}colorsLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}colorsArray(){const e=this.bb.__offset(this.bb_pos,16);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsSize(e){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsSizeLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsSizeArray(){const e=this.bb.__offset(this.bb_pos,18);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}ids(e){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}idsLength(){const e=this.bb.__offset(this.bb_pos,20);return e?this.bb.__vector_len(this.bb_pos+e):0}idsArray(){const e=this.bb.__offset(this.bb_pos,20);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}id(e){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__string(this.bb_pos+t,e):null}capacity(){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.readUint32(this.bb_pos+e):0}capacityOffset(){const e=this.bb.__offset(this.bb_pos,26);return e?this.bb.readUint32(this.bb_pos+e):0}static startFragment(e){e.startObject(12)}static addPosition(e,t){e.addFieldOffset(0,t,0)}static createPositionVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startPositionVector(e,t){e.startVector(4,t,4)}static addNormal(e,t){e.addFieldOffset(1,t,0)}static createNormalVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startNormalVector(e,t){e.startVector(4,t,4)}static addIndex(e,t){e.addFieldOffset(2,t,0)}static createIndexVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startIndexVector(e,t){e.startVector(4,t,4)}static addGroups(e,t){e.addFieldOffset(3,t,0)}static createGroupsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startGroupsVector(e,t){e.startVector(4,t,4)}static addMaterials(e,t){e.addFieldOffset(4,t,0)}static createMaterialsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startMaterialsVector(e,t){e.startVector(4,t,4)}static addMatrices(e,t){e.addFieldOffset(5,t,0)}static createMatricesVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startMatricesVector(e,t){e.startVector(4,t,4)}static addColors(e,t){e.addFieldOffset(6,t,0)}static createColorsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startColorsVector(e,t){e.startVector(4,t,4)}static addItemsSize(e,t){e.addFieldOffset(7,t,0)}static createItemsSizeVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsSizeVector(e,t){e.startVector(4,t,4)}static addIds(e,t){e.addFieldOffset(8,t,0)}static createIdsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startIdsVector(e,t){e.startVector(4,t,4)}static addId(e,t){e.addFieldOffset(9,t,0)}static addCapacity(e,t){e.addFieldInt32(10,t,0)}static addCapacityOffset(e,t){e.addFieldInt32(11,t,0)}static endFragment(e){return e.endObject()}static createFragment(e,t,s,i,n,r,o,a,h,c,d,u,f){return Jt.startFragment(e),Jt.addPosition(e,t),Jt.addNormal(e,s),Jt.addIndex(e,i),Jt.addGroups(e,n),Jt.addMaterials(e,r),Jt.addMatrices(e,o),Jt.addColors(e,a),Jt.addItemsSize(e,h),Jt.addIds(e,c),Jt.addId(e,d),Jt.addCapacity(e,u),Jt.addCapacityOffset(e,f),Jt.endFragment(e)}}let Du=class Bd{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFragmentsGroup(e,t){return(t||new Bd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFragmentsGroup(e,t){return e.setPosition(e.position()+Xs),(t||new Bd).__init(e.readInt32(e.position())+e.position(),e)}items(e,t){const s=this.bb.__offset(this.bb_pos,4);return s?(t||new Jt).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}itemsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}civil(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new P0).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}coordinationMatrix(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}coordinationMatrixLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}coordinationMatrixArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}ids(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}idsLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}idsArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsKeys(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsKeysLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsKeysArray(){const e=this.bb.__offset(this.bb_pos,12);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsKeysIndices(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsKeysIndicesLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsKeysIndicesArray(){const e=this.bb.__offset(this.bb_pos,14);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsRels(e){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsRelsLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsRelsArray(){const e=this.bb.__offset(this.bb_pos,16);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}itemsRelsIndices(e){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}itemsRelsIndicesLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}itemsRelsIndicesArray(){const e=this.bb.__offset(this.bb_pos,18);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}fragmentKeys(e){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__string(this.bb_pos+t,e):null}globalIds(e){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__string(this.bb_pos+t,e):null}id(e){const t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}name(e){const t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}ifcName(e){const t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}ifcDescription(e){const t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}ifcSchema(e){const t=this.bb.__offset(this.bb_pos,32);return t?this.bb.__string(this.bb_pos+t,e):null}maxExpressId(){const e=this.bb.__offset(this.bb_pos,34);return e?this.bb.readUint32(this.bb_pos+e):0}boundingBox(e){const t=this.bb.__offset(this.bb_pos,36);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}boundingBoxLength(){const e=this.bb.__offset(this.bb_pos,36);return e?this.bb.__vector_len(this.bb_pos+e):0}boundingBoxArray(){const e=this.bb.__offset(this.bb_pos,36);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}opaqueGeometriesIds(e){const t=this.bb.__offset(this.bb_pos,38);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+e*4):0}opaqueGeometriesIdsLength(){const e=this.bb.__offset(this.bb_pos,38);return e?this.bb.__vector_len(this.bb_pos+e):0}opaqueGeometriesIdsArray(){const e=this.bb.__offset(this.bb_pos,38);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}transparentGeometriesIds(e){const t=this.bb.__offset(this.bb_pos,40);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+e*4):0}transparentGeometriesIdsLength(){const e=this.bb.__offset(this.bb_pos,40);return e?this.bb.__vector_len(this.bb_pos+e):0}transparentGeometriesIdsArray(){const e=this.bb.__offset(this.bb_pos,40);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startFragmentsGroup(e){e.startObject(19)}static addItems(e,t){e.addFieldOffset(0,t,0)}static createItemsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startItemsVector(e,t){e.startVector(4,t,4)}static addCivil(e,t){e.addFieldOffset(1,t,0)}static addCoordinationMatrix(e,t){e.addFieldOffset(2,t,0)}static createCoordinationMatrixVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startCoordinationMatrixVector(e,t){e.startVector(4,t,4)}static addIds(e,t){e.addFieldOffset(3,t,0)}static createIdsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startIdsVector(e,t){e.startVector(4,t,4)}static addItemsKeys(e,t){e.addFieldOffset(4,t,0)}static createItemsKeysVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsKeysVector(e,t){e.startVector(4,t,4)}static addItemsKeysIndices(e,t){e.addFieldOffset(5,t,0)}static createItemsKeysIndicesVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsKeysIndicesVector(e,t){e.startVector(4,t,4)}static addItemsRels(e,t){e.addFieldOffset(6,t,0)}static createItemsRelsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsRelsVector(e,t){e.startVector(4,t,4)}static addItemsRelsIndices(e,t){e.addFieldOffset(7,t,0)}static createItemsRelsIndicesVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startItemsRelsIndicesVector(e,t){e.startVector(4,t,4)}static addFragmentKeys(e,t){e.addFieldOffset(8,t,0)}static addGlobalIds(e,t){e.addFieldOffset(9,t,0)}static addId(e,t){e.addFieldOffset(10,t,0)}static addName(e,t){e.addFieldOffset(11,t,0)}static addIfcName(e,t){e.addFieldOffset(12,t,0)}static addIfcDescription(e,t){e.addFieldOffset(13,t,0)}static addIfcSchema(e,t){e.addFieldOffset(14,t,0)}static addMaxExpressId(e,t){e.addFieldInt32(15,t,0)}static addBoundingBox(e,t){e.addFieldOffset(16,t,0)}static createBoundingBoxVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startBoundingBoxVector(e,t){e.startVector(4,t,4)}static addOpaqueGeometriesIds(e,t){e.addFieldOffset(17,t,0)}static createOpaqueGeometriesIdsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startOpaqueGeometriesIdsVector(e,t){e.startVector(4,t,4)}static addTransparentGeometriesIds(e,t){e.addFieldOffset(18,t,0)}static createTransparentGeometriesIdsVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startTransparentGeometriesIdsVector(e,t){e.startVector(4,t,4)}static endFragmentsGroup(e){return e.endObject()}static finishFragmentsGroupBuffer(e,t){e.finish(t)}static finishSizePrefixedFragmentsGroupBuffer(e,t){e.finish(t,void 0,!0)}},oy=class{constructor(){We(this,"version",2),We(this,"separator","|")}import(e){const t=new ul(e),s=Du.getRootAsFragmentsGroup(t),i=this.constructFragmentGroup(s),n=s.itemsLength();for(let r=0;r<n;r++){const o=s.items(r);if(!o)continue;const a=this.constructGeometry(o),h=this.constructMaterials(o),c=o.capacity(),d=new wr(a,h,c);d.capacityOffset=o.capacityOffset(),this.setInstances(o,d),this.setID(o,d),i.items.push(d),i.add(d.mesh)}return i}export(e){const t=new Kf(1024),s=[],i=Du,n=Jt;let r=null;if(e.civilData){const be=[],fe=O0,ue=P0;for(const[Se,_e]of e.civilData.alignments){const{absolute:Le,horizontal:Ge,vertical:Ze}=_e,$e=this.saveCivilCurves(Ge,t),_=this.saveCivilCurves(Ze,t),$=this.saveCivilCurves(Le,t),Q=fe.createHorizontalVector(t,$e),N=fe.createVerticalVector(t,_),P=fe.createAbsoluteVector(t,$);fe.startAlignment(t),fe.addHorizontal(t,Q),fe.addVertical(t,N),fe.addAbsolute(t,P),fe.addInitialPk(t,_e.initialKP);const W=fe.endAlignment(t);be.push(W)}const He=ue.createAlignmentsVector(t,be),Xe=ue.createCoordinationMatrixVector(t,e.coordinationMatrix.elements);ue.startCivilData(t),ue.addAlignments(t,He),ue.addCoordinationMatrix(t,Xe),r=ue.endCivilData(t)}for(const be of e.items){const fe=be.exportData(),ue=[];for(const N of be.ids){const P=be.getInstancesIDs(N);if(!P)throw new Error("Instances not found!");ue.push(P.size)}const He=n.createPositionVector(t,fe.position),Xe=n.createNormalVector(t,fe.normal),Se=n.createIndexVector(t,fe.index),_e=n.createGroupsVector(t,fe.groups),Le=n.createMaterialsVector(t,fe.materials),Ge=n.createMatricesVector(t,fe.matrices),Ze=n.createColorsVector(t,fe.colors),$e=n.createIdsVector(t,fe.ids),_=n.createItemsSizeVector(t,ue),$=t.createString(fe.id);n.startFragment(t),n.addPosition(t,He),n.addNormal(t,Xe),n.addIndex(t,Se),n.addGroups(t,_e),n.addMaterials(t,Le),n.addMatrices(t,Ge),n.addColors(t,Ze),n.addIds(t,$e),n.addItemsSize(t,_),n.addId(t,$),n.addCapacity(t,be.capacity),n.addCapacityOffset(t,be.capacityOffset);const Q=Jt.endFragment(t);s.push(Q)}const o=i.createItemsVector(t,s),a=i.createCoordinationMatrixVector(t,e.coordinationMatrix.elements);let h="";for(const be of e.keyFragments.values())h.length&&(h+=this.separator),h+=be;let c="";for(const[be]of e.globalToExpressIDs)c.length&&(c+=this.separator),c+=be;const d=t.createString(h),u=t.createString(c),f=[],m=[],p=[],g=[],E=[];let I=0,v=0;for(const[be,[fe,ue]]of e.data){f.push(I),p.push(v),E.push(be);for(const He of fe)m.push(He);for(const He of ue)g.push(He);I+=fe.length,v+=ue.length}const b=[],C=[];for(const[be,fe]of e.geometryIDs.opaque)b.push(be,fe);for(const[be,fe]of e.geometryIDs.transparent)C.push(be,fe);const F=t.createString(e.uuid),A=t.createString(e.name),R=t.createString(e.ifcMetadata.name),O=t.createString(e.ifcMetadata.description),L=t.createString(e.ifcMetadata.schema),k=i.createItemsKeysIndicesVector(t,f),x=i.createItemsKeysVector(t,m),M=i.createItemsRelsIndicesVector(t,p),w=i.createItemsRelsVector(t,g),G=i.createIdsVector(t,E),J=i.createOpaqueGeometriesIdsVector(t,b),Z=i.createTransparentGeometriesIdsVector(t,C),{min:le,max:ee}=e.boundingBox,xe=[le.x,le.y,le.z,ee.x,ee.y,ee.z],X=i.createBoundingBoxVector(t,xe);i.startFragmentsGroup(t),i.addId(t,F),i.addName(t,A),i.addIfcName(t,R),i.addIfcDescription(t,O),i.addIfcSchema(t,L),i.addMaxExpressId(t,e.ifcMetadata.maxExpressID),i.addItems(t,o),i.addFragmentKeys(t,d),i.addGlobalIds(t,u),i.addIds(t,G),i.addItemsKeysIndices(t,k),i.addItemsKeys(t,x),i.addItemsRelsIndices(t,M),i.addItemsRels(t,w),i.addCoordinationMatrix(t,a),i.addBoundingBox(t,X),i.addOpaqueGeometriesIds(t,J),i.addTransparentGeometriesIds(t,Z),r!==null&&i.addCivil(t,r);const j=Du.endFragmentsGroup(t);return t.finish(j),t.asUint8Array()}setID(e,t){const s=e.id();s&&(t.id=s,t.mesh.uuid=s)}setInstances(e,t){const s=e.matricesArray(),i=e.colorsArray(),n=e.idsArray(),r=e.itemsSizeArray();if(!s||!n||!r)throw new Error("Error: Can't load empty fragment!");const o=[];let a=0;for(let h=0;h<r.length;h++){const c=n[h],d=r[h],u=[],f=[];for(let p=0;p<d;p++){const g=a*16,E=s.subarray(g,g+17),I=new Oe().fromArray(E);if(u.push(I),i){const v=a*3,[b,C,F]=i.subarray(v,v+4),A=new mt(b,C,F);f.push(A)}a++}const m=f.length?f:void 0;o.push({id:c,transforms:u,colors:m})}t.add(o)}constructMaterials(e){const t=e.materialsArray(),s=[];if(!t)return s;for(let i=0;i<t.length;i+=5){const n=t[i],r=!!t[i+1],o=t[i+2],a=t[i+3],h=t[i+4],c=new mt(o,a,h),d=new kn({color:c,opacity:n,transparent:r});s.push(d)}return s}constructFragmentGroup(e){const t=new ia,s=e.civil();if(s){const R=s.coordinationMatrixArray(),O=new Oe;R&&O.fromArray(R),t.civilData={alignments:new Map,coordinationMatrix:O};const L=s.alignmentsLength();for(let k=0;k<L;k++){const x=new mi({color:16777215}),M=new Dc,w=s.alignments(k);if(!w)throw new Error("Alignment not found!");const G=w.horizontalLength();M.horizontal=this.constructCivilCurves(w,M,"horizontal",G,x);const J=w.verticalLength();M.vertical=this.constructCivilCurves(w,M,"vertical",J,x);const Z=w.horizontalLength();M.absolute=this.constructCivilCurves(w,M,"absolute",Z,x),M.initialKP=w.initialPk(),t.civilData.alignments.set(k,M)}}t.uuid=e.id()||t.uuid,t.name=e.name()||"",t.ifcMetadata={name:e.ifcName()||"",description:e.ifcDescription()||"",schema:e.ifcSchema()||"IFC2X3",maxExpressID:e.maxExpressId()||0};const i=new Oe().elements,n=e.coordinationMatrixArray()||i,r=e.idsArray()||new Uint32Array,o=e.itemsKeysIndicesArray()||new Uint32Array,a=e.itemsKeysArray()||new Uint32Array,h=e.itemsRelsArray()||new Uint32Array,c=e.itemsRelsIndicesArray()||new Uint32Array,d=(e.fragmentKeys()||"").split(this.separator),u=(e.globalIds()||"").split(this.separator);this.setGroupData(t,r,o,a,0),this.setGroupData(t,r,c,h,1);const f=e.opaqueGeometriesIdsArray()||new Uint32Array,m=e.transparentGeometriesIdsArray()||new Uint32Array,p=new Map;for(let R=0;R<f.length-1;R+=2){const O=f[R],L=f[R+1];p.set(O,L)}const g=new Map;for(let R=0;R<m.length-1;R+=2){const O=m[R],L=m[R+1];g.set(O,L)}t.geometryIDs={opaque:p,transparent:g};const E=e.boundingBoxArray()||[0,0,0,0,0,0],[I,v,b,C,F,A]=E;t.boundingBox.min.set(I,v,b),t.boundingBox.max.set(C,F,A);for(let R=0;R<d.length;R++)t.keyFragments.set(R,d[R]);n.length===16&&t.coordinationMatrix.fromArray(n);for(let R=0;R<r.length;R++)t.globalToExpressIDs.set(u[R],r[R]);return t}setGroupData(e,t,s,i,n){for(let r=0;r<s.length;r++){const o=t[r],a=s[r],h=s[r+1],c=h===void 0?i.length:h,d=[];for(let f=a;f<c;f++)d.push(i[f]);e.data.has(o)||e.data.set(o,[[],[]]);const u=e.data.get(o);u&&(u[n]=d)}}constructGeometry(e){const t=e.positionArray()||new Float32Array,s=e.normalArray()||new Float32Array,i=e.indexArray(),n=e.groupsArray();if(!i)throw new Error("Index not found!");const r=new ft;if(r.setIndex(Array.from(i)),r.setAttribute("position",new Rt(t,3)),r.setAttribute("normal",new Rt(s,3)),n)for(let o=0;o<n.length;o+=3){const a=n[o],h=n[o+1],c=n[o+2];r.addGroup(a,h,c)}return r}constructCivilCurves(e,t,s,i,n){const r=[];for(let o=0;o<i;o++){const a=e[s](o);if(!a)throw new Error("Curve not found!");const h=a.pointsArray();if(h===null)throw new Error("Curve points not found!");let c={};const d=a.data();d&&(c=JSON.parse(d));const u=new Rc,f=new Rt(h,3);u.setAttribute("position",f);const m=[];for(let g=0;g<h.length/3-1;g++)m.push(g,g+1);u.setIndex(m);const p=new Lc(o,c,t,u,n);r.push(p.curve)}return r}saveCivilCurves(e,t){const s=uc,i=[];for(const n of e){const r=n.mesh.geometry.attributes.position.array,o=s.createPointsVector(t,r),a=t.createString(JSON.stringify(n.data));s.startCivilCurve(t),s.addPoints(t,o),s.addData(t,a);const h=s.endCivilCurve(t);i.push(h)}return i}},Nc=class{constructor(){We(this,"parsers",[new oy,new ry]),We(this,"version","auto")}import(e){const t=this.parsers.length;if(this.version==="auto"){for(let n=0;n<this.parsers.length;n++){const r=this.parsers[n].import(e);if(Object.keys(r).length!==0){if(n!==0){const o=this.parsers.length-n;this.warnVersion(o,t)}return r}}throw new Error("No valid parser found for this file")}this.checkCurrentVersionValid(this.version);const s=this.parsers.length-this.version,i=this.parsers[s].import(e);if(Object.keys(i).length===0)throw new Error(`The given version ${this.version} doesn't match to the given file. Try using "auto" in the version property to handle versions automatically.`);return i}export(e){if(this.version==="auto")return this.parsers[0].export(e);this.checkCurrentVersionValid(this.version);const t=this.parsers.length-this.version;return this.parsers[t].export(e)}checkCurrentVersionValid(e){if(this.version!=="auto"){if(this.version!==e&&this.warnVersion(this.version,e),!Number.isInteger(this.version))throw new Error("Invalid version. Non-automatic versions must an integer.");if(this.version<1||this.version>e)throw new Error(`Invalid version. Versions range from 1 to ${e}.`)}}warnVersion(e,t){console.warn(`This fragment file version is ${e}. The latest version is ${t}. To avoid issues, please consider updating your fragments. You can do so by regenerating your fragments from the original IFC file.`)}};const M0=class zd extends hl{constructor(){super(...arguments),We(this,"items",[]),We(this,"boundingBox",new Qe),We(this,"coordinationMatrix",new Oe),We(this,"keyFragments",new Map),We(this,"globalToExpressIDs",new Map),We(this,"data",new Map),We(this,"geometryIDs",{opaque:new Map,transparent:new Map}),We(this,"ifcMetadata",{name:"",description:"",schema:"IFC2X3",maxExpressID:0}),We(this,"civilData"),We(this,"streamSettings",{baseUrl:"",baseFileName:"",ids:new Map,types:new Map}),We(this,"isStreamed",!1),We(this,"_properties")}get hasProperties(){const e=this._properties!==void 0,t=this.streamSettings.ids.size!==0;return e||t}getFragmentMap(e){const t={};for(const s of e){const i=this.data.get(s);if(i)for(const n of i[0]){const r=this.keyFragments.get(n);r!==void 0&&(t[r]||(t[r]=new Set),t[r].add(s))}}return t}getItemVertices(e){const t=[],s=this.getFragmentMap([e]);for(const i in s){const n=this.items.find(o=>o.id===i);if(!n)continue;const r=n.getInstancesIDs(e);if(r)for(const o of r){const a=new Oe;n.mesh.getMatrixAt(o,a);for(const h of n.uniqueVertices){const c=h.clone().applyMatrix4(a);t.push(c)}}}return t}dispose(e=!0){for(const t of this.items)t.dispose(e);if(this.coordinationMatrix=new Oe,this.keyFragments.clear(),this.data.clear(),this._properties={},this.removeFromParent(),this.items=[],this.civilData){const{alignments:t}=this.civilData;for(const[s,i]of t)this.disposeAlignment(i.vertical),this.disposeAlignment(i.horizontal),this.disposeAlignment(i.absolute)}this.civilData=void 0}setLocalProperties(e){this._properties=e}getLocalProperties(){return this._properties}getAllPropertiesIDs(){return this._properties?Object.keys(this._properties).map(e=>parseInt(e,10)):Array.from(this.streamSettings.ids.keys())}getAllPropertiesTypes(){if(this._properties){const e=new Set;for(const t in this._properties){const s=this._properties[t];s.type!==void 0&&e.add(s.type)}return Array.from(e)}return Array.from(this.streamSettings.types.keys())}async getProperties(e){if(this._properties)return this._properties[e]||null;const t=this.getPropsURL(e),s=await this.getPropertiesData(t);return s?s[e]:null}async setProperties(e,t){if(this._properties){t!==null?this._properties[e]=t:delete this._properties[e];return}throw new Error("Writing streamed properties not supported yet!")}async getAllPropertiesOfType(e){if(this._properties){const n={};let r=!1;for(const o in this._properties){const a=this._properties[o];a.type===e&&(n[a.expressID]=a,r=!0)}return r?n:null}const{types:t}=this.streamSettings,s=t.get(e);if(s===void 0)return null;const i={};for(const n of s){const r=this.constructFileName(n),o=this.constructURL(r),a=await this.getPropertiesData(o);for(const h in a)i[parseInt(h,10)]=a[h]}return i}clone(e){throw new Error("Use FragmentsGroup.cloneGroup instead!")}cloneGroup(e){const t=new zd;t.coordinationMatrix=this.coordinationMatrix,t.position.copy(this.position),t.rotation.copy(this.rotation),t.scale.copy(this.scale),t.updateMatrix(),t.ifcMetadata={...this.ifcMetadata},e||(e=this.getFragmentMap(this.data.keys()));const s=new Set,i=new Map;for(const n of this.items){if(!e[n.id])continue;const r=e[n.id],o=n.clone(r);i.set(n.id,o.id),t.items.push(o),t.add(o.mesh);for(const a of r)s.add(a)}for(const n of s){const r=this.data.get(n);r&&t.data.set(n,r)}for(const[n,r]of this.keyFragments)if(i.has(r)){const o=i.get(r);if(o===void 0)throw new Error("Malformed fragment ID map during clone!");t.keyFragments.set(n,o)}for(const[n,r]of this.globalToExpressIDs)s.has(r)&&t.globalToExpressIDs.set(n,r);return this.civilData&&(t.civilData={coordinationMatrix:this.coordinationMatrix,alignments:new Map}),t}getPropsURL(e){const{ids:t}=this.streamSettings,s=t.get(e);if(s===void 0)throw new Error("ID not found");const i=this.constructFileName(s);return this.constructURL(i)}async getPropertiesData(e){const t=await zd.fetch(e);if(t.json)return t.json();if(t.text){const s=await t.text();return JSON.parse(s)}throw new Error("Invalid response type when getting properties data.")}constructFileName(e){const{baseFileName:t}=this.streamSettings;return`${t}-${e}`}constructURL(e){const{baseUrl:t}=this.streamSettings;return`${t}${e}`}disposeAlignment(e){for(const t of e)if(t.mesh.geometry.dispose(),Array.isArray(t.mesh.material))for(const s of t.mesh.material)s.dispose();else t.mesh.material.dispose();e.length=0}};We(M0,"fetch",async l=>fetch(l));let ia=M0,Dc=class{constructor(){We(this,"vertical",[]),We(this,"horizontal",[]),We(this,"absolute",[]),We(this,"initialKP",0)}getLength(e){let t=0;for(const s of this[e])t+=s.getLength();return t}getPointAt(e,t){const s=this.getCurveAt(e,t);return s.curve.getPointAt(s.percentage)}getPercentageAt(e,t,s=.01){const i=this[t];let n=0;for(const r of i){const o=r.getPercentageAt(e,s),a=r.getLength();if(o!==null){const h=n+o*a,c=this.getLength(t);return h/c}n+=a}return null}getCurveAt(e,t){e<0?e=0:e>1&&(e=1);const s=this[t],i=this.getLength(t)*e;let n=0;for(const r of s){const o=r.getLength();if(n+o>=i){const a=(i-n)/o;return{curve:r,percentage:a}}n+=o}throw new Error("Could not compute point!")}},ay=class{constructor(e,t,s,i){We(this,"index"),We(this,"mesh"),We(this,"data"),We(this,"alignment"),this.index=e,this.mesh=t,this.data=s,this.alignment=i}get _index(){return this.mesh.geometry.index}get _pos(){return this.mesh.geometry.attributes.position.array}getLength(){let e=0;for(let t=0;t<this._index.array.length-1;t+=2){const{startPoint:s,endPoint:i}=this.getSegment(t);e+=s.distanceTo(i)}return e}getPointAt(e){const{startPoint:t,endPoint:s,distanceToStart:i}=this.getSegmentAt(e),n=s.clone();return n.sub(t),n.normalize(),n.multiplyScalar(i),n.add(t),n}getSegmentAt(e){e<0?e=0:e>1&&(e=1);const t=this.getLength()*e;let s=0;for(let i=0;i<this._index.array.length-1;i+=2){const{startPoint:n,endPoint:r}=this.getSegment(i),o=n.distanceTo(r);if(s+o>=t)return{distanceToStart:t-s,index:i,startPoint:n,endPoint:r};s+=o}throw new Error("Could not compute point")}getPercentageAt(e,t=.01){let s=0;for(let i=0;i<this._index.array.length-1;i+=2){const{startPoint:n,endPoint:r}=this.getSegment(i),o=n.distanceTo(r),a=e.distanceTo(n),h=e.distanceTo(r);if(a+h-o<=t){const c=s+a,d=this.getLength();return c/d}s+=o}return null}getSegment(e){const t=this._index.array[e]*3,s=this._index.array[e+1]*3,i=new U(this._pos[t],this._pos[t+1],this._pos[t+2]),n=new U(this._pos[s],this._pos[s+1],this._pos[s+2]);return{startPoint:i,endPoint:n}}},Lc=class extends r0{constructor(e,t,s,i,n){super(i,n),We(this,"curve"),this.curve=new ay(e,this,t,s)}},N0=class tn{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsStreamedGeometry(e,t){return(t||new tn).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStreamedGeometry(e,t){return e.setPosition(e.position()+Xs),(t||new tn).__init(e.readInt32(e.position())+e.position(),e)}geometryId(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb_pos+e):0}position(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}positionLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}positionArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}normal(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+e*4):0}normalLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}normalArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}index(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}indexLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}indexArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startStreamedGeometry(e){e.startObject(4)}static addGeometryId(e,t){e.addFieldInt32(0,t,0)}static addPosition(e,t){e.addFieldOffset(1,t,0)}static createPositionVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startPositionVector(e,t){e.startVector(4,t,4)}static addNormal(e,t){e.addFieldOffset(2,t,0)}static createNormalVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addFloat32(t[s]);return e.endVector()}static startNormalVector(e,t){e.startVector(4,t,4)}static addIndex(e,t){e.addFieldOffset(3,t,0)}static createIndexVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addInt32(t[s]);return e.endVector()}static startIndexVector(e,t){e.startVector(4,t,4)}static endStreamedGeometry(e){return e.endObject()}static createStreamedGeometry(e,t,s,i,n){return tn.startStreamedGeometry(e),tn.addGeometryId(e,t),tn.addPosition(e,s),tn.addNormal(e,i),tn.addIndex(e,n),tn.endStreamedGeometry(e)}},um=class vo{constructor(){We(this,"bb",null),We(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsStreamedGeometries(e,t){return(t||new vo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStreamedGeometries(e,t){return e.setPosition(e.position()+Xs),(t||new vo).__init(e.readInt32(e.position())+e.position(),e)}geometries(e,t){const s=this.bb.__offset(this.bb_pos,4);return s?(t||new N0).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+e*4),this.bb):null}geometriesLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}static startStreamedGeometries(e){e.startObject(1)}static addGeometries(e,t){e.addFieldOffset(0,t,0)}static createGeometriesVector(e,t){e.startVector(4,t.length,4);for(let s=t.length-1;s>=0;s--)e.addOffset(t[s]);return e.endVector()}static startGeometriesVector(e,t){e.startVector(4,t,4)}static endStreamedGeometries(e){return e.endObject()}static finishStreamedGeometriesBuffer(e,t){e.finish(t)}static finishSizePrefixedStreamedGeometriesBuffer(e,t){e.finish(t,void 0,!0)}static createStreamedGeometries(e,t){return vo.startStreamedGeometries(e),vo.addGeometries(e,t),vo.endStreamedGeometries(e)}},Qf=class{import(e){const t=new ul(e),s=um.getRootAsStreamedGeometries(t),i=new Map,n=s.geometriesLength();for(let r=0;r<n;r++){const o=s.geometries(r);if(!o)continue;const a=o.geometryId();if(a===null)throw new Error("Error finding ID!");const h=o.positionArray(),c=o.normalArray(),d=o.indexArray();!h||!c||!d||i.set(a,{position:h,normal:c,index:d})}return i}export(e){const t=new Kf(1024),s=[],i=um,n=N0;for(const[a,{index:h,position:c,normal:d}]of e){const u=n.createIndexVector(t,h),f=n.createPositionVector(t,c),m=n.createNormalVector(t,d);n.startStreamedGeometry(t),n.addGeometryId(t,a),n.addIndex(t,u),n.addPosition(t,f),n.addNormal(t,m);const p=n.endStreamedGeometry(t);s.push(p)}const r=i.createGeometriesVector(t,s);i.startStreamedGeometries(t),i.addGeometries(t,r);const o=i.endStreamedGeometries(t);return t.finish(o),t.asUint8Array()}};var ly=Object.defineProperty,hy=(l,e,t)=>e in l?ly(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,V=(l,e,t)=>(hy(l,typeof e!="symbol"?e+"":e,t),t);const D0=0,cy=1,uy=2,dm=2,Lu=1.25,fm=1,dc=6*4+4+4,Uc=65535,dy=Math.pow(2,-24),Uu=Symbol("SKIP_GENERATION");function fy(l){return l.index?l.index.count:l.attributes.position.count}function na(l){return fy(l)/3}function py(l,e=ArrayBuffer){return l>65535?new Uint32Array(new e(4*l)):new Uint16Array(new e(2*l))}function my(l,e){if(!l.index){const t=l.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=py(t,s);l.setIndex(new Rt(i,1));for(let n=0;n<t;n++)i[n]=n}}function L0(l){const e=na(l),t=l.drawRange,s=t.start/3,i=(t.start+t.count)/3,n=Math.max(0,s),r=Math.min(e,i)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function U0(l){if(!l.groups||!l.groups.length)return L0(l);const e=[],t=new Set,s=l.drawRange,i=s.start/3,n=(s.start+s.count)/3;for(const o of l.groups){const a=o.start/3,h=(o.start+o.count)/3;t.add(Math.max(i,a)),t.add(Math.min(n,h))}const r=Array.from(t.values()).sort((o,a)=>o-a);for(let o=0;o<r.length-1;o++){const a=r[o],h=r[o+1];e.push({offset:Math.floor(a),count:Math.floor(h-a)})}return e}function gy(l){if(l.groups.length===0)return!1;const e=na(l),t=U0(l).sort((n,r)=>n.offset-r.offset),s=t[t.length-1];s.count=Math.min(e-s.offset,s.count);let i=0;return t.forEach(({count:n})=>i+=n),e!==i}function Yt(l,e,t){return t.min.x=e[l],t.min.y=e[l+1],t.min.z=e[l+2],t.max.x=e[l+3],t.max.y=e[l+4],t.max.z=e[l+5],t}function Ey(l){l[0]=l[1]=l[2]=1/0,l[3]=l[4]=l[5]=-1/0}function pm(l){let e=-1,t=-1/0;for(let s=0;s<3;s++){const i=l[s+3]-l[s];i>t&&(t=i,e=s)}return e}function mm(l,e){e.set(l)}function gm(l,e,t){let s,i;for(let n=0;n<3;n++){const r=n+3;s=l[n],i=e[n],t[n]=s<i?s:i,s=l[r],i=e[r],t[r]=s>i?s:i}}function nh(l,e,t){for(let s=0;s<3;s++){const i=e[l+2*s],n=e[l+2*s+1],r=i-n,o=i+n;r<t[s]&&(t[s]=r),o>t[s+3]&&(t[s+3]=o)}}function va(l){const e=l[3]-l[0],t=l[4]-l[1],s=l[5]-l[2];return 2*(e*t+t*s+s*e)}function Bu(l,e,t,s,i=null){let n=1/0,r=1/0,o=1/0,a=-1/0,h=-1/0,c=-1/0,d=1/0,u=1/0,f=1/0,m=-1/0,p=-1/0,g=-1/0;const E=i!==null;for(let I=e*6,v=(e+t)*6;I<v;I+=6){const b=l[I+0],C=l[I+1],F=b-C,A=b+C;F<n&&(n=F),A>a&&(a=A),E&&b<d&&(d=b),E&&b>m&&(m=b);const R=l[I+2],O=l[I+3],L=R-O,k=R+O;L<r&&(r=L),k>h&&(h=k),E&&R<u&&(u=R),E&&R>p&&(p=R);const x=l[I+4],M=l[I+5],w=x-M,G=x+M;w<o&&(o=w),G>c&&(c=G),E&&x<f&&(f=x),E&&x>g&&(g=x)}s[0]=n,s[1]=r,s[2]=o,s[3]=a,s[4]=h,s[5]=c,E&&(i[0]=d,i[1]=u,i[2]=f,i[3]=m,i[4]=p,i[5]=g)}function Iy(l,e,t,s){let i=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,h=-1/0;for(let c=e*6,d=(e+t)*6;c<d;c+=6){const u=l[c+0];u<i&&(i=u),u>o&&(o=u);const f=l[c+2];f<n&&(n=f),f>a&&(a=f);const m=l[c+4];m<r&&(r=m),m>h&&(h=m)}s[0]=i,s[1]=n,s[2]=r,s[3]=o,s[4]=a,s[5]=h}function by(l,e){Ey(e);const t=l.attributes.position,s=l.index?l.index.array:null,i=na(l),n=new Float32Array(i*6),r=t.normalized,o=t.array,a=t.offset||0;let h=3;t.isInterleavedBufferAttribute&&(h=t.data.stride);const c=["getX","getY","getZ"];for(let d=0;d<i;d++){const u=d*3,f=d*6;let m=u+0,p=u+1,g=u+2;s&&(m=s[m],p=s[p],g=s[g]),r||(m=m*h+a,p=p*h+a,g=g*h+a);for(let E=0;E<3;E++){let I,v,b;r?(I=t[c[E]](m),v=t[c[E]](p),b=t[c[E]](g)):(I=o[m+E],v=o[p+E],b=o[g+E]);let C=I;v<C&&(C=v),b<C&&(C=b);let F=I;v>F&&(F=v),b>F&&(F=b);const A=(F-C)/2,R=E*2;n[f+R+0]=C+A,n[f+R+1]=A+(Math.abs(C)+A)*dy,C<e[E]&&(e[E]=C),F>e[E+3]&&(e[E+3]=F)}}return n}const sn=32,yy=(l,e)=>l.candidate-e.candidate,_n=new Array(sn).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),rh=new Float32Array(6);function wy(l,e,t,s,i,n){let r=-1,o=0;if(n===D0)r=pm(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(n===cy)r=pm(l),r!==-1&&(o=Cy(t,s,i,r));else if(n===uy){const a=va(l);let h=Lu*i;const c=s*6,d=(s+i)*6;for(let u=0;u<3;u++){const f=e[u],m=(e[u+3]-f)/sn;if(i<sn/4){const p=[..._n];p.length=i;let g=0;for(let I=c;I<d;I+=6,g++){const v=p[g];v.candidate=t[I+2*u],v.count=0;const{bounds:b,leftCacheBounds:C,rightCacheBounds:F}=v;for(let A=0;A<3;A++)F[A]=1/0,F[A+3]=-1/0,C[A]=1/0,C[A+3]=-1/0,b[A]=1/0,b[A+3]=-1/0;nh(I,t,b)}p.sort(yy);let E=i;for(let I=0;I<E;I++){const v=p[I];for(;I+1<E&&p[I+1].candidate===v.candidate;)p.splice(I+1,1),E--}for(let I=c;I<d;I+=6){const v=t[I+2*u];for(let b=0;b<E;b++){const C=p[b];v>=C.candidate?nh(I,t,C.rightCacheBounds):(nh(I,t,C.leftCacheBounds),C.count++)}}for(let I=0;I<E;I++){const v=p[I],b=v.count,C=i-v.count,F=v.leftCacheBounds,A=v.rightCacheBounds;let R=0;b!==0&&(R=va(F)/a);let O=0;C!==0&&(O=va(A)/a);const L=fm+Lu*(R*b+O*C);L<h&&(r=u,h=L,o=v.candidate)}}else{for(let E=0;E<sn;E++){const I=_n[E];I.count=0,I.candidate=f+m+E*m;const v=I.bounds;for(let b=0;b<3;b++)v[b]=1/0,v[b+3]=-1/0}for(let E=c;E<d;E+=6){let I=~~((t[E+2*u]-f)/m);I>=sn&&(I=sn-1);const v=_n[I];v.count++,nh(E,t,v.bounds)}const p=_n[sn-1];mm(p.bounds,p.rightCacheBounds);for(let E=sn-2;E>=0;E--){const I=_n[E],v=_n[E+1];gm(I.bounds,v.rightCacheBounds,I.rightCacheBounds)}let g=0;for(let E=0;E<sn-1;E++){const I=_n[E],v=I.count,b=I.bounds,C=_n[E+1].rightCacheBounds;v!==0&&(g===0?mm(b,rh):gm(b,rh,rh)),g+=v;let F=0,A=0;g!==0&&(F=va(rh)/a);const R=i-g;R!==0&&(A=va(C)/a);const O=fm+Lu*(F*g+A*R);O<h&&(r=u,h=O,o=I.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function Cy(l,e,t,s){let i=0;for(let n=e,r=e+t;n<r;n++)i+=l[n*6+s*2];return i/t}let oh=class{constructor(){}};function vy(l,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,h=n.axis*2;for(;;){for(;r<=o&&t[r*6+h]<a;)r++;for(;r<=o&&t[o*6+h]>=a;)o--;if(r<o){for(let c=0;c<3;c++){let d=e[r*3+c];e[r*3+c]=e[o*3+c],e[o*3+c]=d}for(let c=0;c<6;c++){let d=t[r*6+c];t[r*6+c]=t[o*6+c],t[o*6+c]=d}r++,o--}else return r}}function _y(l,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,h=n.axis*2;for(;;){for(;r<=o&&t[r*6+h]<a;)r++;for(;r<=o&&t[o*6+h]>=a;)o--;if(r<o){let c=l[r];l[r]=l[o],l[o]=c;for(let d=0;d<6;d++){let u=t[r*6+d];t[r*6+d]=t[o*6+d],t[o*6+d]=u}r++,o--}else return r}}function Ty(l,e){const t=(l.index?l.index.count:l.attributes.position.count)/3,s=t>2**16,i=s?4:2,n=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=s?new Uint32Array(n):new Uint16Array(n);for(let o=0,a=r.length;o<a;o++)r[o]=o;return r}function xy(l,e){const t=l.geometry,s=t.index?t.index.array:null,i=e.maxDepth,n=e.verbose,r=e.maxLeafTris,o=e.strategy,a=e.onProgress,h=na(t),c=l._indirectBuffer;let d=!1;const u=new Float32Array(6),f=new Float32Array(6),m=by(t,u),p=e.indirect?_y:vy,g=[],E=e.indirect?L0(t):U0(t);if(E.length===1){const b=E[0],C=new oh;C.boundingData=u,Iy(m,b.offset,b.count,f),v(C,b.offset,b.count,f),g.push(C)}else for(let b of E){const C=new oh;C.boundingData=new Float32Array(6),Bu(m,b.offset,b.count,C.boundingData,f),v(C,b.offset,b.count,f),g.push(C)}return g;function I(b){a&&a(b/h)}function v(b,C,F,A=null,R=0){if(!d&&R>=i&&(d=!0,n&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),F<=r||R>=i)return I(C+F),b.offset=C,b.count=F,b;const O=wy(b.boundingData,A,m,C,F,o);if(O.axis===-1)return I(C+F),b.offset=C,b.count=F,b;const L=p(c,s,m,C,F,O);if(L===C||L===C+F)I(C+F),b.offset=C,b.count=F;else{b.splitAxis=O.axis;const k=new oh,x=C,M=L-C;b.left=k,k.boundingData=new Float32Array(6),Bu(m,x,M,k.boundingData,f),v(k,x,M,f,R+1);const w=new oh,G=L,J=F-M;b.right=w,w.boundingData=new Float32Array(6),Bu(m,G,J,w.boundingData,f),v(w,G,J,f,R+1)}return b}}function Ay(l,e){const t=l.geometry;e.indirect&&(l._indirectBuffer=Ty(t,e.useSharedArrayBuffer),gy(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),l._indirectBuffer||my(t,e);const s=xy(l,e);let i,n,r;const o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<s.length;d++){const u=s[d];let f=h(u);const m=new a(dc*f);i=new Float32Array(m),n=new Uint32Array(m),r=new Uint16Array(m),c(0,u),o.push(m)}l._roots=o;return;function h(d){return d.count?1:1+h(d.left)+h(d.right)}function c(d,u){const f=d/4,m=d/2,p=!!u.count,g=u.boundingData;for(let E=0;E<6;E++)i[f+E]=g[E];if(p){const E=u.offset,I=u.count;return n[f+6]=E,r[m+14]=I,r[m+15]=Uc,d+dc}else{const E=u.left,I=u.right,v=u.splitAxis;let b;if(b=c(d+dc,E),b/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[f+6]=b/4,b=c(b,I),n[f+7]=v,b}}}class fn{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const o=e[n][t];s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}setFromPoints(e,t){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=e.dot(o);s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}fn.prototype.setFromBox=function(){const l=new U;return function(e,t){const s=t.min,i=t.max;let n=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let a=0;a<=1;a++)for(let h=0;h<=1;h++){l.x=s.x*o+i.x*(1-o),l.y=s.y*a+i.y*(1-a),l.z=s.z*h+i.z*(1-h);const c=e.dot(l);n=Math.min(c,n),r=Math.max(c,r)}this.min=n,this.max=r}}();const Fy=function(){const l=new U,e=new U,t=new U;return function(s,i,n){const r=s.start,o=l,a=i.start,h=e;t.subVectors(r,a),l.subVectors(s.end,s.start),e.subVectors(i.end,i.start);const c=t.dot(h),d=h.dot(o),u=h.dot(h),f=t.dot(o),m=o.dot(o)*u-d*d;let p,g;m!==0?p=(c*d-f*u)/m:p=0,g=(c+p*d)/u,n.x=p,n.y=g}}(),qf=function(){const l=new lt,e=new U,t=new U;return function(s,i,n,r){Fy(s,i,l);let o=l.x,a=l.y;if(o>=0&&o<=1&&a>=0&&a<=1){s.at(o,n),i.at(a,r);return}else if(o>=0&&o<=1){a<0?i.at(0,r):i.at(1,r),s.closestPointToPoint(r,!0,n);return}else if(a>=0&&a<=1){o<0?s.at(0,n):s.at(1,n),i.closestPointToPoint(n,!0,r);return}else{let h;o<0?h=s.start:h=s.end;let c;a<0?c=i.start:c=i.end;const d=e,u=t;if(s.closestPointToPoint(c,!0,e),i.closestPointToPoint(h,!0,t),d.distanceToSquared(c)<=u.distanceToSquared(h)){n.copy(d),r.copy(c);return}else{n.copy(h),r.copy(u);return}}}}(),Ry=function(){const l=new U,e=new U,t=new _s,s=new Et;return function(i,n){const{radius:r,center:o}=i,{a,b:h,c}=n;if(s.start=a,s.end=h,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r||(s.start=a,s.end=c,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r)||(s.start=h,s.end=c,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r))return!0;const d=n.getPlane(t);if(Math.abs(d.distanceToPoint(o))<=r){const u=d.projectPoint(o,e);if(n.containsPoint(u))return!0}return!1}}(),Sy=1e-15;function zu(l){return Math.abs(l)<Sy}class xi extends cs{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new U),this.satBounds=new Array(4).fill().map(()=>new fn),this.points=[this.a,this.b,this.c],this.sphere=new pi,this.plane=new _s,this.needsUpdate=!0}intersectsSphere(e){return Ry(e,this)}update(){const e=this.a,t=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const h=n[1],c=r[1];h.subVectors(e,t),c.setFromPoints(h,i);const d=n[2],u=r[2];d.subVectors(t,s),u.setFromPoints(d,i);const f=n[3],m=r[3];f.subVectors(s,e),m.setFromPoints(f,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}xi.prototype.closestPointToSegment=function(){const l=new U,e=new U,t=new Et;return function(s,i=null,n=null){const{start:r,end:o}=s,a=this.points;let h,c=1/0;for(let d=0;d<3;d++){const u=(d+1)%3;t.start.copy(a[d]),t.end.copy(a[u]),qf(t,s,l,e),h=l.distanceToSquared(e),h<c&&(c=h,i&&i.copy(l),n&&n.copy(e))}return this.closestPointToPoint(r,l),h=r.distanceToSquared(l),h<c&&(c=h,i&&i.copy(l),n&&n.copy(r)),this.closestPointToPoint(o,l),h=o.distanceToSquared(l),h<c&&(c=h,i&&i.copy(l),n&&n.copy(o)),Math.sqrt(c)}}();xi.prototype.intersectsTriangle=function(){const l=new xi,e=new Array(3),t=new Array(3),s=new fn,i=new fn,n=new U,r=new U,o=new U,a=new U,h=new U,c=new Et,d=new Et,u=new Et,f=new U;function m(p,g,E){const I=p.points;let v=0,b=-1;for(let C=0;C<3;C++){const{start:F,end:A}=c;F.copy(I[C]),A.copy(I[(C+1)%3]),c.delta(r);const R=zu(g.distanceToPoint(F));if(zu(g.normal.dot(r))&&R){E.copy(c),v=2;break}const O=g.intersectLine(c,f);if(!O&&R&&f.copy(F),(O||R)&&!zu(f.distanceTo(A))){if(v<=1)(v===1?E.start:E.end).copy(f),R&&(b=v);else if(v>=2){(b===1?E.start:E.end).copy(f),v=2;break}if(v++,v===2&&b===-1)break}}return v}return function(p,g=null,E=!1){this.needsUpdate&&this.update(),p.isExtendedTriangle?p.needsUpdate&&p.update():(l.copy(p),l.update(),p=l);const I=this.plane,v=p.plane;if(Math.abs(I.normal.dot(v.normal))>1-1e-10){const b=this.satBounds,C=this.satAxes;t[0]=p.a,t[1]=p.b,t[2]=p.c;for(let R=0;R<4;R++){const O=b[R],L=C[R];if(s.setFromPoints(L,t),O.isSeparated(s))return!1}const F=p.satBounds,A=p.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let R=0;R<4;R++){const O=F[R],L=A[R];if(s.setFromPoints(L,e),O.isSeparated(s))return!1}for(let R=0;R<4;R++){const O=C[R];for(let L=0;L<4;L++){const k=A[L];if(n.crossVectors(O,k),s.setFromPoints(n,e),i.setFromPoints(n,t),s.isSeparated(i))return!1}}return g&&(E||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}else{const b=m(this,v,d);if(b===1&&p.containsPoint(d.end))return g&&(g.start.copy(d.end),g.end.copy(d.end)),!0;if(b!==2)return!1;const C=m(p,I,u);if(C===1&&this.containsPoint(u.end))return g&&(g.start.copy(u.end),g.end.copy(u.end)),!0;if(C!==2)return!1;if(d.delta(o),u.delta(a),o.dot(a)<0){let x=u.start;u.start=u.end,u.end=x}const F=d.start.dot(o),A=d.end.dot(o),R=u.start.dot(o),O=u.end.dot(o),L=A<R,k=F<O;return F!==O&&R!==A&&L===k?!1:(g&&(h.subVectors(d.start,u.start),h.dot(o)>0?g.start.copy(d.start):g.start.copy(u.start),h.subVectors(d.end,u.end),h.dot(o)<0?g.end.copy(d.end):g.end.copy(u.end)),!0)}}}();xi.prototype.distanceToPoint=function(){const l=new U;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();xi.prototype.distanceToTriangle=function(){const l=new U,e=new U,t=["a","b","c"],s=new Et,i=new Et;return function(n,r=null,o=null){const a=r||o?s:null;if(this.intersectsTriangle(n,a))return(r||o)&&(r&&a.getCenter(r),o&&a.getCenter(o)),0;let h=1/0;for(let c=0;c<3;c++){let d;const u=t[c],f=n[u];this.closestPointToPoint(f,l),d=f.distanceToSquared(l),d<h&&(h=d,r&&r.copy(l),o&&o.copy(f));const m=this[u];n.closestPointToPoint(m,l),d=m.distanceToSquared(l),d<h&&(h=d,r&&r.copy(m),o&&o.copy(l))}for(let c=0;c<3;c++){const d=t[c],u=t[(c+1)%3];s.set(this[d],this[u]);for(let f=0;f<3;f++){const m=t[f],p=t[(f+1)%3];i.set(n[m],n[p]),qf(s,i,l,e);const g=l.distanceToSquared(e);g<h&&(h=g,r&&r.copy(l),o&&o.copy(e))}}return Math.sqrt(h)}}();let Ms=class{constructor(e,t,s){this.isOrientedBox=!0,this.min=new U,this.max=new U,this.matrix=new Oe,this.invMatrix=new Oe,this.points=new Array(8).fill().map(()=>new U),this.satAxes=new Array(3).fill().map(()=>new U),this.satBounds=new Array(3).fill().map(()=>new fn),this.alignedSatBounds=new Array(3).fill().map(()=>new fn),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,s){this.min.copy(e),this.max.copy(t),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Ms.prototype.update=function(){return function(){const l=this.matrix,e=this.min,t=this.max,s=this.points;for(let a=0;a<=1;a++)for(let h=0;h<=1;h++)for(let c=0;c<=1;c++){const d=1*a|2*h|4*c,u=s[d];u.x=a?t.x:e.x,u.y=h?t.y:e.y,u.z=c?t.z:e.z,u.applyMatrix4(l)}const i=this.satBounds,n=this.satAxes,r=s[0];for(let a=0;a<3;a++){const h=n[a],c=i[a],d=1<<a,u=s[d];h.subVectors(r,u),c.setFromPoints(h,s)}const o=this.alignedSatBounds;o[0].setFromPointsField(s,"x"),o[1].setFromPointsField(s,"y"),o[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Ms.prototype.intersectsBox=function(){const l=new fn;return function(e){this.needsUpdate&&this.update();const t=e.min,s=e.max,i=this.satBounds,n=this.satAxes,r=this.alignedSatBounds;if(l.min=t.x,l.max=s.x,r[0].isSeparated(l)||(l.min=t.y,l.max=s.y,r[1].isSeparated(l))||(l.min=t.z,l.max=s.z,r[2].isSeparated(l)))return!1;for(let o=0;o<3;o++){const a=n[o],h=i[o];if(l.setFromBox(a,e),h.isSeparated(l))return!1}return!0}}();Ms.prototype.intersectsTriangle=function(){const l=new xi,e=new Array(3),t=new fn,s=new fn,i=new U;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(l.copy(n),l.update(),n=l);const r=this.satBounds,o=this.satAxes;e[0]=n.a,e[1]=n.b,e[2]=n.c;for(let d=0;d<3;d++){const u=r[d],f=o[d];if(t.setFromPoints(f,e),u.isSeparated(t))return!1}const a=n.satBounds,h=n.satAxes,c=this.points;for(let d=0;d<3;d++){const u=a[d],f=h[d];if(t.setFromPoints(f,c),u.isSeparated(t))return!1}for(let d=0;d<3;d++){const u=o[d];for(let f=0;f<4;f++){const m=h[f];if(i.crossVectors(u,m),t.setFromPoints(i,e),s.setFromPoints(i,c),t.isSeparated(s))return!1}}return!0}}();Ms.prototype.closestPointToPoint=function(){return function(l,e){return this.needsUpdate&&this.update(),e.copy(l).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();Ms.prototype.distanceToPoint=function(){const l=new U;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();Ms.prototype.distanceToBox=function(){const l=["x","y","z"],e=new Array(12).fill().map(()=>new Et),t=new Array(12).fill().map(()=>new Et),s=new U,i=new U;return function(n,r=0,o=null,a=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(o||a)&&(n.getCenter(i),this.closestPointToPoint(i,s),n.closestPointToPoint(s,i),o&&o.copy(s),a&&a.copy(i)),0;const h=r*r,c=n.min,d=n.max,u=this.points;let f=1/0;for(let p=0;p<8;p++){const g=u[p];i.copy(g).clamp(c,d);const E=g.distanceToSquared(i);if(E<f&&(f=E,o&&o.copy(g),a&&a.copy(i),E<h))return Math.sqrt(E)}let m=0;for(let p=0;p<3;p++)for(let g=0;g<=1;g++)for(let E=0;E<=1;E++){const I=(p+1)%3,v=(p+2)%3,b=g<<I|E<<v,C=1<<p|g<<I|E<<v,F=u[b],A=u[C];e[m].set(F,A);const R=l[p],O=l[I],L=l[v],k=t[m],x=k.start,M=k.end;x[R]=c[R],x[O]=g?c[O]:d[O],x[L]=E?c[L]:d[O],M[R]=d[R],M[O]=g?c[O]:d[O],M[L]=E?c[L]:d[O],m++}for(let p=0;p<=1;p++)for(let g=0;g<=1;g++)for(let E=0;E<=1;E++){i.x=p?d.x:c.x,i.y=g?d.y:c.y,i.z=E?d.z:c.z,this.closestPointToPoint(i,s);const I=i.distanceToSquared(s);if(I<f&&(f=I,o&&o.copy(s),a&&a.copy(i),I<h))return Math.sqrt(I)}for(let p=0;p<12;p++){const g=e[p];for(let E=0;E<12;E++){const I=t[E];qf(g,I,s,i);const v=s.distanceToSquared(i);if(v<f&&(f=v,o&&o.copy(s),a&&a.copy(i),v<h))return Math.sqrt(v)}}return Math.sqrt(f)}}();let Jf=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}},Oy=class extends Jf{constructor(){super(()=>new xi)}};const ni=new Oy;function Gs(l,e){return e[l+15]===65535}function js(l,e){return e[l+6]}function ri(l,e){return e[l+14]}function oi(l){return l+8}function ai(l,e){return e[l+6]}function B0(l,e){return e[l+7]}class Py{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=s=>{t&&e.push(t),t=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Dt=new Py;let Bn,Ro;const Zr=[],ah=new Jf(()=>new Qe);function My(l,e,t,s,i,n){Bn=ah.getPrimitive(),Ro=ah.getPrimitive(),Zr.push(Bn,Ro),Dt.setBuffer(l._roots[e]);const r=kd(0,l.geometry,t,s,i,n);Dt.clearBuffer(),ah.releasePrimitive(Bn),ah.releasePrimitive(Ro),Zr.pop(),Zr.pop();const o=Zr.length;return o>0&&(Ro=Zr[o-1],Bn=Zr[o-2]),r}function kd(l,e,t,s,i=null,n=0,r=0){const{float32Array:o,uint16Array:a,uint32Array:h}=Dt;let c=l*2;if(Gs(c,a)){const d=js(l,h),u=ri(c,a);return Yt(l,o,Bn),s(d,u,!1,r,n+l,Bn)}else{let d=function(k){const{uint16Array:x,uint32Array:M}=Dt;let w=k*2;for(;!Gs(w,x);)k=oi(k),w=k*2;return js(k,M)},u=function(k){const{uint16Array:x,uint32Array:M}=Dt;let w=k*2;for(;!Gs(w,x);)k=ai(k,M),w=k*2;return js(k,M)+ri(w,x)};const f=oi(l),m=ai(l,h);let p=f,g=m,E,I,v,b;if(i&&(v=Bn,b=Ro,Yt(p,o,v),Yt(g,o,b),E=i(v),I=i(b),I<E)){p=m,g=f;const k=E;E=I,I=k,v=b}v||(v=Bn,Yt(p,o,v));const C=Gs(p*2,a),F=t(v,C,E,r+1,n+p);let A;if(F===dm){const k=d(p),x=u(p)-k;A=s(k,x,!0,r+1,n+p,v)}else A=F&&kd(p,e,t,s,i,n,r+1);if(A)return!0;b=Ro,Yt(g,o,b);const R=Gs(g*2,a),O=t(b,R,I,r+1,n+g);let L;if(O===dm){const k=d(g),x=u(g)-k;L=s(k,x,!0,r+1,n+g,b)}else L=O&&kd(g,e,t,s,i,n,r+1);return!!L}}const _a=new U,ku=new U;function Ny(l,e,t={},s=0,i=1/0){const n=s*s,r=i*i;let o=1/0,a=null;if(l.shapecast({boundsTraverseOrder:c=>(_a.copy(e).clamp(c.min,c.max),_a.distanceToSquared(e)),intersectsBounds:(c,d,u)=>u<o&&u<r,intersectsTriangle:(c,d)=>{c.closestPointToPoint(e,_a);const u=e.distanceToSquared(_a);return u<o&&(ku.copy(_a),o=u,a=d),u<n}}),o===1/0)return null;const h=Math.sqrt(o);return t.point?t.point.copy(ku):t.point=ku.clone(),t.distance=h,t.faceIndex=a,t}const Xr=new U,Kr=new U,Qr=new U,lh=new lt,hh=new lt,ch=new lt,Em=new U,Im=new U,bm=new U,uh=new U;function Dy(l,e,t,s,i,n){let r;return n===kf?r=l.intersectTriangle(s,t,e,!0,i):r=l.intersectTriangle(e,t,s,n!==Fi,i),r===null?null:{distance:l.origin.distanceTo(i),point:i.clone()}}function Ly(l,e,t,s,i,n,r,o,a){Xr.fromBufferAttribute(e,n),Kr.fromBufferAttribute(e,r),Qr.fromBufferAttribute(e,o);const h=Dy(l,Xr,Kr,Qr,uh,a);if(h){s&&(lh.fromBufferAttribute(s,n),hh.fromBufferAttribute(s,r),ch.fromBufferAttribute(s,o),h.uv=cs.getInterpolation(uh,Xr,Kr,Qr,lh,hh,ch,new lt)),i&&(lh.fromBufferAttribute(i,n),hh.fromBufferAttribute(i,r),ch.fromBufferAttribute(i,o),h.uv1=cs.getInterpolation(uh,Xr,Kr,Qr,lh,hh,ch,new lt)),t&&(Em.fromBufferAttribute(t,n),Im.fromBufferAttribute(t,r),bm.fromBufferAttribute(t,o),h.normal=cs.getInterpolation(uh,Xr,Kr,Qr,Em,Im,bm,new U),h.normal.dot(l.direction)>0&&h.normal.multiplyScalar(-1));const c={a:n,b:r,c:o,normal:new U,materialIndex:0};cs.getNormal(Xr,Kr,Qr,c.normal),h.face=c,h.faceIndex=n}return h}function Bc(l,e,t,s,i){const n=s*3;let r=n+0,o=n+1,a=n+2;const h=l.index;l.index&&(r=h.getX(r),o=h.getX(o),a=h.getX(a));const{position:c,normal:d,uv:u,uv1:f}=l.attributes,m=Ly(t,c,d,u,f,r,o,a,e);return m?(m.faceIndex=s,i&&i.push(m),m):null}function es(l,e,t,s){const i=l.a,n=l.b,r=l.c;let o=e,a=e+1,h=e+2;t&&(o=t.getX(o),a=t.getX(a),h=t.getX(h)),i.x=s.getX(o),i.y=s.getY(o),i.z=s.getZ(o),n.x=s.getX(a),n.y=s.getY(a),n.z=s.getZ(a),r.x=s.getX(h),r.y=s.getY(h),r.z=s.getZ(h)}function Uy(l,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=s,h=s+i;a<h;a++)Bc(r,e,t,a,n)}function By(l,e,t,s,i){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let h=s,c=s+i;h<c;h++){let d;d=Bc(n,e,t,h),d&&d.distance<o&&(a=d,o=d.distance)}return a}function zy(l,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,h=o.attributes.position;for(let c=l,d=e+l;c<d;c++){let u;if(u=c,es(r,u*3,a,h),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}function ky(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,h=0;const c=l._roots;for(let u=0,f=c.length;u<f;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),d(0,h),h+=n.byteLength;function d(u,f,m=!1){const p=u*2;if(o[p+15]===Uc){const g=r[u+6],E=o[p+14];let I=1/0,v=1/0,b=1/0,C=-1/0,F=-1/0,A=-1/0;for(let R=3*g,O=3*(g+E);R<O;R++){let L=s[R];const k=i.getX(L),x=i.getY(L),M=i.getZ(L);k<I&&(I=k),k>C&&(C=k),x<v&&(v=x),x>F&&(F=x),M<b&&(b=M),M>A&&(A=M)}return a[u+0]!==I||a[u+1]!==v||a[u+2]!==b||a[u+3]!==C||a[u+4]!==F||a[u+5]!==A?(a[u+0]=I,a[u+1]=v,a[u+2]=b,a[u+3]=C,a[u+4]=F,a[u+5]=A,!0):!1}else{const g=u+8,E=r[u+6],I=g+f,v=E+f;let b=m,C=!1,F=!1;e?b||(C=e.has(I),F=e.has(v),b=!C&&!F):(C=!0,F=!0);const A=b||C,R=b||F;let O=!1;A&&(O=d(g,f,b));let L=!1;R&&(L=d(E,f,b));const k=O||L;if(k)for(let x=0;x<3;x++){const M=g+x,w=E+x,G=a[M],J=a[M+3],Z=a[w],le=a[w+3];a[u+x]=G<Z?G:Z,a[u+x+3]=J>le?J:le}return k}}}const ym=new Qe;function Gn(l,e,t,s){return Yt(l,e,ym),t.intersectBox(ym,s)}function Vy(l,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=s,h=s+i;a<h;a++){let c=o?o[a]:a;Bc(r,e,t,c,n)}}function Yy(l,e,t,s,i){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let h=s,c=s+i;h<c;h++){let d;d=Bc(n,e,t,r?r[h]:h),d&&d.distance<o&&(a=d,o=d.distance)}return a}function Gy(l,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,h=o.attributes.position;for(let c=l,d=e+l;c<d;c++){let u;if(u=t.resolveTriangleIndex(c),es(r,u*3,a,h),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}const wm=new U;function Hy(l,e,t,s,i){Dt.setBuffer(l._roots[e]),Vd(0,l,t,s,i),Dt.clearBuffer()}function Vd(l,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Dt,a=l*2;if(Gs(a,r)){const h=js(l,o),c=ri(a,r);Uy(e,t,s,h,c,i)}else{const h=oi(l);Gn(h,n,s,wm)&&Vd(h,e,t,s,i);const c=ai(l,o);Gn(c,n,s,wm)&&Vd(c,e,t,s,i)}}const Cm=new U,Wy=["x","y","z"];function jy(l,e,t,s){Dt.setBuffer(l._roots[e]);const i=Yd(0,l,t,s);return Dt.clearBuffer(),i}function Yd(l,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=Dt;let o=l*2;if(Gs(o,n)){const a=js(l,r),h=ri(o,n);return By(e,t,s,a,h)}else{const a=B0(l,r),h=Wy[a],c=s.direction[h]>=0;let d,u;c?(d=oi(l),u=ai(l,r)):(d=ai(l,r),u=oi(l));const f=Gn(d,i,s,Cm)?Yd(d,e,t,s):null;if(f){const p=f.point[h];if(c?p<=i[u+a]:p>=i[u+a+3])return f}const m=Gn(u,i,s,Cm)?Yd(u,e,t,s):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}const dh=new Qe,qr=new xi,Jr=new xi,Ta=new Oe,vm=new Ms,fh=new Ms;function Zy(l,e,t,s){Dt.setBuffer(l._roots[e]);const i=Gd(0,l,t,s);return Dt.clearBuffer(),i}function Gd(l,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=Dt;let a=l*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),vm.set(t.boundingBox.min,t.boundingBox.max,s),i=vm),Gs(a,r)){const h=e.geometry,c=h.index,d=h.attributes.position,u=t.index,f=t.attributes.position,m=js(l,o),p=ri(a,r);if(Ta.copy(s).invert(),t.boundsTree)return Yt(l,n,fh),fh.matrix.copy(Ta),fh.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>fh.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(s),g.b.applyMatrix4(s),g.c.applyMatrix4(s),g.needsUpdate=!0;for(let E=m*3,I=(p+m)*3;E<I;E+=3)if(es(Jr,E,c,d),Jr.needsUpdate=!0,g.intersectsTriangle(Jr))return!0;return!1}});for(let g=m*3,E=(p+m)*3;g<E;g+=3){es(qr,g,c,d),qr.a.applyMatrix4(Ta),qr.b.applyMatrix4(Ta),qr.c.applyMatrix4(Ta),qr.needsUpdate=!0;for(let I=0,v=u.count;I<v;I+=3)if(es(Jr,I,u,f),Jr.needsUpdate=!0,qr.intersectsTriangle(Jr))return!0}}else{const h=l+8,c=o[l+6];return Yt(h,n,dh),!!(i.intersectsBox(dh)&&Gd(h,e,t,s,i)||(Yt(c,n,dh),i.intersectsBox(dh)&&Gd(c,e,t,s,i)))}}const ph=new Oe,Vu=new Ms,xa=new Ms,Xy=new U,Ky=new U,Qy=new U,qy=new U;function Jy(l,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Vu.set(e.boundingBox.min,e.boundingBox.max,t),Vu.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,h=o.index,c=e.attributes.position,d=e.index,u=ni.getPrimitive(),f=ni.getPrimitive();let m=Xy,p=Ky,g=null,E=null;i&&(g=Qy,E=qy);let I=1/0,v=null,b=null;return ph.copy(t).invert(),xa.matrix.copy(ph),l.shapecast({boundsTraverseOrder:C=>Vu.distanceToBox(C),intersectsBounds:(C,F,A)=>A<I&&A<r?(F&&(xa.min.copy(C.min),xa.max.copy(C.max),xa.needsUpdate=!0),!0):!1,intersectsRange:(C,F)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:A=>xa.distanceToBox(A),intersectsBounds:(A,R,O)=>O<I&&O<r,intersectsRange:(A,R)=>{for(let O=A,L=A+R;O<L;O++){es(f,3*O,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let k=C,x=C+F;k<x;k++){es(u,3*k,h,a),u.needsUpdate=!0;const M=u.distanceToTriangle(f,m,g);if(M<I&&(p.copy(m),E&&E.copy(g),I=M,v=k,b=O),M<n)return!0}}}});{const A=na(e);for(let R=0,O=A;R<O;R++){es(f,3*R,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let L=C,k=C+F;L<k;L++){es(u,3*L,h,a),u.needsUpdate=!0;const x=u.distanceToTriangle(f,m,g);if(x<I&&(p.copy(m),E&&E.copy(g),I=x,v=L,b=R),x<n)return!0}}}}}),ni.releasePrimitive(u),ni.releasePrimitive(f),I===1/0?null:(s.point?s.point.copy(p):s.point=p.clone(),s.distance=I,s.faceIndex=v,i&&(i.point?i.point.copy(E):i.point=E.clone(),i.point.applyMatrix4(ph),p.applyMatrix4(ph),i.distance=p.sub(i.point).length(),i.faceIndex=b),s)}function $y(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,h=0;const c=l._roots;for(let u=0,f=c.length;u<f;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),d(0,h),h+=n.byteLength;function d(u,f,m=!1){const p=u*2;if(o[p+15]===Uc){const g=r[u+6],E=o[p+14];let I=1/0,v=1/0,b=1/0,C=-1/0,F=-1/0,A=-1/0;for(let R=g,O=g+E;R<O;R++){const L=3*l.resolveTriangleIndex(R);for(let k=0;k<3;k++){let x=L+k;x=s?s[x]:x;const M=i.getX(x),w=i.getY(x),G=i.getZ(x);M<I&&(I=M),M>C&&(C=M),w<v&&(v=w),w>F&&(F=w),G<b&&(b=G),G>A&&(A=G)}}return a[u+0]!==I||a[u+1]!==v||a[u+2]!==b||a[u+3]!==C||a[u+4]!==F||a[u+5]!==A?(a[u+0]=I,a[u+1]=v,a[u+2]=b,a[u+3]=C,a[u+4]=F,a[u+5]=A,!0):!1}else{const g=u+8,E=r[u+6],I=g+f,v=E+f;let b=m,C=!1,F=!1;e?b||(C=e.has(I),F=e.has(v),b=!C&&!F):(C=!0,F=!0);const A=b||C,R=b||F;let O=!1;A&&(O=d(g,f,b));let L=!1;R&&(L=d(E,f,b));const k=O||L;if(k)for(let x=0;x<3;x++){const M=g+x,w=E+x,G=a[M],J=a[M+3],Z=a[w],le=a[w+3];a[u+x]=G<Z?G:Z,a[u+x+3]=J>le?J:le}return k}}}const _m=new U;function ew(l,e,t,s,i){Dt.setBuffer(l._roots[e]),Hd(0,l,t,s,i),Dt.clearBuffer()}function Hd(l,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Dt,a=l*2;if(Gs(a,r)){const h=js(l,o),c=ri(a,r);Vy(e,t,s,h,c,i)}else{const h=oi(l);Gn(h,n,s,_m)&&Hd(h,e,t,s,i);const c=ai(l,o);Gn(c,n,s,_m)&&Hd(c,e,t,s,i)}}const Tm=new U,tw=["x","y","z"];function sw(l,e,t,s){Dt.setBuffer(l._roots[e]);const i=Wd(0,l,t,s);return Dt.clearBuffer(),i}function Wd(l,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=Dt;let o=l*2;if(Gs(o,n)){const a=js(l,r),h=ri(o,n);return Yy(e,t,s,a,h)}else{const a=B0(l,r),h=tw[a],c=s.direction[h]>=0;let d,u;c?(d=oi(l),u=ai(l,r)):(d=ai(l,r),u=oi(l));const f=Gn(d,i,s,Tm)?Wd(d,e,t,s):null;if(f){const p=f.point[h];if(c?p<=i[u+a]:p>=i[u+a+3])return f}const m=Gn(u,i,s,Tm)?Wd(u,e,t,s):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}const mh=new Qe,$r=new xi,eo=new xi,Aa=new Oe,xm=new Ms,gh=new Ms;function iw(l,e,t,s){Dt.setBuffer(l._roots[e]);const i=jd(0,l,t,s);return Dt.clearBuffer(),i}function jd(l,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=Dt;let a=l*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),xm.set(t.boundingBox.min,t.boundingBox.max,s),i=xm),Gs(a,r)){const h=e.geometry,c=h.index,d=h.attributes.position,u=t.index,f=t.attributes.position,m=js(l,o),p=ri(a,r);if(Aa.copy(s).invert(),t.boundsTree)return Yt(l,n,gh),gh.matrix.copy(Aa),gh.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>gh.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(s),g.b.applyMatrix4(s),g.c.applyMatrix4(s),g.needsUpdate=!0;for(let E=m,I=p+m;E<I;E++)if(es(eo,3*e.resolveTriangleIndex(E),c,d),eo.needsUpdate=!0,g.intersectsTriangle(eo))return!0;return!1}});for(let g=m,E=p+m;g<E;g++){const I=e.resolveTriangleIndex(g);es($r,3*I,c,d),$r.a.applyMatrix4(Aa),$r.b.applyMatrix4(Aa),$r.c.applyMatrix4(Aa),$r.needsUpdate=!0;for(let v=0,b=u.count;v<b;v+=3)if(es(eo,v,u,f),eo.needsUpdate=!0,$r.intersectsTriangle(eo))return!0}}else{const h=l+8,c=o[l+6];return Yt(h,n,mh),!!(i.intersectsBox(mh)&&jd(h,e,t,s,i)||(Yt(c,n,mh),i.intersectsBox(mh)&&jd(c,e,t,s,i)))}}const Eh=new Oe,Yu=new Ms,Fa=new Ms,nw=new U,rw=new U,ow=new U,aw=new U;function lw(l,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Yu.set(e.boundingBox.min,e.boundingBox.max,t),Yu.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,h=o.index,c=e.attributes.position,d=e.index,u=ni.getPrimitive(),f=ni.getPrimitive();let m=nw,p=rw,g=null,E=null;i&&(g=ow,E=aw);let I=1/0,v=null,b=null;return Eh.copy(t).invert(),Fa.matrix.copy(Eh),l.shapecast({boundsTraverseOrder:C=>Yu.distanceToBox(C),intersectsBounds:(C,F,A)=>A<I&&A<r?(F&&(Fa.min.copy(C.min),Fa.max.copy(C.max),Fa.needsUpdate=!0),!0):!1,intersectsRange:(C,F)=>{if(e.boundsTree){const A=e.boundsTree;return A.shapecast({boundsTraverseOrder:R=>Fa.distanceToBox(R),intersectsBounds:(R,O,L)=>L<I&&L<r,intersectsRange:(R,O)=>{for(let L=R,k=R+O;L<k;L++){const x=A.resolveTriangleIndex(L);es(f,3*x,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let M=C,w=C+F;M<w;M++){const G=l.resolveTriangleIndex(M);es(u,3*G,h,a),u.needsUpdate=!0;const J=u.distanceToTriangle(f,m,g);if(J<I&&(p.copy(m),E&&E.copy(g),I=J,v=M,b=L),J<n)return!0}}}})}else{const A=na(e);for(let R=0,O=A;R<O;R++){es(f,3*R,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let L=C,k=C+F;L<k;L++){const x=l.resolveTriangleIndex(L);es(u,3*x,h,a),u.needsUpdate=!0;const M=u.distanceToTriangle(f,m,g);if(M<I&&(p.copy(m),E&&E.copy(g),I=M,v=L,b=R),M<n)return!0}}}}}),ni.releasePrimitive(u),ni.releasePrimitive(f),I===1/0?null:(s.point?s.point.copy(p):s.point=p.clone(),s.distance=I,s.faceIndex=v,i&&(i.point?i.point.copy(E):i.point=E.clone(),i.point.applyMatrix4(Eh),p.applyMatrix4(Eh),i.distance=p.sub(i.point).length(),i.faceIndex=b),s)}function hw(){return typeof SharedArrayBuffer<"u"}const rl=new Dt.constructor,_c=new Dt.constructor,Nn=new Jf(()=>new Qe),to=new Qe,so=new Qe,Gu=new Qe,Hu=new Qe;let Wu=!1;function cw(l,e,t,s){if(Wu)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Wu=!0;const i=l._roots,n=e._roots;let r,o=0,a=0;const h=new Oe().copy(t).invert();for(let c=0,d=i.length;c<d;c++){rl.setBuffer(i[c]),a=0;const u=Nn.getPrimitive();Yt(0,rl.float32Array,u),u.applyMatrix4(h);for(let f=0,m=n.length;f<m&&(_c.setBuffer(n[c]),r=bi(0,0,t,h,s,o,a,0,0,u),_c.clearBuffer(),a+=n[f].length,!r);f++);if(Nn.releasePrimitive(u),rl.clearBuffer(),o+=i[c].length,r)break}return Wu=!1,r}function bi(l,e,t,s,i,n=0,r=0,o=0,a=0,h=null,c=!1){let d,u;c?(d=_c,u=rl):(d=rl,u=_c);const f=d.float32Array,m=d.uint32Array,p=d.uint16Array,g=u.float32Array,E=u.uint32Array,I=u.uint16Array,v=l*2,b=e*2,C=Gs(v,p),F=Gs(b,I);let A=!1;if(F&&C)c?A=i(js(e,E),ri(e*2,I),js(l,m),ri(l*2,p),a,r+e,o,n+l):A=i(js(l,m),ri(l*2,p),js(e,E),ri(e*2,I),o,n+l,a,r+e);else if(F){const R=Nn.getPrimitive();Yt(e,g,R),R.applyMatrix4(t);const O=oi(l),L=ai(l,m);Yt(O,f,to),Yt(L,f,so);const k=R.intersectsBox(to),x=R.intersectsBox(so);A=k&&bi(e,O,s,t,i,r,n,a,o+1,R,!c)||x&&bi(e,L,s,t,i,r,n,a,o+1,R,!c),Nn.releasePrimitive(R)}else{const R=oi(e),O=ai(e,E);Yt(R,g,Gu),Yt(O,g,Hu);const L=h.intersectsBox(Gu),k=h.intersectsBox(Hu);if(L&&k)A=bi(l,R,t,s,i,n,r,o,a+1,h,c)||bi(l,O,t,s,i,n,r,o,a+1,h,c);else if(L)if(C)A=bi(l,R,t,s,i,n,r,o,a+1,h,c);else{const x=Nn.getPrimitive();x.copy(Gu).applyMatrix4(t);const M=oi(l),w=ai(l,m);Yt(M,f,to),Yt(w,f,so);const G=x.intersectsBox(to),J=x.intersectsBox(so);A=G&&bi(R,M,s,t,i,r,n,a,o+1,x,!c)||J&&bi(R,w,s,t,i,r,n,a,o+1,x,!c),Nn.releasePrimitive(x)}else if(k)if(C)A=bi(l,O,t,s,i,n,r,o,a+1,h,c);else{const x=Nn.getPrimitive();x.copy(Hu).applyMatrix4(t);const M=oi(l),w=ai(l,m);Yt(M,f,to),Yt(w,f,so);const G=x.intersectsBox(to),J=x.intersectsBox(so);A=G&&bi(O,M,s,t,i,r,n,a,o+1,x,!c)||J&&bi(O,w,s,t,i,r,n,a,o+1,x,!c),Nn.releasePrimitive(x)}}return A}const Ih=new Ms,Am=new Qe;class $f{static serialize(e,t={}){t={cloneBuffers:!0,...t};const s=e.geometry,i=e._roots,n=e._indirectBuffer,r=s.getIndex();let o;return t.cloneBuffers?o={roots:i.map(a=>a.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:i,index:r.array,indirectBuffer:n},o}static deserialize(e,t,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:i,roots:n,indirectBuffer:r}=e,o=new $f(t,{...s,[Uu]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const a=t.getIndex();if(a===null){const h=new Rt(e.index,1,!1);t.setIndex(h)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:D0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Uu]:!1},t),t.useSharedArrayBuffer&&!hw())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Uu]||(Ay(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Qe)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=t.indirect?i=>s[i]:i=>i}refit(e=null){return(this.indirect?$y:ky)(this,e)}traverse(e,t=0){const s=this._roots[t],i=new Uint32Array(s),n=new Uint16Array(s);r(0);function r(o,a=0){const h=o*2,c=n[h+15]===Uc;if(c){const d=i[o+6],u=n[h+14];e(a,c,new Float32Array(s,o*4,6),d,u)}else{const d=o+dc/4,u=i[o+6],f=i[o+7];e(a,c,new Float32Array(s,o*4,6),f)||(r(d,a+1),r(u,a+1))}}}raycast(e,t=Do){const s=this._roots,i=this.geometry,n=[],r=t.isMaterial,o=Array.isArray(t),a=i.groups,h=r?t.side:t,c=this.indirect?ew:Hy;for(let d=0,u=s.length;d<u;d++){const f=o?t[a[d].materialIndex].side:h,m=n.length;if(c(this,d,f,e,n),o){const p=a[d].materialIndex;for(let g=m,E=n.length;g<E;g++)n[g].face.materialIndex=p}}return n}raycastFirst(e,t=Do){const s=this._roots,i=this.geometry,n=t.isMaterial,r=Array.isArray(t);let o=null;const a=i.groups,h=n?t.side:t,c=this.indirect?sw:jy;for(let d=0,u=s.length;d<u;d++){const f=r?t[a[d].materialIndex].side:h,m=c(this,d,f,e);m!=null&&(o==null||m.distance<o.distance)&&(o=m,r&&(m.face.materialIndex=a[d].materialIndex))}return o}intersectsGeometry(e,t){let s=!1;const i=this._roots,n=this.indirect?iw:Zy;for(let r=0,o=i.length;r<o&&(s=n(this,r,e,t),!s);r++);return s}shapecast(e){const t=ni.getPrimitive(),s=this.indirect?Gy:zy;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const d=r;r=(u,f,m,p,g)=>d(u,f,m,p,g)?!0:s(u,f,this,o,m,p,t)}else r||(o?r=(d,u,f,m)=>s(d,u,this,o,f,m,t):r=(d,u,f)=>f);let a=!1,h=0;const c=this._roots;for(let d=0,u=c.length;d<u;d++){const f=c[d];if(a=My(this,d,n,r,i,h),a)break;h+=f.byteLength}return ni.releasePrimitive(t),a}bvhcast(e,t,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=ni.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,h=this.indirect?m=>{const p=this.resolveTriangleIndex(m);es(r,p*3,o,a)}:m=>{es(r,m*3,o,a)},c=ni.getPrimitive(),d=e.geometry.index,u=e.geometry.attributes.position,f=e.indirect?m=>{const p=e.resolveTriangleIndex(m);es(c,p*3,d,u)}:m=>{es(c,m*3,d,u)};if(n){const m=(p,g,E,I,v,b,C,F)=>{for(let A=E,R=E+I;A<R;A++){f(A),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let O=p,L=p+g;O<L;O++)if(h(O),r.needsUpdate=!0,n(r,c,O,A,v,b,C,F))return!0}return!1};if(i){const p=i;i=function(g,E,I,v,b,C,F,A){return p(g,E,I,v,b,C,F,A)?!0:m(g,E,I,v,b,C,F,A)}}else i=m}return cw(this,e,t,i)}intersectsBox(e,t){return Ih.set(e.min,e.max,t),Ih.needsUpdate=!0,this.shapecast({intersectsBounds:s=>Ih.intersectsBox(s),intersectsTriangle:s=>Ih.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,s={},i={},n=0,r=1/0){return(this.indirect?lw:Jy)(this,e,t,s,i,n,r)}closestPointToPoint(e,t={},s=0,i=1/0){return Ny(this,e,t,s,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Yt(0,new Float32Array(t),Am),e.union(Am)}),e}}function Fm(l,e,t){return l===null||(l.point.applyMatrix4(e.matrixWorld),l.distance=l.point.distanceTo(t.ray.origin),l.object=e,l.distance<t.near||l.distance>t.far)?null:l}const ju=new Vf,Rm=new Oe,uw=ye.prototype.raycast;function dw(l,e){if(this.geometry.boundsTree){if(this.material===void 0)return;Rm.copy(this.matrixWorld).invert(),ju.copy(l.ray).applyMatrix4(Rm);const t=this.geometry.boundsTree;if(l.firstHitOnly===!0){const s=Fm(t.raycastFirst(ju,this.material),this,l);s&&e.push(s)}else{const s=t.raycast(ju,this.material);for(let i=0,n=s.length;i<n;i++){const r=Fm(s[i],this,l);r&&e.push(r)}}}else uw.call(this,l,e)}function fw(l){return this.boundsTree=new $f(this,l),this.boundsTree}function pw(){this.boundsTree=null}class Ue{constructor(){V(this,"trigger",e=>{const t=this.handlers.slice(0);for(const s of t)s(e)}),V(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class fc{constructor(){V(this,"trigger",async e=>{const t=this.handlers.slice(0);for(const s of t)await s(e)}),V(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class ep{constructor(e){V(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),V(this,"isResizeable",()=>"resize"in this&&"getSize"in this),V(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),V(this,"isHideable",()=>"visible"in this),V(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=e}}let qt=class extends ep{};class z0 extends ep{constructor(e){super(e),V(this,"worlds",new Map),V(this,"onWorldChanged",new Ue),V(this,"currentWorld",null),this.onWorldChanged.add(({world:t,action:s})=>{s==="removed"&&this.worlds.delete(t.uuid)})}}let mw=class extends z0{constructor(){super(...arguments),V(this,"hasCameraControls",()=>"controls"in this)}};const k0=class Zd extends qt{constructor(e){super(e),V(this,"_disposedComponents",new Set),V(this,"enabled",!0),e.add(Zd.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,s=!0){e.removeFromParent();const i=e;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(e,t),s&&i.children&&i.children.length&&this.disposeChildren(i),e.children.length=0}disposeGeometry(e){e.boundsTree&&e.disposeBoundsTree&&e.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){const s=e;s.geometry&&this.disposeGeometry(s.geometry),t&&s.material&&Zd.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(e){for(const t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()}};V(k0,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let Bo=k0;class gw extends z0{constructor(e){super(e),V(this,"onDisposed",new Ue),V(this,"directionalLights",new Map),V(this,"ambientLights",new Map)}dispose(){const e=this.components.get(Bo);for(const t of this.three.children){const s=t;s.geometry&&e.destroy(s)}for(const[,t]of this.directionalLights)t.removeFromParent(),t.target.removeFromParent(),t.dispose();for(const[,t]of this.ambientLights)t.removeFromParent(),t.dispose();this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}}class Po extends Set{constructor(e){super(e),V(this,"onItemAdded",new Ue),V(this,"onItemDeleted",new Ue),V(this,"onCleared",new Ue),V(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...e){for(const t of e)this.has(t)||!this.guard(t)||(super.add(t),this.onItemAdded||(this.onItemAdded=new Ue),this.onItemAdded.trigger(t));return this}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(),t}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class Hn extends Map{constructor(e){super(e),V(this,"onItemSet",new Ue),V(this,"onItemUpdated",new Ue),V(this,"onItemDeleted",new Ue),V(this,"onCleared",new Ue),V(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(e,t){const s=this.has(e);if(!(this.guard??(()=>!0))(e,t))return this;const i=super.set(e,t);return s?(this.onItemUpdated||(this.onItemUpdated=new Ue),this.onItemUpdated.trigger({key:e,value:t})):(this.onItemSet||(this.onItemSet=new Ue),this.onItemSet.trigger({key:e,value:t})),i}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(e),t}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}const pc=0,Ew=1,Iw=new U,Sm=new Et,Zu=new _s,Om=new U,bh=new cs;let bw=class{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Pm,this.unassigned=new Pm,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.vertices.push(new yw(e[t]));this.compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(s){const i=s.geometry;if(i!==void 0){const n=i.attributes.position;if(n!==void 0)for(let r=0,o=n.count;r<o;r++){const a=new U;a.fromBufferAttribute(n,r).applyMatrix4(s.matrixWorld),t.push(a)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let s=0,i=t.length;s<i;s++)if(t[s].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const s=this.faces;let i=-1/0,n=1/0;for(let r=0,o=s.length;r<o;r++){const a=s[r],h=a.distanceToPoint(e.origin),c=a.normal.dot(e.direction);if(h>0&&c>=0)return null;const d=c!==0?-h/c:0;if(!(d<=0)&&(c>0?n=Math.min(d,n):i=Math.max(d,i),i>n))return null}return i!==-1/0?e.at(i,t):e.at(n,t),t}intersectsRay(e){return this.intersectRay(e,Iw)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let s=e.outside;for(;s.next!==null&&s.next.face===e;)s=s.next;return this.assigned.removeSubList(t,s),t.prev=s.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const s=this.removeAllVerticesFromFace(e);if(s!==void 0)if(t===void 0)this.unassigned.appendChain(s);else{let i=s;do{const n=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=n}while(i!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const s=t.next;let i=this.tolerance,n=null;for(let r=0;r<e.length;r++){const o=e[r];if(o.mark===pc){const a=o.distanceToPoint(t.point);if(a>i&&(i=a,n=o),i>1e3*this.tolerance)break}}n!==null&&this.addVertexToFace(t,n),t=s}while(t!==null)}return this}computeExtremes(){const e=new U,t=new U,s=[],i=[];for(let n=0;n<3;n++)s[n]=i[n]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let n=0,r=this.vertices.length;n<r;n++){const o=this.vertices[n],a=o.point;for(let h=0;h<3;h++)a.getComponent(h)<e.getComponent(h)&&(e.setComponent(h,a.getComponent(h)),s[h]=o);for(let h=0;h<3;h++)a.getComponent(h)>t.getComponent(h)&&(t.setComponent(h,a.getComponent(h)),i[h]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:s,max:i}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),s=t.min,i=t.max;let n=0,r=0;for(let u=0;u<3;u++){const f=i[u].point.getComponent(u)-s[u].point.getComponent(u);f>n&&(n=f,r=u)}const o=s[r],a=i[r];let h,c;n=0,Sm.set(o.point,a.point);for(let u=0,f=this.vertices.length;u<f;u++){const m=e[u];if(m!==o&&m!==a){Sm.closestPointToPoint(m.point,!0,Om);const p=Om.distanceToSquared(m.point);p>n&&(n=p,h=m)}}n=-1,Zu.setFromCoplanarPoints(o.point,a.point,h.point);for(let u=0,f=this.vertices.length;u<f;u++){const m=e[u];if(m!==o&&m!==a&&m!==h){const p=Math.abs(Zu.distanceToPoint(m.point));p>n&&(n=p,c=m)}}const d=[];if(Zu.distanceToPoint(c.point)<0){d.push(vi.create(o,a,h),vi.create(c,a,o),vi.create(c,h,a),vi.create(c,o,h));for(let u=0;u<3;u++){const f=(u+1)%3;d[u+1].getEdge(2).setTwin(d[0].getEdge(f)),d[u+1].getEdge(1).setTwin(d[f+1].getEdge(0))}}else{d.push(vi.create(o,h,a),vi.create(c,o,a),vi.create(c,a,h),vi.create(c,h,o));for(let u=0;u<3;u++){const f=(u+1)%3;d[u+1].getEdge(2).setTwin(d[0].getEdge((3-u)%3)),d[u+1].getEdge(0).setTwin(d[f+1].getEdge(1))}}for(let u=0;u<4;u++)this.faces.push(d[u]);for(let u=0,f=e.length;u<f;u++){const m=e[u];if(m!==o&&m!==a&&m!==h&&m!==c){n=this.tolerance;let p=null;for(let g=0;g<4;g++){const E=this.faces[g].distanceToPoint(m.point);E>n&&(n=E,p=this.faces[g])}p!==null&&this.addVertexToFace(m,p)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const s=this.faces[t];s.mark===pc&&e.push(s)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const s=this.assigned.first().face;let i=s.outside;do{const n=s.distanceToPoint(i.point);n>t&&(t=n,e=i),i=i.next}while(i!==null&&i.face===s);return e}}computeHorizon(e,t,s,i){this.deleteFaceVertices(s),s.mark=Ew;let n;t===null?n=t=s.getEdge(0):n=t.next;do{const r=n.twin,o=r.face;o.mark===pc&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,o,i):i.push(n)),n=n.next}while(n!==t);return this}addAdjoiningFace(e,t){const s=vi.create(e,t.tail(),t.head());return this.faces.push(s),s.getEdge(-1).setTwin(t.twin),s.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let s=null,i=null;for(let n=0;n<t.length;n++){const r=t[n],o=this.addAdjoiningFace(e,r);s===null?s=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return s.next.setTwin(i),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}};class vi{constructor(){this.normal=new U,this.midpoint=new U,this.area=0,this.constant=0,this.outside=null,this.mark=pc,this.edge=null}static create(e,t,s){const i=new vi,n=new Xu(e,i),r=new Xu(t,i),o=new Xu(s,i);return n.next=o.prev=r,r.next=n.prev=o,o.next=r.prev=n,i.edge=n,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),s=this.edge.next.head();return bh.set(e.point,t.point,s.point),bh.getNormal(this.normal),bh.getMidpoint(this.midpoint),this.area=bh.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}let Xu=class{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}},yw=class{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}};class Pm{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}const Xd=[2,2,1],Kd=[1,0,0];function zi(l,e){return l*3+e}function ww(l){const e=l.elements;let t=0;for(let s=0;s<9;s++)t+=e[s]*e[s];return Math.sqrt(t)}function Cw(l){const e=l.elements;let t=0;for(let s=0;s<3;s++){const i=e[zi(Xd[s],Kd[s])];t+=2*i*i}return Math.sqrt(t)}function vw(l,e){let t=0,s=1;const i=l.elements;for(let h=0;h<3;h++){const c=Math.abs(i[zi(Xd[h],Kd[h])]);c>t&&(t=c,s=h)}let n=1,r=0;const o=Kd[s],a=Xd[s];if(Math.abs(i[zi(a,o)])>Number.EPSILON){const h=i[zi(a,a)],c=i[zi(o,o)],d=i[zi(a,o)],u=(h-c)/2/d;let f;u<0?f=-1/(-u+Math.sqrt(1+u*u)):f=1/(u+Math.sqrt(1+u*u)),n=1/Math.sqrt(1+f*f),r=f*n}return e.identity(),e.elements[zi(o,o)]=n,e.elements[zi(a,a)]=n,e.elements[zi(a,o)]=r,e.elements[zi(o,a)]=-r,e}function _w(l,e){let t=0,s=0;const i=10;e.unitary.identity(),e.diagonal.copy(l);const n=e.unitary,r=e.diagonal,o=new Us,a=new Us,h=Number.EPSILON*ww(r);for(;s<i&&Cw(r)>h;)vw(r,o),a.copy(o).transpose(),r.multiply(o),r.premultiply(a),n.multiply(o),++t>2&&(s++,t=0);return e}function Tw(l){const e=[];for(let Se=0;Se<l.length-2;Se+=3){const _e=l[Se],Le=l[Se+1],Ge=l[Se+2];e.push(new U(_e,Le,Ge))}const t=new bw;t.setFromPoints(e);const s={unitary:new Us,diagonal:new Us},i=t.faces,n=[],r=[];for(let Se=0,_e=i.length;Se<_e;Se++){const Le=i[Se];let Ge=Le.edge;n.length=0;do n.push(Ge),Ge=Ge.next;while(Ge!==Le.edge);const Ze=n.length-2;for(let $e=1,_=Ze;$e<=_;$e++){const $=n[0].vertex,Q=n[$e+0].vertex,N=n[$e+1].vertex;r.push($.point.x,$.point.y,$.point.z),r.push(Q.point.x,Q.point.y,Q.point.z),r.push(N.point.x,N.point.y,N.point.z)}}const o=new U,a=new U,h=new U,c=new U,d=new U,u=new U,f=new U,m=new U;let p=0,g=0,E=0,I=0,v=0,b=0,C=0;for(let Se=0,_e=r.length;Se<_e;Se+=9){o.fromArray(r,Se),a.fromArray(r,Se+3),h.fromArray(r,Se+6),f.set(0,0,0),f.add(o).add(a).add(h).divideScalar(3),c.subVectors(a,o),d.subVectors(h,o);const Le=u.crossVectors(c,d).length()/2;m.add(u.copy(f).multiplyScalar(Le)),p+=Le,g+=(9*f.x*f.x+o.x*o.x+a.x*a.x+h.x*h.x)*(Le/12),E+=(9*f.x*f.y+o.x*o.y+a.x*a.y+h.x*h.y)*(Le/12),I+=(9*f.x*f.z+o.x*o.z+a.x*a.z+h.x*h.z)*(Le/12),v+=(9*f.y*f.y+o.y*o.y+a.y*a.y+h.y*h.y)*(Le/12),b+=(9*f.y*f.z+o.y*o.z+a.y*a.z+h.y*h.z)*(Le/12),C+=(9*f.z*f.z+o.z*o.z+a.z*a.z+h.z*h.z)*(Le/12)}m.divideScalar(p),g/=p,E/=p,I/=p,v/=p,b/=p,C/=p,g-=m.x*m.x,E-=m.x*m.y,I-=m.x*m.z,v-=m.y*m.y,b-=m.y*m.z,C-=m.z*m.z;const F=new Us;F.elements[0]=g,F.elements[1]=E,F.elements[2]=I,F.elements[3]=E,F.elements[4]=v,F.elements[5]=b,F.elements[6]=I,F.elements[7]=b,F.elements[8]=C,_w(F,s);const A=s.unitary,R=new U,O=new U,L=new U;A.extractBasis(R,O,L);let k=-1/0,x=-1/0,M=-1/0,w=1/0,G=1/0,J=1/0;for(let Se=0,_e=e.length;Se<_e;Se++){const Le=e[Se];k=Math.max(R.dot(Le),k),x=Math.max(O.dot(Le),x),M=Math.max(L.dot(Le),M),w=Math.min(R.dot(Le),w),G=Math.min(O.dot(Le),G),J=Math.min(L.dot(Le),J)}R.multiplyScalar(.5*(w+k)),O.multiplyScalar(.5*(G+x)),L.multiplyScalar(.5*(J+M));const Z=new U,le=new U,ee=new Us;Z.add(R).add(O).add(L),le.x=k-w,le.y=x-G,le.z=M-J,le.multiplyScalar(.5),ee.copy(A);const{x:xe,y:X,z:j}=le,be=new Oe;be.makeScale(xe*2,X*2,j*2);const fe=new Oe;fe.makeTranslation(-xe,-X,-j);const ue=new Oe;ue.makeTranslation(Z.x,Z.y,Z.z);const He=new Oe;He.setFromMatrix3(ee);const Xe=new Oe;return Xe.multiply(ue),Xe.multiply(He),Xe.multiply(fe),Xe.multiply(be),{center:Z,halfSizes:le,rotation:ee,transformation:Xe}}function xw(l,e,t){const s=[l[0]-e[0],l[1]-e[1],l[2]-e[2]];return t[0]*s[0]+t[1]*s[1]+t[2]*s[2]>0}class Mm{static isTransparent(e){return e.transparent&&e.opacity<1}}const Qd=class as{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${as._lut[e&255]+as._lut[e>>8&255]+as._lut[e>>16&255]+as._lut[e>>24&255]}-${as._lut[t&255]}${as._lut[t>>8&255]}-${as._lut[t>>16&15|64]}${as._lut[t>>24&255]}-${as._lut[s&63|128]}${as._lut[s>>8&255]}-${as._lut[s>>16&255]}${as._lut[s>>24&255]}${as._lut[i&255]}${as._lut[i>>8&255]}${as._lut[i>>16&255]}${as._lut[i>>24&255]}`.toLowerCase()}static validate(e){if(!as._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};V(Qd,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),V(Qd,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let Cr=Qd;const V0=class Y0{constructor(){V(this,"onDisposed",new Ue),V(this,"list",new Map),V(this,"enabled",!1),V(this,"_clock"),V(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(e);requestAnimationFrame(this.update)}),this._clock=new Yf,Y0.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");Cr.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const s=new e(this);return this.list.has(t)||this.add(t,s),s}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){ft.prototype.computeBoundsTree=fw,ft.prototype.disposeBoundsTree=pw,ye.prototype.raycast=dw}};V(V0,"release","2.2.9");let Aw=V0,Fw=class extends ep{constructor(){super(...arguments),V(this,"meshes",new Set),V(this,"onAfterUpdate",new Ue),V(this,"onBeforeUpdate",new Ue),V(this,"onDisposed",new Ue),V(this,"isDisposing",!1),V(this,"enabled",!0),V(this,"uuid",Cr.create()),V(this,"name"),V(this,"_scene"),V(this,"_camera"),V(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const t=this.components.get(Bo);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)t.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}},xx=class extends gw{constructor(e){super(e),V(this,"isSetup",!1),V(this,"three"),V(this,"onSetup",new Ue),V(this,"config",{directionalLight:{color:new mt("white"),intensity:1.5,position:new U(5,10,3)},ambientLight:{color:new mt("white"),intensity:1}}),this.three=new Zi,this.three.background=new mt(2107698)}setup(e){this.config={...this.config,...e};const t=new MI(this.config.directionalLight.color,this.config.directionalLight.intensity);t.position.copy(this.config.directionalLight.position);const s=new NI(this.config.ambientLight.color,this.config.ambientLight.intensity);this.three.add(t,s),this.directionalLights.set(t.uuid,t),this.ambientLights.set(s.uuid,s),this.isSetup=!0,this.onSetup.trigger(this)}};/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const tt={LEFT:1,RIGHT:2,MIDDLE:4},Ae=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),io={NONE:0,IN:1,OUT:-1};function ir(l){return l.isPerspectiveCamera}function Fn(l){return l.isOrthographicCamera}const no=Math.PI*2,Nm=Math.PI/2,G0=1e-5,Ra=Math.PI/180;function yi(l,e,t){return Math.max(e,Math.min(t,l))}function St(l,e=G0){return Math.abs(l)<e}function wt(l,e,t=G0){return St(l-e,t)}function Dm(l,e){return Math.round(l/e)*e}function Sa(l){return isFinite(l)?l:l<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Oa(l){return Math.abs(l)<Number.MAX_VALUE?l:l*(1/0)}function yh(l,e,t,s,i=1/0,n){s=Math.max(1e-4,s);const r=2/s,o=r*n,a=1/(1+o+.48*o*o+.235*o*o*o);let h=l-e;const c=e,d=i*s;h=yi(h,-d,d),e=l-h;const u=(t.value+r*h)*n;t.value=(t.value-r*u)*a;let f=e+(h+u)*a;return c-l>0==f>c&&(f=c,t.value=(f-c)/n),f}function Lm(l,e,t,s,i=1/0,n,r){s=Math.max(1e-4,s);const o=2/s,a=o*n,h=1/(1+a+.48*a*a+.235*a*a*a);let c=e.x,d=e.y,u=e.z,f=l.x-c,m=l.y-d,p=l.z-u;const g=c,E=d,I=u,v=i*s,b=v*v,C=f*f+m*m+p*p;if(C>b){const G=Math.sqrt(C);f=f/G*v,m=m/G*v,p=p/G*v}c=l.x-f,d=l.y-m,u=l.z-p;const F=(t.x+o*f)*n,A=(t.y+o*m)*n,R=(t.z+o*p)*n;t.x=(t.x-o*F)*h,t.y=(t.y-o*A)*h,t.z=(t.z-o*R)*h,r.x=c+(f+F)*h,r.y=d+(m+A)*h,r.z=u+(p+R)*h;const O=g-l.x,L=E-l.y,k=I-l.z,x=r.x-g,M=r.y-E,w=r.z-I;return O*x+L*M+k*w>0&&(r.x=g,r.y=E,r.z=I,t.x=(r.x-g)/n,t.y=(r.y-E)/n,t.z=(r.z-I)/n),r}function Ku(l,e){e.set(0,0),l.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=l.length,e.y/=l.length}function Qu(l,e){return Fn(l)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}let Rw=class{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const t=this._listeners[e.type];if(t!==void 0){e.target=this;const s=t.slice(0);for(let i=0,n=s.length;i<n;i++)s[i].call(this,e)}}};const Sw="2.7.3",wh=1/8,H0=typeof window<"u",Ow=H0&&/Mac/.test(navigator.platform),Pw=!(H0&&"PointerEvent"in window);let qe,Um,Ch,qu,Ds,rt,bt,ro,Pa,Oi,Pi,nr,Bm,zm,qs,Ma,oo,km,Ju,Vm,$u,ed,vh;class Cs extends Rw{static install(e){qe=e.THREE,Um=Object.freeze(new qe.Vector3(0,0,0)),Ch=Object.freeze(new qe.Vector3(0,1,0)),qu=Object.freeze(new qe.Vector3(0,0,1)),Ds=new qe.Vector2,rt=new qe.Vector3,bt=new qe.Vector3,ro=new qe.Vector3,Pa=new qe.Vector3,Oi=new qe.Vector3,Pi=new qe.Vector3,nr=new qe.Vector3,Bm=new qe.Vector3,zm=new qe.Vector3,qs=new qe.Spherical,Ma=new qe.Spherical,oo=new qe.Box3,km=new qe.Box3,Ju=new qe.Sphere,Vm=new qe.Quaternion,$u=new qe.Quaternion,ed=new qe.Matrix4,vh=new qe.Raycaster}static get ACTION(){return Ae}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=Ae.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=io.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new qe.Vector3,this._focalOffsetVelocity=new qe.Vector3,this._zoomVelocity={value:0},this._truckInternal=(b,C,F)=>{let A,R;if(ir(this._camera)){const O=rt.copy(this._camera.position).sub(this._target),L=this._camera.getEffectiveFOV()*Ra,k=O.length()*Math.tan(L*.5);A=this.truckSpeed*b*k/this._elementRect.height,R=this.truckSpeed*C*k/this._elementRect.height}else if(Fn(this._camera)){const O=this._camera;A=b*(O.right-O.left)/O.zoom/this._elementRect.width,R=C*(O.top-O.bottom)/O.zoom/this._elementRect.height}else return;this.verticalDragToForward?(F?this.setFocalOffset(this._focalOffsetEnd.x+A,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(A,0,!0),this.forward(-R,!0)):F?this.setFocalOffset(this._focalOffsetEnd.x+A,this._focalOffsetEnd.y+R,this._focalOffsetEnd.z,!0):this.truck(A,R,!0)},this._rotateInternal=(b,C)=>{const F=no*this.azimuthRotateSpeed*b/this._elementRect.height,A=no*this.polarRotateSpeed*C/this._elementRect.height;this.rotate(F,A,!0)},this._dollyInternal=(b,C,F)=>{const A=Math.pow(.95,-b*this.dollySpeed),R=this._sphericalEnd.radius,O=this._sphericalEnd.radius*A,L=yi(O,this.minDistance,this.maxDistance),k=L-O;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(O,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(k,!0),this._dollyToNoClamp(L,!0)):this._dollyToNoClamp(L,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?O:L)-R,this._dollyControlCoord.set(C,F)),this._lastDollyDirection=Math.sign(-b)},this._zoomInternal=(b,C,F)=>{const A=Math.pow(.95,b*this.dollySpeed),R=this._zoom,O=this._zoom*A;this.zoomTo(O,!0),this.dollyToCursor&&(this._changedZoom+=O-R,this._dollyControlCoord.set(C,F))},typeof qe>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new qe.Quaternion().setFromUnitVectors(this._camera.up,Ch),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=Ae.NONE,this._target=new qe.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new qe.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new qe.Spherical().setFromVector3(rt.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new qe.Vector3,new qe.Vector3,new qe.Vector3,new qe.Vector3],this._updateNearPlaneCorners(),this._boundary=new qe.Box3(new qe.Vector3(-1/0,-1/0,-1/0),new qe.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new qe.Vector2,this.mouseButtons={left:Ae.ROTATE,middle:Ae.DOLLY,right:Ae.TRUCK,wheel:ir(this._camera)?Ae.DOLLY:Fn(this._camera)?Ae.ZOOM:Ae.NONE},this.touches={one:Ae.TOUCH_ROTATE,two:ir(this._camera)?Ae.TOUCH_DOLLY_TRUCK:Fn(this._camera)?Ae.TOUCH_ZOOM_TRUCK:Ae.NONE,three:Ae.TOUCH_TRUCK};const s=new qe.Vector2,i=new qe.Vector2,n=new qe.Vector2,r=b=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const A=this._domElement.getBoundingClientRect(),R=b.clientX/A.width,O=b.clientY/A.height;if(R<this._interactiveArea.left||R>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}const C=b.pointerType!=="mouse"?null:(b.buttons&tt.LEFT)===tt.LEFT?tt.LEFT:(b.buttons&tt.MIDDLE)===tt.MIDDLE?tt.MIDDLE:(b.buttons&tt.RIGHT)===tt.RIGHT?tt.RIGHT:null;if(C!==null){const A=this._findPointerByMouseButton(C);A&&this._disposePointer(A)}if((b.buttons&tt.LEFT)===tt.LEFT&&this._lockedPointer)return;const F={pointerId:b.pointerId,clientX:b.clientX,clientY:b.clientY,deltaX:0,deltaY:0,mouseButton:C};this._activePointers.push(F),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,p(b)},o=b=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const A=this._domElement.getBoundingClientRect(),R=b.clientX/A.width,O=b.clientY/A.height;if(R<this._interactiveArea.left||R>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}const C=(b.buttons&tt.LEFT)===tt.LEFT?tt.LEFT:(b.buttons&tt.MIDDLE)===tt.MIDDLE?tt.MIDDLE:(b.buttons&tt.RIGHT)===tt.RIGHT?tt.RIGHT:null;if(C!==null){const A=this._findPointerByMouseButton(C);A&&this._disposePointer(A)}const F={pointerId:1,clientX:b.clientX,clientY:b.clientY,deltaX:0,deltaY:0,mouseButton:(b.buttons&tt.LEFT)===tt.LEFT?tt.LEFT:(b.buttons&tt.MIDDLE)===tt.LEFT?tt.MIDDLE:(b.buttons&tt.RIGHT)===tt.LEFT?tt.RIGHT:null};this._activePointers.push(F),this._domElement.ownerDocument.removeEventListener("mousemove",h),this._domElement.ownerDocument.removeEventListener("mouseup",d),this._domElement.ownerDocument.addEventListener("mousemove",h),this._domElement.ownerDocument.addEventListener("mouseup",d),this._isDragging=!0,p(b)},a=b=>{b.cancelable&&b.preventDefault();const C=b.pointerId,F=this._lockedPointer||this._findPointerById(C);if(F){if(F.clientX=b.clientX,F.clientY=b.clientY,F.deltaX=b.movementX,F.deltaY=b.movementY,this._state=0,b.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(b.buttons&tt.LEFT)===tt.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(b.buttons&tt.MIDDLE)===tt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(b.buttons&tt.RIGHT)===tt.RIGHT&&(this._state=this._state|this.mouseButtons.right);g()}},h=b=>{const C=this._lockedPointer||this._findPointerById(1);C&&(C.clientX=b.clientX,C.clientY=b.clientY,C.deltaX=b.movementX,C.deltaY=b.movementY,this._state=0,(this._lockedPointer||(b.buttons&tt.LEFT)===tt.LEFT)&&(this._state=this._state|this.mouseButtons.left),(b.buttons&tt.MIDDLE)===tt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(b.buttons&tt.RIGHT)===tt.RIGHT&&(this._state=this._state|this.mouseButtons.right),g())},c=b=>{const C=this._findPointerById(b.pointerId);if(!(C&&C===this._lockedPointer)){if(C&&this._disposePointer(C),b.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=Ae.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=Ae.NONE;E()}},d=()=>{const b=this._findPointerById(1);b&&b===this._lockedPointer||(b&&this._disposePointer(b),this._state=Ae.NONE,E())};let u=-1;const f=b=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===Ae.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const O=this._domElement.getBoundingClientRect(),L=b.clientX/O.width,k=b.clientY/O.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||k<this._interactiveArea.top||k>this._interactiveArea.bottom)return}if(b.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===Ae.ROTATE||this.mouseButtons.wheel===Ae.TRUCK){const O=performance.now();u-O<1e3&&this._getClientRect(this._elementRect),u=O}const C=Ow?-1:-3,F=b.deltaMode===1?b.deltaY/C:b.deltaY/(C*10),A=this.dollyToCursor?(b.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,R=this.dollyToCursor?(b.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case Ae.ROTATE:{this._rotateInternal(b.deltaX,b.deltaY),this._isUserControllingRotate=!0;break}case Ae.TRUCK:{this._truckInternal(b.deltaX,b.deltaY,!1),this._isUserControllingTruck=!0;break}case Ae.OFFSET:{this._truckInternal(b.deltaX,b.deltaY,!0),this._isUserControllingOffset=!0;break}case Ae.DOLLY:{this._dollyInternal(-F,A,R),this._isUserControllingDolly=!0;break}case Ae.ZOOM:{this._zoomInternal(-F,A,R),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},m=b=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Cs.ACTION.NONE){const C=b instanceof PointerEvent?b.pointerId:0,F=this._findPointerById(C);F&&this._disposePointer(F),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mousemove",h),this._domElement.ownerDocument.removeEventListener("mouseup",d);return}b.preventDefault()}},p=b=>{if(this._enabled){if(Ku(this._activePointers,Ds),this._getClientRect(this._elementRect),s.copy(Ds),i.copy(Ds),this._activePointers.length>=2){const C=Ds.x-this._activePointers[1].clientX,F=Ds.y-this._activePointers[1].clientY,A=Math.sqrt(C*C+F*F);n.set(0,A);const R=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,O=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(R,O)}if(this._state=0,!b)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in b&&b.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(b.buttons&tt.LEFT)===tt.LEFT&&(this._state=this._state|this.mouseButtons.left),(b.buttons&tt.MIDDLE)===tt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(b.buttons&tt.RIGHT)===tt.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&Ae.ROTATE)===Ae.ROTATE||(this._state&Ae.TOUCH_ROTATE)===Ae.TOUCH_ROTATE||(this._state&Ae.TOUCH_DOLLY_ROTATE)===Ae.TOUCH_DOLLY_ROTATE||(this._state&Ae.TOUCH_ZOOM_ROTATE)===Ae.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&Ae.TRUCK)===Ae.TRUCK||(this._state&Ae.TOUCH_TRUCK)===Ae.TOUCH_TRUCK||(this._state&Ae.TOUCH_DOLLY_TRUCK)===Ae.TOUCH_DOLLY_TRUCK||(this._state&Ae.TOUCH_ZOOM_TRUCK)===Ae.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&Ae.DOLLY)===Ae.DOLLY||(this._state&Ae.TOUCH_DOLLY)===Ae.TOUCH_DOLLY||(this._state&Ae.TOUCH_DOLLY_TRUCK)===Ae.TOUCH_DOLLY_TRUCK||(this._state&Ae.TOUCH_DOLLY_OFFSET)===Ae.TOUCH_DOLLY_OFFSET||(this._state&Ae.TOUCH_DOLLY_ROTATE)===Ae.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&Ae.ZOOM)===Ae.ZOOM||(this._state&Ae.TOUCH_ZOOM)===Ae.TOUCH_ZOOM||(this._state&Ae.TOUCH_ZOOM_TRUCK)===Ae.TOUCH_ZOOM_TRUCK||(this._state&Ae.TOUCH_ZOOM_OFFSET)===Ae.TOUCH_ZOOM_OFFSET||(this._state&Ae.TOUCH_ZOOM_ROTATE)===Ae.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&Ae.OFFSET)===Ae.OFFSET||(this._state&Ae.TOUCH_OFFSET)===Ae.TOUCH_OFFSET||(this._state&Ae.TOUCH_DOLLY_OFFSET)===Ae.TOUCH_DOLLY_OFFSET||(this._state&Ae.TOUCH_ZOOM_OFFSET)===Ae.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},g=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Ku(this._activePointers,Ds);const b=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,C=b?-b.deltaX:i.x-Ds.x,F=b?-b.deltaY:i.y-Ds.y;if(i.copy(Ds),((this._state&Ae.ROTATE)===Ae.ROTATE||(this._state&Ae.TOUCH_ROTATE)===Ae.TOUCH_ROTATE||(this._state&Ae.TOUCH_DOLLY_ROTATE)===Ae.TOUCH_DOLLY_ROTATE||(this._state&Ae.TOUCH_ZOOM_ROTATE)===Ae.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(C,F),this._isUserControllingRotate=!0),(this._state&Ae.DOLLY)===Ae.DOLLY||(this._state&Ae.ZOOM)===Ae.ZOOM){const A=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,R=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,O=this.dollyDragInverted?-1:1;(this._state&Ae.DOLLY)===Ae.DOLLY?(this._dollyInternal(O*F*wh,A,R),this._isUserControllingDolly=!0):(this._zoomInternal(O*F*wh,A,R),this._isUserControllingZoom=!0)}if((this._state&Ae.TOUCH_DOLLY)===Ae.TOUCH_DOLLY||(this._state&Ae.TOUCH_ZOOM)===Ae.TOUCH_ZOOM||(this._state&Ae.TOUCH_DOLLY_TRUCK)===Ae.TOUCH_DOLLY_TRUCK||(this._state&Ae.TOUCH_ZOOM_TRUCK)===Ae.TOUCH_ZOOM_TRUCK||(this._state&Ae.TOUCH_DOLLY_OFFSET)===Ae.TOUCH_DOLLY_OFFSET||(this._state&Ae.TOUCH_ZOOM_OFFSET)===Ae.TOUCH_ZOOM_OFFSET||(this._state&Ae.TOUCH_DOLLY_ROTATE)===Ae.TOUCH_DOLLY_ROTATE||(this._state&Ae.TOUCH_ZOOM_ROTATE)===Ae.TOUCH_ZOOM_ROTATE){const A=Ds.x-this._activePointers[1].clientX,R=Ds.y-this._activePointers[1].clientY,O=Math.sqrt(A*A+R*R),L=n.y-O;n.set(0,O);const k=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,x=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&Ae.TOUCH_DOLLY)===Ae.TOUCH_DOLLY||(this._state&Ae.TOUCH_DOLLY_ROTATE)===Ae.TOUCH_DOLLY_ROTATE||(this._state&Ae.TOUCH_DOLLY_TRUCK)===Ae.TOUCH_DOLLY_TRUCK||(this._state&Ae.TOUCH_DOLLY_OFFSET)===Ae.TOUCH_DOLLY_OFFSET?(this._dollyInternal(L*wh,k,x),this._isUserControllingDolly=!0):(this._zoomInternal(L*wh,k,x),this._isUserControllingZoom=!0)}((this._state&Ae.TRUCK)===Ae.TRUCK||(this._state&Ae.TOUCH_TRUCK)===Ae.TOUCH_TRUCK||(this._state&Ae.TOUCH_DOLLY_TRUCK)===Ae.TOUCH_DOLLY_TRUCK||(this._state&Ae.TOUCH_ZOOM_TRUCK)===Ae.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(C,F,!1),this._isUserControllingTruck=!0),((this._state&Ae.OFFSET)===Ae.OFFSET||(this._state&Ae.TOUCH_OFFSET)===Ae.TOUCH_OFFSET||(this._state&Ae.TOUCH_DOLLY_OFFSET)===Ae.TOUCH_DOLLY_OFFSET||(this._state&Ae.TOUCH_ZOOM_OFFSET)===Ae.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(C,F,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},E=()=>{Ku(this._activePointers,Ds),i.copy(Ds),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",h),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",d),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",I),this._domElement.ownerDocument.addEventListener("pointerlockerror",v),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),p())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",I),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))};const I=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},v=()=>{this.unlockPointer()};this._addAllEventListeners=b=>{this._domElement=b,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),Pw&&this._domElement.addEventListener("mousedown",o),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",m)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("mousedown",o),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",m),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",h),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",d),this._domElement.ownerDocument.removeEventListener("pointerlockchange",I),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))},this.cancel=()=>{this._state!==Ae.NONE&&(this._state=Ae.NONE,this._activePointers.length=0,E())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=yi(e.width,0,1),this._interactiveArea.height=yi(e.height,0,1),this._interactiveArea.x=yi(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=yi(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=yi(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=yi(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!s||wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=io.NONE,this._changedDolly=0,this._dollyToNoClamp(yi(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),r=wt(n,this._spherical.radius);if(!(s>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,n)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const i=!t||wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Pa).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=yi(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||wt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),Oi.setFromMatrixColumn(this._camera.matrix,0),Pi.setFromMatrixColumn(this._camera.matrix,1),Oi.multiplyScalar(e),Pi.multiplyScalar(-t);const i=rt.copy(Oi).add(Pi),n=bt.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,s)}forward(e,t=!1){rt.setFromMatrixColumn(this._camera.matrix,0),rt.crossVectors(this._camera.up,rt),rt.multiplyScalar(e);const s=bt.copy(this._targetEnd).add(rt);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return rt.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+rt.x,this._targetEnd.y+rt.y,this._targetEnd.z+rt.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const n=rt.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const r=!i||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,s,i=!1){const n=rt.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:r=0,paddingTop:o=0}={}){const a=[],h=e.isBox3?oo.copy(e):oo.setFromObject(e);h.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=Dm(this._sphericalEnd.theta,Nm),d=Dm(this._sphericalEnd.phi,Nm);a.push(this.rotateTo(c,d,t));const u=rt.setFromSpherical(this._sphericalEnd).normalize(),f=Vm.setFromUnitVectors(u,qu),m=wt(Math.abs(u.y),1);m&&f.multiply($u.setFromAxisAngle(Ch,c)),f.multiply(this._yAxisUpSpaceInverse);const p=km.makeEmpty();bt.copy(h.min).applyQuaternion(f),p.expandByPoint(bt),bt.copy(h.min).setX(h.max.x).applyQuaternion(f),p.expandByPoint(bt),bt.copy(h.min).setY(h.max.y).applyQuaternion(f),p.expandByPoint(bt),bt.copy(h.max).setZ(h.min.z).applyQuaternion(f),p.expandByPoint(bt),bt.copy(h.min).setZ(h.max.z).applyQuaternion(f),p.expandByPoint(bt),bt.copy(h.max).setY(h.min.y).applyQuaternion(f),p.expandByPoint(bt),bt.copy(h.max).setX(h.min.x).applyQuaternion(f),p.expandByPoint(bt),bt.copy(h.max).applyQuaternion(f),p.expandByPoint(bt),p.min.x-=i,p.min.y-=r,p.max.x+=n,p.max.y+=o,f.setFromUnitVectors(qu,u),m&&f.premultiply($u.invert()),f.premultiply(this._yAxisUpSpace);const g=p.getSize(rt),E=p.getCenter(bt).applyQuaternion(f);if(ir(this._camera)){const I=this.getDistanceToFitBox(g.x,g.y,g.z,s);a.push(this.moveTo(E.x,E.y,E.z,t)),a.push(this.dollyTo(I,t)),a.push(this.setFocalOffset(0,0,0,t))}else if(Fn(this._camera)){const I=this._camera,v=I.right-I.left,b=I.top-I.bottom,C=s?Math.max(v/g.x,b/g.y):Math.min(v/g.x,b/g.y);a.push(this.moveTo(E.x,E.y,E.z,t)),a.push(this.zoomTo(C,t)),a.push(this.setFocalOffset(0,0,0,t))}return Promise.all(a)}fitToSphere(e,t){const s=[],i=e instanceof qe.Sphere?Ju.copy(e):Cs.createBoundingSphere(e,Ju);if(s.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),ir(this._camera)){const n=this.getDistanceToFitSphere(i.radius);s.push(this.dollyTo(n,t))}else if(Fn(this._camera)){const n=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,o=2*i.radius,a=Math.min(n/o,r/o);s.push(this.zoomTo(a,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,n,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=io.NONE,this._changedDolly=0;const a=bt.set(i,n,r),h=rt.set(e,t,s);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(h.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!o||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold)&&wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,s,i,n,r,o,a,h,c,d,u,f,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=io.NONE,this._changedDolly=0;const p=rt.set(i,n,r),g=bt.set(e,t,s);qs.setFromVector3(g.sub(p).applyQuaternion(this._yAxisUpSpace));const E=ro.set(c,d,u),I=bt.set(o,a,h);Ma.setFromVector3(I.sub(E).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(E,f));const v=Ma.theta-qs.theta,b=Ma.phi-qs.phi,C=Ma.radius-qs.radius;this._sphericalEnd.set(qs.radius+C*f,qs.phi+b*f,qs.theta+v*f),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const F=!m||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold)&&wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(F)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const n=this.getPosition(rt),r=this.setLookAt(n.x,n.y,n.z,e,t,s,i);return this._sphericalEnd.phi=yi(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const n=!i||wt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&wt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&wt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),Oi.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Pi.setFromMatrixColumn(this._camera.matrixWorldInverse,1),nr.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=rt.set(e,t,s),n=i.distanceTo(this._camera.position),r=i.sub(this._camera.position);Oi.multiplyScalar(r.x),Pi.multiplyScalar(r.y),nr.multiplyScalar(r.z),rt.copy(Oi).add(Pi).add(nr),rt.z=rt.z+n,this.dollyTo(n,!1),this.setFocalOffset(-rt.x,rt.y,-rt.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new qe.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(Qu(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,r=this._camera.getEffectiveFOV()*Ra,o=this._camera.aspect;return((i?n>o:n<o)?t:e/o)*.5/Math.tan(r*.5)+s*.5}getDistanceToFitSphere(e){if(Qu(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Ra,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new qe.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new qe.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof qe.Spherical?e:new qe.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new qe.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%no,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=no),this._spherical.theta+=no*Math.round((this._sphericalEnd.theta-this._spherical.theta)/no)}reset(e=!1){if(!wt(this._camera.up.x,this._cameraUp0.x)||!wt(this._camera.up.y,this._cameraUp0.y)||!wt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(rt);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ch),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=rt.subVectors(this._target,this._camera.position).normalize(),t=bt.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(rt);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=Bm.subVectors(this._targetEnd,this._target),r=zm.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(St(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=yh(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,c,1/0,e),this._needsUpdate=!0}if(St(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=yh(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,c,1/0,e),this._needsUpdate=!0}if(St(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const c=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=yh(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,c,this.maxSpeed,e),this._needsUpdate=!0}if(St(n.x)&&St(n.y)&&St(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const c=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Lm(this._target,this._targetEnd,this._targetVelocity,c,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(St(r.x)&&St(r.y)&&St(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const c=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Lm(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,c,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(St(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const c=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=yh(this._zoom,this._zoomEnd,this._zoomVelocity,c,1/0,e)}if(this.dollyToCursor){if(ir(this._camera)&&this._changedDolly!==0){const c=this._spherical.radius-this._lastDistance,d=this._camera,u=this._getCameraDirection(Pa),f=rt.copy(u).cross(d.up).normalize();f.lengthSq()===0&&(f.x=1);const m=bt.crossVectors(f,u),p=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*Ra*.5),g=(this._sphericalEnd.radius-c-this._sphericalEnd.radius)/this._sphericalEnd.radius,E=ro.copy(this._targetEnd).add(f.multiplyScalar(this._dollyControlCoord.x*p*d.aspect)).add(m.multiplyScalar(this._dollyControlCoord.y*p)),I=rt.copy(this._targetEnd).lerp(E,g),v=this._lastDollyDirection===io.IN&&this._spherical.radius<=this.minDistance,b=this._lastDollyDirection===io.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(v||b)){this._sphericalEnd.radius-=c,this._spherical.radius-=c;const F=bt.copy(u).multiplyScalar(-c);I.add(F)}this._boundary.clampPoint(I,I);const C=bt.subVectors(I,this._targetEnd);this._targetEnd.copy(I),this._target.add(C),this._changedDolly-=c,St(this._changedDolly)&&(this._changedDolly=0)}else if(Fn(this._camera)&&this._changedZoom!==0){const c=this._zoom-this._lastZoom,d=this._camera,u=rt.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),f=bt.set(0,0,-1).applyQuaternion(d.quaternion),m=ro.copy(u).add(f.multiplyScalar(-u.dot(d.up))),p=-(this._zoom-c-this._zoom)/this._zoom,g=this._getCameraDirection(Pa),E=this._targetEnd.dot(g),I=rt.copy(this._targetEnd).lerp(m,p),v=I.dot(g),b=g.multiplyScalar(v-E);I.sub(b),this._boundary.clampPoint(I,I);const C=bt.subVectors(I,this._targetEnd);this._targetEnd.copy(I),this._target.add(C),this._changedZoom-=c,St(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!St(this._focalOffset.x)||!St(this._focalOffset.y)||!St(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Oi.setFromMatrixColumn(this._camera.matrix,0),Pi.setFromMatrixColumn(this._camera.matrix,1),nr.setFromMatrixColumn(this._camera.matrix,2),Oi.multiplyScalar(this._focalOffset.x),Pi.multiplyScalar(-this._focalOffset.y),nr.multiplyScalar(this._focalOffset.z),rt.copy(Oi).add(Pi).add(nr),this._camera.position.add(rt)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),rt.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const h=this._needsUpdate;return h&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):h?(this.dispatchEvent({type:"update"}),St(t,this.restThreshold)&&St(s,this.restThreshold)&&St(i,this.restThreshold)&&St(n.x,this.restThreshold)&&St(n.y,this.restThreshold)&&St(n.z,this.restThreshold)&&St(r.x,this.restThreshold)&&St(r.y,this.restThreshold)&&St(r.z,this.restThreshold)&&St(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!h&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=h,this._needsUpdate=!1,h}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Sa(this.maxDistance),minZoom:this.minZoom,maxZoom:Sa(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Sa(this.maxPolarAngle),minAzimuthAngle:Sa(this.minAzimuthAngle),maxAzimuthAngle:Sa(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:rt.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=Oa(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=Oa(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=Oa(s.maxPolarAngle),this.minAzimuthAngle=Oa(s.minAzimuthAngle),this.maxAzimuthAngle=Oa(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),qs.setFromVector3(rt.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(qs.theta,qs.phi,t),this.dollyTo(qs.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Sw),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const n=bt.copy(t).add(e),r=this._boundary.clampPoint(n,ro).sub(n),o=r.lengthSq();if(o===0)return e.add(t);if(o===i)return e;if(s===0)return e.add(t).add(r);{const a=1+s*o/t.dot(r);return e.add(bt.copy(t).multiplyScalar(a)).add(r.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(ir(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*Ra,i=Math.tan(s*.5)*t,n=i*e.aspect;this._nearPlaneCorners[0].set(-n,-i,0),this._nearPlaneCorners[1].set(n,-i,0),this._nearPlaneCorners[2].set(n,i,0),this._nearPlaneCorners[3].set(-n,i,0)}else if(Fn(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,n=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(s,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Qu(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(Pa);ed.lookAt(Um,t,this._camera.up);for(let s=0;s<4;s++){const i=bt.copy(this._nearPlaneCorners[s]);i.applyMatrix4(ed);const n=ro.addVectors(this._target,i);vh.set(n,t),vh.far=this._spherical.radius+1;const r=vh.intersectObjects(this.colliderMeshes);r.length!==0&&r[0].distance<e&&(e=r[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new qe.Sphere){const s=t,i=s.center;oo.makeEmpty(),e.traverseVisible(r=>{r.isMesh&&oo.expandByObject(r)}),oo.getCenter(i);let n=0;return e.traverseVisible(r=>{if(!r.isMesh)return;const o=r,a=o.geometry.clone();a.applyMatrix4(o.matrixWorld);const h=a.attributes.position;for(let c=0,d=h.count;c<d;c++)rt.fromBufferAttribute(h,c),n=Math.max(n,i.distanceToSquared(rt))}),s.radius=Math.sqrt(n),s}}let qd=class W0 extends mw{constructor(e){super(e),V(this,"onBeforeUpdate",new Ue),V(this,"onAfterUpdate",new Ue),V(this,"onAspectUpdated",new Ue),V(this,"onDisposed",new Ue),V(this,"three"),V(this,"_allControls",new Map),V(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof gi){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:t,world:s})=>{if(t==="added"){const i=this.newCameraControls();this._allControls.set(s.uuid,i)}if(t==="removed"){const i=this._allControls.get(s.uuid);i&&(i.dispose(),this._allControls.delete(s.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.currentWorld!==null&&(this.controls.enabled=e)}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[e,t]of this._allControls)t.dispose()}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}setupCamera(){const e=window.innerWidth/window.innerHeight,t=new Sc(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new U(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");Cs.install({THREE:W0.getSubsetOfThree()});const{domElement:e}=this.currentWorld.renderer.three,t=new Cs(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t.minDistance=6,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:a0,Vector2:lt,Vector3:U,Vector4:Fr,Quaternion:Ht,Matrix4:Oe,Spherical:o0,Box3:Qe,Sphere:pi,Raycaster:Tr,MathUtils:xr}}};const j0=class Z0 extends qt{constructor(e){super(e),V(this,"onAfterUpdate",new Ue),V(this,"onBeforeUpdate",new Ue),V(this,"onDisposed",new Ue),V(this,"onWorldCreated",new Ue),V(this,"onWorldDeleted",new Ue),V(this,"list",new Map),V(this,"enabled",!0),e.add(Z0.uuid,this)}create(){const e=new Fw(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),this.onWorldCreated.trigger(e),e}delete(e){if(!this.list.has(e.uuid))throw new Error("The provided world is not found in the list!");const t=e.uuid;this.list.delete(e.uuid),e.dispose(),this.onWorldDeleted.trigger(t)}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[t,s]of this.list)s.update(e)}};V(j0,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Mw=j0;function Nw(l,e,t,s){return new Promise((i,n)=>{function r(){const o=l.clientWaitSync(e,t,0);if(o===l.WAIT_FAILED){n();return}if(o===l.TIMEOUT_EXPIRED){setTimeout(r,s);return}i()}r()})}async function Dw(l,e,t,s,i,n,r){const o=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0);l.flush(),await Nw(l,o,0,10),l.deleteSync(o),l.bindBuffer(e,t),l.getBufferSubData(e,s,i,n,r),l.bindBuffer(e,null)}async function Lw(l,e,t,s,i,n,r,o){const a=l.createBuffer();return l.bindBuffer(l.PIXEL_PACK_BUFFER,a),l.bufferData(l.PIXEL_PACK_BUFFER,o.byteLength,l.STREAM_READ),l.readPixels(e,t,s,i,n,r,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await Dw(l,l.PIXEL_PACK_BUFFER,a,0,o),l.deleteBuffer(a),o}let Uw=class{constructor(e,t,s){if(V(this,"onDisposed",new Ue),V(this,"onViewUpdated",new fc),V(this,"enabled",!0),V(this,"needsUpdate",!1),V(this,"renderDebugFrame",!1),V(this,"components"),V(this,"world"),V(this,"renderer"),V(this,"autoUpdate",!0),V(this,"updateInterval",1e3),V(this,"worker"),V(this,"scene",new Zi),V(this,"_width",512),V(this,"_height",512),V(this,"_availableColor",1),V(this,"renderTarget"),V(this,"bufferSize"),V(this,"_buffer"),V(this,"_isWorkerBusy",!1),V(this,"updateVisibility",async r=>{if(!this.enabled||!this.needsUpdate&&!r||this._isWorkerBusy)return;this._isWorkerBusy=!0;const o=this.world.camera.three;o.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,o);const a=this.renderer.getContext();try{await Lw(a,0,0,this._width,this._height,a.RGBA,a.UNSIGNED_BYTE,this._buffer)}catch{this.needsUpdate=!1,this._isWorkerBusy=!1,this.renderer.setRenderTarget(null);return}this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,o),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.applySettings(s),this.world=t,this.renderer=new Lo,this.renderTarget=new Hi(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=t.renderer.clippingPlanes;const i=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,n=new Blob([i],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n))}dispose(){this.enabled=!1;for(const e of this.scene.children)e.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let e=BigInt(this._availableColor.toString());const t=[];do t.unshift(Number(e%256n)),e/=256n;while(e);for(;t.length!==3;)t.unshift(0);const[s,i,n]=t,r=`${s}-${i}-${n}`;return{r:s,g:i,b:n,code:r}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(e){e&&(e.updateInterval!==void 0&&(this.updateInterval=e.updateInterval),e.height!==void 0&&(this._height=e.height),e.width!==void 0&&(this._width=e.width),e.autoUpdate!==void 0&&(this.autoUpdate=e.autoUpdate))}};class Bw extends Uw{constructor(e,t,s){super(e,t,s),V(this,"onViewUpdated",new Ue),V(this,"threshold",100),V(this,"colorMeshes",new Map),V(this,"isProcessing",!1),V(this,"_interval",null),V(this,"_colorCodeMeshMap",new Map),V(this,"_meshIDColorCodeMap",new Map),V(this,"_currentVisibleMeshes",new Set),V(this,"_recentlyHiddenMeshes",new Set),V(this,"_intervalID",null),V(this,"_transparentMat",new is({transparent:!0,opacity:0})),V(this,"handleWorkerMessage",async i=>{if(this.isProcessing)return;const n=i.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[r,o]of n){if(o<this.threshold)continue;const a=this._colorCodeMeshMap.get(r);a&&(this._currentVisibleMeshes.add(a),this._recentlyHiddenMeshes.delete(a))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._interval=window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval)),this.onViewUpdated.add(({seen:i,unseen:n})=>{for(const r of i)r.visible=!0;for(const r of n)r.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._interval!==null&&(window.clearInterval(this._interval),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const e=this.components.get(Bo);for(const t in this.colorMeshes){const s=this.colorMeshes.get(t);s&&e.destroy(s,!0)}this.colorMeshes.clear()}add(e){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=e instanceof ss,{geometry:s,material:i}=e,{colorMaterial:n,code:r}=this.getAvailableMaterial();let o;if(Array.isArray(i)){let c=!0;const d=[];for(const u of i)Mm.isTransparent(u)?d.push(this._transparentMat):(c=!1,d.push(n));if(c){n.dispose(),this.isProcessing=!1;return}o=d}else if(Mm.isTransparent(i)){n.dispose(),this.isProcessing=!1;return}else o=n;this._colorCodeMeshMap.set(r,e),this._meshIDColorCodeMap.set(e.uuid,r);const a=t?e.count:1,h=new ss(s,o,a);t?h.instanceMatrix=e.instanceMatrix:h.setMatrixAt(0,new Oe),e.visible=!1,e.updateWorldMatrix(!0,!1),h.applyMatrix4(e.matrixWorld),h.updateMatrix(),this.scene.add(h),this.colorMeshes.set(e.uuid,h),this.increaseColor(),this.isProcessing=!1}remove(e){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=this.components.get(Bo);this._currentVisibleMeshes.delete(e),this._recentlyHiddenMeshes.delete(e);const s=this.colorMeshes.get(e.uuid),i=this._meshIDColorCodeMap.get(e.uuid);if(!s||!i){this.isProcessing=!1;return}this._colorCodeMeshMap.delete(i),this._meshIDColorCodeMap.delete(e.uuid),this.colorMeshes.delete(e.uuid),s.geometry=void 0,s.material=[],t.destroy(s,!0),this._recentlyHiddenMeshes.delete(e),this._currentVisibleMeshes.delete(e),this.isProcessing=!1}updateInstanced(e){for(const t of e){const s=this.colorMeshes.get(t.uuid);s&&(s.count=t.count)}}getAvailableMaterial(){const{r:e,g:t,b:s,code:i}=this.getAvailableColor(),n=$s.enabled;$s.enabled=!1;const r=new mt(`rgb(${e}, ${t}, ${s})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const o=this.world.renderer.clippingPlanes,a=new is({color:r,clippingPlanes:o,side:Fi});return $s.enabled=n,{colorMaterial:a,code:i}}}const X0=class Jd extends qt{constructor(e){super(e),V(this,"onDisposed",new Ue),V(this,"_enabled",!0),V(this,"list",new Map),e.add(Jd.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const[t,s]of this.list)s.enabled=e}create(e,t){if(this.list.has(e.uuid))return this.list.get(e.uuid);const s=new Bw(this.components,e,t);return this.list.set(e.uuid,s),s}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(Jd.uuid),this.onDisposed.reset();for(const[e,t]of this.list)t.dispose();this.list.clear()}updateInstanced(e){for(const[,t]of this.list)t.updateInstanced(e)}};V(X0,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let zw=X0;class kw{constructor(e){V(this,"_event"),V(this,"_position",new lt),V(this,"onDisposed",new Ue),V(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event),this._position.y=this.getPositionY(e,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(e,t){return-((t.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t){return(t.clientX-e.left)/(e.right-e.left)*2-1}setupEvents(e){e?this.dom.addEventListener("pointermove",this.updateMouseInfo):this.dom.removeEventListener("pointermove",this.updateMouseInfo)}}class Vw{constructor(e,t){V(this,"enabled",!0),V(this,"components"),V(this,"onDisposed",new Ue),V(this,"mouse"),V(this,"three",new Tr),V(this,"world");const s=t.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new kw(s.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(e=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const t=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,t),this.intersect(e)}castRayFromVector(e,t,s=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(s)}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),s=this.filterClippingPlanes(t);return s.length>0?s[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const s=t.clippingPlanes;return e.length<=0||!s||s?.length<=0?e:e.filter(i=>s.every(n=>n.distanceToPoint(i.point)>0))}}const K0=class Q0 extends qt{constructor(e){super(e),V(this,"enabled",!0),V(this,"list",new Map),V(this,"onDisposed",new Ue),e.add(Q0.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new Vw(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};V(K0,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let $d=K0,Yw=class{constructor(e,t,s){V(this,"onDisposed",new Ue),V(this,"world"),V(this,"components"),V(this,"three"),V(this,"_fade",3),V(this,"updateZoom",()=>{this.world.camera instanceof qd&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;const{color:i,size1:n,size2:r,distance:o}=s;this.components=e;const a=new Ar(2,2,1,1),h=new ms({side:Fi,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:i},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new ye(a,h),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}dispose(){this.setupEvents(!1),this.components.get(Bo).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(this.world.isDisposing||!(this.world.camera instanceof qd))return;const t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}};const q0=class J0 extends qt{constructor(e){super(e),V(this,"list",new Map),V(this,"config",{color:new mt(12303291),size1:1,size2:10,distance:500}),V(this,"onDisposed",new Ue),V(this,"enabled",!0),e.add(J0.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");const t=new Yw(this.components,e,this.config);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};V(q0,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");let Ox=q0;const rr=new Tr,ys=new U,Tn=new U,Bt=new Ht,Ym={X:new U(1,0,0),Y:new U(0,1,0),Z:new U(0,0,1)},td={type:"change"},Gm={type:"mouseDown"},Hm={type:"mouseUp",mode:null},Wm={type:"objectChange"};let Gw=class extends Wi{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const s=new Kw;this._gizmo=s,this.add(s);const i=new Qw;this._plane=i,this.add(i);const n=this;function r(I,v){let b=v;Object.defineProperty(n,I,{get:function(){return b!==void 0?b:v},set:function(C){b!==C&&(b=C,i[I]=C,s[I]=C,n.dispatchEvent({type:I+"-changed",value:C}),n.dispatchEvent(td))}}),n[I]=v,i[I]=v,s[I]=v}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new U,a=new U,h=new Ht,c=new Ht,d=new U,u=new Ht,f=new U,m=new U,p=new U,g=0,E=new U;r("worldPosition",o),r("worldPositionStart",a),r("worldQuaternion",h),r("worldQuaternionStart",c),r("cameraPosition",d),r("cameraQuaternion",u),r("pointStart",f),r("pointEnd",m),r("rotationAxis",p),r("rotationAngle",g),r("eye",E),this._offset=new U,this._startNorm=new U,this._endNorm=new U,this._cameraScale=new U,this._parentPosition=new U,this._parentQuaternion=new Ht,this._parentQuaternionInv=new Ht,this._parentScale=new U,this._worldScaleStart=new U,this._worldQuaternionInv=new Ht,this._worldScale=new U,this._positionStart=new U,this._quaternionStart=new Ht,this._scaleStart=new U,this._getPointer=Hw.bind(this),this._onPointerDown=jw.bind(this),this._onPointerHover=Ww.bind(this),this._onPointerMove=Zw.bind(this),this._onPointerUp=Xw.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;rr.setFromCamera(e,this.camera);const t=sd(this._gizmo.picker[this.mode],rr);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){rr.setFromCamera(e,this.camera);const t=sd(this._plane,rr,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Gm.mode=this.mode,this.dispatchEvent(Gm)}}pointerMove(e){const t=this.axis,s=this.mode,i=this.object;let n=this.space;if(s==="scale"?n="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(n="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;rr.setFromCamera(e,this.camera);const r=sd(this._plane,rr,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(i.position.applyQuaternion(Bt.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),n==="world"&&(i.parent&&i.position.add(ys.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(ys.setFromMatrixPosition(i.parent.matrixWorld))));else if(s==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),Tn.set(o,o,o)}else ys.copy(this.pointStart),Tn.copy(this.pointEnd),ys.applyQuaternion(this._worldQuaternionInv),Tn.applyQuaternion(this._worldQuaternionInv),Tn.divide(ys),t.search("X")===-1&&(Tn.x=1),t.search("Y")===-1&&(Tn.y=1),t.search("Z")===-1&&(Tn.z=1);i.scale.copy(this._scaleStart).multiply(Tn),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(ys.setFromMatrixPosition(this.camera.matrixWorld));let a=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(ys.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Ym[t]),ys.copy(Ym[t]),n==="local"&&ys.applyQuaternion(this.worldQuaternion),ys.cross(this.eye),ys.length()===0?a=!0:this.rotationAngle=this._offset.dot(ys.normalize())*o),(t==="E"||a)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Bt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Bt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(td),this.dispatchEvent(Wm)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Hm.mode=this.mode,this.dispatchEvent(Hm)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(td),this.dispatchEvent(Wm),this.pointStart.copy(this.pointEnd))}getRaycaster(){return rr}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}};function Hw(l){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:l.button};{const e=this.domElement.getBoundingClientRect();return{x:(l.clientX-e.left)/e.width*2-1,y:-(l.clientY-e.top)/e.height*2+1,button:l.button}}}function Ww(l){if(this.enabled)switch(l.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(l));break}}function jw(l){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(l.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(l)),this.pointerDown(this._getPointer(l)))}function Zw(l){this.enabled&&this.pointerMove(this._getPointer(l))}function Xw(l){this.enabled&&(this.domElement.releasePointerCapture(l.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(l)))}function sd(l,e,t){const s=e.intersectObject(l,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||t)return s[i];return!1}const _h=new Hf,At=new U(0,1,0),jm=new U(0,0,0),Zm=new Oe,Th=new Ht,mc=new Ht,Mi=new U,Xm=new Oe,el=new U(1,0,0),pr=new U(0,1,0),tl=new U(0,0,1),xh=new U,Na=new U,Da=new U;let Kw=class extends Wi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new is({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new mi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const i=t.clone();i.opacity=.5;const n=e.clone();n.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const a=e.clone();a.color.setHex(16711680),a.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const d=e.clone();d.opacity=.25;const u=e.clone();u.color.setHex(16776960),u.opacity=.25,e.clone().color.setHex(16776960);const f=e.clone();f.color.setHex(7895160);const m=new vt(0,.04,.1,12);m.translate(0,.05,0);const p=new pt(.08,.08,.08);p.translate(0,.04,0);const g=new ft;g.setAttribute("position",new Vn([0,0,0,1,0,0],3));const E=new vt(.0075,.0075,.5,3);E.translate(0,.25,0);function I(w,G){const J=new Vi(w,.0075,3,64,G*Math.PI*2);return J.rotateY(Math.PI/2),J.rotateX(Math.PI/2),J}function v(){const w=new ft;return w.setAttribute("position",new Vn([0,0,0,1,1,1],3)),w}const b={X:[[new ye(m,n),[.5,0,0],[0,0,-Math.PI/2]],[new ye(m,n),[-.5,0,0],[0,0,Math.PI/2]],[new ye(E,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new ye(m,r),[0,.5,0]],[new ye(m,r),[0,-.5,0],[Math.PI,0,0]],[new ye(E,r)]],Z:[[new ye(m,o),[0,0,.5],[Math.PI/2,0,0]],[new ye(m,o),[0,0,-.5],[-Math.PI/2,0,0]],[new ye(E,o),null,[Math.PI/2,0,0]]],XYZ:[[new ye(new Ln(.1,0),d.clone()),[0,0,0]]],XY:[[new ye(new pt(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new ye(new pt(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new pt(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new ye(new vt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new vt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new vt(.2,0,.6,4),s),[0,.3,0]],[new ye(new vt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new vt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ye(new vt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new ye(new Ln(.2,0),s)]],XY:[[new ye(new pt(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ye(new pt(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new pt(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},F={START:[[new ye(new Ln(.01,2),i),null,null,null,"helper"]],END:[[new ye(new Ln(.01,2),i),null,null,null,"helper"]],DELTA:[[new xt(v(),i),null,null,null,"helper"]],X:[[new xt(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new xt(g,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new xt(g,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={XYZE:[[new ye(I(.5,1),f),null,[0,Math.PI/2,0]]],X:[[new ye(I(.5,.5),n)]],Y:[[new ye(I(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new ye(I(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new ye(I(.75,1),u),null,[0,Math.PI/2,0]]]},R={AXIS:[[new xt(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},O={XYZE:[[new ye(new l0(.25,10,8),s)]],X:[[new ye(new Vi(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ye(new Vi(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ye(new Vi(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ye(new Vi(.75,.1,2,24),s)]]},L={X:[[new ye(p,n),[.5,0,0],[0,0,-Math.PI/2]],[new ye(E,n),[0,0,0],[0,0,-Math.PI/2]],[new ye(p,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new ye(p,r),[0,.5,0]],[new ye(E,r)],[new ye(p,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new ye(p,o),[0,0,.5],[Math.PI/2,0,0]],[new ye(E,o),[0,0,0],[Math.PI/2,0,0]],[new ye(p,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new ye(new pt(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new ye(new pt(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new pt(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new pt(.1,.1,.1),d.clone())]]},k={X:[[new ye(new vt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new vt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new vt(.2,0,.6,4),s),[0,.3,0]],[new ye(new vt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new vt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ye(new vt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new ye(new pt(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ye(new pt(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new pt(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new pt(.2,.2,.2),s),[0,0,0]]]},x={X:[[new xt(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new xt(g,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new xt(g,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function M(w){const G=new Wi;for(const J in w)for(let Z=w[J].length;Z--;){const le=w[J][Z][0].clone(),ee=w[J][Z][1],xe=w[J][Z][2],X=w[J][Z][3],j=w[J][Z][4];le.name=J,le.tag=j,ee&&le.position.set(ee[0],ee[1],ee[2]),xe&&le.rotation.set(xe[0],xe[1],xe[2]),X&&le.scale.set(X[0],X[1],X[2]),le.updateMatrix();const be=le.geometry.clone();be.applyMatrix4(le.matrix),le.geometry=be,le.renderOrder=1/0,le.position.set(0,0,0),le.rotation.set(0,0,0),le.scale.set(1,1,1),G.add(le)}return G}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=M(b)),this.add(this.gizmo.rotate=M(A)),this.add(this.gizmo.scale=M(L)),this.add(this.picker.translate=M(C)),this.add(this.picker.rotate=M(O)),this.add(this.picker.scale=M(k)),this.add(this.helper.translate=M(F)),this.add(this.helper.rotate=M(R)),this.add(this.helper.scale=M(x)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:mc;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const n=s[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(Bt.setFromEuler(_h.set(0,0,0)),n.quaternion.copy(t).multiply(Bt),Math.abs(At.copy(el).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(Bt.setFromEuler(_h.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(Bt),Math.abs(At.copy(pr).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(Bt.setFromEuler(_h.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(Bt),Math.abs(At.copy(tl).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(Bt.setFromEuler(_h.set(0,Math.PI/2,0)),At.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(Zm.lookAt(jm,At,pr)),n.quaternion.multiply(Bt),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),ys.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ys.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(ys),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(At.copy(el).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(At.copy(pr).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(At.copy(tl).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(At.copy(tl).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(At.copy(el).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(At.copy(pr).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(Th.copy(t),At.copy(this.eye).applyQuaternion(Bt.copy(t).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(Zm.lookAt(this.eye,jm,pr)),n.name==="X"&&(Bt.setFromAxisAngle(el,Math.atan2(-At.y,At.z)),Bt.multiplyQuaternions(Th,Bt),n.quaternion.copy(Bt)),n.name==="Y"&&(Bt.setFromAxisAngle(pr,Math.atan2(At.x,At.z)),Bt.multiplyQuaternions(Th,Bt),n.quaternion.copy(Bt)),n.name==="Z"&&(Bt.setFromAxisAngle(tl,Math.atan2(At.y,At.x)),Bt.multiplyQuaternions(Th,Bt),n.quaternion.copy(Bt))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(o){return n.name===o}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(e)}},Qw=class extends ye{constructor(){super(new Ar(1e5,1e5,2,2),new is({visible:!1,wireframe:!0,side:Fi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),xh.copy(el).applyQuaternion(t==="local"?this.worldQuaternion:mc),Na.copy(pr).applyQuaternion(t==="local"?this.worldQuaternion:mc),Da.copy(tl).applyQuaternion(t==="local"?this.worldQuaternion:mc),At.copy(Na),this.mode){case"translate":case"scale":switch(this.axis){case"X":At.copy(this.eye).cross(xh),Mi.copy(xh).cross(At);break;case"Y":At.copy(this.eye).cross(Na),Mi.copy(Na).cross(At);break;case"Z":At.copy(this.eye).cross(Da),Mi.copy(Da).cross(At);break;case"XY":Mi.copy(Da);break;case"YZ":Mi.copy(xh);break;case"XZ":At.copy(Da),Mi.copy(Na);break;case"XYZ":case"E":Mi.set(0,0,0);break}break;case"rotate":default:Mi.set(0,0,0)}Mi.length()===0?this.quaternion.copy(this.cameraQuaternion):(Xm.lookAt(ys.set(0,0,0),Mi,At),this.quaternion.setFromRotationMatrix(Xm)),super.updateMatrixWorld(e)}},qw=class $0{constructor(e,t,s,i,n,r=5,o=!0){if(V(this,"onDraggingStarted",new Ue),V(this,"onDraggingEnded",new Ue),V(this,"onDisposed",new Ue),V(this,"normal"),V(this,"origin"),V(this,"three",new _s),V(this,"components"),V(this,"world"),V(this,"type","default"),V(this,"_helper"),V(this,"_visible",!0),V(this,"_enabled",!0),V(this,"_controlsActive",!1),V(this,"_arrowBoundBox",new ye),V(this,"_planeMesh"),V(this,"_controls"),V(this,"_hiddenMaterial",new is({visible:!1})),V(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),V(this,"changeDrag",a=>{this._visible=!a.value,this.preventCameraMovement(),this.notifyDraggingChanged(a)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,t.renderer.setPlane(!0,this.three),this._planeMesh=$0.newPlaneMesh(r,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),o&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(e){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,this.world.renderer.setPlane(e,this.three)}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.visible=e,this._helper.visible=e,this.toggleControls(e)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new U(1,0,0),t=new U;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,s=new Gw(e,t);return this.initializeControls(s),this.world.scene.three.add(s),s}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new vt(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new Wi;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const s=new Ar(1),i=new ye(s,t);return i.scale.set(e,e,e),i}};const eE=class ef extends qt{constructor(e){super(e),V(this,"onBeforeDrag",new Ue),V(this,"onAfterDrag",new Ue),V(this,"onBeforeCreate",new Ue),V(this,"onBeforeCancel",new Ue),V(this,"onAfterCancel",new Ue),V(this,"onBeforeDelete",new Ue),V(this,"onAfterCreate",new Ue),V(this,"onAfterDelete",new Ue),V(this,"onDisposed",new Ue),V(this,"orthogonalY",!1),V(this,"toleranceOrthogonalY",.7),V(this,"Type",qw),V(this,"list",[]),V(this,"_material",new is({color:12255487,side:Fi,transparent:!0,opacity:.2})),V(this,"_size",5),V(this,"_enabled",!1),V(this,"_visible",!0),V(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),V(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(ef.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const t of this.list)t.enabled=e;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get material(){return this._material}set material(e){this._material=e;for(const t of this.list)t.planeMaterial=e}get size(){return this._size}set size(e){this._size=e;for(const t of this.list)t.size=e}dispose(){this._enabled=!1;for(const e of this.list)e.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(ef.uuid),this.onDisposed.reset()}create(e){const t=this.components.get($d).get(e).castRay();return t?this.createPlaneFromIntersection(e,t):null}createFromNormalAndCoplanarPoint(e,t,s){const i=this.newPlane(e,s,t);return this.updateMaterialsAndPlanes(),i}delete(e,t){t||(t=this.pickPlane(e)),t&&this.deletePlane(t)}deleteAll(e){const t=[...this.list];for(const s of t)if(!e||e.has(s.type)){this.delete(s.world,s);const i=this.list.indexOf(s);i!==-1&&this.list.splice(i,1)}}deletePlane(e){const t=this.list.indexOf(e);if(t!==-1){if(this.list.splice(t,1),!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(e)}}pickPlane(e){const t=this.components.get($d).get(e),s=this.getAllPlaneMeshes(),i=t.castRay(s);if(i){const n=i.object;return this.list.find(r=>r.meshes.includes(n))}}getAllPlaneMeshes(){const e=[];for(const t of this.list)e.push(...t.meshes);return e}createPlaneFromIntersection(e,t){var s;if(!e.renderer)throw new Error("The given world must have a renderer!");const i=t.point.distanceTo(new U(0,0,0)),n=(s=t.face)==null?void 0:s.normal;if(!i||!n)return null;const r=this.getWorldNormal(t,n),o=this.newPlane(e,t.point,r.negate());return o.visible=this._visible,o.size=this._size,e.renderer.setPlane(!0,o.three),this.updateMaterialsAndPlanes(),o}getWorldNormal(e,t){const s=e.object;let i=e.object.matrixWorld.clone();if(s instanceof ss&&e.instanceId!==void 0){const o=new Oe;s.getMatrixAt(e.instanceId,o),i=o.multiply(i)}const n=new Us().getNormalMatrix(i),r=t.clone().applyMatrix3(n).normalize();return this.normalizePlaneDirectionY(r),r}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,s){const i=new this.Type(this.components,e,t,s,this._material);return i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging),this.list.push(i),this.onAfterCreate.trigger(i),i}updateMaterialsAndPlanes(){const e=this.components.get(Mw);for(const[t,s]of e.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:i}=s.renderer;for(const n of s.meshes)if(n.material)if(Array.isArray(n.material))for(const r of n.material)r.clippingPlanes=i;else n.material.clippingPlanes=i}}};V(eE,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let Jw=eE,$w=class{constructor(e){V(this,"enabled",!1),V(this,"id","FirstPerson"),this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const e=this.camera.controls,t=new U;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=Cs.ACTION.DOLLY,e.touches.two=Cs.ACTION.TOUCH_ZOOM_TRUCK}},eC=class{constructor(e){V(this,"enabled",!0),V(this,"id","Orbit"),this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){const e=this.camera.controls;e.minDistance=1,e.maxDistance=300;const t=new U;e.getPosition(t);const s=t.length();e.distance=s,e.truckSpeed=2;const{rotation:i}=this.camera.three,n=new U(0,0,-1).applyEuler(i),r=t.addScaledVector(n,s);e.moveTo(r.x,r.y,r.z)}},tC=class{constructor(e){V(this,"enabled",!1),V(this,"id","Plan"),V(this,"mouseAction1"),V(this,"mouseAction2"),V(this,"mouseInitialized",!1),V(this,"defaultAzimuthSpeed"),V(this,"defaultPolarSpeed"),this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;const t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=Cs.ACTION.TRUCK,t.touches.one=Cs.ACTION.TOUCH_TRUCK,t.touches.two=Cs.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=Cs.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}},sC=class{constructor(e){V(this,"onChanged",new Ue),V(this,"current","Perspective"),V(this,"camera"),V(this,"matchOrthoDistanceEnabled",!1),V(this,"_component"),V(this,"_previousDistance",-1),this._component=e,this.camera=e.three}async set(e){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const e=this.getPerspectiveDims();if(!e)return;const{width:t,height:s}=e;this.setupOrthoCamera(s,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const e=this._component.currentWorld;if(!e||!e.renderer)return null;const t=new U;this._component.threePersp.getWorldDirection(t);const s=new U;this._component.controls.getTarget(s);const i=s.clone().sub(this._component.threePersp.position).dot(t),n=e.renderer.getSize(),r=n.x/n.y,o=this._component.threePersp,a=i*2*Math.atan(o.fov*(Math.PI/180)/2);return{width:a*r,height:a}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=Cs.ACTION.ZOOM,this._component.controls.mouseButtons.middle=Cs.ACTION.ZOOM;const s=this._component.threePersp,i=this._component.threeOrtho;i.zoom=1,i.left=t/-2,i.right=t/2,i.top=e/2,i.bottom=e/-2,i.updateProjectionMatrix(),i.position.copy(s.position),i.quaternion.copy(s.quaternion),this._component.controls.camera=i}getDistance(){const e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=Cs.ACTION.DOLLY,this._component.controls.mouseButtons.middle=Cs.ACTION.DOLLY;const e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=Cs.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"}},iC=class extends qd{constructor(e){super(e),V(this,"projection"),V(this,"threeOrtho"),V(this,"threePersp"),V(this,"_userInputButtons",{}),V(this,"_frustumSize",50),V(this,"_navigationModes",new Map),V(this,"_mode",null),V(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new sC(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t,this.updateAspect()}),this.onWorldChanged.add(({action:t})=>{t==="added"&&(this._navigationModes.clear(),this._navigationModes.set("Orbit",new eC(this)),this._navigationModes.set("FirstPerson",new $w(this)),this._navigationModes.set("Plan",new tC(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone()))})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}async fit(e,t=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,i=Number.MIN_VALUE,n=new U(s,s,s),r=new U(i,i,i);for(const u of e){const f=new Qe().setFromObject(u);f.min.x<n.x&&(n.x=f.min.x),f.min.y<n.y&&(n.y=f.min.y),f.min.z<n.z&&(n.z=f.min.z),f.max.x>r.x&&(r.x=f.max.x),f.max.y>r.y&&(r.y=f.max.y),f.max.z>r.z&&(r.z=f.max.z)}const o=new Qe(n,r),a=new U;o.getSize(a);const h=new U;o.getCenter(h);const c=Math.max(a.x,a.y,a.z)*t,d=new pi(h,c);await this.controls.fitToSphere(d,!0)}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const e=window.innerWidth/window.innerHeight;return new gi(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const e=this.currentWorld.renderer.getSize(),t=this.threeOrtho.top,s=this.threeOrtho.right,i=e.y/this.previousSize.y,n=e.x/this.previousSize.x,r=t*i,o=s*n;this.threeOrtho.left=-o,this.threeOrtho.right=o,this.threeOrtho.top=r,this.threeOrtho.bottom=-r,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(e)}};const Km=new Map([[Xn,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[Vo,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[Yo,{forRelated:"HasAssociations",forRelating:"ClassificationForObjects"}],[Go,{forRelated:"HasAssignments",forRelating:"IsGroupedBy"}],[Xi,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[Ho,{forRelated:"IsTypedBy",forRelating:"Types"}],[Wo,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[Kn,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}],[jo,{forRelated:"AssignedToFlowElement",forRelating:"HasControlElements"}],[Zo,{forRelated:"ConnectedFrom",forRelating:"ConnectedTo"}],[Xo,{forRelated:"HasAssignments",forRelating:"ReferencedBy"}],[Ko,{forRelated:"HasContext",forRelating:"Declares"}],[Qo,{forRelated:"HasAssignments",forRelating:"Controls"}],[qo,{forRelated:"Nests",forRelating:"IsNestedBy"}],[Jo,{forRelated:"HasAssociations",forRelating:"DocumentRefForObjects"}]]),tE={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class Mo{static async getUnits(e){var t,s,i;const{IFCUNITASSIGNMENT:n}=jt,r=await e.getAllPropertiesOfType(n);if(!r)return 1;const o=Object.keys(r),a=r[parseInt(o[0],10)];for(const h of a.Units){if(h.value===void 0||h.value===null)continue;const c=await e.getProperties(h.value);if(!c||!c.UnitType||!c.UnitType.value||c.UnitType.value!=="LENGTHUNIT")continue;let d=1,u=1;return c.Name.value==="METRE"&&(u=1),c.Name.value==="FOOT"&&(u=.3048),((t=c.Prefix)==null?void 0:t.value)==="MILLI"?d=.001:((s=c.Prefix)==null?void 0:s.value)==="CENTI"?d=.01:((i=c.Prefix)==null?void 0:i.value)==="DECI"&&(d=.1),u*d}return 1}static async findItemByGuid(e,t){var s;const i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(r&&((s=r.GlobalId)==null?void 0:s.value)===t)return r}return null}static async getRelationMap(e,t,s){var i;const n=s??(async()=>{}),r={},o=e.getAllPropertiesIDs();for(const a of o){const h=await e.getProperties(a);if(!h)continue;const c=h.type===t,d=Object.keys(h).find(g=>g.startsWith("Relating")),u=Object.keys(h).find(g=>g.startsWith("Related"));if(!(c&&d&&u))continue;const f=await e.getProperties((i=h[d])==null?void 0:i.value),m=h[u];if(!f||!m||!(m&&Array.isArray(m)))continue;const p=m.map(g=>g.value);await n(f.expressID,p),r[f.expressID]=p}return r}static async getQsetQuantities(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==I0?null:(n.Quantities??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetProps(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==Uo?null:(n.HasProperties??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetRel(e,t){var s;if(!await e.getProperties(t))return null;const i=await e.getAllPropertiesOfType(Xi);if(!i)return null;const n=Object.values(i);let r=null;for(const o of n)((s=o.RelatingPropertyDefinition)==null?void 0:s.value)===t&&(r=o.expressID);return r}static async getQsetRel(e,t){return Mo.getPsetRel(e,t)}static async getEntityName(e,t){var s;const i=await e.getProperties(t);if(!i)return{key:null,name:null};const n=Object.keys(i).find(o=>o.endsWith("Name"))??null,r=n?(s=i[n])==null?void 0:s.value:null;return{key:n,name:r}}static async getQuantityValue(e,t){const s=await e.getProperties(t);if(!s)return{key:null,value:null};const i=Object.keys(s).find(r=>r.endsWith("Value"))??null;let n;return i===null||s[i]===void 0||s[i]===null?n=null:n=s[i].value,{key:i,value:n}}static isRel(e){return tE[e].startsWith("IFCREL")}static async attributeExists(e,t,s){const i=await e.getProperties(t);return i?Object.keys(i).includes(s):!1}static async groupEntitiesByType(e,t){var s;const i=new Map;for(const n of t){const r=await e.getProperties(n);if(!r)continue;const o=r.type;i.get(o)||i.set(o,new Set),(s=i.get(o))==null||s.add(n)}return i}}let nC=class{constructor(){V(this,"factor",1),V(this,"complement",1)}apply(e){const t=this.getScaleMatrix().multiply(e);e.copy(t)}setUp(e){var t,s,i;this.factor=1;const n=this.getLengthUnits(e);if(!n)return;const r=n==null,o=n.Name===void 0||n.Name===null;r||o||(n.Name.value==="FOOT"&&(this.factor=.3048),((t=n.Prefix)==null?void 0:t.value)==="MILLI"?this.complement=.001:((s=n.Prefix)==null?void 0:s.value)==="CENTI"?this.complement=.01:((i=n.Prefix)==null?void 0:i.value)==="DECI"&&(this.complement=.01))}getLengthUnits(e){try{const t=e.GetLineIDsWithType(0,b0).get(0),s=e.GetLine(0,t);for(const i of s.Units){if(!i||i.value===null||i.value===void 0)continue;const n=e.GetLine(0,i.value);if(n.UnitType&&n.UnitType.value==="LENGTHUNIT")return n}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const e=this.factor;return new Oe().fromArray([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])}},sE=class{constructor(){V(this,"itemsByFloor",{}),V(this,"_units",new nC)}setUp(e){this._units.setUp(e),this.cleanUp();try{const t=e.GetLineIDsWithType(0,Kn),s=new Set,i=e.GetLineIDsWithType(0,zs);for(let h=0;h<i.size();h++)s.add(i.get(h));const n=e.GetLineIDsWithType(0,Xn),r=n.size();for(let h=0;h<r;h++){const c=n.get(h),d=e.GetLine(0,c);if(!d||!d.RelatingObject||!d.RelatedObjects)continue;const u=d.RelatingObject.value,f=d.RelatedObjects;for(const m of f){const p=m.value;s.has(p)&&(this.itemsByFloor[p]=u)}}const o={},a=t.size();for(let h=0;h<a;h++){const c=t.get(h),d=e.GetLine(0,c);if(!d||!d.RelatingStructure||!d.RelatedElements)continue;const u=d.RelatingStructure.value,f=d.RelatedElements;if(s.has(u))for(const m of f){o[u]||(o[u]=[]);const p=m.value;o[u].push(p)}else for(const m of f){const p=m.value;this.itemsByFloor[p]=u}}for(const h in o){const c=this.itemsByFloor[h];if(c!==void 0){const d=o[h];for(const u of d)this.itemsByFloor[u]=c}}for(let h=0;h<r;h++){const c=n.get(h),d=e.GetLine(0,c);if(!d||!d.RelatingObject||!d.RelatedObjects)continue;const u=d.RelatingObject.value,f=d.RelatedObjects;for(const m of f){const p=m.value,g=this.itemsByFloor[u];g!==void 0&&(this.itemsByFloor[p]=g)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}},tp=class{constructor(){V(this,"includeProperties",!0),V(this,"optionalCategories",[zs]),V(this,"coordinate",!0),V(this,"wasm",{path:"",absolute:!1,logLevel:u0.LOG_LEVEL_OFF}),V(this,"excludedCategories",new Set),V(this,"includedCategories",new Set),V(this,"saveLocations",!1),V(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),V(this,"autoSetWasm",!0),V(this,"customLocateFileHandler",null)}},iE=class{constructor(){V(this,"defLineMat",new mi({color:16777215}))}read(e){const t=e.GetAllAlignments(0),s=e.GetAllCrossSections2D(0),i=e.GetAllCrossSections3D(0),n={IfcAlignment:t,IfcCrossSection2D:s,IfcCrossSection3D:i};return this.get(n)}get(e){if(e.IfcAlignment){const t=new Map;for(const s of e.IfcAlignment){const i=new Dc;i.absolute=this.getCurves(s.curve3D,i),i.horizontal=this.getCurves(s.horizontal,i),i.vertical=this.getCurves(s.vertical,i),t.set(t.size,i)}return{alignments:t,coordinationMatrix:new Oe}}}getCurves(e,t){const s=[];let i=0;for(const n of e){const r={};if(n.data)for(const u of n.data){const[f,m]=u.split(": "),p=parseFloat(m);r[f]=p||m}const{points:o}=n,a=new Float32Array(o.length*3);for(let u=0;u<o.length;u++){const{x:f,y:m,z:p}=o[u];a[u*3]=f,a[u*3+1]=m,a[u*3+2]=p||0}const h=new Rt(a,3),c=new Rc;c.setAttribute("position",h);const d=new Lc(i,r,t,c,this.defLineMat);s.push(d.curve),i++}return s}},nE=class{getNameInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,d0)||{};if(!i)return s;const[n,r,o,a,h,c,d]=i;if(n!=null&&n.value&&(s.name=n.value),r!=null&&r.value&&(s.creationDate=new Date(r.value)),o){s.author={};const[u,f]=o;u!=null&&u.value&&(s.author.name=u.value),f!=null&&f.value&&(s.author.email=f.value)}return(t=a[0])!=null&&t.value&&(s.organization=a[0].value),h!=null&&h.value&&(s.preprocessorVersion=h?.value),c!=null&&c.value&&(s.originatingSystem=c?.value),d!=null&&d.value&&(s.authorization=d?.value),s}getDescriptionInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,f0)||{};if(!i)return s;const[n,r]=i;if((t=n[0])!=null&&t.value){const o=n[0].value.match(/\[([^\]]+)\]/);o&&o[1]&&(s.viewDefinition=o[1])}return r!=null&&r.value&&(s.implementationLevel=r.value),s}},rE=class{static get(e,t){const s=[$o,ea,ta,Rr,zs,p0,m0,g0,E0],i=e.data;for(const n of s){const r=t.GetLineIDsWithType(0,n),o=r.size();for(let a=0;a<o;a++){const h=r.get(a);i.has(h)||i.set(h,[[],[0,n]])}}}};const oE=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),aE=class lE extends qt{constructor(e){super(e),V(this,"enabled",!0),e.add(lE.uuid,this)}async export(e,t,s=!1,i=!0){const n={},r=new Set(e.GetIfcEntityList(t)),o=new Set([$o,ea,ta,Rr,zs]);for(const a of o)r.add(a);for(const a of r){if(oE.has(a))continue;const h=o.has(a)&&i,c=e.GetLineIDsWithType(t,a);for(const d of c){const u=e.GetLine(0,d,h,s);n[u.expressID]=u}}return n}};V(aE,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let rC=aE;const hE=class tf extends qt{constructor(e){super(e),V(this,"onDisposed",new Ue),V(this,"onIfcStartedLoading",new Ue),V(this,"onSetup",new Ue),V(this,"settings",new tp),V(this,"webIfc",new fi),V(this,"enabled",!0),V(this,"_material",new kn),V(this,"_spatialTree",new sE),V(this,"_metaData",new nE),V(this,"_fragmentInstances",new Map),V(this,"_civil",new iE),V(this,"_visitedFragments",new Map),V(this,"_materialT",new kn({transparent:!0,opacity:.5})),this.components.add(tf.uuid,this),this.settings.excludedCategories.add(Oc)}dispose(){this.webIfc=null,this.onDisposed.trigger(tf.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,t=!0){const s=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(e);const i=await this.getAllGeometries(),n=await this.components.get(rC).export(this.webIfc,0);i.setLocalProperties(n);const r=this.components.get(kt);r.groups.set(i.uuid,i);for(const o of i.items)r.list.set(o.id,o),o.mesh.uuid=o.id,o.group=i;r.onFragmentsLoaded.trigger(i),t&&r.coordinate([i]);for(const[o]of i.data){const a=n[o];if(!a||!a.GlobalId)continue;const h=a.GlobalId.value||a.GlobalId;i.globalToExpressIDs.set(h,o)}return rE.get(i,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-s} ms!`),i}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new fi,this._visitedFragments.clear(),this._fragmentInstances.clear()}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const e=this.webIfc.GetIfcEntityList(0),t=new ia;t.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const s=[];for(const n of e){if(!this.webIfc.IsIfcElement(n)&&n!==zs)continue;const r=this.settings.includedCategories;if(r.size>0&&!r.has(n)||this.settings.excludedCategories.has(n))continue;const o=this.webIfc.GetLineIDsWithType(0,n),a=o.size();for(let h=0;h<a;h++){const c=o.get(h);s.push(c);const d=this._spatialTree.itemsByFloor[c]||0;t.data.set(c,[[],[d,n]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,s,n=>{this.getMesh(n,t)});for(const n of this._visitedFragments){const{index:r,fragment:o}=n[1];t.keyFragments.set(r,o.id)}for(const n of t.items){const r=this._fragmentInstances.get(n.id);if(!r)throw new Error("Fragment not found!");const o=[];for(const[a,h]of r)o.push(h);n.add(o)}const i=this.webIfc.GetCoordinationMatrix(0);return t.coordinationMatrix.fromArray(i),t.civilData=this._civil.read(this.webIfc),t}getMesh(e,t){const s=e.geometries.size(),i=e.expressID;for(let n=0;n<s;n++){const r=e.geometries.get(n),{x:o,y:a,z:h,w:c}=r.color,d=c!==1,{geometryExpressID:u}=r,f=`${u}-${d}`;if(!this._visitedFragments.has(f)){const b=this.getGeometry(this.webIfc,u),C=d?this._materialT:this._material,F=new wr(b,C,1);t.add(F.mesh),t.items.push(F);const A=this._visitedFragments.size;this._visitedFragments.set(f,{index:A,fragment:F})}const m=new mt().setRGB(o,a,h,"srgb"),p=new Oe;p.fromArray(r.flatTransformation);const g=this._visitedFragments.get(f);if(g===void 0)throw new Error("Error getting geometry data for streaming!");const E=t.data.get(i);if(!E)throw new Error("Data not found!");E[0].push(g.index);const{fragment:I}=g;this._fragmentInstances.has(I.id)||this._fragmentInstances.set(I.id,new Map);const v=this._fragmentInstances.get(I.id);if(!v)throw new Error("Instances not found!");if(v.has(i)){const b=v.get(i);if(!b)throw new Error("Instance not found!");b.transforms.push(p),b.colors&&b.colors.push(m)}else v.set(i,{id:i,transforms:[p],colors:[m]})}}getGeometry(e,t){const s=e.GetGeometry(0,t),i=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let d=0;d<n.length;d+=6)r[d/2]=n[d],r[d/2+1]=n[d+1],r[d/2+2]=n[d+2],o[d/2]=n[d+3],o[d/2+1]=n[d+4],o[d/2+2]=n[d+5];const a=new ft,h=new Rt(r,3),c=new Rt(o,3);return a.setAttribute("position",h),a.setAttribute("normal",c),a.setIndex(Array.from(i)),s.delete(),a}async autoSetWasm(){const e=await fetch(`https://unpkg.com/@thatopen/components@${Aw.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};V(hE,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let oC=hE;const aC={IfcRelAssignsToControl:{related:5,relating:7},IfcRelAssignsToGroup:{related:5,relating:7},IfcRelAssignsToProduct:{related:5,relating:7},IfcRelAssociatesClassification:{related:5,relating:6},IfcRelAssociatesMaterial:{related:5,relating:6},IfcRelAssociatesDocument:{related:5,relating:6},IfcRelContainedInSpatialStructure:{related:5,relating:6},IfcRelFlowControlElements:{related:5,relating:6},IfcRelConnectsElements:{related:7,relating:6},IfcRelDeclares:{related:6,relating:5},IfcRelAggregates:{related:6,relating:5},IfcRelNests:{related:6,relating:5},IfcRelDefinesByProperties:{related:5,relating:6},IfcRelDefinesByType:{related:5,relating:6},IfcRelDefinesByTemplate:{related:5,relating:6}},lC={[Qo]:"IfcRelAssignsToControl",[Go]:"IfcRelAssignsToGroup",[Xo]:"IfcRelAssignsToProduct",[Yo]:"IfcRelAssociatesClassification",[Vo]:"IfcRelAssociatesMaterial",[Jo]:"IfcRelAssociatesDocument",[Kn]:"IfcRelContainedInSpatialStructure",[Zo]:"IfcRelConnectsElements",[jo]:"IfcRelFlowControlElements",[Ko]:"IfcRelDeclares",[Xn]:"IfcRelAggregates",[qo]:"IfcRelNests",[Xi]:"IfcRelDefinesByProperties",[Ho]:"IfcRelDefinesByType",[Wo]:"IfcRelDefinesByTemplate"},cE=class _o extends qt{constructor(e){super(e),V(this,"onDisposed",new Ue),V(this,"onRequestFile",new Ue),V(this,"ifcToExport",null),V(this,"onElementToPset",new Ue),V(this,"onPropToPset",new Ue),V(this,"onPsetRemoved",new Ue),V(this,"onDataChanged",new Ue),V(this,"wasm",{path:"/",absolute:!1}),V(this,"enabled",!0),V(this,"attributeListeners",{}),V(this,"selectedModel"),V(this,"changeMap",{}),this.components.add(_o.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(_o.uuid),this.onDisposed.reset()}static getIFCSchema(e){const t=e.ifcMetadata.schema;if(!t)throw new Error("IFC Schema not found");return t.startsWith("IFC2X3")?"IFC2X3":t.startsWith("IFC4")&&t.replace("IFC4","")===""?"IFC4":t.startsWith("IFC4X3")?"IFC4X3":t}async setData(e,...t){for(const s of t){const{expressID:i}=s;(!i||i===-1)&&(s.expressID=this.getNewExpressID(e)),await e.setProperties(s.expressID,s),this.registerChange(e,s.expressID)}}async newPset(e,t,s){const i=_o.getIFCSchema(e),{ownerHistoryHandle:n}=await this.getOwnerHistory(e),r=this.newGUID(e),o=new jt[i].IfcLabel(t),a=s?new jt[i].IfcText(s):null,h=new jt[i].IfcPropertySet(r,n,o,a,[]);h.expressID=this.getNewExpressID(e);const c=this.newGUID(e),d=new jt[i].IfcRelDefinesByProperties(c,n,null,null,[],new hs(h.expressID));return d.expressID=this.getNewExpressID(e),await this.setData(e,h,d),{pset:h,rel:d}}async removePset(e,...t){for(const s of t){const i=await e.getProperties(s);if(i?.type!==Uo)continue;const n=await Mo.getPsetRel(e,s);if(n&&(await e.setProperties(n,null),this.registerChange(e,n)),i){for(const r of i.HasProperties)await e.setProperties(r.value,null);await e.setProperties(s,null),this.onPsetRemoved.trigger({model:e,psetID:s}),this.registerChange(e,s)}}}newSingleStringProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleNumericProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleBooleanProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}async removePsetProp(e,t,s){const i=await e.getProperties(t),n=await e.getProperties(s);!i||!n||i.type===Uo&&n&&(i.HasProperties=i.HasProperties.filter(r=>r.value!==s),await e.setProperties(s,null),this.registerChange(e,t,s))}addElementToPset(e,t,...s){this.components.get(dl).addEntitiesRelation(e,t,{type:Xi,inv:"IsDefinedBy"},...s)}async addPropToPset(e,t,...s){const i=await e.getProperties(t);if(i){for(const n of s){if(i.HasProperties.includes(n))continue;const r=new hs(n);i.HasProperties.push(r),this.onPropToPset.trigger({model:e,psetID:t,propID:n})}this.registerChange(e,t)}}async createIfcRel(e,t,s,i){const n=lC[t];if(!n)throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const r=e.ifcMetadata.schema,o=aC[n],a=jt[r][n];if(!(o&&a))throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const h=[new jt[r].IfcGloballyUniqueId(Cr.create())],{related:c,relating:d}=o,u=[...new Set(i)].map(p=>new hs(p)),f=(p,g)=>{for(let E=p;E<g-1;E++)h.push(null)};c<d?(f(1,c),h.push(u),f(c,d),h.push(new hs(s))):(f(1,d),f(d,c),h.push(new hs(s)),h.push(u));const m=new a(...h);return await this.setData(e,m),m}async saveToIfc(e,t){const s=this.components.get(oC),i=s.webIfc,n=await s.readIfcFile(t);await this.components.get(dl).applyRelationChanges();const r=this.changeMap[e.uuid]??[];for(const a of r){const h=await e.getProperties(a);h?i.WriteLine(n,h):i.DeleteLine(n,a)}const o=i.SaveModel(n);return s.webIfc.CloseModel(n),s.cleanUp(),o}async getEntityRef(e,t){const s=await e.getAllPropertiesOfType(t);if(!s)return null;const i=[];for(const n in s){const r=new hs(Number(n));i.push(r)}return i}async setAttributeListener(e,t,s){this.attributeListeners[e.uuid]||(this.attributeListeners[e.uuid]={});const i=this.attributeListeners[e.uuid][t]?this.attributeListeners[e.uuid][t][s]:null;if(i)return i;const n=await e.getProperties(t);if(!n)throw new Error(`Entity with expressID ${t} doesn't exists.`);const r=n[s];if(Array.isArray(r)||!r)throw new Error(`Attribute ${s} is array or null, and it can't have a listener.`);const o=r.value;if(o===void 0||o==null)throw new Error(`Attribute ${s} has a badly defined handle.`);const a=new Ue;return Object.defineProperty(n[s],"value",{get(){return this._value},async set(h){this._value=h,a.trigger(h)}}),n[s].value=o,this.attributeListeners[e.uuid][t]||(this.attributeListeners[e.uuid][t]={}),this.attributeListeners[e.uuid][t][s]=a,a}getNewExpressID(e){return e.ifcMetadata.maxExpressID++,e.ifcMetadata.maxExpressID}newGUID(e){const t=_o.getIFCSchema(e);return new jt[t].IfcGloballyUniqueId(Cr.create())}async getOwnerHistory(e){const t=await e.getAllPropertiesOfType(c0);if(!t)throw new Error("No OwnerHistory was found.");const s=Object.keys(t).map(r=>parseInt(r,10)),i=t[s[0]],n=new hs(i.expressID);return{ownerHistory:i,ownerHistoryHandle:n}}registerChange(e,...t){this.changeMap[e.uuid]||(this.changeMap[e.uuid]=new Set);for(const s of t)this.changeMap[e.uuid].add(s),this.onDataChanged.trigger({model:e,expressID:s})}async newSingleProperty(e,t,s,i){const n=_o.getIFCSchema(e),r=new jt[n].IfcIdentifier(s),o=new jt[n][t](i),a=new jt[n].IfcPropertySingleValue(r,null,o,null);return a.expressID=this.getNewExpressID(e),await this.setData(e,a),a}};V(cE,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");let hC=cE;const uE=class sf extends qt{constructor(e){super(e),V(this,"onDisposed",new Ue),V(this,"onRelationsIndexed",new Ue),V(this,"relationMaps",{}),V(this,"enabled",!0),V(this,"_relToAttributesMap",Km),V(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements","HasControlElements","AssignedToFlowElement","ConnectedTo","ConnectedFrom","ReferencedBy","Declares","HasContext","Controls","IsNestedBy","Nests","DocumentRefForObjects"]),V(this,"_ifcRels",[Xn,Vo,Yo,Go,Xi,Ho,Wo,Kn,jo,Zo,Xo,Ko,Qo,qo,Jo]),V(this,"onFragmentsDisposed",t=>{delete this.relationMaps[t.groupID]}),V(this,"_changeMap",{}),V(this,"onEntitiesRelated",new Ue),this.components.add(sf.uuid,this),e.get(kt).onFragmentsDisposed.add(this.onFragmentsDisposed)}indexRelations(e,t,s,i){const n=Object.keys(t).find(c=>c.startsWith("Relating")),r=Object.keys(t).find(c=>c.startsWith("Related"));if(!(n&&r))return;const o=t[n].value,a=t[r].map(c=>c.value),h=this.getAttributeIndex(i);if(h!==null){let c=e.get(o);c||(c=new Map,e.set(o,c));let d=c.get(h);d||(d=[],c.set(h,d)),d.push(...a)}for(const c of a){const d=this.getAttributeIndex(s);if(d===null)continue;let u=e.get(c);u||(u=new Map,e.set(c,u));let f=u.get(d);f||(f=[],u.set(d,f)),f.push(o)}}getAttributeIndex(e){const t=this._inverseAttributes.indexOf(e);return t===-1?null:t}setRelationMap(e,t){this.relationMaps[e.uuid]=t,this.onRelationsIndexed.trigger({modelID:e.uuid,relationsMap:t})}async process(e){if(!e.hasProperties)throw new Error("FragmentsGroup properties not found");let t=this.relationMaps[e.uuid];if(t)return t;t=new Map;for(const s of this._ifcRels){const i=await e.getAllPropertiesOfType(s);if(!i)continue;const n=this._relToAttributesMap.get(s);if(!n)continue;const{forRelated:r,forRelating:o}=n;for(const a in i){const h=i[a];this.indexRelations(t,h,r,o)}}return this.setRelationMap(e,t),t}async processFromWebIfc(e,t){const s=new Map;for(const i of this._ifcRels){const n=this._relToAttributesMap.get(i);if(!n)continue;const{forRelated:r,forRelating:o}=n,a=e.GetLineIDsWithType(t,i);for(let h=0;h<a.size();h++){const c=await e.properties.getItemProperties(t,a.get(h));this.indexRelations(s,c,r,o)}}return this.onRelationsIndexed.trigger({modelID:t.toString(),relationsMap:s}),s}getEntityRelations(e,t,s){const i=this.relationMaps[e.uuid];if(!i)throw new Error(`IfcRelationsIndexer: model ${e.uuid} has no relations indexed.`);const n=i.get(t),r=this.getAttributeIndex(s);return n===void 0||r===null?null:n.get(r)||null}serializeRelations(e){const t={};for(const[s,i]of e.entries()){t[s]||(t[s]={});for(const[n,r]of i.entries())t[s][n]=r}return JSON.stringify(t)}serializeModelRelations(e){const t=this.relationMaps[e.uuid];return t?this.serializeRelations(t):null}serializeAllRelations(){const e={};for(const t in this.relationMaps){const s=this.relationMaps[t],i={};for(const[n,r]of s.entries()){i[n]||(i[n]={});for(const[o,a]of r.entries())i[n][o]=a}e[t]=i}return JSON.stringify(e)}getRelationsMapFromJSON(e){const t=JSON.parse(e),s=new Map;for(const i in t){const n=t[i],r=new Map;for(const o in n)r.set(Number(o),n[o]);s.set(Number(i),r)}return s}dispose(){this.relationMaps={},this.components.get(kt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(sf.uuid),this.onDisposed.reset()}getEntitiesWithRelation(e,t,s){const i=this.relationMaps[e.uuid];if(!i)throw new Error("IfcRelationsIndexer: the model relations are not indexed!");const n=new Set;for(const[r,o]of i){const a=this.getAttributeIndex(t);if(a===null)throw new Error("IfcRelationsIndexer: invalid inverse attribute name");const h=o.get(a);h&&h.includes(s)&&n.add(r)}return n}addEntityRelations(e,t,s,...i){const n=this.getEntityRelations(e,t,s);if(n)n.push(...i);else{const r=this.getAttributeIndex(s);if(!r)throw new Error(`IfcRelationsIndexer: ${s} is not a valid relation name.`);const o=this.relationMaps[e.uuid].get(t);o?.set(r,i)}}async applyRelationChanges(){const e=this.components.get(kt),t=this.components.get(hC);for(const s in this._changeMap){const i=e.groups.get(s);if(!i)continue;const n=this._changeMap[s];for(const[r,o]of n)for(const[a,h]of o){const{related:c,relID:d}=h;if(d){const u=await i.getProperties(d);if(!u)continue;const f=Object.keys(u),m=f.find(g=>g.startsWith("Related")),p=f.find(g=>g.startsWith("Relating"));if(!(m&&p))continue;u[m]=[...c].map(g=>new hs(g)),u[p]=new hs(a),await t.setData(i,u)}else{const u=await t.createIfcRel(i,r,a,[...c]);if(!u)continue;h.relID=u.expressID}}}}addEntitiesRelation(e,t,s,...i){const{type:n,inv:r}=s,o=this.relationMaps[e.uuid];if(!o||!this._ifcRels.includes(n))return;const a=Km.get(n);if(!a)return;const{forRelated:h,forRelating:c}=a;if(!(h===r||c===r))return;let d=this._changeMap[e.uuid];d||(d=new Hn,this._changeMap[e.uuid]=d);const u=c===r?[t]:i,f=h===r?[t]:i;let m=d.get(n);m||(m=new Hn,m.onItemSet.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:u,relatedIDs:f})),m.onItemUpdated.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:u,relatedIDs:f})),d.set(n,m));for(const p of u){let g=m.get(p);g||(g={related:new Po},m.set(p,g)),g.related.add(...f)}for(const p of u){let g=o.get(p);g||(g=new Map,o.set(p,g));const E=this.getAttributeIndex(c);if(E!==null){let I=g.get(E);I||(I=[],g.set(E,I)),I.push(...f)}}for(const p of f){let g=o.get(p);g||(g=new Map,o.set(p,g));const E=this.getAttributeIndex(h);if(E===null)continue;let I=g.get(E);I||(I=[],g.set(E,I)),I.push(...u)}}getEntityChildren(e,t,s=new Set){if(s.add(t),this.relationMaps[e.uuid]===void 0)throw new Error("The provided model has no indices. You have to generate them first.");const i=this.getEntityRelations(e,t,"IsDecomposedBy");if(i)for(const r of i)this.getEntityChildren(e,r,s);const n=this.getEntityRelations(e,t,"ContainsElements");if(n)for(const r of n)this.getEntityChildren(e,r,s);return s}};V(uE,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let dl=uE;const dE=class fE extends qt{constructor(e){super(e),V(this,"onDisposed",new Ue),V(this,"onFragmentsLoaded",new Ue),V(this,"onFragmentsDisposed",new Ue),V(this,"list",new Hn),V(this,"groups",new Hn),V(this,"baseCoordinationModel",""),V(this,"baseCoordinationMatrix",new Oe),V(this,"enabled",!0),V(this,"_loader",new Nc),this.components.add(fE.uuid,this)}get meshes(){const e=[];for(const[t,s]of this.list)e.push(s.mesh);return e}dispose(){for(const[e,t]of this.groups)t.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(e){const{uuid:t}=e,s=[];for(const i of e.items)s.push(i.id),this.list.delete(i.id);e.dispose(!0),this.groups.delete(e.uuid),this.groups.size===0&&(this.baseCoordinationModel="",this.baseCoordinationMatrix=new Oe),this.onFragmentsDisposed.trigger({groupID:t,fragmentIDs:s})}load(e,t){const s={coordinate:!0,...t},{coordinate:i,name:n,properties:r,relationsMap:o}=s,a=this._loader.import(e);t&&(a.isStreamed=t.isStreamed||!1),n&&(a.name=n);for(const h of a.items)h.group=a,this.list.set(h.id,h);return i&&this.coordinate([a]),this.groups.set(a.uuid,a),r&&a.setLocalProperties(r),o&&this.components.get(dl).setRelationMap(a,o),this.onFragmentsLoaded.trigger(a),a}export(e){return this._loader.export(e)}getModelIdMap(e){const t={};for(const s in e){const i=this.list.get(s);if(!(i&&i.group))continue;const n=i.group;n.uuid in t||(t[n.uuid]=new Set);const r=e[s];for(const o of r)t[n.uuid].add(o)}return t}modelIdToFragmentIdMap(e){let t={};for(const s in e){const i=this.groups.get(s);if(!i)continue;const n=e[s],r=i.getFragmentMap(n);t={...t,...r}}return t}guidToFragmentIdMap(e){const t={};for(const[s,i]of this.groups){s in t||(t[s]=new Set);for(const n of e){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return this.modelIdToFragmentIdMap(t)}coordinate(e=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const t=e.pop();if(!t)return;this.baseCoordinationModel=t.uuid,this.baseCoordinationMatrix=t.coordinationMatrix.clone()}if(e.length)for(const t of e)t.coordinationMatrix.equals(this.baseCoordinationMatrix)||(t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrix(),this.applyBaseCoordinateSystem(t,t.coordinationMatrix))}applyBaseCoordinateSystem(e,t){t&&e.applyMatrix4(t.clone().invert()),e.applyMatrix4(this.baseCoordinationMatrix)}clone(e,t){const s=e.cloneGroup(t);this.groups.set(s.uuid,s);for(const i of s.items)this.list.set(i.id,i);return s}};V(dE,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let kt=dE;var Ah=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cC(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function Fh(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pE={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(l,e){(function(t){l.exports=t()})(function(){return function t(s,i,n){function r(h,c){if(!i[h]){if(!s[h]){var d=typeof Fh=="function"&&Fh;if(!c&&d)return d(h,!0);if(o)return o(h,!0);var u=new Error("Cannot find module '"+h+"'");throw u.code="MODULE_NOT_FOUND",u}var f=i[h]={exports:{}};s[h][0].call(f.exports,function(m){var p=s[h][1][m];return r(p||m)},f,f.exports,t,s,i,n)}return i[h].exports}for(var o=typeof Fh=="function"&&Fh,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,s,i){var n=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(a){for(var h,c,d,u,f,m,p,g=[],E=0,I=a.length,v=I,b=n.getTypeOf(a)!=="string";E<a.length;)v=I-E,d=b?(h=a[E++],c=E<I?a[E++]:0,E<I?a[E++]:0):(h=a.charCodeAt(E++),c=E<I?a.charCodeAt(E++):0,E<I?a.charCodeAt(E++):0),u=h>>2,f=(3&h)<<4|c>>4,m=1<v?(15&c)<<2|d>>6:64,p=2<v?63&d:64,g.push(o.charAt(u)+o.charAt(f)+o.charAt(m)+o.charAt(p));return g.join("")},i.decode=function(a){var h,c,d,u,f,m,p=0,g=0,E="data:";if(a.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var I,v=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===o.charAt(64)&&v--,a.charAt(a.length-2)===o.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(I=r.uint8array?new Uint8Array(0|v):new Array(0|v);p<a.length;)h=o.indexOf(a.charAt(p++))<<2|(u=o.indexOf(a.charAt(p++)))>>4,c=(15&u)<<4|(f=o.indexOf(a.charAt(p++)))>>2,d=(3&f)<<6|(m=o.indexOf(a.charAt(p++))),I[g++]=h,f!==64&&(I[g++]=c),m!==64&&(I[g++]=d);return I}},{"./support":30,"./utils":32}],2:[function(t,s,i){var n=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function h(c,d,u,f,m){this.compressedSize=c,this.uncompressedSize=d,this.crc32=u,this.compression=f,this.compressedContent=m}h.prototype={getContentWorker:function(){var c=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),d=this;return c.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(c,d,u){return c.pipe(new o).pipe(new a("uncompressedSize")).pipe(d.compressWorker(u)).pipe(new a("compressedSize")).withStreamInfo("compression",d)},s.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,i){var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,i){var n=t("./utils"),r=function(){for(var o,a=[],h=0;h<256;h++){o=h;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[h]=o}return a}();s.exports=function(o,a){return o!==void 0&&o.length?n.getTypeOf(o)!=="string"?function(h,c,d,u){var f=r,m=u+d;h^=-1;for(var p=u;p<m;p++)h=h>>>8^f[255&(h^c[p])];return-1^h}(0|a,o,o.length,0):function(h,c,d,u){var f=r,m=u+d;h^=-1;for(var p=u;p<m;p++)h=h>>>8^f[255&(h^c.charCodeAt(p))];return-1^h}(0|a,o,o.length,0):0}},{"./utils":32}],5:[function(t,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,s,i){var n=null;n=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:n}},{lie:37}],7:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),h=n?"uint8array":"array";function c(d,u){a.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=u,this.meta={}}i.magic="\b\0",o.inherits(c,a),c.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,d.data),!1)},c.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(u){d.push({data:u,meta:d.meta})}},i.compressWorker=function(d){return new c("Deflate",d)},i.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,i){function n(f,m){var p,g="";for(p=0;p<m;p++)g+=String.fromCharCode(255&f),f>>>=8;return g}function r(f,m,p,g,E,I){var v,b,C=f.file,F=f.compression,A=I!==h.utf8encode,R=o.transformTo("string",I(C.name)),O=o.transformTo("string",h.utf8encode(C.name)),L=C.comment,k=o.transformTo("string",I(L)),x=o.transformTo("string",h.utf8encode(L)),M=O.length!==C.name.length,w=x.length!==L.length,G="",J="",Z="",le=C.dir,ee=C.date,xe={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(xe.crc32=f.crc32,xe.compressedSize=f.compressedSize,xe.uncompressedSize=f.uncompressedSize);var X=0;m&&(X|=8),A||!M&&!w||(X|=2048);var j=0,be=0;le&&(j|=16),E==="UNIX"?(be=798,j|=function(ue,He){var Xe=ue;return ue||(Xe=He?16893:33204),(65535&Xe)<<16}(C.unixPermissions,le)):(be=20,j|=function(ue){return 63&(ue||0)}(C.dosPermissions)),v=ee.getUTCHours(),v<<=6,v|=ee.getUTCMinutes(),v<<=5,v|=ee.getUTCSeconds()/2,b=ee.getUTCFullYear()-1980,b<<=4,b|=ee.getUTCMonth()+1,b<<=5,b|=ee.getUTCDate(),M&&(J=n(1,1)+n(c(R),4)+O,G+="up"+n(J.length,2)+J),w&&(Z=n(1,1)+n(c(k),4)+x,G+="uc"+n(Z.length,2)+Z);var fe="";return fe+=`
\0`,fe+=n(X,2),fe+=F.magic,fe+=n(v,2),fe+=n(b,2),fe+=n(xe.crc32,4),fe+=n(xe.compressedSize,4),fe+=n(xe.uncompressedSize,4),fe+=n(R.length,2),fe+=n(G.length,2),{fileRecord:d.LOCAL_FILE_HEADER+fe+R+G,dirRecord:d.CENTRAL_FILE_HEADER+n(be,2)+fe+n(k.length,2)+"\0\0\0\0"+n(j,4)+n(g,4)+R+G+k}}var o=t("../utils"),a=t("../stream/GenericWorker"),h=t("../utf8"),c=t("../crc32"),d=t("../signature");function u(f,m,p,g){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=g,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(u,a),u.prototype.push=function(f){var m=f.meta.percent||0,p=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,a.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-g-1))/p:100}}))},u.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var p=r(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,p=r(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(g){return d.DATA_DESCRIPTOR+n(g.crc32,4)+n(g.compressedSize,4)+n(g.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-f,g=function(E,I,v,b,C){var F=o.transformTo("string",C(b));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(E,2)+n(E,2)+n(I,4)+n(v,4)+n(F.length,2)+F}(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(p){m.processChunk(p)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(p){m.error(p)}),this},u.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(f){var m=this._sources;if(!a.prototype.error.call(this,f))return!1;for(var p=0;p<m.length;p++)try{m[p].error(f)}catch{}return!0},u.prototype.lock=function(){a.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},s.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,i){var n=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(o,a,h){var c=new r(a.streamFiles,h,a.platform,a.encodeFileName),d=0;try{o.forEach(function(u,f){d++;var m=function(I,v){var b=I||v,C=n[b];if(!C)throw new Error(b+" is not a valid compression method !");return C}(f.options.compression,a.compression),p=f.options.compressionOptions||a.compressionOptions||{},g=f.dir,E=f.date;f._compressWorker(m,p).withStreamInfo("file",{name:u,dir:g,date:E,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(c)}),c.entriesCount=d}catch(u){c.error(u)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,i){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,o){return new n().loadAsync(r,o)},n.external=t("./external"),s.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,i){var n=t("./utils"),r=t("./external"),o=t("./utf8"),a=t("./zipEntries"),h=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function d(u){return new r.Promise(function(f,m){var p=u.decompressed.getContentWorker().pipe(new h);p.on("error",function(g){m(g)}).on("end",function(){p.streamInfo.crc32!==u.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}s.exports=function(u,f){var m=this;return f=n.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(u)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",u,!0,f.optimizedBinaryString,f.base64).then(function(p){var g=new a(f);return g.load(p),g}).then(function(p){var g=[r.Promise.resolve(p)],E=p.files;if(f.checkCRC32)for(var I=0;I<E.length;I++)g.push(d(E[I]));return r.Promise.all(g)}).then(function(p){for(var g=p.shift(),E=g.files,I=0;I<E.length;I++){var v=E[I],b=v.fileNameStr,C=n.resolve(v.fileNameStr);m.file(C,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:f.createFolders}),v.dir||(m.file(C).unsafeOriginalName=b)}return g.zipComment.length&&(m.comment=g.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,i){var n=t("../utils"),r=t("../stream/GenericWorker");function o(a,h){r.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(h)}n.inherits(o,r),o.prototype._bindStream=function(a){var h=this;(this._stream=a).pause(),a.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,i){var n=t("readable-stream").Readable;function r(o,a,h){n.call(this,a),this._helper=o;var c=this;o.on("data",function(d,u){c.push(d)||c._helper.pause(),h&&h(u)}).on("error",function(d){c.emit("error",d)}).on("end",function(){c.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},s.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,s,i){function n(C,F,A){var R,O=o.getTypeOf(F),L=o.extend(A||{},c);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(C=E(C)),L.createFolders&&(R=g(C))&&I.call(this,R,!0);var k=O==="string"&&L.binary===!1&&L.base64===!1;A&&A.binary!==void 0||(L.binary=!k),(F instanceof d&&F.uncompressedSize===0||L.dir||!F||F.length===0)&&(L.base64=!1,L.binary=!0,F="",L.compression="STORE",O="string");var x=null;x=F instanceof d||F instanceof a?F:m.isNode&&m.isStream(F)?new p(C,F):o.prepareContent(C,F,L.binary,L.optimizedBinaryString,L.base64);var M=new u(C,x,L);this.files[C]=M}var r=t("./utf8"),o=t("./utils"),a=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),c=t("./defaults"),d=t("./compressedObject"),u=t("./zipObject"),f=t("./generate"),m=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),g=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var F=C.lastIndexOf("/");return 0<F?C.substring(0,F):""},E=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},I=function(C,F){return F=F!==void 0?F:c.createFolders,C=E(C),this.files[C]||n.call(this,C,null,{dir:!0,createFolders:F}),this.files[C]};function v(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var b={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var F,A,R;for(F in this.files)R=this.files[F],(A=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&C(A,R)},filter:function(C){var F=[];return this.forEach(function(A,R){C(A,R)&&F.push(R)}),F},file:function(C,F,A){if(arguments.length!==1)return C=this.root+C,n.call(this,C,F,A),this;if(v(C)){var R=C;return this.filter(function(L,k){return!k.dir&&R.test(L)})}var O=this.files[this.root+C];return O&&!O.dir?O:null},folder:function(C){if(!C)return this;if(v(C))return this.filter(function(O,L){return L.dir&&C.test(O)});var F=this.root+C,A=I.call(this,F),R=this.clone();return R.root=A.name,R},remove:function(C){C=this.root+C;var F=this.files[C];if(F||(C.slice(-1)!=="/"&&(C+="/"),F=this.files[C]),F&&!F.dir)delete this.files[C];else for(var A=this.filter(function(O,L){return L.name.slice(0,C.length)===C}),R=0;R<A.length;R++)delete this.files[A[R].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var F,A={};try{if((A=o.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");o.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var R=A.comment||this.comment||"";F=f.generateWorker(this,A,R)}catch(O){(F=new a("error")).error(O)}return new h(F,A.type||"string",A.mimeType)},generateAsync:function(C,F){return this.generateInternalStream(C).accumulate(F)},generateNodeStream:function(C,F){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(F)}};s.exports=b},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,i){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o);for(var a=0;a<this.data.length;a++)o[a]=255&o[a]}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var a=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===a&&this.data[u+1]===h&&this.data[u+2]===c&&this.data[u+3]===d)return u-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var a=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),u=this.readData(4);return a===u[0]&&h===u[1]&&c===u[2]&&d===u[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,s,i){var n=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var a,h=0;for(this.checkOffset(o),a=this.index+o-1;a>=this.index;a--)h=(h<<8)+this.byteAt(a);return this.index+=o,h},readString:function(o){return n.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=r},{"../utils":32}],19:[function(t,s,i){var n=t("./Uint8ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,s,i){var n=t("./ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,i){var n=t("../utils"),r=t("../support"),o=t("./ArrayReader"),a=t("./StringReader"),h=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");s.exports=function(d){var u=n.getTypeOf(d);return n.checkSupport(u),u!=="string"||r.uint8array?u==="nodebuffer"?new h(d):r.uint8array?new c(n.transformTo("uint8array",d)):new o(n.transformTo("array",d)):new a(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,i){var n=t("./GenericWorker"),r=t("../utils");function o(a){n.call(this,"ConvertWorker to "+a),this.destType=a}r.inherits(o,n),o.prototype.processChunk=function(a){this.push({data:r.transformTo(this.destType,a.data),meta:a.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,i){var n=t("./GenericWorker"),r=t("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n),o.prototype.processChunk=function(a){this.streamInfo.crc32=r(a.data,this.streamInfo.crc32||0),this.push(a)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}n.inherits(o,r),o.prototype.processChunk=function(a){if(a){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+a.data.length}r.prototype.processChunk.call(this,a)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=n.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,h);break;case"uint8array":a=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":a=this.data.slice(this.index,h)}return this.index=h,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,i){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var a=0;a<this._listeners[r].length;a++)this._listeners[r][a].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(a){o.processChunk(a)}),r.on("end",function(){o.end()}),r.on("error",function(a){o.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},s.exports=n},{}],29:[function(t,s,i){var n=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),a=t("../base64"),h=t("../support"),c=t("../external"),d=null;if(h.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(m,p){return new c.Promise(function(g,E){var I=[],v=m._internalType,b=m._outputType,C=m._mimeType;m.on("data",function(F,A){I.push(F),p&&p(A)}).on("error",function(F){I=[],E(F)}).on("end",function(){try{var F=function(A,R,O){switch(A){case"blob":return n.newBlob(n.transformTo("arraybuffer",R),O);case"base64":return a.encode(R);default:return n.transformTo(A,R)}}(b,function(A,R){var O,L=0,k=null,x=0;for(O=0;O<R.length;O++)x+=R[O].length;switch(A){case"string":return R.join("");case"array":return Array.prototype.concat.apply([],R);case"uint8array":for(k=new Uint8Array(x),O=0;O<R.length;O++)k.set(R[O],L),L+=R[O].length;return k;case"nodebuffer":return Buffer.concat(R);default:throw new Error("concat : unsupported type '"+A+"'")}}(v,I),C);g(F)}catch(A){E(A)}I=[]}).resume()})}function f(m,p,g){var E=p;switch(p){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=p,this._mimeType=g,n.checkSupport(E),this._worker=m.pipe(new r(E)),m.lock()}catch(I){this._worker=new o("error"),this._worker.error(I)}}f.prototype={accumulate:function(m){return u(this,m)},on:function(m,p){var g=this;return m==="data"?this._worker.on(m,function(E){p.call(g,E.data,E.meta)}):this._worker.on(m,function(){n.delay(p,arguments,g)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},s.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=r.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,i){for(var n=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),a=t("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function d(){a.call(this,"utf-8 decode"),this.leftOver=null}function u(){a.call(this,"utf-8 encode")}i.utf8encode=function(f){return r.nodebuffer?o.newBufferFrom(f,"utf-8"):function(m){var p,g,E,I,v,b=m.length,C=0;for(I=0;I<b;I++)(64512&(g=m.charCodeAt(I)))==55296&&I+1<b&&(64512&(E=m.charCodeAt(I+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),I++),C+=g<128?1:g<2048?2:g<65536?3:4;for(p=r.uint8array?new Uint8Array(C):new Array(C),I=v=0;v<C;I++)(64512&(g=m.charCodeAt(I)))==55296&&I+1<b&&(64512&(E=m.charCodeAt(I+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),I++),g<128?p[v++]=g:(g<2048?p[v++]=192|g>>>6:(g<65536?p[v++]=224|g>>>12:(p[v++]=240|g>>>18,p[v++]=128|g>>>12&63),p[v++]=128|g>>>6&63),p[v++]=128|63&g);return p}(f)},i.utf8decode=function(f){return r.nodebuffer?n.transformTo("nodebuffer",f).toString("utf-8"):function(m){var p,g,E,I,v=m.length,b=new Array(2*v);for(p=g=0;p<v;)if((E=m[p++])<128)b[g++]=E;else if(4<(I=h[E]))b[g++]=65533,p+=I-1;else{for(E&=I===2?31:I===3?15:7;1<I&&p<v;)E=E<<6|63&m[p++],I--;1<I?b[g++]=65533:E<65536?b[g++]=E:(E-=65536,b[g++]=55296|E>>10&1023,b[g++]=56320|1023&E)}return b.length!==g&&(b.subarray?b=b.subarray(0,g):b.length=g),n.applyFromCharCode(b)}(f=n.transformTo(r.uint8array?"uint8array":"array",f))},n.inherits(d,a),d.prototype.processChunk=function(f){var m=n.transformTo(r.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var g=function(I,v){var b;for((v=v||I.length)>I.length&&(v=I.length),b=v-1;0<=b&&(192&I[b])==128;)b--;return b<0||b===0?v:b+h[I[b]]>v?b:v}(m),E=m;g!==m.length&&(r.uint8array?(E=m.subarray(0,g),this.leftOver=m.subarray(g,m.length)):(E=m.slice(0,g),this.leftOver=m.slice(g,m.length))),this.push({data:i.utf8decode(E),meta:f.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,n.inherits(u,a),u.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,i){var n=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),a=t("./external");function h(p){return p}function c(p,g){for(var E=0;E<p.length;++E)g[E]=255&p.charCodeAt(E);return g}t("setimmediate"),i.newBlob=function(p,g){i.checkSupport("blob");try{return new Blob([p],{type:g})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(p),E.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(p,g,E){var I=[],v=0,b=p.length;if(b<=E)return String.fromCharCode.apply(null,p);for(;v<b;)g==="array"||g==="nodebuffer"?I.push(String.fromCharCode.apply(null,p.slice(v,Math.min(v+E,b)))):I.push(String.fromCharCode.apply(null,p.subarray(v,Math.min(v+E,b)))),v+=E;return I.join("")},stringifyByChar:function(p){for(var g="",E=0;E<p.length;E++)g+=String.fromCharCode(p[E]);return g},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function u(p){var g=65536,E=i.getTypeOf(p),I=!0;if(E==="uint8array"?I=d.applyCanBeUsed.uint8array:E==="nodebuffer"&&(I=d.applyCanBeUsed.nodebuffer),I)for(;1<g;)try{return d.stringifyByChunk(p,E,g)}catch{g=Math.floor(g/2)}return d.stringifyByChar(p)}function f(p,g){for(var E=0;E<p.length;E++)g[E]=p[E];return g}i.applyFromCharCode=u;var m={};m.string={string:h,array:function(p){return c(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return c(p,new Uint8Array(p.length))},nodebuffer:function(p){return c(p,o.allocBuffer(p.length))}},m.array={string:u,array:h,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},m.arraybuffer={string:function(p){return u(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:h,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:u,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:h,nodebuffer:function(p){return o.newBufferFrom(p)}},m.nodebuffer={string:u,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:h},i.transformTo=function(p,g){if(g=g||"",!p)return g;i.checkSupport(p);var E=i.getTypeOf(g);return m[E][p](g)},i.resolve=function(p){for(var g=p.split("/"),E=[],I=0;I<g.length;I++){var v=g[I];v==="."||v===""&&I!==0&&I!==g.length-1||(v===".."?E.pop():E.push(v))}return E.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":n.nodebuffer&&o.isBuffer(p)?"nodebuffer":n.uint8array&&p instanceof Uint8Array?"uint8array":n.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!n[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var g,E,I="";for(E=0;E<(p||"").length;E++)I+="\\x"+((g=p.charCodeAt(E))<16?"0":"")+g.toString(16).toUpperCase();return I},i.delay=function(p,g,E){setImmediate(function(){p.apply(E||null,g||[])})},i.inherits=function(p,g){function E(){}E.prototype=g.prototype,p.prototype=new E},i.extend=function(){var p,g,E={};for(p=0;p<arguments.length;p++)for(g in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],g)&&E[g]===void 0&&(E[g]=arguments[p][g]);return E},i.prepareContent=function(p,g,E,I,v){return a.Promise.resolve(g).then(function(b){return n.blob&&(b instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(b))!==-1)&&typeof FileReader<"u"?new a.Promise(function(C,F){var A=new FileReader;A.onload=function(R){C(R.target.result)},A.onerror=function(R){F(R.target.error)},A.readAsArrayBuffer(b)}):b}).then(function(b){var C=i.getTypeOf(b);return C?(C==="arraybuffer"?b=i.transformTo("uint8array",b):C==="string"&&(v?b=r.decode(b):E&&I!==!0&&(b=function(F){return c(F,n.uint8array?new Uint8Array(F.length):new Array(F.length))}(b))),b):a.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),a=t("./zipEntry"),h=t("./support");function c(d){this.files=[],this.loadOptions=d}c.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(u)+", expected "+r.pretty(d)+")")}},isSignature:function(d,u){var f=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===u;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),u=h.uint8array?"uint8array":"array",f=r.transformTo(u,d);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,u,f,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),u=this.reader.readInt(4),f=this.reader.readData(u),this.zip64ExtensibleData[d]={id:d,length:u,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,u;for(d=0;d<this.files.length;d++)u=this.files[d],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var u=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=u-f;if(0<m)this.isSignature(u,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=n(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),a=t("./crc32"),h=t("./utf8"),c=t("./compressions"),d=t("./support");function u(f,m){this.options=f,this.loadOptions=m}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(g){for(var E in c)if(Object.prototype.hasOwnProperty.call(c,E)&&c[E].magic===g)return c[E];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,p,g,E=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<E;)m=f.readInt(2),p=f.readInt(2),g=f.readData(p),this.extraFields[m]={id:m,length:p,value:g};f.setIndex(E)},handleUTF8:function(){var f=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=r.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var E=r.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=n(f.value);return m.readInt(1)!==1||a(this.fileName)!==m.readInt(4)?null:h.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=n(f.value);return m.readInt(1)!==1||a(this.fileComment)!==m.readInt(4)?null:h.utf8decode(m.readData(f.length-5))}return null}},s.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,i){function n(m,p,g){this.name=m,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=p,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),a=t("./utf8"),h=t("./compressedObject"),c=t("./stream/GenericWorker");n.prototype={internalStream:function(m){var p=null,g="string";try{if(!m)throw new Error("No output type specified.");var E=(g=m.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),p=this._decompressWorker();var I=!this._dataBinary;I&&!E&&(p=p.pipe(new a.Utf8EncodeWorker)),!I&&E&&(p=p.pipe(new a.Utf8DecodeWorker))}catch(v){(p=new c("error")).error(v)}return new r(p,g,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof h&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new a.Utf8EncodeWorker)),h.createWorkerFrom(g,m,p)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<d.length;f++)n.prototype[d[f]]=u;s.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,i){(function(n){var r,o,a=n.MutationObserver||n.WebKitMutationObserver;if(a){var h=0,c=new a(m),d=n.document.createTextNode("");c.observe(d,{characterData:!0}),r=function(){d.data=h=++h%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var p=n.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},n.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var u=new n.MessageChannel;u.port1.onmessage=m,r=function(){u.port2.postMessage(0)}}var f=[];function m(){var p,g;o=!0;for(var E=f.length;E;){for(g=f,f=[],p=-1;++p<E;)g[p]();E=f.length}o=!1}s.exports=function(p){f.push(p)!==1||o||r()}}).call(this,typeof Ah<"u"?Ah:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,i){var n=t("immediate");function r(){}var o={},a=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function d(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,E!==r&&p(this,E)}function u(E,I,v){this.promise=E,typeof I=="function"&&(this.onFulfilled=I,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function f(E,I,v){n(function(){var b;try{b=I(v)}catch(C){return o.reject(E,C)}b===E?o.reject(E,new TypeError("Cannot resolve promise with itself")):o.resolve(E,b)})}function m(E){var I=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof I=="function")return function(){I.apply(E,arguments)}}function p(E,I){var v=!1;function b(A){v||(v=!0,o.reject(E,A))}function C(A){v||(v=!0,o.resolve(E,A))}var F=g(function(){I(C,b)});F.status==="error"&&b(F.value)}function g(E,I){var v={};try{v.value=E(I),v.status="success"}catch(b){v.status="error",v.value=b}return v}(s.exports=d).prototype.finally=function(E){if(typeof E!="function")return this;var I=this.constructor;return this.then(function(v){return I.resolve(E()).then(function(){return v})},function(v){return I.resolve(E()).then(function(){throw v})})},d.prototype.catch=function(E){return this.then(null,E)},d.prototype.then=function(E,I){if(typeof E!="function"&&this.state===h||typeof I!="function"&&this.state===a)return this;var v=new this.constructor(r);return this.state!==c?f(v,this.state===h?E:I,this.outcome):this.queue.push(new u(v,E,I)),v},u.prototype.callFulfilled=function(E){o.resolve(this.promise,E)},u.prototype.otherCallFulfilled=function(E){f(this.promise,this.onFulfilled,E)},u.prototype.callRejected=function(E){o.reject(this.promise,E)},u.prototype.otherCallRejected=function(E){f(this.promise,this.onRejected,E)},o.resolve=function(E,I){var v=g(m,I);if(v.status==="error")return o.reject(E,v.value);var b=v.value;if(b)p(E,b);else{E.state=h,E.outcome=I;for(var C=-1,F=E.queue.length;++C<F;)E.queue[C].callFulfilled(I)}return E},o.reject=function(E,I){E.state=a,E.outcome=I;for(var v=-1,b=E.queue.length;++v<b;)E.queue[v].callRejected(I);return E},d.resolve=function(E){return E instanceof this?E:o.resolve(new this(r),E)},d.reject=function(E){var I=new this(r);return o.reject(I,E)},d.all=function(E){var I=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=E.length,b=!1;if(!v)return this.resolve([]);for(var C=new Array(v),F=0,A=-1,R=new this(r);++A<v;)O(E[A],A);return R;function O(L,k){I.resolve(L).then(function(x){C[k]=x,++F!==v||b||(b=!0,o.resolve(R,C))},function(x){b||(b=!0,o.reject(R,x))})}},d.race=function(E){var I=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=E.length,b=!1;if(!v)return this.resolve([]);for(var C=-1,F=new this(r);++C<v;)A=E[C],I.resolve(A).then(function(R){b||(b=!0,o.resolve(F,R))},function(R){b||(b=!0,o.reject(F,R))});var A;return F}},{immediate:36}],38:[function(t,s,i){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,i){var n=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),h=t("./zlib/zstream"),c=Object.prototype.toString,d=0,u=-1,f=0,m=8;function p(E){if(!(this instanceof p))return new p(E);this.options=r.assign({level:u,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},E||{});var I=this.options;I.raw&&0<I.windowBits?I.windowBits=-I.windowBits:I.gzip&&0<I.windowBits&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var v=n.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(v!==d)throw new Error(a[v]);if(I.header&&n.deflateSetHeader(this.strm,I.header),I.dictionary){var b;if(b=typeof I.dictionary=="string"?o.string2buf(I.dictionary):c.call(I.dictionary)==="[object ArrayBuffer]"?new Uint8Array(I.dictionary):I.dictionary,(v=n.deflateSetDictionary(this.strm,b))!==d)throw new Error(a[v]);this._dict_set=!0}}function g(E,I){var v=new p(I);if(v.push(E,!0),v.err)throw v.msg||a[v.err];return v.result}p.prototype.push=function(E,I){var v,b,C=this.strm,F=this.options.chunkSize;if(this.ended)return!1;b=I===~~I?I:I===!0?4:0,typeof E=="string"?C.input=o.string2buf(E):c.call(E)==="[object ArrayBuffer]"?C.input=new Uint8Array(E):C.input=E,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new r.Buf8(F),C.next_out=0,C.avail_out=F),(v=n.deflate(C,b))!==1&&v!==d)return this.onEnd(v),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||b!==4&&b!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(C.output,C.next_out))):this.onData(r.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&v!==1);return b===4?(v=n.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===d):b!==2||(this.onEnd(d),!(C.avail_out=0))},p.prototype.onData=function(E){this.chunks.push(E)},p.prototype.onEnd=function(E){E===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=p,i.deflate=g,i.deflateRaw=function(E,I){return(I=I||{}).raw=!0,g(E,I)},i.gzip=function(E,I){return(I=I||{}).gzip=!0,g(E,I)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,i){var n=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),h=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),u=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},p||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||p&&p.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var E=n.inflateInit2(this.strm,g.windowBits);if(E!==a.Z_OK)throw new Error(h[E]);this.header=new d,n.inflateGetHeader(this.strm,this.header)}function m(p,g){var E=new f(g);if(E.push(p,!0),E.err)throw E.msg||h[E.err];return E.result}f.prototype.push=function(p,g){var E,I,v,b,C,F,A=this.strm,R=this.options.chunkSize,O=this.options.dictionary,L=!1;if(this.ended)return!1;I=g===~~g?g:g===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof p=="string"?A.input=o.binstring2buf(p):u.call(p)==="[object ArrayBuffer]"?A.input=new Uint8Array(p):A.input=p,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new r.Buf8(R),A.next_out=0,A.avail_out=R),(E=n.inflate(A,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&O&&(F=typeof O=="string"?o.string2buf(O):u.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,E=n.inflateSetDictionary(this.strm,F)),E===a.Z_BUF_ERROR&&L===!0&&(E=a.Z_OK,L=!1),E!==a.Z_STREAM_END&&E!==a.Z_OK)return this.onEnd(E),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&E!==a.Z_STREAM_END&&(A.avail_in!==0||I!==a.Z_FINISH&&I!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=o.utf8border(A.output,A.next_out),b=A.next_out-v,C=o.buf2string(A.output,v),A.next_out=b,A.avail_out=R-b,b&&r.arraySet(A.output,A.output,v,b,0),this.onData(C)):this.onData(r.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(L=!0)}while((0<A.avail_in||A.avail_out===0)&&E!==a.Z_STREAM_END);return E===a.Z_STREAM_END&&(I=a.Z_FINISH),I===a.Z_FINISH?(E=n.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===a.Z_OK):I!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(A.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=f,i.inflate=m,i.inflateRaw=function(p,g){return(g=g||{}).raw=!0,m(p,g)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(a){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},i.shrinkBuf=function(a,h){return a.length===h?a:a.subarray?a.subarray(0,h):(a.length=h,a)};var r={arraySet:function(a,h,c,d,u){if(h.subarray&&a.subarray)a.set(h.subarray(c,c+d),u);else for(var f=0;f<d;f++)a[u+f]=h[c+f]},flattenChunks:function(a){var h,c,d,u,f,m;for(h=d=0,c=a.length;h<c;h++)d+=a[h].length;for(m=new Uint8Array(d),h=u=0,c=a.length;h<c;h++)f=a[h],m.set(f,u),u+=f.length;return m}},o={arraySet:function(a,h,c,d,u){for(var f=0;f<d;f++)a[u+f]=h[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};i.setTyped=function(a){a?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(n)},{}],42:[function(t,s,i){var n=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var a=new n.Buf8(256),h=0;h<256;h++)a[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(d,u){if(u<65537&&(d.subarray&&o||!d.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(d,u));for(var f="",m=0;m<u;m++)f+=String.fromCharCode(d[m]);return f}a[254]=a[254]=1,i.string2buf=function(d){var u,f,m,p,g,E=d.length,I=0;for(p=0;p<E;p++)(64512&(f=d.charCodeAt(p)))==55296&&p+1<E&&(64512&(m=d.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),I+=f<128?1:f<2048?2:f<65536?3:4;for(u=new n.Buf8(I),p=g=0;g<I;p++)(64512&(f=d.charCodeAt(p)))==55296&&p+1<E&&(64512&(m=d.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),f<128?u[g++]=f:(f<2048?u[g++]=192|f>>>6:(f<65536?u[g++]=224|f>>>12:(u[g++]=240|f>>>18,u[g++]=128|f>>>12&63),u[g++]=128|f>>>6&63),u[g++]=128|63&f);return u},i.buf2binstring=function(d){return c(d,d.length)},i.binstring2buf=function(d){for(var u=new n.Buf8(d.length),f=0,m=u.length;f<m;f++)u[f]=d.charCodeAt(f);return u},i.buf2string=function(d,u){var f,m,p,g,E=u||d.length,I=new Array(2*E);for(f=m=0;f<E;)if((p=d[f++])<128)I[m++]=p;else if(4<(g=a[p]))I[m++]=65533,f+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&f<E;)p=p<<6|63&d[f++],g--;1<g?I[m++]=65533:p<65536?I[m++]=p:(p-=65536,I[m++]=55296|p>>10&1023,I[m++]=56320|1023&p)}return c(I,m)},i.utf8border=function(d,u){var f;for((u=u||d.length)>d.length&&(u=d.length),f=u-1;0<=f&&(192&d[f])==128;)f--;return f<0||f===0?u:f+a[d[f]]>u?f:u}},{"./common":41}],43:[function(t,s,i){s.exports=function(n,r,o,a){for(var h=65535&n|0,c=n>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;c=c+(h=h+r[a++]|0)|0,--d;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(t,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,i){var n=function(){for(var r,o=[],a=0;a<256;a++){r=a;for(var h=0;h<8;h++)r=1&r?3988292384^r>>>1:r>>>1;o[a]=r}return o}();s.exports=function(r,o,a,h){var c=n,d=h+a;r^=-1;for(var u=h;u<d;u++)r=r>>>8^c[255&(r^o[u])];return-1^r}},{}],46:[function(t,s,i){var n,r=t("../utils/common"),o=t("./trees"),a=t("./adler32"),h=t("./crc32"),c=t("./messages"),d=0,u=4,f=0,m=-2,p=-1,g=4,E=2,I=8,v=9,b=286,C=30,F=19,A=2*b+1,R=15,O=3,L=258,k=L+O+1,x=42,M=113,w=1,G=2,J=3,Z=4;function le(_,$){return _.msg=c[$],$}function ee(_){return(_<<1)-(4<_?9:0)}function xe(_){for(var $=_.length;0<=--$;)_[$]=0}function X(_){var $=_.state,Q=$.pending;Q>_.avail_out&&(Q=_.avail_out),Q!==0&&(r.arraySet(_.output,$.pending_buf,$.pending_out,Q,_.next_out),_.next_out+=Q,$.pending_out+=Q,_.total_out+=Q,_.avail_out-=Q,$.pending-=Q,$.pending===0&&($.pending_out=0))}function j(_,$){o._tr_flush_block(_,0<=_.block_start?_.block_start:-1,_.strstart-_.block_start,$),_.block_start=_.strstart,X(_.strm)}function be(_,$){_.pending_buf[_.pending++]=$}function fe(_,$){_.pending_buf[_.pending++]=$>>>8&255,_.pending_buf[_.pending++]=255&$}function ue(_,$){var Q,N,P=_.max_chain_length,W=_.strstart,se=_.prev_length,ie=_.nice_match,K=_.strstart>_.w_size-k?_.strstart-(_.w_size-k):0,de=_.window,Te=_.w_mask,pe=_.prev,Pe=_.strstart+L,Ke=de[W+se-1],Ye=de[W+se];_.prev_length>=_.good_match&&(P>>=2),ie>_.lookahead&&(ie=_.lookahead);do if(de[(Q=$)+se]===Ye&&de[Q+se-1]===Ke&&de[Q]===de[W]&&de[++Q]===de[W+1]){W+=2,Q++;do;while(de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&W<Pe);if(N=L-(Pe-W),W=Pe-L,se<N){if(_.match_start=$,ie<=(se=N))break;Ke=de[W+se-1],Ye=de[W+se]}}while(($=pe[$&Te])>K&&--P!=0);return se<=_.lookahead?se:_.lookahead}function He(_){var $,Q,N,P,W,se,ie,K,de,Te,pe=_.w_size;do{if(P=_.window_size-_.lookahead-_.strstart,_.strstart>=pe+(pe-k)){for(r.arraySet(_.window,_.window,pe,pe,0),_.match_start-=pe,_.strstart-=pe,_.block_start-=pe,$=Q=_.hash_size;N=_.head[--$],_.head[$]=pe<=N?N-pe:0,--Q;);for($=Q=pe;N=_.prev[--$],_.prev[$]=pe<=N?N-pe:0,--Q;);P+=pe}if(_.strm.avail_in===0)break;if(se=_.strm,ie=_.window,K=_.strstart+_.lookahead,de=P,Te=void 0,Te=se.avail_in,de<Te&&(Te=de),Q=Te===0?0:(se.avail_in-=Te,r.arraySet(ie,se.input,se.next_in,Te,K),se.state.wrap===1?se.adler=a(se.adler,ie,Te,K):se.state.wrap===2&&(se.adler=h(se.adler,ie,Te,K)),se.next_in+=Te,se.total_in+=Te,Te),_.lookahead+=Q,_.lookahead+_.insert>=O)for(W=_.strstart-_.insert,_.ins_h=_.window[W],_.ins_h=(_.ins_h<<_.hash_shift^_.window[W+1])&_.hash_mask;_.insert&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[W+O-1])&_.hash_mask,_.prev[W&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=W,W++,_.insert--,!(_.lookahead+_.insert<O)););}while(_.lookahead<k&&_.strm.avail_in!==0)}function Xe(_,$){for(var Q,N;;){if(_.lookahead<k){if(He(_),_.lookahead<k&&$===d)return w;if(_.lookahead===0)break}if(Q=0,_.lookahead>=O&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,Q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),Q!==0&&_.strstart-Q<=_.w_size-k&&(_.match_length=ue(_,Q)),_.match_length>=O)if(N=o._tr_tally(_,_.strstart-_.match_start,_.match_length-O),_.lookahead-=_.match_length,_.match_length<=_.max_lazy_match&&_.lookahead>=O){for(_.match_length--;_.strstart++,_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,Q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart,--_.match_length!=0;);_.strstart++}else _.strstart+=_.match_length,_.match_length=0,_.ins_h=_.window[_.strstart],_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+1])&_.hash_mask;else N=o._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++;if(N&&(j(_,!1),_.strm.avail_out===0))return w}return _.insert=_.strstart<O-1?_.strstart:O-1,$===u?(j(_,!0),_.strm.avail_out===0?J:Z):_.last_lit&&(j(_,!1),_.strm.avail_out===0)?w:G}function Se(_,$){for(var Q,N,P;;){if(_.lookahead<k){if(He(_),_.lookahead<k&&$===d)return w;if(_.lookahead===0)break}if(Q=0,_.lookahead>=O&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,Q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),_.prev_length=_.match_length,_.prev_match=_.match_start,_.match_length=O-1,Q!==0&&_.prev_length<_.max_lazy_match&&_.strstart-Q<=_.w_size-k&&(_.match_length=ue(_,Q),_.match_length<=5&&(_.strategy===1||_.match_length===O&&4096<_.strstart-_.match_start)&&(_.match_length=O-1)),_.prev_length>=O&&_.match_length<=_.prev_length){for(P=_.strstart+_.lookahead-O,N=o._tr_tally(_,_.strstart-1-_.prev_match,_.prev_length-O),_.lookahead-=_.prev_length-1,_.prev_length-=2;++_.strstart<=P&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,Q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),--_.prev_length!=0;);if(_.match_available=0,_.match_length=O-1,_.strstart++,N&&(j(_,!1),_.strm.avail_out===0))return w}else if(_.match_available){if((N=o._tr_tally(_,0,_.window[_.strstart-1]))&&j(_,!1),_.strstart++,_.lookahead--,_.strm.avail_out===0)return w}else _.match_available=1,_.strstart++,_.lookahead--}return _.match_available&&(N=o._tr_tally(_,0,_.window[_.strstart-1]),_.match_available=0),_.insert=_.strstart<O-1?_.strstart:O-1,$===u?(j(_,!0),_.strm.avail_out===0?J:Z):_.last_lit&&(j(_,!1),_.strm.avail_out===0)?w:G}function _e(_,$,Q,N,P){this.good_length=_,this.max_lazy=$,this.nice_length=Q,this.max_chain=N,this.func=P}function Le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*A),this.dyn_dtree=new r.Buf16(2*(2*C+1)),this.bl_tree=new r.Buf16(2*(2*F+1)),xe(this.dyn_ltree),xe(this.dyn_dtree),xe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(R+1),this.heap=new r.Buf16(2*b+1),xe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*b+1),xe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ge(_){var $;return _&&_.state?(_.total_in=_.total_out=0,_.data_type=E,($=_.state).pending=0,$.pending_out=0,$.wrap<0&&($.wrap=-$.wrap),$.status=$.wrap?x:M,_.adler=$.wrap===2?0:1,$.last_flush=d,o._tr_init($),f):le(_,m)}function Ze(_){var $=Ge(_);return $===f&&function(Q){Q.window_size=2*Q.w_size,xe(Q.head),Q.max_lazy_match=n[Q.level].max_lazy,Q.good_match=n[Q.level].good_length,Q.nice_match=n[Q.level].nice_length,Q.max_chain_length=n[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=O-1,Q.match_available=0,Q.ins_h=0}(_.state),$}function $e(_,$,Q,N,P,W){if(!_)return m;var se=1;if($===p&&($=6),N<0?(se=0,N=-N):15<N&&(se=2,N-=16),P<1||v<P||Q!==I||N<8||15<N||$<0||9<$||W<0||g<W)return le(_,m);N===8&&(N=9);var ie=new Le;return(_.state=ie).strm=_,ie.wrap=se,ie.gzhead=null,ie.w_bits=N,ie.w_size=1<<ie.w_bits,ie.w_mask=ie.w_size-1,ie.hash_bits=P+7,ie.hash_size=1<<ie.hash_bits,ie.hash_mask=ie.hash_size-1,ie.hash_shift=~~((ie.hash_bits+O-1)/O),ie.window=new r.Buf8(2*ie.w_size),ie.head=new r.Buf16(ie.hash_size),ie.prev=new r.Buf16(ie.w_size),ie.lit_bufsize=1<<P+6,ie.pending_buf_size=4*ie.lit_bufsize,ie.pending_buf=new r.Buf8(ie.pending_buf_size),ie.d_buf=1*ie.lit_bufsize,ie.l_buf=3*ie.lit_bufsize,ie.level=$,ie.strategy=W,ie.method=Q,Ze(_)}n=[new _e(0,0,0,0,function(_,$){var Q=65535;for(Q>_.pending_buf_size-5&&(Q=_.pending_buf_size-5);;){if(_.lookahead<=1){if(He(_),_.lookahead===0&&$===d)return w;if(_.lookahead===0)break}_.strstart+=_.lookahead,_.lookahead=0;var N=_.block_start+Q;if((_.strstart===0||_.strstart>=N)&&(_.lookahead=_.strstart-N,_.strstart=N,j(_,!1),_.strm.avail_out===0)||_.strstart-_.block_start>=_.w_size-k&&(j(_,!1),_.strm.avail_out===0))return w}return _.insert=0,$===u?(j(_,!0),_.strm.avail_out===0?J:Z):(_.strstart>_.block_start&&(j(_,!1),_.strm.avail_out),w)}),new _e(4,4,8,4,Xe),new _e(4,5,16,8,Xe),new _e(4,6,32,32,Xe),new _e(4,4,16,16,Se),new _e(8,16,32,32,Se),new _e(8,16,128,128,Se),new _e(8,32,128,256,Se),new _e(32,128,258,1024,Se),new _e(32,258,258,4096,Se)],i.deflateInit=function(_,$){return $e(_,$,I,15,8,0)},i.deflateInit2=$e,i.deflateReset=Ze,i.deflateResetKeep=Ge,i.deflateSetHeader=function(_,$){return _&&_.state?_.state.wrap!==2?m:(_.state.gzhead=$,f):m},i.deflate=function(_,$){var Q,N,P,W;if(!_||!_.state||5<$||$<0)return _?le(_,m):m;if(N=_.state,!_.output||!_.input&&_.avail_in!==0||N.status===666&&$!==u)return le(_,_.avail_out===0?-5:m);if(N.strm=_,Q=N.last_flush,N.last_flush=$,N.status===x)if(N.wrap===2)_.adler=0,be(N,31),be(N,139),be(N,8),N.gzhead?(be(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),be(N,255&N.gzhead.time),be(N,N.gzhead.time>>8&255),be(N,N.gzhead.time>>16&255),be(N,N.gzhead.time>>24&255),be(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),be(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(be(N,255&N.gzhead.extra.length),be(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(_.adler=h(_.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(be(N,0),be(N,0),be(N,0),be(N,0),be(N,0),be(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),be(N,3),N.status=M);else{var se=I+(N.w_bits-8<<4)<<8;se|=(2<=N.strategy||N.level<2?0:N.level<6?1:N.level===6?2:3)<<6,N.strstart!==0&&(se|=32),se+=31-se%31,N.status=M,fe(N,se),N.strstart!==0&&(fe(N,_.adler>>>16),fe(N,65535&_.adler)),_.adler=1}if(N.status===69)if(N.gzhead.extra){for(P=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),X(_),P=N.pending,N.pending!==N.pending_buf_size));)be(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(N.status===73)if(N.gzhead.name){P=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),X(_),P=N.pending,N.pending===N.pending_buf_size)){W=1;break}W=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,be(N,W)}while(W!==0);N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),W===0&&(N.gzindex=0,N.status=91)}else N.status=91;if(N.status===91)if(N.gzhead.comment){P=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),X(_),P=N.pending,N.pending===N.pending_buf_size)){W=1;break}W=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,be(N,W)}while(W!==0);N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),W===0&&(N.status=103)}else N.status=103;if(N.status===103&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&X(_),N.pending+2<=N.pending_buf_size&&(be(N,255&_.adler),be(N,_.adler>>8&255),_.adler=0,N.status=M)):N.status=M),N.pending!==0){if(X(_),_.avail_out===0)return N.last_flush=-1,f}else if(_.avail_in===0&&ee($)<=ee(Q)&&$!==u)return le(_,-5);if(N.status===666&&_.avail_in!==0)return le(_,-5);if(_.avail_in!==0||N.lookahead!==0||$!==d&&N.status!==666){var ie=N.strategy===2?function(K,de){for(var Te;;){if(K.lookahead===0&&(He(K),K.lookahead===0)){if(de===d)return w;break}if(K.match_length=0,Te=o._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,Te&&(j(K,!1),K.strm.avail_out===0))return w}return K.insert=0,de===u?(j(K,!0),K.strm.avail_out===0?J:Z):K.last_lit&&(j(K,!1),K.strm.avail_out===0)?w:G}(N,$):N.strategy===3?function(K,de){for(var Te,pe,Pe,Ke,Ye=K.window;;){if(K.lookahead<=L){if(He(K),K.lookahead<=L&&de===d)return w;if(K.lookahead===0)break}if(K.match_length=0,K.lookahead>=O&&0<K.strstart&&(pe=Ye[Pe=K.strstart-1])===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]){Ke=K.strstart+L;do;while(pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&Pe<Ke);K.match_length=L-(Ke-Pe),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=O?(Te=o._tr_tally(K,1,K.match_length-O),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(Te=o._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),Te&&(j(K,!1),K.strm.avail_out===0))return w}return K.insert=0,de===u?(j(K,!0),K.strm.avail_out===0?J:Z):K.last_lit&&(j(K,!1),K.strm.avail_out===0)?w:G}(N,$):n[N.level].func(N,$);if(ie!==J&&ie!==Z||(N.status=666),ie===w||ie===J)return _.avail_out===0&&(N.last_flush=-1),f;if(ie===G&&($===1?o._tr_align(N):$!==5&&(o._tr_stored_block(N,0,0,!1),$===3&&(xe(N.head),N.lookahead===0&&(N.strstart=0,N.block_start=0,N.insert=0))),X(_),_.avail_out===0))return N.last_flush=-1,f}return $!==u?f:N.wrap<=0?1:(N.wrap===2?(be(N,255&_.adler),be(N,_.adler>>8&255),be(N,_.adler>>16&255),be(N,_.adler>>24&255),be(N,255&_.total_in),be(N,_.total_in>>8&255),be(N,_.total_in>>16&255),be(N,_.total_in>>24&255)):(fe(N,_.adler>>>16),fe(N,65535&_.adler)),X(_),0<N.wrap&&(N.wrap=-N.wrap),N.pending!==0?f:1)},i.deflateEnd=function(_){var $;return _&&_.state?($=_.state.status)!==x&&$!==69&&$!==73&&$!==91&&$!==103&&$!==M&&$!==666?le(_,m):(_.state=null,$===M?le(_,-3):f):m},i.deflateSetDictionary=function(_,$){var Q,N,P,W,se,ie,K,de,Te=$.length;if(!_||!_.state||(W=(Q=_.state).wrap)===2||W===1&&Q.status!==x||Q.lookahead)return m;for(W===1&&(_.adler=a(_.adler,$,Te,0)),Q.wrap=0,Te>=Q.w_size&&(W===0&&(xe(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0),de=new r.Buf8(Q.w_size),r.arraySet(de,$,Te-Q.w_size,Q.w_size,0),$=de,Te=Q.w_size),se=_.avail_in,ie=_.next_in,K=_.input,_.avail_in=Te,_.next_in=0,_.input=$,He(Q);Q.lookahead>=O;){for(N=Q.strstart,P=Q.lookahead-(O-1);Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[N+O-1])&Q.hash_mask,Q.prev[N&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=N,N++,--P;);Q.strstart=N,Q.lookahead=O-1,He(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=O-1,Q.match_available=0,_.next_in=ie,_.input=K,_.avail_in=se,Q.wrap=W,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,i){s.exports=function(n,r){var o,a,h,c,d,u,f,m,p,g,E,I,v,b,C,F,A,R,O,L,k,x,M,w,G;o=n.state,a=n.next_in,w=n.input,h=a+(n.avail_in-5),c=n.next_out,G=n.output,d=c-(r-n.avail_out),u=c+(n.avail_out-257),f=o.dmax,m=o.wsize,p=o.whave,g=o.wnext,E=o.window,I=o.hold,v=o.bits,b=o.lencode,C=o.distcode,F=(1<<o.lenbits)-1,A=(1<<o.distbits)-1;e:do{v<15&&(I+=w[a++]<<v,v+=8,I+=w[a++]<<v,v+=8),R=b[I&F];t:for(;;){if(I>>>=O=R>>>24,v-=O,(O=R>>>16&255)===0)G[c++]=65535&R;else{if(!(16&O)){if(!(64&O)){R=b[(65535&R)+(I&(1<<O)-1)];continue t}if(32&O){o.mode=12;break e}n.msg="invalid literal/length code",o.mode=30;break e}L=65535&R,(O&=15)&&(v<O&&(I+=w[a++]<<v,v+=8),L+=I&(1<<O)-1,I>>>=O,v-=O),v<15&&(I+=w[a++]<<v,v+=8,I+=w[a++]<<v,v+=8),R=C[I&A];s:for(;;){if(I>>>=O=R>>>24,v-=O,!(16&(O=R>>>16&255))){if(!(64&O)){R=C[(65535&R)+(I&(1<<O)-1)];continue s}n.msg="invalid distance code",o.mode=30;break e}if(k=65535&R,v<(O&=15)&&(I+=w[a++]<<v,(v+=8)<O&&(I+=w[a++]<<v,v+=8)),f<(k+=I&(1<<O)-1)){n.msg="invalid distance too far back",o.mode=30;break e}if(I>>>=O,v-=O,(O=c-d)<k){if(p<(O=k-O)&&o.sane){n.msg="invalid distance too far back",o.mode=30;break e}if(M=E,(x=0)===g){if(x+=m-O,O<L){for(L-=O;G[c++]=E[x++],--O;);x=c-k,M=G}}else if(g<O){if(x+=m+g-O,(O-=g)<L){for(L-=O;G[c++]=E[x++],--O;);if(x=0,g<L){for(L-=O=g;G[c++]=E[x++],--O;);x=c-k,M=G}}}else if(x+=g-O,O<L){for(L-=O;G[c++]=E[x++],--O;);x=c-k,M=G}for(;2<L;)G[c++]=M[x++],G[c++]=M[x++],G[c++]=M[x++],L-=3;L&&(G[c++]=M[x++],1<L&&(G[c++]=M[x++]))}else{for(x=c-k;G[c++]=G[x++],G[c++]=G[x++],G[c++]=G[x++],2<(L-=3););L&&(G[c++]=G[x++],1<L&&(G[c++]=G[x++]))}break}}break}}while(a<h&&c<u);a-=L=v>>3,I&=(1<<(v-=L<<3))-1,n.next_in=a,n.next_out=c,n.avail_in=a<h?h-a+5:5-(a-h),n.avail_out=c<u?u-c+257:257-(c-u),o.hold=I,o.bits=v}},{}],49:[function(t,s,i){var n=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),a=t("./inffast"),h=t("./inftrees"),c=1,d=2,u=0,f=-2,m=1,p=852,g=592;function E(x){return(x>>>24&255)+(x>>>8&65280)+((65280&x)<<8)+((255&x)<<24)}function I(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(x){var M;return x&&x.state?(M=x.state,x.total_in=x.total_out=M.total=0,x.msg="",M.wrap&&(x.adler=1&M.wrap),M.mode=m,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new n.Buf32(p),M.distcode=M.distdyn=new n.Buf32(g),M.sane=1,M.back=-1,u):f}function b(x){var M;return x&&x.state?((M=x.state).wsize=0,M.whave=0,M.wnext=0,v(x)):f}function C(x,M){var w,G;return x&&x.state?(G=x.state,M<0?(w=0,M=-M):(w=1+(M>>4),M<48&&(M&=15)),M&&(M<8||15<M)?f:(G.window!==null&&G.wbits!==M&&(G.window=null),G.wrap=w,G.wbits=M,b(x))):f}function F(x,M){var w,G;return x?(G=new I,(x.state=G).window=null,(w=C(x,M))!==u&&(x.state=null),w):f}var A,R,O=!0;function L(x){if(O){var M;for(A=new n.Buf32(512),R=new n.Buf32(32),M=0;M<144;)x.lens[M++]=8;for(;M<256;)x.lens[M++]=9;for(;M<280;)x.lens[M++]=7;for(;M<288;)x.lens[M++]=8;for(h(c,x.lens,0,288,A,0,x.work,{bits:9}),M=0;M<32;)x.lens[M++]=5;h(d,x.lens,0,32,R,0,x.work,{bits:5}),O=!1}x.lencode=A,x.lenbits=9,x.distcode=R,x.distbits=5}function k(x,M,w,G){var J,Z=x.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new n.Buf8(Z.wsize)),G>=Z.wsize?(n.arraySet(Z.window,M,w-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(G<(J=Z.wsize-Z.wnext)&&(J=G),n.arraySet(Z.window,M,w-G,J,Z.wnext),(G-=J)?(n.arraySet(Z.window,M,w-G,G,0),Z.wnext=G,Z.whave=Z.wsize):(Z.wnext+=J,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=J))),0}i.inflateReset=b,i.inflateReset2=C,i.inflateResetKeep=v,i.inflateInit=function(x){return F(x,15)},i.inflateInit2=F,i.inflate=function(x,M){var w,G,J,Z,le,ee,xe,X,j,be,fe,ue,He,Xe,Se,_e,Le,Ge,Ze,$e,_,$,Q,N,P=0,W=new n.Buf8(4),se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!x||!x.state||!x.output||!x.input&&x.avail_in!==0)return f;(w=x.state).mode===12&&(w.mode=13),le=x.next_out,J=x.output,xe=x.avail_out,Z=x.next_in,G=x.input,ee=x.avail_in,X=w.hold,j=w.bits,be=ee,fe=xe,$=u;e:for(;;)switch(w.mode){case m:if(w.wrap===0){w.mode=13;break}for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(2&w.wrap&&X===35615){W[w.check=0]=255&X,W[1]=X>>>8&255,w.check=o(w.check,W,2,0),j=X=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&X)<<8)+(X>>8))%31){x.msg="incorrect header check",w.mode=30;break}if((15&X)!=8){x.msg="unknown compression method",w.mode=30;break}if(j-=4,_=8+(15&(X>>>=4)),w.wbits===0)w.wbits=_;else if(_>w.wbits){x.msg="invalid window size",w.mode=30;break}w.dmax=1<<_,x.adler=w.check=1,w.mode=512&X?10:12,j=X=0;break;case 2:for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(w.flags=X,(255&w.flags)!=8){x.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){x.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=X>>8&1),512&w.flags&&(W[0]=255&X,W[1]=X>>>8&255,w.check=o(w.check,W,2,0)),j=X=0,w.mode=3;case 3:for(;j<32;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.head&&(w.head.time=X),512&w.flags&&(W[0]=255&X,W[1]=X>>>8&255,W[2]=X>>>16&255,W[3]=X>>>24&255,w.check=o(w.check,W,4,0)),j=X=0,w.mode=4;case 4:for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.head&&(w.head.xflags=255&X,w.head.os=X>>8),512&w.flags&&(W[0]=255&X,W[1]=X>>>8&255,w.check=o(w.check,W,2,0)),j=X=0,w.mode=5;case 5:if(1024&w.flags){for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.length=X,w.head&&(w.head.extra_len=X),512&w.flags&&(W[0]=255&X,W[1]=X>>>8&255,w.check=o(w.check,W,2,0)),j=X=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(ee<(ue=w.length)&&(ue=ee),ue&&(w.head&&(_=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),n.arraySet(w.head.extra,G,Z,ue,_)),512&w.flags&&(w.check=o(w.check,G,ue,Z)),ee-=ue,Z+=ue,w.length-=ue),w.length))break e;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(ee===0)break e;for(ue=0;_=G[Z+ue++],w.head&&_&&w.length<65536&&(w.head.name+=String.fromCharCode(_)),_&&ue<ee;);if(512&w.flags&&(w.check=o(w.check,G,ue,Z)),ee-=ue,Z+=ue,_)break e}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(ee===0)break e;for(ue=0;_=G[Z+ue++],w.head&&_&&w.length<65536&&(w.head.comment+=String.fromCharCode(_)),_&&ue<ee;);if(512&w.flags&&(w.check=o(w.check,G,ue,Z)),ee-=ue,Z+=ue,_)break e}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(X!==(65535&w.check)){x.msg="header crc mismatch",w.mode=30;break}j=X=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),x.adler=w.check=0,w.mode=12;break;case 10:for(;j<32;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}x.adler=w.check=E(X),j=X=0,w.mode=11;case 11:if(w.havedict===0)return x.next_out=le,x.avail_out=xe,x.next_in=Z,x.avail_in=ee,w.hold=X,w.bits=j,2;x.adler=w.check=1,w.mode=12;case 12:if(M===5||M===6)break e;case 13:if(w.last){X>>>=7&j,j-=7&j,w.mode=27;break}for(;j<3;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}switch(w.last=1&X,j-=1,3&(X>>>=1)){case 0:w.mode=14;break;case 1:if(L(w),w.mode=20,M!==6)break;X>>>=2,j-=2;break e;case 2:w.mode=17;break;case 3:x.msg="invalid block type",w.mode=30}X>>>=2,j-=2;break;case 14:for(X>>>=7&j,j-=7&j;j<32;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if((65535&X)!=(X>>>16^65535)){x.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&X,j=X=0,w.mode=15,M===6)break e;case 15:w.mode=16;case 16:if(ue=w.length){if(ee<ue&&(ue=ee),xe<ue&&(ue=xe),ue===0)break e;n.arraySet(J,G,Z,ue,le),ee-=ue,Z+=ue,xe-=ue,le+=ue,w.length-=ue;break}w.mode=12;break;case 17:for(;j<14;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(w.nlen=257+(31&X),X>>>=5,j-=5,w.ndist=1+(31&X),X>>>=5,j-=5,w.ncode=4+(15&X),X>>>=4,j-=4,286<w.nlen||30<w.ndist){x.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;j<3;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.lens[se[w.have++]]=7&X,X>>>=3,j-=3}for(;w.have<19;)w.lens[se[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,Q={bits:w.lenbits},$=h(0,w.lens,0,19,w.lencode,0,w.work,Q),w.lenbits=Q.bits,$){x.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;_e=(P=w.lencode[X&(1<<w.lenbits)-1])>>>16&255,Le=65535&P,!((Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(Le<16)X>>>=Se,j-=Se,w.lens[w.have++]=Le;else{if(Le===16){for(N=Se+2;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(X>>>=Se,j-=Se,w.have===0){x.msg="invalid bit length repeat",w.mode=30;break}_=w.lens[w.have-1],ue=3+(3&X),X>>>=2,j-=2}else if(Le===17){for(N=Se+3;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}j-=Se,_=0,ue=3+(7&(X>>>=Se)),X>>>=3,j-=3}else{for(N=Se+7;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}j-=Se,_=0,ue=11+(127&(X>>>=Se)),X>>>=7,j-=7}if(w.have+ue>w.nlen+w.ndist){x.msg="invalid bit length repeat",w.mode=30;break}for(;ue--;)w.lens[w.have++]=_}}if(w.mode===30)break;if(w.lens[256]===0){x.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,Q={bits:w.lenbits},$=h(c,w.lens,0,w.nlen,w.lencode,0,w.work,Q),w.lenbits=Q.bits,$){x.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,Q={bits:w.distbits},$=h(d,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,Q),w.distbits=Q.bits,$){x.msg="invalid distances set",w.mode=30;break}if(w.mode=20,M===6)break e;case 20:w.mode=21;case 21:if(6<=ee&&258<=xe){x.next_out=le,x.avail_out=xe,x.next_in=Z,x.avail_in=ee,w.hold=X,w.bits=j,a(x,fe),le=x.next_out,J=x.output,xe=x.avail_out,Z=x.next_in,G=x.input,ee=x.avail_in,X=w.hold,j=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;_e=(P=w.lencode[X&(1<<w.lenbits)-1])>>>16&255,Le=65535&P,!((Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(_e&&!(240&_e)){for(Ge=Se,Ze=_e,$e=Le;_e=(P=w.lencode[$e+((X&(1<<Ge+Ze)-1)>>Ge)])>>>16&255,Le=65535&P,!(Ge+(Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}X>>>=Ge,j-=Ge,w.back+=Ge}if(X>>>=Se,j-=Se,w.back+=Se,w.length=Le,_e===0){w.mode=26;break}if(32&_e){w.back=-1,w.mode=12;break}if(64&_e){x.msg="invalid literal/length code",w.mode=30;break}w.extra=15&_e,w.mode=22;case 22:if(w.extra){for(N=w.extra;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.length+=X&(1<<w.extra)-1,X>>>=w.extra,j-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;_e=(P=w.distcode[X&(1<<w.distbits)-1])>>>16&255,Le=65535&P,!((Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(!(240&_e)){for(Ge=Se,Ze=_e,$e=Le;_e=(P=w.distcode[$e+((X&(1<<Ge+Ze)-1)>>Ge)])>>>16&255,Le=65535&P,!(Ge+(Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}X>>>=Ge,j-=Ge,w.back+=Ge}if(X>>>=Se,j-=Se,w.back+=Se,64&_e){x.msg="invalid distance code",w.mode=30;break}w.offset=Le,w.extra=15&_e,w.mode=24;case 24:if(w.extra){for(N=w.extra;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.offset+=X&(1<<w.extra)-1,X>>>=w.extra,j-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){x.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(xe===0)break e;if(ue=fe-xe,w.offset>ue){if((ue=w.offset-ue)>w.whave&&w.sane){x.msg="invalid distance too far back",w.mode=30;break}He=ue>w.wnext?(ue-=w.wnext,w.wsize-ue):w.wnext-ue,ue>w.length&&(ue=w.length),Xe=w.window}else Xe=J,He=le-w.offset,ue=w.length;for(xe<ue&&(ue=xe),xe-=ue,w.length-=ue;J[le++]=Xe[He++],--ue;);w.length===0&&(w.mode=21);break;case 26:if(xe===0)break e;J[le++]=w.length,xe--,w.mode=21;break;case 27:if(w.wrap){for(;j<32;){if(ee===0)break e;ee--,X|=G[Z++]<<j,j+=8}if(fe-=xe,x.total_out+=fe,w.total+=fe,fe&&(x.adler=w.check=w.flags?o(w.check,J,fe,le-fe):r(w.check,J,fe,le-fe)),fe=xe,(w.flags?X:E(X))!==w.check){x.msg="incorrect data check",w.mode=30;break}j=X=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;j<32;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(X!==(4294967295&w.total)){x.msg="incorrect length check",w.mode=30;break}j=X=0}w.mode=29;case 29:$=1;break e;case 30:$=-3;break e;case 31:return-4;case 32:default:return f}return x.next_out=le,x.avail_out=xe,x.next_in=Z,x.avail_in=ee,w.hold=X,w.bits=j,(w.wsize||fe!==x.avail_out&&w.mode<30&&(w.mode<27||M!==4))&&k(x,x.output,x.next_out,fe-x.avail_out)?(w.mode=31,-4):(be-=x.avail_in,fe-=x.avail_out,x.total_in+=be,x.total_out+=fe,w.total+=fe,w.wrap&&fe&&(x.adler=w.check=w.flags?o(w.check,J,fe,x.next_out-fe):r(w.check,J,fe,x.next_out-fe)),x.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(be==0&&fe===0||M===4)&&$===u&&($=-5),$)},i.inflateEnd=function(x){if(!x||!x.state)return f;var M=x.state;return M.window&&(M.window=null),x.state=null,u},i.inflateGetHeader=function(x,M){var w;return x&&x.state&&2&(w=x.state).wrap?((w.head=M).done=!1,u):f},i.inflateSetDictionary=function(x,M){var w,G=M.length;return x&&x.state?(w=x.state).wrap!==0&&w.mode!==11?f:w.mode===11&&r(1,M,G,0)!==w.check?-3:k(x,M,G,G)?(w.mode=31,-4):(w.havedict=1,u):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,i){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(c,d,u,f,m,p,g,E){var I,v,b,C,F,A,R,O,L,k=E.bits,x=0,M=0,w=0,G=0,J=0,Z=0,le=0,ee=0,xe=0,X=0,j=null,be=0,fe=new n.Buf16(16),ue=new n.Buf16(16),He=null,Xe=0;for(x=0;x<=15;x++)fe[x]=0;for(M=0;M<f;M++)fe[d[u+M]]++;for(J=k,G=15;1<=G&&fe[G]===0;G--);if(G<J&&(J=G),G===0)return m[p++]=20971520,m[p++]=20971520,E.bits=1,0;for(w=1;w<G&&fe[w]===0;w++);for(J<w&&(J=w),x=ee=1;x<=15;x++)if(ee<<=1,(ee-=fe[x])<0)return-1;if(0<ee&&(c===0||G!==1))return-1;for(ue[1]=0,x=1;x<15;x++)ue[x+1]=ue[x]+fe[x];for(M=0;M<f;M++)d[u+M]!==0&&(g[ue[d[u+M]]++]=M);if(A=c===0?(j=He=g,19):c===1?(j=r,be-=257,He=o,Xe-=257,256):(j=a,He=h,-1),x=w,F=p,le=M=X=0,b=-1,C=(xe=1<<(Z=J))-1,c===1&&852<xe||c===2&&592<xe)return 1;for(;;){for(R=x-le,L=g[M]<A?(O=0,g[M]):g[M]>A?(O=He[Xe+g[M]],j[be+g[M]]):(O=96,0),I=1<<x-le,w=v=1<<Z;m[F+(X>>le)+(v-=I)]=R<<24|O<<16|L|0,v!==0;);for(I=1<<x-1;X&I;)I>>=1;if(I!==0?(X&=I-1,X+=I):X=0,M++,--fe[x]==0){if(x===G)break;x=d[u+g[M]]}if(J<x&&(X&C)!==b){for(le===0&&(le=J),F+=w,ee=1<<(Z=x-le);Z+le<G&&!((ee-=fe[Z+le])<=0);)Z++,ee<<=1;if(xe+=1<<Z,c===1&&852<xe||c===2&&592<xe)return 1;m[b=X&C]=J<<24|Z<<16|F-p|0}}return X!==0&&(m[F+X]=x-le<<24|64<<16|0),E.bits=J,0}},{"../utils/common":41}],51:[function(t,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,i){var n=t("../utils/common"),r=0,o=1;function a(P){for(var W=P.length;0<=--W;)P[W]=0}var h=0,c=29,d=256,u=d+1+c,f=30,m=19,p=2*u+1,g=15,E=16,I=7,v=256,b=16,C=17,F=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(2*(u+2));a(k);var x=new Array(2*f);a(x);var M=new Array(512);a(M);var w=new Array(256);a(w);var G=new Array(c);a(G);var J,Z,le,ee=new Array(f);function xe(P,W,se,ie,K){this.static_tree=P,this.extra_bits=W,this.extra_base=se,this.elems=ie,this.max_length=K,this.has_stree=P&&P.length}function X(P,W){this.dyn_tree=P,this.max_code=0,this.stat_desc=W}function j(P){return P<256?M[P]:M[256+(P>>>7)]}function be(P,W){P.pending_buf[P.pending++]=255&W,P.pending_buf[P.pending++]=W>>>8&255}function fe(P,W,se){P.bi_valid>E-se?(P.bi_buf|=W<<P.bi_valid&65535,be(P,P.bi_buf),P.bi_buf=W>>E-P.bi_valid,P.bi_valid+=se-E):(P.bi_buf|=W<<P.bi_valid&65535,P.bi_valid+=se)}function ue(P,W,se){fe(P,se[2*W],se[2*W+1])}function He(P,W){for(var se=0;se|=1&P,P>>>=1,se<<=1,0<--W;);return se>>>1}function Xe(P,W,se){var ie,K,de=new Array(g+1),Te=0;for(ie=1;ie<=g;ie++)de[ie]=Te=Te+se[ie-1]<<1;for(K=0;K<=W;K++){var pe=P[2*K+1];pe!==0&&(P[2*K]=He(de[pe]++,pe))}}function Se(P){var W;for(W=0;W<u;W++)P.dyn_ltree[2*W]=0;for(W=0;W<f;W++)P.dyn_dtree[2*W]=0;for(W=0;W<m;W++)P.bl_tree[2*W]=0;P.dyn_ltree[2*v]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0}function _e(P){8<P.bi_valid?be(P,P.bi_buf):0<P.bi_valid&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0}function Le(P,W,se,ie){var K=2*W,de=2*se;return P[K]<P[de]||P[K]===P[de]&&ie[W]<=ie[se]}function Ge(P,W,se){for(var ie=P.heap[se],K=se<<1;K<=P.heap_len&&(K<P.heap_len&&Le(W,P.heap[K+1],P.heap[K],P.depth)&&K++,!Le(W,ie,P.heap[K],P.depth));)P.heap[se]=P.heap[K],se=K,K<<=1;P.heap[se]=ie}function Ze(P,W,se){var ie,K,de,Te,pe=0;if(P.last_lit!==0)for(;ie=P.pending_buf[P.d_buf+2*pe]<<8|P.pending_buf[P.d_buf+2*pe+1],K=P.pending_buf[P.l_buf+pe],pe++,ie===0?ue(P,K,W):(ue(P,(de=w[K])+d+1,W),(Te=A[de])!==0&&fe(P,K-=G[de],Te),ue(P,de=j(--ie),se),(Te=R[de])!==0&&fe(P,ie-=ee[de],Te)),pe<P.last_lit;);ue(P,v,W)}function $e(P,W){var se,ie,K,de=W.dyn_tree,Te=W.stat_desc.static_tree,pe=W.stat_desc.has_stree,Pe=W.stat_desc.elems,Ke=-1;for(P.heap_len=0,P.heap_max=p,se=0;se<Pe;se++)de[2*se]!==0?(P.heap[++P.heap_len]=Ke=se,P.depth[se]=0):de[2*se+1]=0;for(;P.heap_len<2;)de[2*(K=P.heap[++P.heap_len]=Ke<2?++Ke:0)]=1,P.depth[K]=0,P.opt_len--,pe&&(P.static_len-=Te[2*K+1]);for(W.max_code=Ke,se=P.heap_len>>1;1<=se;se--)Ge(P,de,se);for(K=Pe;se=P.heap[1],P.heap[1]=P.heap[P.heap_len--],Ge(P,de,1),ie=P.heap[1],P.heap[--P.heap_max]=se,P.heap[--P.heap_max]=ie,de[2*K]=de[2*se]+de[2*ie],P.depth[K]=(P.depth[se]>=P.depth[ie]?P.depth[se]:P.depth[ie])+1,de[2*se+1]=de[2*ie+1]=K,P.heap[1]=K++,Ge(P,de,1),2<=P.heap_len;);P.heap[--P.heap_max]=P.heap[1],function(Ye,_t){var gs,Tt,Es,et,ns,je,Pt=_t.dyn_tree,ks=_t.max_code,mn=_t.stat_desc.static_tree,Ve=_t.stat_desc.has_stree,Qn=_t.stat_desc.extra_bits,gn=_t.stat_desc.extra_base,Ts=_t.stat_desc.max_length,Ks=0;for(et=0;et<=g;et++)Ye.bl_count[et]=0;for(Pt[2*Ye.heap[Ye.heap_max]+1]=0,gs=Ye.heap_max+1;gs<p;gs++)Ts<(et=Pt[2*Pt[2*(Tt=Ye.heap[gs])+1]+1]+1)&&(et=Ts,Ks++),Pt[2*Tt+1]=et,ks<Tt||(Ye.bl_count[et]++,ns=0,gn<=Tt&&(ns=Qn[Tt-gn]),je=Pt[2*Tt],Ye.opt_len+=je*(et+ns),Ve&&(Ye.static_len+=je*(mn[2*Tt+1]+ns)));if(Ks!==0){do{for(et=Ts-1;Ye.bl_count[et]===0;)et--;Ye.bl_count[et]--,Ye.bl_count[et+1]+=2,Ye.bl_count[Ts]--,Ks-=2}while(0<Ks);for(et=Ts;et!==0;et--)for(Tt=Ye.bl_count[et];Tt!==0;)ks<(Es=Ye.heap[--gs])||(Pt[2*Es+1]!==et&&(Ye.opt_len+=(et-Pt[2*Es+1])*Pt[2*Es],Pt[2*Es+1]=et),Tt--)}}(P,W),Xe(de,Ke,P.bl_count)}function _(P,W,se){var ie,K,de=-1,Te=W[1],pe=0,Pe=7,Ke=4;for(Te===0&&(Pe=138,Ke=3),W[2*(se+1)+1]=65535,ie=0;ie<=se;ie++)K=Te,Te=W[2*(ie+1)+1],++pe<Pe&&K===Te||(pe<Ke?P.bl_tree[2*K]+=pe:K!==0?(K!==de&&P.bl_tree[2*K]++,P.bl_tree[2*b]++):pe<=10?P.bl_tree[2*C]++:P.bl_tree[2*F]++,de=K,Ke=(pe=0)===Te?(Pe=138,3):K===Te?(Pe=6,3):(Pe=7,4))}function $(P,W,se){var ie,K,de=-1,Te=W[1],pe=0,Pe=7,Ke=4;for(Te===0&&(Pe=138,Ke=3),ie=0;ie<=se;ie++)if(K=Te,Te=W[2*(ie+1)+1],!(++pe<Pe&&K===Te)){if(pe<Ke)for(;ue(P,K,P.bl_tree),--pe!=0;);else K!==0?(K!==de&&(ue(P,K,P.bl_tree),pe--),ue(P,b,P.bl_tree),fe(P,pe-3,2)):pe<=10?(ue(P,C,P.bl_tree),fe(P,pe-3,3)):(ue(P,F,P.bl_tree),fe(P,pe-11,7));de=K,Ke=(pe=0)===Te?(Pe=138,3):K===Te?(Pe=6,3):(Pe=7,4)}}a(ee);var Q=!1;function N(P,W,se,ie){fe(P,(h<<1)+(ie?1:0),3),function(K,de,Te,pe){_e(K),be(K,Te),be(K,~Te),n.arraySet(K.pending_buf,K.window,de,Te,K.pending),K.pending+=Te}(P,W,se)}i._tr_init=function(P){Q||(function(){var W,se,ie,K,de,Te=new Array(g+1);for(K=ie=0;K<c-1;K++)for(G[K]=ie,W=0;W<1<<A[K];W++)w[ie++]=K;for(w[ie-1]=K,K=de=0;K<16;K++)for(ee[K]=de,W=0;W<1<<R[K];W++)M[de++]=K;for(de>>=7;K<f;K++)for(ee[K]=de<<7,W=0;W<1<<R[K]-7;W++)M[256+de++]=K;for(se=0;se<=g;se++)Te[se]=0;for(W=0;W<=143;)k[2*W+1]=8,W++,Te[8]++;for(;W<=255;)k[2*W+1]=9,W++,Te[9]++;for(;W<=279;)k[2*W+1]=7,W++,Te[7]++;for(;W<=287;)k[2*W+1]=8,W++,Te[8]++;for(Xe(k,u+1,Te),W=0;W<f;W++)x[2*W+1]=5,x[2*W]=He(W,5);J=new xe(k,A,d+1,u,g),Z=new xe(x,R,0,f,g),le=new xe(new Array(0),O,0,m,I)}(),Q=!0),P.l_desc=new X(P.dyn_ltree,J),P.d_desc=new X(P.dyn_dtree,Z),P.bl_desc=new X(P.bl_tree,le),P.bi_buf=0,P.bi_valid=0,Se(P)},i._tr_stored_block=N,i._tr_flush_block=function(P,W,se,ie){var K,de,Te=0;0<P.level?(P.strm.data_type===2&&(P.strm.data_type=function(pe){var Pe,Ke=4093624447;for(Pe=0;Pe<=31;Pe++,Ke>>>=1)if(1&Ke&&pe.dyn_ltree[2*Pe]!==0)return r;if(pe.dyn_ltree[18]!==0||pe.dyn_ltree[20]!==0||pe.dyn_ltree[26]!==0)return o;for(Pe=32;Pe<d;Pe++)if(pe.dyn_ltree[2*Pe]!==0)return o;return r}(P)),$e(P,P.l_desc),$e(P,P.d_desc),Te=function(pe){var Pe;for(_(pe,pe.dyn_ltree,pe.l_desc.max_code),_(pe,pe.dyn_dtree,pe.d_desc.max_code),$e(pe,pe.bl_desc),Pe=m-1;3<=Pe&&pe.bl_tree[2*L[Pe]+1]===0;Pe--);return pe.opt_len+=3*(Pe+1)+5+5+4,Pe}(P),K=P.opt_len+3+7>>>3,(de=P.static_len+3+7>>>3)<=K&&(K=de)):K=de=se+5,se+4<=K&&W!==-1?N(P,W,se,ie):P.strategy===4||de===K?(fe(P,2+(ie?1:0),3),Ze(P,k,x)):(fe(P,4+(ie?1:0),3),function(pe,Pe,Ke,Ye){var _t;for(fe(pe,Pe-257,5),fe(pe,Ke-1,5),fe(pe,Ye-4,4),_t=0;_t<Ye;_t++)fe(pe,pe.bl_tree[2*L[_t]+1],3);$(pe,pe.dyn_ltree,Pe-1),$(pe,pe.dyn_dtree,Ke-1)}(P,P.l_desc.max_code+1,P.d_desc.max_code+1,Te+1),Ze(P,P.dyn_ltree,P.dyn_dtree)),Se(P),ie&&_e(P)},i._tr_tally=function(P,W,se){return P.pending_buf[P.d_buf+2*P.last_lit]=W>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&W,P.pending_buf[P.l_buf+P.last_lit]=255&se,P.last_lit++,W===0?P.dyn_ltree[2*se]++:(P.matches++,W--,P.dyn_ltree[2*(w[se]+d+1)]++,P.dyn_dtree[2*j(W)]++),P.last_lit===P.lit_bufsize-1},i._tr_align=function(P){fe(P,2,3),ue(P,v,k),function(W){W.bi_valid===16?(be(W,W.bi_buf),W.bi_buf=0,W.bi_valid=0):8<=W.bi_valid&&(W.pending_buf[W.pending++]=255&W.bi_buf,W.bi_buf>>=8,W.bi_valid-=8)}(P)}},{"../utils/common":41}],53:[function(t,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,i){(function(n){(function(r,o){if(!r.setImmediate){var a,h,c,d,u=1,f={},m=!1,p=r.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(r);g=g&&g.setTimeout?g:r,a={}.toString.call(r.process)==="[object process]"?function(b){process.nextTick(function(){I(b)})}:function(){if(r.postMessage&&!r.importScripts){var b=!0,C=r.onmessage;return r.onmessage=function(){b=!1},r.postMessage("","*"),r.onmessage=C,b}}()?(d="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",v,!1):r.attachEvent("onmessage",v),function(b){r.postMessage(d+b,"*")}):r.MessageChannel?((c=new MessageChannel).port1.onmessage=function(b){I(b.data)},function(b){c.port2.postMessage(b)}):p&&"onreadystatechange"in p.createElement("script")?(h=p.documentElement,function(b){var C=p.createElement("script");C.onreadystatechange=function(){I(b),C.onreadystatechange=null,h.removeChild(C),C=null},h.appendChild(C)}):function(b){setTimeout(I,0,b)},g.setImmediate=function(b){typeof b!="function"&&(b=new Function(""+b));for(var C=new Array(arguments.length-1),F=0;F<C.length;F++)C[F]=arguments[F+1];var A={callback:b,args:C};return f[u]=A,a(u),u++},g.clearImmediate=E}function E(b){delete f[b]}function I(b){if(m)setTimeout(I,0,b);else{var C=f[b];if(C){m=!0;try{(function(F){var A=F.callback,R=F.args;switch(R.length){case 0:A();break;case 1:A(R[0]);break;case 2:A(R[0],R[1]);break;case 3:A(R[0],R[1],R[2]);break;default:A.apply(o,R)}})(C)}finally{E(b),m=!1}}}}function v(b){b.source===r&&typeof b.data=="string"&&b.data.indexOf(d)===0&&I(+b.data.slice(d.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof Ah<"u"?Ah:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(pE);var uC=pE.exports;const Qm=cC(uC);var mE={},zc={};(function(l){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+e+"]["+t+"]*",i=new RegExp("^"+s+"$"),n=function(o,a){const h=[];let c=a.exec(o);for(;c;){const d=[];d.startIndex=a.lastIndex-c[0].length;const u=c.length;for(let f=0;f<u;f++)d.push(c[f]);h.push(d),c=a.exec(o)}return h},r=function(o){const a=i.exec(o);return!(a===null||typeof a>"u")};l.isExist=function(o){return typeof o<"u"},l.isEmptyObject=function(o){return Object.keys(o).length===0},l.merge=function(o,a,h){if(a){const c=Object.keys(a),d=c.length;for(let u=0;u<d;u++)h==="strict"?o[c[u]]=[a[c[u]]]:o[c[u]]=a[c[u]]}},l.getValue=function(o){return l.isExist(o)?o:""},l.isName=r,l.getAllMatches=n,l.nameRegexp=s})(zc);const sp=zc,dC={allowBooleanAttributes:!1,unpairedTags:[]};mE.validate=function(l,e){e=Object.assign({},dC,e);const t=[];let s=!1,i=!1;l[0]==="\uFEFF"&&(l=l.substr(1));for(let n=0;n<l.length;n++)if(l[n]==="<"&&l[n+1]==="?"){if(n+=2,n=Jm(l,n),n.err)return n}else if(l[n]==="<"){let r=n;if(n++,l[n]==="!"){n=$m(l,n);continue}else{let o=!1;l[n]==="/"&&(o=!0,n++);let a="";for(;n<l.length&&l[n]!==">"&&l[n]!==" "&&l[n]!=="	"&&l[n]!==`
`&&l[n]!=="\r";n++)a+=l[n];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),n--),!yC(a)){let d;return a.trim().length===0?d="Invalid space after '<'.":d="Tag '"+a+"' is an invalid name.",Kt("InvalidTag",d,Fs(l,n))}const h=mC(l,n);if(h===!1)return Kt("InvalidAttr","Attributes for '"+a+"' have open quote.",Fs(l,n));let c=h.value;if(n=h.index,c[c.length-1]==="/"){const d=n-c.length;c=c.substring(0,c.length-1);const u=eg(c,e);if(u===!0)s=!0;else return Kt(u.err.code,u.err.msg,Fs(l,d+u.err.line))}else if(o)if(h.tagClosed){if(c.trim().length>0)return Kt("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",Fs(l,r));if(t.length===0)return Kt("InvalidTag","Closing tag '"+a+"' has not been opened.",Fs(l,r));{const d=t.pop();if(a!==d.tagName){let u=Fs(l,d.tagStartPos);return Kt("InvalidTag","Expected closing tag '"+d.tagName+"' (opened in line "+u.line+", col "+u.col+") instead of closing tag '"+a+"'.",Fs(l,r))}t.length==0&&(i=!0)}}else return Kt("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",Fs(l,n));else{const d=eg(c,e);if(d!==!0)return Kt(d.err.code,d.err.msg,Fs(l,n-c.length+d.err.line));if(i===!0)return Kt("InvalidXml","Multiple possible root nodes found.",Fs(l,n));e.unpairedTags.indexOf(a)!==-1||t.push({tagName:a,tagStartPos:r}),s=!0}for(n++;n<l.length;n++)if(l[n]==="<")if(l[n+1]==="!"){n++,n=$m(l,n);continue}else if(l[n+1]==="?"){if(n=Jm(l,++n),n.err)return n}else break;else if(l[n]==="&"){const d=IC(l,n);if(d==-1)return Kt("InvalidChar","char '&' is not expected.",Fs(l,n));n=d}else if(i===!0&&!qm(l[n]))return Kt("InvalidXml","Extra text at the end",Fs(l,n));l[n]==="<"&&n--}}else{if(qm(l[n]))continue;return Kt("InvalidChar","char '"+l[n]+"' is not expected.",Fs(l,n))}if(s){if(t.length==1)return Kt("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",Fs(l,t[0].tagStartPos));if(t.length>0)return Kt("InvalidXml","Invalid '"+JSON.stringify(t.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Kt("InvalidXml","Start tag expected.",1);return!0};function qm(l){return l===" "||l==="	"||l===`
`||l==="\r"}function Jm(l,e){const t=e;for(;e<l.length;e++)if(l[e]=="?"||l[e]==" "){const s=l.substr(t,e-t);if(e>5&&s==="xml")return Kt("InvalidXml","XML declaration allowed only at the start of the document.",Fs(l,e));if(l[e]=="?"&&l[e+1]==">"){e++;break}else continue}return e}function $m(l,e){if(l.length>e+5&&l[e+1]==="-"&&l[e+2]==="-"){for(e+=3;e<l.length;e++)if(l[e]==="-"&&l[e+1]==="-"&&l[e+2]===">"){e+=2;break}}else if(l.length>e+8&&l[e+1]==="D"&&l[e+2]==="O"&&l[e+3]==="C"&&l[e+4]==="T"&&l[e+5]==="Y"&&l[e+6]==="P"&&l[e+7]==="E"){let t=1;for(e+=8;e<l.length;e++)if(l[e]==="<")t++;else if(l[e]===">"&&(t--,t===0))break}else if(l.length>e+9&&l[e+1]==="["&&l[e+2]==="C"&&l[e+3]==="D"&&l[e+4]==="A"&&l[e+5]==="T"&&l[e+6]==="A"&&l[e+7]==="["){for(e+=8;e<l.length;e++)if(l[e]==="]"&&l[e+1]==="]"&&l[e+2]===">"){e+=2;break}}return e}const fC='"',pC="'";function mC(l,e){let t="",s="",i=!1;for(;e<l.length;e++){if(l[e]===fC||l[e]===pC)s===""?s=l[e]:s!==l[e]||(s="");else if(l[e]===">"&&s===""){i=!0;break}t+=l[e]}return s!==""?!1:{value:t,index:e,tagClosed:i}}const gC=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function eg(l,e){const t=sp.getAllMatches(l,gC),s={};for(let i=0;i<t.length;i++){if(t[i][1].length===0)return Kt("InvalidAttr","Attribute '"+t[i][2]+"' has no space in starting.",La(t[i]));if(t[i][3]!==void 0&&t[i][4]===void 0)return Kt("InvalidAttr","Attribute '"+t[i][2]+"' is without value.",La(t[i]));if(t[i][3]===void 0&&!e.allowBooleanAttributes)return Kt("InvalidAttr","boolean attribute '"+t[i][2]+"' is not allowed.",La(t[i]));const n=t[i][2];if(!bC(n))return Kt("InvalidAttr","Attribute '"+n+"' is an invalid name.",La(t[i]));if(!s.hasOwnProperty(n))s[n]=1;else return Kt("InvalidAttr","Attribute '"+n+"' is repeated.",La(t[i]))}return!0}function EC(l,e){let t=/\d/;for(l[e]==="x"&&(e++,t=/[\da-fA-F]/);e<l.length;e++){if(l[e]===";")return e;if(!l[e].match(t))break}return-1}function IC(l,e){if(e++,l[e]===";")return-1;if(l[e]==="#")return e++,EC(l,e);let t=0;for(;e<l.length;e++,t++)if(!(l[e].match(/\w/)&&t<20)){if(l[e]===";")break;return-1}return e}function Kt(l,e,t){return{err:{code:l,msg:e,line:t.line||t,col:t.col}}}function bC(l){return sp.isName(l)}function yC(l){return sp.isName(l)}function Fs(l,e){const t=l.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function La(l){return l.startIndex+l[1].length}var ip={};const gE={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(l,e){return e},attributeValueProcessor:function(l,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(l,e,t){return l}},wC=function(l){return Object.assign({},gE,l)};ip.buildOptions=wC;ip.defaultOptions=gE;let CC=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};var vC=CC;const _C=zc;function TC(l,e){const t={};if(l[e+3]==="O"&&l[e+4]==="C"&&l[e+5]==="T"&&l[e+6]==="Y"&&l[e+7]==="P"&&l[e+8]==="E"){e=e+9;let s=1,i=!1,n=!1,r="";for(;e<l.length;e++)if(l[e]==="<"&&!n){if(i&&FC(l,e))e+=7,[entityName,val,e]=xC(l,e+1),val.indexOf("&")===-1&&(t[PC(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&RC(l,e))e+=8;else if(i&&SC(l,e))e+=8;else if(i&&OC(l,e))e+=9;else if(AC)n=!0;else throw new Error("Invalid DOCTYPE");s++,r=""}else if(l[e]===">"){if(n?l[e-1]==="-"&&l[e-2]==="-"&&(n=!1,s--):s--,s===0)break}else l[e]==="["?i=!0:r+=l[e];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function xC(l,e){let t="";for(;e<l.length&&l[e]!=="'"&&l[e]!=='"';e++)t+=l[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=l[e++];let i="";for(;e<l.length&&l[e]!==s;e++)i+=l[e];return[t,i,e]}function AC(l,e){return l[e+1]==="!"&&l[e+2]==="-"&&l[e+3]==="-"}function FC(l,e){return l[e+1]==="!"&&l[e+2]==="E"&&l[e+3]==="N"&&l[e+4]==="T"&&l[e+5]==="I"&&l[e+6]==="T"&&l[e+7]==="Y"}function RC(l,e){return l[e+1]==="!"&&l[e+2]==="E"&&l[e+3]==="L"&&l[e+4]==="E"&&l[e+5]==="M"&&l[e+6]==="E"&&l[e+7]==="N"&&l[e+8]==="T"}function SC(l,e){return l[e+1]==="!"&&l[e+2]==="A"&&l[e+3]==="T"&&l[e+4]==="T"&&l[e+5]==="L"&&l[e+6]==="I"&&l[e+7]==="S"&&l[e+8]==="T"}function OC(l,e){return l[e+1]==="!"&&l[e+2]==="N"&&l[e+3]==="O"&&l[e+4]==="T"&&l[e+5]==="A"&&l[e+6]==="T"&&l[e+7]==="I"&&l[e+8]==="O"&&l[e+9]==="N"}function PC(l){if(_C.isName(l))return l;throw new Error(`Invalid entity name ${l}`)}var MC=TC;const NC=/^[-+]?0x[a-fA-F0-9]+$/,DC=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const LC={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function UC(l,e={}){if(e=Object.assign({},LC,e),!l||typeof l!="string")return l;let t=l.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return l;if(e.hex&&NC.test(t))return Number.parseInt(t,16);{const s=DC.exec(t);if(s){const i=s[1],n=s[2];let r=BC(s[3]);const o=s[4]||s[6];if(!e.leadingZeros&&n.length>0&&i&&t[2]!=="."||!e.leadingZeros&&n.length>0&&!i&&t[1]!==".")return l;{const a=Number(t),h=""+a;return h.search(/[eE]/)!==-1||o?e.eNotation?a:l:t.indexOf(".")!==-1?h==="0"&&r===""||h===r||i&&h==="-"+r?a:l:n?r===h||i+r===h?a:l:t===h||t===i+h?a:l}}else return l}}function BC(l){return l&&l.indexOf(".")!==-1&&(l=l.replace(/0+$/,""),l==="."?l="0":l[0]==="."?l="0"+l:l[l.length-1]==="."&&(l=l.substr(0,l.length-1))),l}var zC=UC;const EE=zc,Ua=vC,kC=MC,VC=zC;let YC=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,s)=>String.fromCharCode(Number.parseInt(s,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,s)=>String.fromCharCode(Number.parseInt(s,16))}},this.addExternalEntities=GC,this.parseXml=XC,this.parseTextData=HC,this.resolveNameSpace=WC,this.buildAttributesMap=ZC,this.isItStopNode=JC,this.replaceEntitiesValue=QC,this.readStopNodeData=ev,this.saveTextToParentTag=qC,this.addChild=KC}};function GC(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const s=e[t];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:l[s]}}}function HC(l,e,t,s,i,n,r){if(l!==void 0&&(this.options.trimValues&&!s&&(l=l.trim()),l.length>0)){r||(l=this.replaceEntitiesValue(l));const o=this.options.tagValueProcessor(e,l,t,i,n);return o==null?l:typeof o!=typeof l||o!==l?o:this.options.trimValues?rf(l,this.options.parseTagValue,this.options.numberParseOptions):l.trim()===l?rf(l,this.options.parseTagValue,this.options.numberParseOptions):l}}function WC(l){if(this.options.removeNSPrefix){const e=l.split(":"),t=l.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(l=t+e[1])}return l}const jC=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function ZC(l,e,t){if(!this.options.ignoreAttributes&&typeof l=="string"){const s=EE.getAllMatches(l,jC),i=s.length,n={};for(let r=0;r<i;r++){const o=this.resolveNameSpace(s[r][1]);let a=s[r][4],h=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(h=this.options.transformAttributeName(h)),h==="__proto__"&&(h="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const c=this.options.attributeValueProcessor(o,a,e);c==null?n[h]=a:typeof c!=typeof a||c!==a?n[h]=c:n[h]=rf(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[h]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const r={};return r[this.options.attributesGroupName]=n,r}return n}}const XC=function(l){l=l.replace(/\r\n?/g,`
`);const e=new Ua("!xml");let t=e,s="",i="";for(let n=0;n<l.length;n++)if(l[n]==="<")if(l[n+1]==="/"){const r=gr(l,">",n,"Closing Tag is not closed.");let o=l.substring(n+2,r).trim();if(this.options.removeNSPrefix){const c=o.indexOf(":");c!==-1&&(o=o.substr(c+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&(s=this.saveTextToParentTag(s,t,i));const a=i.substring(i.lastIndexOf(".")+1);if(o&&this.options.unpairedTags.indexOf(o)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${o}>`);let h=0;a&&this.options.unpairedTags.indexOf(a)!==-1?(h=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):h=i.lastIndexOf("."),i=i.substring(0,h),t=this.tagsNodeStack.pop(),s="",n=r}else if(l[n+1]==="?"){let r=nf(l,n,!1,"?>");if(!r)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,t,i),!(this.options.ignoreDeclaration&&r.tagName==="?xml"||this.options.ignorePiTags)){const o=new Ua(r.tagName);o.add(this.options.textNodeName,""),r.tagName!==r.tagExp&&r.attrExpPresent&&(o[":@"]=this.buildAttributesMap(r.tagExp,i,r.tagName)),this.addChild(t,o,i)}n=r.closeIndex+1}else if(l.substr(n+1,3)==="!--"){const r=gr(l,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const o=l.substring(n+4,r-2);s=this.saveTextToParentTag(s,t,i),t.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}n=r}else if(l.substr(n+1,2)==="!D"){const r=kC(l,n);this.docTypeEntities=r.entities,n=r.i}else if(l.substr(n+1,2)==="!["){const r=gr(l,"]]>",n,"CDATA is not closed.")-2,o=l.substring(n+9,r);s=this.saveTextToParentTag(s,t,i);let a=this.parseTextData(o,t.tagname,i,!0,!1,!0,!0);a==null&&(a=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):t.add(this.options.textNodeName,a),n=r+2}else{let r=nf(l,n,this.options.removeNSPrefix),o=r.tagName;const a=r.rawTagName;let h=r.tagExp,c=r.attrExpPresent,d=r.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&s&&t.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,t,i,!1));const u=t;if(u&&this.options.unpairedTags.indexOf(u.tagname)!==-1&&(t=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),o!==e.tagname&&(i+=i?"."+o:o),this.isItStopNode(this.options.stopNodes,i,o)){let f="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),h=o):h=h.substr(0,h.length-1),n=r.closeIndex;else if(this.options.unpairedTags.indexOf(o)!==-1)n=r.closeIndex;else{const p=this.readStopNodeData(l,a,d+1);if(!p)throw new Error(`Unexpected end of ${a}`);n=p.i,f=p.tagContent}const m=new Ua(o);o!==h&&c&&(m[":@"]=this.buildAttributesMap(h,i,o)),f&&(f=this.parseTextData(f,o,i,!0,c,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),m.add(this.options.textNodeName,f),this.addChild(t,m,i)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),h=o):h=h.substr(0,h.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const f=new Ua(o);o!==h&&c&&(f[":@"]=this.buildAttributesMap(h,i,o)),this.addChild(t,f,i),i=i.substr(0,i.lastIndexOf("."))}else{const f=new Ua(o);this.tagsNodeStack.push(t),o!==h&&c&&(f[":@"]=this.buildAttributesMap(h,i,o)),this.addChild(t,f,i),t=f}s="",n=d}}else s+=l[n];return e.child};function KC(l,e,t){const s=this.options.updateTag(e.tagname,t,e[":@"]);s===!1||(typeof s=="string"&&(e.tagname=s),l.addChild(e))}const QC=function(l){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];l=l.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];l=l.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];l=l.replace(t.regex,t.val)}l=l.replace(this.ampEntity.regex,this.ampEntity.val)}return l};function qC(l,e,t,s){return l&&(s===void 0&&(s=Object.keys(e.child).length===0),l=this.parseTextData(l,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,s),l!==void 0&&l!==""&&e.add(this.options.textNodeName,l),l=""),l}function JC(l,e,t){const s="*."+t;for(const i in l){const n=l[i];if(s===n||e===n)return!0}return!1}function $C(l,e,t=">"){let s,i="";for(let n=e;n<l.length;n++){let r=l[n];if(s)r===s&&(s="");else if(r==='"'||r==="'")s=r;else if(r===t[0])if(t[1]){if(l[n+1]===t[1])return{data:i,index:n}}else return{data:i,index:n};else r==="	"&&(r=" ");i+=r}}function gr(l,e,t,s){const i=l.indexOf(e,t);if(i===-1)throw new Error(s);return i+e.length-1}function nf(l,e,t,s=">"){const i=$C(l,e+1,s);if(!i)return;let n=i.data;const r=i.index,o=n.search(/\s/);let a=n,h=!0;o!==-1&&(a=n.substring(0,o),n=n.substring(o+1).trimStart());const c=a;if(t){const d=a.indexOf(":");d!==-1&&(a=a.substr(d+1),h=a!==i.data.substr(d+1))}return{tagName:a,tagExp:n,closeIndex:r,attrExpPresent:h,rawTagName:c}}function ev(l,e,t){const s=t;let i=1;for(;t<l.length;t++)if(l[t]==="<")if(l[t+1]==="/"){const n=gr(l,">",t,`${e} is not closed`);if(l.substring(t+2,n).trim()===e&&(i--,i===0))return{tagContent:l.substring(s,t),i:n};t=n}else if(l[t+1]==="?")t=gr(l,"?>",t+1,"StopNode is not closed.");else if(l.substr(t+1,3)==="!--")t=gr(l,"-->",t+3,"StopNode is not closed.");else if(l.substr(t+1,2)==="![")t=gr(l,"]]>",t,"StopNode is not closed.")-2;else{const n=nf(l,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&i++,t=n.closeIndex)}}function rf(l,e,t){if(e&&typeof l=="string"){const s=l.trim();return s==="true"?!0:s==="false"?!1:VC(l,t)}else return EE.isExist(l)?l:""}var tv=YC,IE={};function sv(l,e){return bE(l,e)}function bE(l,e,t){let s;const i={};for(let n=0;n<l.length;n++){const r=l[n],o=iv(r);let a="";if(t===void 0?a=o:a=t+"."+o,o===e.textNodeName)s===void 0?s=r[o]:s+=""+r[o];else{if(o===void 0)continue;if(r[o]){let h=bE(r[o],e,a);const c=rv(h,e);r[":@"]?nv(h,r[":@"],a,e):Object.keys(h).length===1&&h[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?h=h[e.textNodeName]:Object.keys(h).length===0&&(e.alwaysCreateTextNode?h[e.textNodeName]="":h=""),i[o]!==void 0&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(h)):e.isArray(o,a,c)?i[o]=[h]:i[o]=h}}}return typeof s=="string"?s.length>0&&(i[e.textNodeName]=s):s!==void 0&&(i[e.textNodeName]=s),i}function iv(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const s=e[t];if(s!==":@")return s}}function nv(l,e,t,s){if(e){const i=Object.keys(e),n=i.length;for(let r=0;r<n;r++){const o=i[r];s.isArray(o,t+"."+o,!0,!0)?l[o]=[e[o]]:l[o]=e[o]}}}function rv(l,e){const{textNodeName:t}=e,s=Object.keys(l).length;return!!(s===0||s===1&&(l[t]||typeof l[t]=="boolean"||l[t]===0))}IE.prettify=sv;const{buildOptions:ov}=ip,av=tv,{prettify:lv}=IE,hv=mE;let cv=class{constructor(e){this.externalEntities={},this.options=ov(e)}parse(e,t){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const n=hv.validate(e,t);if(n!==!0)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const s=new av(this.options);s.addExternalEntities(this.externalEntities);const i=s.parseXml(e);return this.options.preserveOrder||i===void 0?i:lv(i,this.options)}addEntity(e,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}};var uv=cv;const dv=uv;var fv={XMLParser:dv};let of=class{constructor(e,t){V(this,"date",new Date),V(this,"author"),V(this,"guid",Cr.create()),V(this,"viewpoint"),V(this,"modifiedAuthor"),V(this,"modifiedDate"),V(this,"topic"),V(this,"_components"),V(this,"_comment",""),this._components=e,this._comment=t;const s=this._components.get(Ss);this.author=s.config.author}set comment(e){var t;const s=this._components.get(Ss);this._comment=e,this.modifiedDate=new Date,this.modifiedAuthor=s.config.author,(t=this.topic)==null||t.comments.set(this.guid,this)}get comment(){return this._comment}serialize(){let e=null;this.viewpoint&&(e=`<Viewpoint Guid="${this.viewpoint.guid}"/>`);let t=null;this.modifiedDate&&(t=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let s=null;return this.modifiedAuthor&&(s=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`),`
      <Comment Guid="${this.guid}">
        <Date>${this.date.toISOString()}</Date>
        <Author>${this.author}</Author>
        <Comment>${this.comment}</Comment>
        ${e??""}
        ${s??""}
        ${t??""}
      </Comment>
    `}};const yE=class Rn{constructor(e){V(this,"guid",Cr.create()),V(this,"title",Rn.default.title),V(this,"creationDate",new Date),V(this,"creationAuthor",""),V(this,"viewpoints",new Po),V(this,"relatedTopics",new Po),V(this,"comments",new Hn),V(this,"customData",{}),V(this,"description"),V(this,"serverAssignedId"),V(this,"dueDate"),V(this,"modifiedAuthor"),V(this,"modifiedDate"),V(this,"index"),V(this,"_type",Rn.default.type),V(this,"_status",Rn.default.status),V(this,"_priority",Rn.default.priority),V(this,"_stage",Rn.default.priority),V(this,"_assignedTo",Rn.default.assignedTo),V(this,"_labels",Rn.default.labels),V(this,"_components"),this._components=e;const t=e.get(Ss);this.creationAuthor=t.config.author,this.relatedTopics.guard=s=>s!==this.guid}set type(e){const t=this._components.get(Ss),{strict:s,types:i}=t.config;(!s||i.has(e))&&(this._type=e)}get type(){return this._type}set status(e){const t=this._components.get(Ss),{strict:s,statuses:i}=t.config;(!s||i.has(e))&&(this._status=e)}get status(){return this._status}set priority(e){const t=this._components.get(Ss);if(e){const{strict:s,priorities:i}=t.config;if(!(!s||i.has(e)))return;this._priority=e}else this._priority=e}get priority(){return this._priority}set stage(e){const t=this._components.get(Ss);if(e){const{strict:s,stages:i}=t.config;if(!(!s||i.has(e)))return;this._stage=e}else this._stage=e}get stage(){return this._stage}set assignedTo(e){const t=this._components.get(Ss);if(e){const{strict:s,users:i}=t.config;if(!(!s||i.has(e)))return;this._assignedTo=e}else this._assignedTo=e}get assignedTo(){return this._assignedTo}set labels(e){const t=this._components.get(Ss),{strict:s,labels:i}=t.config;if(s){const n=new Set;for(const r of e)(!s||i.has(r))&&n.add(r);this._labels=n}else this._labels=e}get labels(){return this._labels}get _managerVersion(){return this._components.get(Ss).config.version}set(e){const t=e,s=this;for(const i in e){if(i==="guid")continue;const n=t[i];i in this&&(s[i]=n)}return this._components.get(Ss).list.set(this.guid,this),this}createComment(e,t){const s=new of(this._components,e);return s.viewpoint=t,s.topic=this,this.comments.set(s.guid,s),s}createLabelTags(e=this._managerVersion){let t="Labels";e==="2.1"&&(t="Labels"),e==="3"&&(t="Label");let s=[...this.labels].map(i=>`<${t}>${i}</${t}>`).join(`
`);for(const i in this.customData){const n=this.customData[i];typeof n=="string"&&(s+=`
<${t}>${n}</${t}>`)}return e==="2.1"?s:e==="3"?s.length!==0?`<Labels>
${s}
</Labels>`:"<Labels/>":s}createCommentTags(e=this._managerVersion){const t=[...this.comments.values()].map(s=>s.serialize()).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<Comments>
${t}
</Comments>`:"<Comments/>":t}createViewpointTags(e=this._managerVersion){let t="Viewpoints";e==="2.1"&&(t="Viewpoints"),e==="3"&&(t="ViewPoint");const s=this._components.get(cn),i=[...this.viewpoints].map(n=>s.list.get(n)).filter(n=>n).map(n=>`<${t} Guid="${n.guid}">
          <Viewpoint>${n.guid}.bcfv</Viewpoint>
          <Snapshot>${n.guid}.jpeg</Snapshot>
        </${t}>
      `).join(`
`);return e==="2.1"?i:e==="3"?i.length!==0?`<Viewpoints>
${i}
</Viewpoints>`:"<Viewpoints />":i}createRelatedTopicTags(e=this._managerVersion){const t=[...this.relatedTopics].map(s=>`<RelatedTopic Guid="${s}"></RelatedTopic>
      `).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<RelatedTopics>
${t}
</RelatedTopics>`:"<RelatedTopics />":t}serialize(){const e=this._managerVersion;let t=null;this.serverAssignedId&&(t=`ServerAssignedId="${this.serverAssignedId}"`);let s=null;this.priority&&(s=`<Priority>${this.priority}</Priority>`);let i=null;this.index&&e==="2.1"&&(i=`<Index>${this.index}</Index>`);let n=null;this.modifiedDate&&(n=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let r=null;this.modifiedAuthor&&(r=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`);let o=null;this.dueDate&&(o=`<DueDate>${this.dueDate.toISOString()}</DueDate>`);let a=null;this.assignedTo&&(a=`<AssignedTo>${this.assignedTo}</AssignedTo>`);let h=null;this.description&&(h=`<Description>${this.description}</Description>`);let c=null;this.stage&&(c=`<Stage>${this.stage}</Stage>`);const d=this.createCommentTags(e),u=this.createViewpointTags(e),f=this.createLabelTags(e),m=this.createRelatedTopicTags(e);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Markup>
        <Topic Guid="${this.guid}" TopicType="${this.type}" TopicStatus="${this.status}" ${t??""}>
          <Title>${this.title}</Title>
          <CreationDate>${this.creationDate.toISOString()}</CreationDate>
          <CreationAuthor>${this.creationAuthor}</CreationAuthor>
          ${s??""}
          ${i??""}
          ${n??""}
          ${r??""}
          ${o??""}
          ${a??""}
          ${h??""}
          ${c??""}
          ${f}
          ${m}
          ${e==="3"?d:""}
          ${e==="3"?u:""}
        </Topic>
        ${e==="2.1"?d:""}
        ${e==="2.1"?u:""}
      </Markup>
    `}};V(yE,"default",{title:"BCF Topic",type:"Issue",status:"Active",labels:new Set});let tg=yE;const pv=(l,e)=>{if(e.trim()==="")return;const t=Ss.xmlParser.parse(e).Extensions;if(!t)return;const{Priorities:s,TopicStatuses:i,TopicTypes:n,Users:r}=t;if(s&&s.Priority){const o=Array.isArray(s.Priority)?s.Priority:[s.Priority];for(const a of o)l.config.priorities.add(a)}if(i&&i.TopicStatus){const o=Array.isArray(i.TopicStatus)?i.TopicStatus:[i.TopicStatus];for(const a of o)l.config.statuses.add(a)}if(n&&n.TopicType){const o=Array.isArray(n.TopicType)?n.TopicType:[n.TopicType];for(const a of o)l.config.types.add(a)}if(r&&r.User){const o=Array.isArray(r.User)?r.User:[r.User];for(const a of o)l.config.users.add(a)}},af=class gc extends qt{constructor(){super(...arguments),V(this,"enabled",!1),V(this,"config",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1}),V(this,"list",new Hn),V(this,"onSetup",new Ue),V(this,"isSetup",!1),V(this,"onBCFImported",new Ue),V(this,"onDisposed",new Ue)}setup(e){this.isSetup||(this.config={...this.config,...e},this.isSetup=!0,this.enabled=!0,this.onSetup.trigger())}create(e){const t=new tg(this.components);return e&&(t.guid=e.guid??t.guid,t.set(e)),this.list.set(t.guid,t),t}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const e=[...this.list].map(([t,s])=>s.type);return new Set(e)}get usedStatuses(){const e=[...this.list].map(([t,s])=>s.status);return new Set(e)}get usedPriorities(){const e=[...this.list].map(([t,s])=>s.priority).filter(t=>t);return new Set(e)}get usedStages(){const e=[...this.list].map(([t,s])=>s.stage).filter(t=>t);return new Set(e)}get usedUsers(){const e=[];for(const[t,s]of this.list){e.push(s.creationAuthor),s.assignedTo&&e.push(s.assignedTo),s.modifiedAuthor&&e.push(s.modifiedAuthor);for(const[i,n]of s.comments)e.push(n.author),n.modifiedAuthor&&e.push(n.modifiedAuthor)}return new Set(e)}get usedLabels(){const e=[];for(const[t,s]of this.list)e.push(...s.labels);return new Set(e)}updateExtensions(){for(const[e,t]of this.list){for(const s of t.labels)this.config.labels.add(s);this.config.types.add(t.type),t.priority&&this.config.priorities.add(t.priority),t.stage&&this.config.stages.add(t.stage),this.config.statuses.add(t.status),this.config.users.add(t.creationAuthor),t.assignedTo&&this.config.users.add(t.assignedTo),t.modifiedAuthor&&this.config.users.add(t.modifiedAuthor);for(const[s,i]of t.comments)this.config.users.add(i.author),i.modifiedAuthor&&this.config.users.add(i.modifiedAuthor)}}updateViewpointReferences(){const e=this.components.get(cn);for(const[t,s]of this.list)for(const i of s.viewpoints)e.list.has(i)||s.viewpoints.delete(i)}async export(e=this.list.values()){const t=new Qm;t.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`),t.file("bcf.extensions",this.serializeExtensions());const s=await(await fetch("https://thatopen.github.io/engine_components/resources/favicon.ico")).blob(),i=this.components.get(cn);for(const n of e){const r=t.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const a=i.list.get(o);a&&(r.file(`${o}.jpeg`,s,{binary:!0}),r.file(`${o}.bcfv`,await a.serialize()))}}return await t.generateAsync({type:"blob"})}serializeExtensions(){const e=[...this.config.types].map(o=>`<TopicType>${o}</TopicType>`).join(`
`),t=[...this.config.statuses].map(o=>`<TopicStatus>${o}</TopicStatus>`).join(`
`),s=[...this.config.priorities].map(o=>`<Priority>${o}</Priority>`).join(`
`),i=[...this.config.labels].map(o=>`<TopicLabel>${o}</TopicLabel>`).join(`
`),n=[...this.config.stages].map(o=>`<Stage>${o}</Stage>`).join(`
`),r=[...this.config.users].map(o=>`<User>${o}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${e.length!==0?`<TopicTypes>
${e}
</TopicTypes>`:""}
        ${t.length!==0?`<TopicStatuses>
${t}
</TopicStatuses>`:""}
        ${s.length!==0?`<Priorities>
${s}
</Priorities>`:""}
        ${i.length!==0?`<TopicLabels>
${i}
</TopicLabels>`:""}
        ${n.length!==0?`<Stages>
${n}
</Stages>`:""}
        ${r.length!==0?`<Users>
${r}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(e){const{Guid:t,Date:s,Author:i,Comment:n,Viewpoint:r}=e;if(!(t&&s&&i&&(of||r)))return null;const o=this.components.get(cn),a=new of(this.components,n??"");return a.guid=t,a.date=new Date(s),a.author=i,a.viewpoint=r!=null&&r.Guid?o.list.get(r.Guid):void 0,a.modifiedAuthor=e.ModifiedAuthor,a.modifiedDate=e.ModifiedDate?new Date(e.ModifiedDate):void 0,a}getMarkupComments(e,t){var s;let i;if(t==="2.1"&&(i=e.Comment),t==="3"&&(i=(s=e.Topic.Comments)==null?void 0:s.Comment),!i)return[];i=Array.isArray(i)?i:[i];const n=i.map(r=>this.processMarkupComment(r)).filter(r=>r);return Array.isArray(n)?n:[n]}getMarkupLabels(e,t){var s;let i;return t==="2.1"&&(i=e.Topic.Labels),t==="3"&&(i=(s=e.Topic.Labels)==null?void 0:s.Label),i?Array.isArray(i)?i:[i]:[]}getMarkupViewpoints(e,t){var s;let i;return t==="2.1"&&(i=e.Viewpoints),t==="3"&&(i=(s=e.Topic.Viewpoints)==null?void 0:s.ViewPoint),i?(i=Array.isArray(i)?i:[i],i):[]}getMarkupRelatedTopics(e,t){var s;let i;return t==="2.1"&&(i=e.Topic.RelatedTopic),t==="3"&&(i=(s=e.Topic.RelatedTopics)==null?void 0:s.RelatedTopic),i?(Array.isArray(i)?i:[i]).map(n=>n.Guid):[]}async load(e,t){var s;const{fallbackVersionOnImport:i,ignoreIncompleteTopicsOnImport:n,updateExtensionsOnImport:r}=this.config,o=new Qm;await o.loadAsync(e);const a=Object.values(o.files);let h=i;const c=a.find(I=>I.name.endsWith(".version"));if(c){const I=await c.async("string"),v=gc.xmlParser.parse(I).Version.VersionId;h=String(v)}if(!(h&&(h==="2.1"||h==="3")))throw new Error(`BCFTopics: ${h} is not supported.`);const d=a.find(I=>I.name.endsWith(".extensions"));if(r&&d){const I=await d.async("string");pv(this,I)}const u=[],f=this.components.get(cn),m=a.filter(I=>I.name.endsWith(".bcfv"));for(const I of m){const v=await I.async("string"),b=gc.xmlParser.parse(v).VisualizationInfo;if(!b){console.warn("Missing VisualizationInfo in Viewpoint");continue}const C={},{Guid:F,ClippingPlanes:A,Components:R,OrthogonalCamera:O,PerspectiveCamera:L}=b;if(F&&(C.guid=F),R){const{Selection:x,Visibility:M}=R;if(x&&x.Component){const G=Array.isArray(x.Component)?x.Component:[x.Component];C.selectionComponents=G.map(J=>J.IfcGuid).filter(J=>J)}if(M&&"DefaultVisibility"in M&&(C.defaultVisibility=M.DefaultVisibility),M&&M.Exceptions&&"Component"in M.Exceptions){const{Component:G}=M.Exceptions,J=Array.isArray(G)?G:[G];C.exceptionComponents=J.map(Z=>Z.IfcGuid).filter(Z=>Z)}let w;h==="2.1"&&(w=R.ViewSetupHints),h==="3"&&(w=(s=R.Visibility)==null?void 0:s.ViewSetupHints),w&&("OpeningsVisible"in w&&(C.openingsVisible=w.OpeningsVisible),"SpacesVisible"in w&&(C.spacesVisible=w.SpacesVisible),"SpaceBoundariesVisible"in w&&(C.spaceBoundariesVisible=w.SpaceBoundariesVisible))}if(O||L){const x=b.PerspectiveCamera??b.OrthogonalCamera,{CameraViewPoint:M,CameraDirection:w}=x,G=new U(Number(M.X),Number(M.Z),Number(-M.Y)),J=new U(Number(w.X),Number(w.Z),Number(-w.Y)),Z={position:{x:G.x,y:G.y,z:G.z},direction:{x:J.x,y:J.y,z:J.z},aspectRatio:"AspectRatio"in x?x.AspectRatio:1};"ViewToWorldScale"in x&&(C.camera={...Z,viewToWorldScale:x.ViewToWorldScale}),"FieldOfView"in x&&(C.camera={...Z,fov:x.FieldOfView})}const k=new FE(this.components,t,{data:C,setCamera:!1});if(R){const{Coloring:x}=R;if(x&&x.Color){const M=Array.isArray(x.Color)?x.Color:[x.Color];for(const w of M){const{Color:G,Component:J}=w,Z=(Array.isArray(J)?J:[J]).map(le=>le.IfcGuid);k.componentColors.set(G,Z)}}}if(u.push(k),A){const x=this.components.get(Jw),M=Array.isArray(A.ClippingPlane)?A.ClippingPlane:[A.ClippingPlane];for(const w of M){const{Location:G,Direction:J}=w;if(!(G&&J))continue;const Z=new U(G.X,G.Z,-G.Y),le=new U(J.X,-J.Z,J.Y),ee=x.createFromNormalAndCoplanarPoint(t,le,Z);ee.visible=!1,ee.enabled=!1,k.clippingPlanes.add(ee)}}}const p={},g=[],E=a.filter(I=>I.name.endsWith(".bcf"));for(const I of E){const v=await I.async("string"),b=gc.xmlParser.parse(v).Markup,C=b.Topic,{Guid:F,TopicType:A,TopicStatus:R,Title:O,CreationDate:L,CreationAuthor:k}=C;if(n&&!(F&&A&&R&&O&&L&&k))continue;const x=new tg(this.components);x.guid=F??x.guid;const M=this.getMarkupRelatedTopics(b,h);p[x.guid]=new Set(M),x.type=A??x.type,x.status=R??x.status,x.title=O??x.title,x.creationDate=L?new Date(L):x.creationDate,x.creationAuthor=k??x.creationAuthor,x.serverAssignedId=C.ServerAssignedId,x.priority=C.Priority,x.index=C.Index,x.modifiedDate=C.ModifiedDate?new Date(C.ModifiedDate):void 0,x.modifiedAuthor=C.ModifiedAuthor,x.dueDate=C.DueDate?new Date(C.DueDate):void 0,x.assignedTo=C.AssignedTo,x.description=C.Description,x.stage=C.Stage;const w=this.getMarkupLabels(b,h);for(const Z of w)x.labels.add(Z);const G=this.getMarkupComments(b,h);for(const Z of G)x.comments.set(Z.guid,Z);const J=this.getMarkupViewpoints(b,h);for(const Z of J){if(!(Z&&Z.Guid))continue;const le=f.list.get(Z.Guid);le&&x.viewpoints.add(le.guid)}this.list.set(x.guid,x),g.push(x)}for(const I in p){const v=this.list.get(I);if(!v)continue;const b=p[I];for(const C of b)v.relatedTopics.add(C)}return this.onBCFImported.trigger(g),{viewpoints:u,topics:g}}};V(af,"uuid","de977976-e4f6-4e4f-a01a-204727839802"),V(af,"xmlParser",new fv.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Ss=af;const wE=class nn extends qt{constructor(e){super(e),V(this,"enabled",!0),V(this,"onDisposed",new Ue),V(this,"_absoluteMin"),V(this,"_absoluteMax"),V(this,"_meshes",[]),this.components.add(nn.uuid,this),this._absoluteMin=nn.newBound(!0),this._absoluteMax=nn.newBound(!1)}static getDimensions(e){const{min:t,max:s}=e,i=Math.abs(s.x-t.x),n=Math.abs(s.y-t.y),r=Math.abs(s.z-t.z),o=new U;return o.subVectors(s,t).divideScalar(2).add(t),{width:i,height:n,depth:r,center:o}}static newBound(e){const t=e?1:-1;return new U(t*Number.MAX_VALUE,t*Number.MAX_VALUE,t*Number.MAX_VALUE)}static getBounds(e,t,s){const i=s||this.newBound(!1),n=t||this.newBound(!0);for(const r of e)r.x<n.x&&(n.x=r.x),r.y<n.y&&(n.y=r.y),r.z<n.z&&(n.z=r.z),r.x>i.x&&(i.x=r.x),r.y>i.y&&(i.y=r.y),r.z>i.z&&(i.z=r.z);return new Qe(t,s)}dispose(){const e=this.components.get(Bo);for(const t of this._meshes)e.destroy(t);this._meshes=[],this.onDisposed.trigger(nn.uuid),this.onDisposed.reset()}get(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone();return new Qe(e,t)}getSphere(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone(),s=Math.abs((t.x-e.x)/2),i=Math.abs((t.y-e.y)/2),n=Math.abs((t.z-e.z)/2),r=new U(e.x+s,e.y+i,e.z+n),o=r.distanceTo(e);return new pi(r,o)}getMesh(){const e=new Qe(this._absoluteMin,this._absoluteMax),t=nn.getDimensions(e),{width:s,height:i,depth:n,center:r}=t,o=new pt(s,i,n),a=new ye(o);return this._meshes.push(a),a.position.copy(r),a}reset(){this._absoluteMin=nn.newBound(!0),this._absoluteMax=nn.newBound(!1)}add(e){for(const t of e.items)this.addMesh(t.mesh)}addMesh(e,t){if(!e.geometry.index)return;const s=nn.getFragmentBounds(e);e.updateMatrixWorld();const i=e.matrixWorld,n=new Oe,r=e instanceof ss,o=new Set;if(e instanceof cl){t||(t=e.fragment.ids);for(const a of t){const h=e.fragment.getInstancesIDs(a);if(h)for(const c of h)o.add(c)}}else o.add(0);for(const a of o){const h=s.min.clone(),c=s.max.clone();r&&(e.getMatrixAt(a,n),h.applyMatrix4(n),c.applyMatrix4(n)),h.applyMatrix4(i),c.applyMatrix4(i),h.x<this._absoluteMin.x&&(this._absoluteMin.x=h.x),h.y<this._absoluteMin.y&&(this._absoluteMin.y=h.y),h.z<this._absoluteMin.z&&(this._absoluteMin.z=h.z),h.x>this._absoluteMax.x&&(this._absoluteMax.x=h.x),h.y>this._absoluteMax.y&&(this._absoluteMax.y=h.y),h.z>this._absoluteMax.z&&(this._absoluteMax.z=h.z),c.x>this._absoluteMax.x&&(this._absoluteMax.x=c.x),c.y>this._absoluteMax.y&&(this._absoluteMax.y=c.y),c.z>this._absoluteMax.z&&(this._absoluteMax.z=c.z),c.x<this._absoluteMin.x&&(this._absoluteMin.x=c.x),c.y<this._absoluteMin.y&&(this._absoluteMin.y=c.y),c.z<this._absoluteMin.z&&(this._absoluteMin.z=c.z)}}addFragmentIdMap(e){const t=this.components.get(kt);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];this.addMesh(i.mesh,n)}}static getFragmentBounds(e){const t=e.geometry.attributes.position,s=Number.MAX_VALUE,i=-s,n=new U(s,s,s),r=new U(i,i,i);if(!e.geometry.index)throw new Error("Geometry must be indexed!");const o=Array.from(e.geometry.index.array);for(let a=0;a<o.length;a++){if(a%3===0&&o[a]===0&&o[a+1]===0&&o[a+2]===0){a+=2;continue}const h=o[a],c=t.getX(h),d=t.getY(h),u=t.getZ(h);c<n.x&&(n.x=c),d<n.y&&(n.y=d),u<n.z&&(n.z=u),c>r.x&&(r.x=c),d>r.y&&(r.y=d),u>r.z&&(r.z=u)}return new Qe(n,r)}};V(wE,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let mv=wE;const CE=class vE extends qt{constructor(e){super(e),V(this,"enabled",!0),V(this,"list",{}),V(this,"onDisposed",new Ue),V(this,"onFragmentsDisposed",t=>{const{groupID:s,fragmentIDs:i}=t;for(const n in this.list){const r=this.list[n],o=Object.keys(r);if(o.includes(s))delete r[s],Object.values(r).length===0&&delete this.list[n];else for(const a of o){const h=r[a];for(const c of i)delete h.map[c];Object.values(h).length===0&&delete r[a]}}}),e.add(vE.uuid,this),e.get(kt).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(kt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(e){for(const t in this.list){const s=this.list[t];for(const i in s){const n=s[i];delete n.map[e]}}}find(e){const t=this.components.get(kt);if(!e){const r={};for(const[o,a]of t.list)r[o]=new Set(a.ids);return r}const s=Object.keys(e).length,i={};for(const r in e){const o=e[r];if(!this.list[r]){console.warn(`Classification ${r} does not exist.`);continue}for(const a of o){const h=this.list[r][a];if(h)for(const c in h.map){i[c]||(i[c]=new Map);for(const d of h.map[c]){const u=i[c].get(d);u===void 0?i[c].set(d,1):i[c].set(d,u+1)}}}}const n={};for(const r in i){const o=i[r];for(const[a,h]of o){if(h===void 0)throw new Error("Malformed fragments map!");h===s&&(n[r]||(n[r]=new Set),n[r].add(a))}}return n}byModel(e,t){this.list.models||(this.list.models={});const s=this.list.models;s[e]||(s[e]={map:{},id:null,name:e});const i=s[e];for(const[n,r]of t.data){const o=r[0];for(const a of o){const h=t.keyFragments.get(a);h&&(i.map[h]||(i.map[h]=new Set),i.map[h].add(n))}}}async byPredefinedType(e){var t;this.list.predefinedTypes||(this.list.predefinedTypes={});const s=this.list.predefinedTypes,i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(!r)continue;const o=String((t=r.PredefinedType)==null?void 0:t.value).toUpperCase();s[o]||(s[o]={map:{},id:null,name:o});const a=s[o];for(const[h,c]of e.data){const d=c[0];for(const u of d){const f=e.keyFragments.get(u);if(!f)throw new Error("Fragment ID not found!");a.map[f]||(a.map[f]=new Set),a.map[f].add(r.expressID)}}}}byEntity(e){this.list.entities||(this.list.entities={});for(const[t,s]of e.data){const i=s[1][1],n=tE[i];this.saveItem(e,"entities",n,t)}}async byIfcRel(e,t,s){Mo.isRel(t)&&await Mo.getRelationMap(e,t,async(i,n)=>{const{name:r}=await Mo.getEntityName(e,i);for(const o of n)this.saveItem(e,s,r??"NO REL NAME",o)})}async bySpatialStructure(e,t={}){var s,i;const n=this.components.get(dl),r=n.relationMaps[e.uuid];if(!r)throw new Error(`Classifier: model relations of ${e.name||e.uuid} have to exists to group by spatial structure.`);const o="spatialStructures",a=t.useProperties===void 0||t.useProperties;for(const[h]of r){if(t.isolate){const f=e.data.get(h);if(!f)continue;const m=f[1][1];if(m===void 0||!t.isolate.has(m))continue}const c=n.getEntityRelations(e,h,"Decomposes");if(c)for(const f of c){let m=f.toString();if(a){const p=await e.getProperties(f);if(!p)continue;m=(s=p.Name)==null?void 0:s.value}this.saveItem(e,o,m,h,f)}const d=n.getEntityRelations(e,h,"ContainsElements");if(!d)continue;let u=h.toString();if(a){const f=await e.getProperties(h);if(!f)continue;u=(i=f.Name)==null?void 0:i.value}for(const f of d){this.saveItem(e,o,u,f,h);const m=n.getEntityRelations(e,Number(f),"IsDecomposedBy");if(m)for(const p of m)this.saveItem(e,o,u,p,h)}}}setColor(e,t,s=!1){const i=this.components.get(kt);for(const n in e){const r=i.list.get(n);if(!r)continue;const o=e[n];r.setColor(t,o,s)}}resetColor(e){const t=this.components.get(kt);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];i.resetColor(n)}}saveItem(e,t,s,i,n=null){this.list[t]||(this.list[t]={});const r=e.data.get(i);if(r)for(const o of r[0]){const a=e.keyFragments.get(o);if(a){const h=this.list[t];h[s]||(h[s]={map:{},id:n,name:s}),h[s].map[a]||(h[s].map[a]=new Set),h[s].map[a].add(i)}}}};V(CE,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let lf=CE;const gv=class _E extends qt{constructor(e){super(e),V(this,"onDisposed",new Ue),V(this,"enabled",!0),V(this,"height",10),V(this,"groupName","spatialStructures"),V(this,"list",new Set),e.add(_E.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(e){if(!this.enabled)return;const t=this.components.get(lf),s=this.components.get(kt),i=e?1:-1;let n=0;const r=t.list[this.groupName],o=new Oe;for(const a in r){o.elements[13]=n*i*this.height;for(const h in r[a].map){const c=s.list.get(h),d=a+h,u=this.list.has(d);if(!c||e&&u||!e&&!u)continue;e?this.list.add(d):this.list.delete(d);const f=r[a].map[h];c.applyTransform(f,o),c.mesh.computeBoundingSphere(),c.mesh.computeBoundingBox()}n++}}};V(gv,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");const TE=class xE extends qt{constructor(e){super(e),V(this,"enabled",!0),this.components.add(xE.uuid,this)}set(e,t){const s=this.components.get(kt);if(!t){for(const[i,n]of s.list)n&&(n.setVisibility(e),this.updateCulledVisibility(n));return}for(const i in t){const n=t[i],r=s.list.get(i);r&&(r.setVisibility(e,n),this.updateCulledVisibility(r))}}isolate(e){this.set(!1),this.set(!0,e)}updateCulledVisibility(e){const t=this.components.get(zw);for(const[s,i]of t.list){const n=i.colorMeshes.get(e.id);n&&(n.count=e.mesh.count)}}};V(TE,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let Ev=TE;class Iv extends tp{constructor(){super(...arguments),V(this,"minGeometrySize",10),V(this,"minAssetsSize",1e3)}}const bv=class AE extends qt{constructor(e){super(e),V(this,"onGeometryStreamed",new Ue),V(this,"onAssetStreamed",new Ue),V(this,"onProgress",new Ue),V(this,"onIfcLoaded",new Ue),V(this,"onDisposed",new Ue),V(this,"settings",new Iv),V(this,"enabled",!0),V(this,"webIfc",new fi),V(this,"_spatialTree",new sE),V(this,"_metaData",new nE),V(this,"_visitedGeometries",new Map),V(this,"_streamSerializer",new Qf),V(this,"_geometries",new Map),V(this,"_geometryCount",0),V(this,"_civil",new iE),V(this,"_groupSerializer",new Nc),V(this,"_assets",[]),V(this,"_meshesWithHoles",new Set),this.components.add(AE.uuid,this),this.settings.excludedCategories.add(Oc)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:e,minAssetsSize:t}=this.settings;this._spatialTree.setUp(this.webIfc);const s=this.webIfc.GetIfcEntityList(0),i=[[]],n=new ia;n.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let r=0,o=0;for(const m of s){if(!this.webIfc.IsIfcElement(m)&&m!==zs||this.settings.excludedCategories.has(m))continue;const p=this.webIfc.GetLineIDsWithType(0,m),g=p.size();for(let E=0;E<g;E++){r>e&&(r=0,o++,i.push([]));const I=p.get(E);i[o].push(I);const v=this.webIfc.GetLine(0,I);if(v.GlobalId){const C=v?.GlobalId.value||v?.GlobalId;n.globalToExpressIDs.set(C,I)}const b=this._spatialTree.itemsByFloor[I]||0;n.data.set(I,[[],[b,m]]),r++}}this._spatialTree.cleanUp();let a=.01,h=0;for(const m of i){h++,this.webIfc.StreamMeshes(0,m,g=>{this.getMesh(this.webIfc,g,n)}),this._geometryCount>e&&await this.streamGeometries(),this._assets.length>t&&await this.streamAssets();const p=h/i.length;p>a&&(a+=.01,a=Math.max(a,p),this.onProgress.trigger(Math.round(a*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:c,transparent:d}=n.geometryIDs;for(const[m,{index:p,uuid:g}]of this._visitedGeometries)n.keyFragments.set(p,g),(m>1?c:d).set(m,p);rE.get(n,this.webIfc);const u=this.webIfc.GetCoordinationMatrix(0);n.coordinationMatrix.fromArray(u),n.civilData=this._civil.read(this.webIfc);const f=this._groupSerializer.export(n);this.onIfcLoaded.trigger(f),n.dispose(!0)}cleanUp(){try{this.webIfc.Dispose()}catch{}this.webIfc=null,this.webIfc=new fi,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(e,t,s){const i=t.geometries.size(),n=t.expressID,r={id:n,geometries:[]};for(let o=0;o<i;o++){const a=t.geometries.get(o),h=a.geometryExpressID,c=a.color.w===1?1:-1,d=h*c;if(!this._visitedGeometries.has(d)){this._visitedGeometries.has(h)||this.getGeometry(e,h);const b=this._visitedGeometries.size,C=xr.generateUUID();this._visitedGeometries.set(d,{uuid:C,index:b})}const u=this._visitedGeometries.get(d);if(u===void 0)throw new Error("Error getting geometry data for streaming!");const f=s.data.get(n);if(!f)throw new Error("Data not found!");f[0].push(u.index);const{x:m,y:p,z:g,w:E}=a.color,I=[m,p,g,E],v=a.flatTransformation;r.geometries.push({color:I,geometryID:h,transformation:v})}this._assets.push(r)}getGeometry(e,t){const s=e.GetGeometry(0,t),i=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let u=0;u<n.length;u+=6)r[u/2]=n[u],r[u/2+1]=n[u+1],r[u/2+2]=n[u+2],o[u/2]=n[u+3],o[u/2+1]=n[u+4],o[u/2+2]=n[u+5];const a=Tw(r),h=new Float32Array(a.transformation.elements),c=[a.center.x,a.center.y,a.center.z];let d=!1;for(let u=0;u<r.length-2;u+=3){const f=r[u],m=r[u+1],p=r[u+2],g=o[u],E=o[u+1],I=o[u+2];if(xw(c,[f,m,p],[g,E,I])){d=!0;break}}this._geometries.set(t,{position:r,normal:o,index:i,boundingBox:h,hasHoles:d}),s.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let e=this._streamSerializer.export(this._geometries),t={};for(const[s,{boundingBox:i,hasHoles:n}]of this._geometries)t[s]={boundingBox:i,hasHoles:n};this.onGeometryStreamed.trigger({data:t,buffer:e}),t=null,e=null,this._geometries.clear(),this._geometryCount=0}};V(bv,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");class yv extends tp{constructor(){super(...arguments),V(this,"propertiesSize",100)}}class wv extends qt{constructor(){super(...arguments),V(this,"onPropertiesStreamed",new fc),V(this,"onProgress",new fc),V(this,"onIndicesStreamed",new fc),V(this,"onDisposed",new Ue),V(this,"enabled",!0),V(this,"settings",new yv),V(this,"webIfc",new fi)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:e}=this.settings,t=new Set(this.webIfc.GetIfcEntityList(0)),s=new Set([$o,ea,ta,Rr,zs]);for(const o of s)t.add(o);let i=.01,n=0;for(const o of t){if(n++,oE.has(o))continue;const a=s.has(o),h=this.webIfc.GetLineIDsWithType(0,o),c=h.size();let d=0;for(let u=0;u<c-e;u+=e){const f={};for(let m=0;m<e;m++){d++;const p=h.get(u+m);try{const g=this.webIfc.GetLine(0,p,a);f[g.expressID]=g}catch{console.log(`Could not get property: ${p}`)}}await this.onPropertiesStreamed.trigger({type:o,data:f})}if(d!==c){const u={};for(let f=d;f<c;f++){const m=h.get(f);try{const p=this.webIfc.GetLine(0,m,a);u[p.expressID]=p}catch{console.log(`Could not get property: ${m}`)}}await this.onPropertiesStreamed.trigger({type:o,data:u})}n/t.size>i&&(i=Math.round(i*100)/100,await this.onProgress.trigger(i),i+=.01)}await this.onProgress.trigger(1);const r=await this.components.get(dl).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(r)}cleanUp(){this.webIfc.Dispose(),this.webIfc=null,this.webIfc=new fi}}V(wv,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");class FE{constructor(e,t,s){V(this,"title"),V(this,"guid",Cr.create()),V(this,"clippingPlanes",new Po),V(this,"camera",{aspectRatio:0,fov:0,direction:{x:0,y:0,z:80},position:{x:0,y:0,z:0}}),V(this,"exceptionComponents",new Po),V(this,"selectionComponents",new Po),V(this,"componentColors",new Hn),V(this,"spacesVisible",!1),V(this,"spaceBoundariesVisible",!1),V(this,"openingsVisible",!1),V(this,"defaultVisibility",!0),V(this,"_components"),V(this,"world");const i={setCamera:!0,...s},{data:n,setCamera:r}=i;this._components=e,this.world=t,n&&(this.guid=n.guid??this.guid,this.set(n)),r&&this.updateCamera()}get _selectionModelIdMap(){const e=this._components.get(kt),t={};for(const[s,i]of e.groups){s in t||(t[s]=new Set);for(const n of this.selectionComponents){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return t}get _exceptionModelIdMap(){const e=this._components.get(kt),t={};for(const[s,i]of e.groups){s in t||(t[s]=new Set);for(const n of this.exceptionComponents){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return t}get selection(){return this._components.get(kt).modelIdToFragmentIdMap(this._selectionModelIdMap)}get exception(){return this._components.get(kt).modelIdToFragmentIdMap(this._exceptionModelIdMap)}get projection(){return"fov"in this.camera?"Perspective":"Orthographic"}get position(){const e=this._components.get(kt),{position:t}=this.camera,{x:s,y:i,z:n}=t,r=new U(s,i,n);return e.applyBaseCoordinateSystem(r,new Oe),r}get direction(){const{direction:e}=this.camera,{x:t,y:s,z:i}=e;return new U(t,s,i)}get _managerVersion(){return this._components.get(Ss).config.version}get topics(){return[...this._components.get(Ss).list.values()].filter(e=>e.viewpoints.has(this.guid))}async addComponentsFromMap(e){var t;const s=this._components.get(kt);for(const i in e){const n=s.list.get(i);if(!(n&&n.group))continue;const r=n.group,o=e[i];for(const a of o){const h=await r.getProperties(a);if(!h)continue;const c=(t=h.GlobalId)==null?void 0:t.value;c&&this.selectionComponents.add(c)}}this._components.get(cn).list.set(this.guid,this)}set(e){const t=e,s=this;for(const i in e){if(i==="guid")continue;const n=t[i];i in this&&(s[i]=n)}return this._components.get(cn).list.set(this.guid,this),this}async go(e=!0){const{camera:t}=this.world;if(!t.hasCameraControls())throw new Error("Viewpoint: the world's camera need controls to set the viewpoint.");t instanceof iC&&t.projection.set(this.projection);const s=this.position,i=this.direction;let n={x:s.x+i.x*80,y:s.y+i.y*80,z:s.z+i.z*80};const r=this.selection;if(Object.keys(r).length===0){const a=this._components.get($d).get(this.world).castRayFromVector(s,this.direction);a&&(n=a.point)}else{const a=this._components.get(mv);a.reset(),a.addFragmentIdMap(r),n=a.getSphere().center,a.reset()}const o=this._components.get(Ev);o.set(this.defaultVisibility),o.set(!this.defaultVisibility,this.exception),o.set(!0,r),await t.controls.setLookAt(s.x,s.y,s.z,n.x,n.y,n.z,e)}updateCamera(){const{camera:e,renderer:t}=this.world;if(!t)throw new Error("Viewpoint: the world needs to have a renderer!");if(!e.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const s=new U;e.controls.getPosition(s);const i=e.three,n=new U(0,0,-1).applyEuler(i.rotation),{width:r,height:o}=t.getSize();let a=r/o;Number.isNaN(a)&&(a=1);const h=this._components.get(kt);s.applyMatrix4(h.baseCoordinationMatrix.clone().invert());const c={aspectRatio:a,position:{x:s.x,y:s.y,z:s.z},direction:{x:n.x,y:n.y,z:n.z}};i instanceof Sc?this.camera={...c,fov:i.fov}:i instanceof gi&&(this.camera={...c,viewToWorldScale:i.top-i.bottom}),this._components.get(cn).list.set(this.guid,this)}colorize(){const e=this._components.get(cn),t=this._components.get(kt),s=this._components.get(lf);for(const[i,n]of this.componentColors){const r=t.guidToFragmentIdMap(n),o=new mt(`#${i}`);s.setColor(r,o,e.config.overwriteColors)}}resetColors(){const e=this._components.get(kt),t=this._components.get(lf);for(const[s,i]of this.componentColors){const n=e.guidToFragmentIdMap(i);t.resetColor(n)}}async createComponentTags(e){var t,s;const i=this._components.get(kt),n=this._components.get(Ss);let r="";if(n.config.includeSelectionTag){const o=e==="selection"?this._selectionModelIdMap:this._exceptionModelIdMap;for(const a in o){const h=i.groups.get(a);if(!h)continue;const c=o[a];for(const d of c){const u=await h.getProperties(d);if(!u)continue;const f=(t=u.GlobalId)==null?void 0:t.value;if(!f)continue;const m=(s=u.Tag)==null?void 0:s.value;let p=null;m&&(p=`AuthoringToolId="${m}"`),r+=`
<Component IfcGuid="${f}" ${p??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}async serialize(e=this._managerVersion){const t=this._components.get(kt),s=this.position;s.applyMatrix4(t.baseCoordinationMatrix.clone().invert());const i=this.direction;i.normalize();const n=new Oe().makeRotationX(Math.PI/2),r=i.clone().applyMatrix4(n);r.normalize();const o=`<CameraViewPoint>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraViewPoint>`,a=`<CameraDirection>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraDirection>`,h=`<CameraUpVector>
      <X>${r.x}</X>
      <Y>${-r.z}</Y>
      <Z>${r.y}</Z>
    </CameraUpVector>`,c=`<AspectRatio>${this.camera.aspectRatio}</AspectRatio>`;let d="";"viewToWorld"in this.camera?d=`<OrthogonalCamera>
        ${o}
        ${a}
        ${h}
        ${c}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(d=`<PerspectiveCamera>
        ${o}
        ${a}
        ${h}
        ${c}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const u=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,f=(await this.createComponentTags("selection")).trim(),m=(await this.createComponentTags("exception")).trim();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${e==="2.1"?u:""}
        ${f.length!==0?`<Selection>${f}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${e==="3"?u:""}
          ${m.length!==0?`<Exceptions>${m}</Exceptions>`:""}
        </Visibility>
      </Components>
      ${d}
    </VisualizationInfo>`}}const RE=class SE extends qt{constructor(e){super(e),V(this,"enabled",!0),V(this,"list",new Hn),V(this,"isSetup",!1),V(this,"onSetup",new Ue),V(this,"config",{overwriteColors:!1}),V(this,"onDisposed",new Ue),e.add(SE.uuid,this)}create(e,t){const s=new FE(this.components,e,{data:t});return t||this.list.set(s.guid,s),s}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};V(RE,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let cn=RE;class Cv{constructor(e){if(V(this,"onDisposed",new Ue),V(this,"onAfterUpdate",new Ue),V(this,"onBeforeUpdate",new Ue),V(this,"onResize",new Ue),V(this,"frontOffset",0),V(this,"overrideMaterial",new Gf),V(this,"backgroundColor",new mt(395274)),V(this,"renderer"),V(this,"enabled",!0),V(this,"world"),V(this,"_lockRotation",!0),V(this,"_camera"),V(this,"_plane"),V(this,"_size",new lt(320,160)),V(this,"_tempVector1",new U),V(this,"_tempVector2",new U),V(this,"_tempTarget",new U),V(this,"down",new U(0,-1,0)),V(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");const i=[],n=this.world.renderer.three;for(const r of n.clippingPlanes)i.push(r);i.push(this._plane),this.renderer.clippingPlanes=i}),this.world=e,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new Lo,this.renderer.setSize(this._size.x,this._size.y);const t=1,s=this._size.x/this._size.y;this._camera=new gi(t*s/-2,t*s/2,t/2,t/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new _s(this.down,200),this.updatePlanes()}get lockRotation(){return this._lockRotation}set lockRotation(e){this._lockRotation=e,e&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(e){this._camera.zoom=e,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();const e=this.world.scene.three,t=this.world.camera;if(!t.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(e instanceof Zi))throw new Error("The given world must have a THREE.Scene as a root!");const s=t.controls;if(s.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(s.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){s.getTarget(this._tempTarget);const n=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=n+Math.PI}this._plane.set(this.down,this._tempVector1.y);const i=e.background;e.background=this.backgroundColor,this.renderer.render(e,this._camera),e.background=i,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(e=this._size){this._size.copy(e),this.renderer.setSize(e.x,e.y);const t=e.x/e.y,s=1;this._camera.left=s*t/-2,this._camera.right=s*t/2,this._camera.top=s/2,this._camera.bottom=-1/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(e)}}const vv=class OE extends qt{constructor(e){super(e),V(this,"onAfterUpdate",new Ue),V(this,"onBeforeUpdate",new Ue),V(this,"onDisposed",new Ue),V(this,"enabled",!0),V(this,"list",new Map),this.components.add(OE.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a minimap!");const t=new Cv(e);return this.list.set(e.uuid,t),t}delete(e){const t=this.list.get(e);t&&t.dispose(),this.list.delete(e)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(const[e,t]of this.list)t.update()}};V(vv,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");const _v=class PE extends qt{constructor(e){super(e),V(this,"enabled",!0),e.add(PE.uuid,this)}static distanceFromPointToLine(e,t,s,i=!1){const n=new Et,r=new U;return n.set(t,s),n.closestPointToPoint(e,i,r),r.distanceTo(e)}getFace(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=new Map,n=e.geometry.index.array,{plane:r}=this.getFaceData(t,s,e),o=[];for(let d=0;d<n.length/3;d++){const{plane:u,edges:f}=this.getFaceData(d,s,e);if(u.equals(r)){o.push({index:d,edges:f});for(const{id:m,points:p,distance:g}of f)i.set(m,{points:p,distance:g})}}let a=0;const h=new Map,c=new Map;for(const{index:d,edges:u}of o){const f=new Map;for(const{id:b}of u)if(h.has(b)){const C=h.get(b);f.set(b,C)}const m=u.map(b=>b.id);if(!f.size){const b=a++;for(const{id:C}of u)h.set(C,b);c.set(b,{edges:new Set(m),indices:new Set([d])});continue}let p=null;const g=new Set,E=new Set(m);for(const[b,C]of f){p===null?p=C:C!==p&&g.add(C),h.delete(b);const{edges:F}=c.get(C);F.delete(b),E.delete(b)}if(p===null)throw new Error("Error computing face!");const I=c.get(p),{indices:v}=I;v.add(d);for(const b of E){h.set(b,p);const{edges:C}=I;C.add(b)}for(const b of g){const C=c.get(b),{edges:F,indices:A}=C,R=c.get(p),{edges:O,indices:L}=R;for(const k of F)O.add(k),h.set(k,p);for(const k of A)L.add(k);c.delete(b)}}for(const[d,{indices:u,edges:f}]of c)if(u.has(t)){const m=[];for(const p of f){const g=i.get(p);m.push(g)}return{edges:m,indices:u}}return null}getVerticesAndNormal(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=e.geometry.index.array,n=e.geometry.attributes.position.array,r=e.geometry.attributes.normal.array,o=i[t*3]*3,a=i[t*3+1]*3,h=i[t*3+2]*3,c=new U(n[o],n[o+1],n[o+2]),d=new U(n[a],n[a+1],n[a+2]),u=new U(n[h],n[h+1],n[h+2]),f=new U(r[o],r[o+1],r[o+2]),m=new U(r[a],r[a+1],r[a+2]),p=new U(r[h],r[h+1],r[h+2]),g=(f.x+m.x+p.x)/3,E=(f.y+m.y+p.y)/3,I=(f.z+m.z+p.z)/3,v=new U(g,E,I);if(s!==void 0&&e instanceof ss){const b=new Oe;e.getMatrixAt(s,b);const C=new Oe;C.extractRotation(b),v.applyMatrix4(C),c.applyMatrix4(b),d.applyMatrix4(b),u.applyMatrix4(b)}return{p1:c,p2:d,p3:u,faceNormal:v}}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}getVolumeFromFragments(e){const t=this.components.get(kt),s=new Oe,i=[];for(const r in e){const o=t.list.get(r);if(!o)continue;const a=e[r];let h=0;for(const u of a){const f=o.getInstancesIDs(u);f&&(h+=f.size)}const c=new ss(o.mesh.geometry,void 0,h);let d=0;for(const u of a){const f=o.getInstancesIDs(u);if(f)for(const m of f)o.mesh.getMatrixAt(m,s),c.setMatrixAt(d++,s)}i.push(c)}const n=this.getVolumeFromMeshes(i);for(const r of i)r.geometry=null,r.material=[],r.dispose();return n}getVolumeFromMeshes(e){let t=0;for(const s of e)t+=this.getVolumeOfMesh(s);return t}getFaceData(e,t,s){const i=this.getVerticesAndNormal(s,e,t),{p1:n,p2:r,p3:o,faceNormal:a}=i;this.round(n),this.round(r),this.round(o),this.round(a);const h=[{id:`${n.x}|${n.y}|${n.z}`,value:n},{id:`${r.x}|${r.y}|${r.z}`,value:r},{id:`${o.x}|${o.y}|${o.z}`,value:o}];h.sort((I,v)=>I.id<v.id?-1:I.id>v.id?1:0);const[{id:c,value:d},{id:u,value:f},{id:m,value:p}]=h,g=[{id:`${c}|${u}`,distance:d.distanceTo(f),points:[d,f]},{id:`${u}|${m}`,distance:f.distanceTo(p),points:[f,p]},{id:`${c}|${m}`,distance:d.distanceTo(p),points:[d,p]}],E=new _s;return E.setFromNormalAndCoplanarPoint(a,n),E.constant=Math.round(E.constant*10)/10,{plane:E,edges:g}}getVolumeOfMesh(e){let t=0;const s=new U,i=new U,n=new U,{index:r}=e.geometry,o=e.geometry.attributes.position.array;if(!r)return console.warn("Geometry must be indexed to compute its volume!"),0;const a=[];if(e instanceof ss)for(let c=0;c<e.count;c++){const d=new Oe;e.getMatrixAt(c,d),a.push(d)}else a.push(new Oe().identity());const{matrixWorld:h}=e;for(let c=0;c<r.array.length-2;c+=3)for(const d of a){const u=d.multiply(h),f=r.array[c]*3,m=r.array[c+1]*3,p=r.array[c+2]*3;s.set(o[f],o[f+1],o[f+2]).applyMatrix4(u),i.set(o[m],o[m+1],o[m+2]).applyMatrix4(u),n.set(o[p],o[p+1],o[p+2]).applyMatrix4(u),t+=this.getSignedVolumeOfTriangle(s,i,n)}return Math.abs(t)}getSignedVolumeOfTriangle(e,t,s){const i=s.x*t.y*e.z,n=t.x*s.y*e.z,r=s.x*e.y*t.z,o=e.x*s.y*t.z,a=t.x*e.y*s.z,h=e.x*t.y*s.z;return 1/6*(-i+n+r-o-a+h)}};V(_v,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");var Tv=Object.defineProperty,xv=(l,e,t)=>e in l?Tv(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,Y=(l,e,t)=>(xv(l,typeof e!="symbol"?e+"":e,t),t),Av=Object.defineProperty,Fv=(l,e,t)=>e in l?Av(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,z=(l,e,t)=>(Fv(l,typeof e!="symbol"?e+"":e,t),t);const ME=0,Rv=1,Sv=2,sg=2,id=1.25,ig=1,Ec=6*4+4+4,kc=65535,Ov=Math.pow(2,-24),nd=Symbol("SKIP_GENERATION");function Pv(l){return l.index?l.index.count:l.attributes.position.count}function ra(l){return Pv(l)/3}function Mv(l,e=ArrayBuffer){return l>65535?new Uint32Array(new e(4*l)):new Uint16Array(new e(2*l))}function Nv(l,e){if(!l.index){const t=l.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=Mv(t,s);l.setIndex(new Rt(i,1));for(let n=0;n<t;n++)i[n]=n}}function NE(l){const e=ra(l),t=l.drawRange,s=t.start/3,i=(t.start+t.count)/3,n=Math.max(0,s),r=Math.min(e,i)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function DE(l){if(!l.groups||!l.groups.length)return NE(l);const e=[],t=new Set,s=l.drawRange,i=s.start/3,n=(s.start+s.count)/3;for(const o of l.groups){const a=o.start/3,h=(o.start+o.count)/3;t.add(Math.max(i,a)),t.add(Math.min(n,h))}const r=Array.from(t.values()).sort((o,a)=>o-a);for(let o=0;o<r.length-1;o++){const a=r[o],h=r[o+1];e.push({offset:Math.floor(a),count:Math.floor(h-a)})}return e}function Dv(l){if(l.groups.length===0)return!1;const e=ra(l),t=DE(l).sort((n,r)=>n.offset-r.offset),s=t[t.length-1];s.count=Math.min(e-s.offset,s.count);let i=0;return t.forEach(({count:n})=>i+=n),e!==i}function Gt(l,e,t){return t.min.x=e[l],t.min.y=e[l+1],t.min.z=e[l+2],t.max.x=e[l+3],t.max.y=e[l+4],t.max.z=e[l+5],t}function Lv(l){l[0]=l[1]=l[2]=1/0,l[3]=l[4]=l[5]=-1/0}function ng(l){let e=-1,t=-1/0;for(let s=0;s<3;s++){const i=l[s+3]-l[s];i>t&&(t=i,e=s)}return e}function rg(l,e){e.set(l)}function og(l,e,t){let s,i;for(let n=0;n<3;n++){const r=n+3;s=l[n],i=e[n],t[n]=s<i?s:i,s=l[r],i=e[r],t[r]=s>i?s:i}}function Rh(l,e,t){for(let s=0;s<3;s++){const i=e[l+2*s],n=e[l+2*s+1],r=i-n,o=i+n;r<t[s]&&(t[s]=r),o>t[s+3]&&(t[s+3]=o)}}function Ba(l){const e=l[3]-l[0],t=l[4]-l[1],s=l[5]-l[2];return 2*(e*t+t*s+s*e)}function rd(l,e,t,s,i=null){let n=1/0,r=1/0,o=1/0,a=-1/0,h=-1/0,c=-1/0,d=1/0,u=1/0,f=1/0,m=-1/0,p=-1/0,g=-1/0;const E=i!==null;for(let I=e*6,v=(e+t)*6;I<v;I+=6){const b=l[I+0],C=l[I+1],F=b-C,A=b+C;F<n&&(n=F),A>a&&(a=A),E&&b<d&&(d=b),E&&b>m&&(m=b);const R=l[I+2],O=l[I+3],L=R-O,k=R+O;L<r&&(r=L),k>h&&(h=k),E&&R<u&&(u=R),E&&R>p&&(p=R);const x=l[I+4],M=l[I+5],w=x-M,G=x+M;w<o&&(o=w),G>c&&(c=G),E&&x<f&&(f=x),E&&x>g&&(g=x)}s[0]=n,s[1]=r,s[2]=o,s[3]=a,s[4]=h,s[5]=c,E&&(i[0]=d,i[1]=u,i[2]=f,i[3]=m,i[4]=p,i[5]=g)}function Uv(l,e,t,s){let i=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,h=-1/0;for(let c=e*6,d=(e+t)*6;c<d;c+=6){const u=l[c+0];u<i&&(i=u),u>o&&(o=u);const f=l[c+2];f<n&&(n=f),f>a&&(a=f);const m=l[c+4];m<r&&(r=m),m>h&&(h=m)}s[0]=i,s[1]=n,s[2]=r,s[3]=o,s[4]=a,s[5]=h}function Bv(l,e){Lv(e);const t=l.attributes.position,s=l.index?l.index.array:null,i=ra(l),n=new Float32Array(i*6),r=t.normalized,o=t.array,a=t.offset||0;let h=3;t.isInterleavedBufferAttribute&&(h=t.data.stride);const c=["getX","getY","getZ"];for(let d=0;d<i;d++){const u=d*3,f=d*6;let m=u+0,p=u+1,g=u+2;s&&(m=s[m],p=s[p],g=s[g]),r||(m=m*h+a,p=p*h+a,g=g*h+a);for(let E=0;E<3;E++){let I,v,b;r?(I=t[c[E]](m),v=t[c[E]](p),b=t[c[E]](g)):(I=o[m+E],v=o[p+E],b=o[g+E]);let C=I;v<C&&(C=v),b<C&&(C=b);let F=I;v>F&&(F=v),b>F&&(F=b);const A=(F-C)/2,R=E*2;n[f+R+0]=C+A,n[f+R+1]=A+(Math.abs(C)+A)*Ov,C<e[E]&&(e[E]=C),F>e[E+3]&&(e[E+3]=F)}}return n}const rn=32,zv=(l,e)=>l.candidate-e.candidate,xn=new Array(rn).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Sh=new Float32Array(6);function kv(l,e,t,s,i,n){let r=-1,o=0;if(n===ME)r=ng(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(n===Rv)r=ng(l),r!==-1&&(o=Vv(t,s,i,r));else if(n===Sv){const a=Ba(l);let h=id*i;const c=s*6,d=(s+i)*6;for(let u=0;u<3;u++){const f=e[u],m=(e[u+3]-f)/rn;if(i<rn/4){const p=[...xn];p.length=i;let g=0;for(let I=c;I<d;I+=6,g++){const v=p[g];v.candidate=t[I+2*u],v.count=0;const{bounds:b,leftCacheBounds:C,rightCacheBounds:F}=v;for(let A=0;A<3;A++)F[A]=1/0,F[A+3]=-1/0,C[A]=1/0,C[A+3]=-1/0,b[A]=1/0,b[A+3]=-1/0;Rh(I,t,b)}p.sort(zv);let E=i;for(let I=0;I<E;I++){const v=p[I];for(;I+1<E&&p[I+1].candidate===v.candidate;)p.splice(I+1,1),E--}for(let I=c;I<d;I+=6){const v=t[I+2*u];for(let b=0;b<E;b++){const C=p[b];v>=C.candidate?Rh(I,t,C.rightCacheBounds):(Rh(I,t,C.leftCacheBounds),C.count++)}}for(let I=0;I<E;I++){const v=p[I],b=v.count,C=i-v.count,F=v.leftCacheBounds,A=v.rightCacheBounds;let R=0;b!==0&&(R=Ba(F)/a);let O=0;C!==0&&(O=Ba(A)/a);const L=ig+id*(R*b+O*C);L<h&&(r=u,h=L,o=v.candidate)}}else{for(let E=0;E<rn;E++){const I=xn[E];I.count=0,I.candidate=f+m+E*m;const v=I.bounds;for(let b=0;b<3;b++)v[b]=1/0,v[b+3]=-1/0}for(let E=c;E<d;E+=6){let I=~~((t[E+2*u]-f)/m);I>=rn&&(I=rn-1);const v=xn[I];v.count++,Rh(E,t,v.bounds)}const p=xn[rn-1];rg(p.bounds,p.rightCacheBounds);for(let E=rn-2;E>=0;E--){const I=xn[E],v=xn[E+1];og(I.bounds,v.rightCacheBounds,I.rightCacheBounds)}let g=0;for(let E=0;E<rn-1;E++){const I=xn[E],v=I.count,b=I.bounds,C=xn[E+1].rightCacheBounds;v!==0&&(g===0?rg(b,Sh):og(b,Sh,Sh)),g+=v;let F=0,A=0;g!==0&&(F=Ba(Sh)/a);const R=i-g;R!==0&&(A=Ba(C)/a);const O=ig+id*(F*g+A*R);O<h&&(r=u,h=O,o=I.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function Vv(l,e,t,s){let i=0;for(let n=e,r=e+t;n<r;n++)i+=l[n*6+s*2];return i/t}class Oh{constructor(){}}function Yv(l,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,h=n.axis*2;for(;;){for(;r<=o&&t[r*6+h]<a;)r++;for(;r<=o&&t[o*6+h]>=a;)o--;if(r<o){for(let c=0;c<3;c++){let d=e[r*3+c];e[r*3+c]=e[o*3+c],e[o*3+c]=d}for(let c=0;c<6;c++){let d=t[r*6+c];t[r*6+c]=t[o*6+c],t[o*6+c]=d}r++,o--}else return r}}function Gv(l,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,h=n.axis*2;for(;;){for(;r<=o&&t[r*6+h]<a;)r++;for(;r<=o&&t[o*6+h]>=a;)o--;if(r<o){let c=l[r];l[r]=l[o],l[o]=c;for(let d=0;d<6;d++){let u=t[r*6+d];t[r*6+d]=t[o*6+d],t[o*6+d]=u}r++,o--}else return r}}function Hv(l,e){const t=(l.index?l.index.count:l.attributes.position.count)/3,s=t>2**16,i=s?4:2,n=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=s?new Uint32Array(n):new Uint16Array(n);for(let o=0,a=r.length;o<a;o++)r[o]=o;return r}function Wv(l,e){const t=l.geometry,s=t.index?t.index.array:null,i=e.maxDepth,n=e.verbose,r=e.maxLeafTris,o=e.strategy,a=e.onProgress,h=ra(t),c=l._indirectBuffer;let d=!1;const u=new Float32Array(6),f=new Float32Array(6),m=Bv(t,u),p=e.indirect?Gv:Yv,g=[],E=e.indirect?NE(t):DE(t);if(E.length===1){const b=E[0],C=new Oh;C.boundingData=u,Uv(m,b.offset,b.count,f),v(C,b.offset,b.count,f),g.push(C)}else for(let b of E){const C=new Oh;C.boundingData=new Float32Array(6),rd(m,b.offset,b.count,C.boundingData,f),v(C,b.offset,b.count,f),g.push(C)}return g;function I(b){a&&a(b/h)}function v(b,C,F,A=null,R=0){if(!d&&R>=i&&(d=!0,n&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),F<=r||R>=i)return I(C+F),b.offset=C,b.count=F,b;const O=kv(b.boundingData,A,m,C,F,o);if(O.axis===-1)return I(C+F),b.offset=C,b.count=F,b;const L=p(c,s,m,C,F,O);if(L===C||L===C+F)I(C+F),b.offset=C,b.count=F;else{b.splitAxis=O.axis;const k=new Oh,x=C,M=L-C;b.left=k,k.boundingData=new Float32Array(6),rd(m,x,M,k.boundingData,f),v(k,x,M,f,R+1);const w=new Oh,G=L,J=F-M;b.right=w,w.boundingData=new Float32Array(6),rd(m,G,J,w.boundingData,f),v(w,G,J,f,R+1)}return b}}function jv(l,e){const t=l.geometry;e.indirect&&(l._indirectBuffer=Hv(t,e.useSharedArrayBuffer),Dv(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),l._indirectBuffer||Nv(t,e);const s=Wv(l,e);let i,n,r;const o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<s.length;d++){const u=s[d];let f=h(u);const m=new a(Ec*f);i=new Float32Array(m),n=new Uint32Array(m),r=new Uint16Array(m),c(0,u),o.push(m)}l._roots=o;return;function h(d){return d.count?1:1+h(d.left)+h(d.right)}function c(d,u){const f=d/4,m=d/2,p=!!u.count,g=u.boundingData;for(let E=0;E<6;E++)i[f+E]=g[E];if(p){const E=u.offset,I=u.count;return n[f+6]=E,r[m+14]=I,r[m+15]=kc,d+Ec}else{const E=u.left,I=u.right,v=u.splitAxis;let b;if(b=c(d+Ec,E),b/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[f+6]=b/4,b=c(b,I),n[f+7]=v,b}}}class pn{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const o=e[n][t];s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}setFromPoints(e,t){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=e.dot(o);s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}pn.prototype.setFromBox=function(){const l=new U;return function(e,t){const s=t.min,i=t.max;let n=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let a=0;a<=1;a++)for(let h=0;h<=1;h++){l.x=s.x*o+i.x*(1-o),l.y=s.y*a+i.y*(1-a),l.z=s.z*h+i.z*(1-h);const c=e.dot(l);n=Math.min(c,n),r=Math.max(c,r)}this.min=n,this.max=r}}();const Zv=function(){const l=new U,e=new U,t=new U;return function(s,i,n){const r=s.start,o=l,a=i.start,h=e;t.subVectors(r,a),l.subVectors(s.end,s.start),e.subVectors(i.end,i.start);const c=t.dot(h),d=h.dot(o),u=h.dot(h),f=t.dot(o),m=o.dot(o)*u-d*d;let p,g;m!==0?p=(c*d-f*u)/m:p=0,g=(c+p*d)/u,n.x=p,n.y=g}}(),np=function(){const l=new lt,e=new U,t=new U;return function(s,i,n,r){Zv(s,i,l);let o=l.x,a=l.y;if(o>=0&&o<=1&&a>=0&&a<=1){s.at(o,n),i.at(a,r);return}else if(o>=0&&o<=1){a<0?i.at(0,r):i.at(1,r),s.closestPointToPoint(r,!0,n);return}else if(a>=0&&a<=1){o<0?s.at(0,n):s.at(1,n),i.closestPointToPoint(n,!0,r);return}else{let h;o<0?h=s.start:h=s.end;let c;a<0?c=i.start:c=i.end;const d=e,u=t;if(s.closestPointToPoint(c,!0,e),i.closestPointToPoint(h,!0,t),d.distanceToSquared(c)<=u.distanceToSquared(h)){n.copy(d),r.copy(c);return}else{n.copy(h),r.copy(u);return}}}}(),Xv=function(){const l=new U,e=new U,t=new _s,s=new Et;return function(i,n){const{radius:r,center:o}=i,{a,b:h,c}=n;if(s.start=a,s.end=h,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r||(s.start=a,s.end=c,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r)||(s.start=h,s.end=c,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r))return!0;const d=n.getPlane(t);if(Math.abs(d.distanceToPoint(o))<=r){const u=d.projectPoint(o,e);if(n.containsPoint(u))return!0}return!1}}(),Kv=1e-15;function od(l){return Math.abs(l)<Kv}class Ai extends cs{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new U),this.satBounds=new Array(4).fill().map(()=>new pn),this.points=[this.a,this.b,this.c],this.sphere=new pi,this.plane=new _s,this.needsUpdate=!0}intersectsSphere(e){return Xv(e,this)}update(){const e=this.a,t=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const h=n[1],c=r[1];h.subVectors(e,t),c.setFromPoints(h,i);const d=n[2],u=r[2];d.subVectors(t,s),u.setFromPoints(d,i);const f=n[3],m=r[3];f.subVectors(s,e),m.setFromPoints(f,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}Ai.prototype.closestPointToSegment=function(){const l=new U,e=new U,t=new Et;return function(s,i=null,n=null){const{start:r,end:o}=s,a=this.points;let h,c=1/0;for(let d=0;d<3;d++){const u=(d+1)%3;t.start.copy(a[d]),t.end.copy(a[u]),np(t,s,l,e),h=l.distanceToSquared(e),h<c&&(c=h,i&&i.copy(l),n&&n.copy(e))}return this.closestPointToPoint(r,l),h=r.distanceToSquared(l),h<c&&(c=h,i&&i.copy(l),n&&n.copy(r)),this.closestPointToPoint(o,l),h=o.distanceToSquared(l),h<c&&(c=h,i&&i.copy(l),n&&n.copy(o)),Math.sqrt(c)}}();Ai.prototype.intersectsTriangle=function(){const l=new Ai,e=new Array(3),t=new Array(3),s=new pn,i=new pn,n=new U,r=new U,o=new U,a=new U,h=new U,c=new Et,d=new Et,u=new Et,f=new U;function m(p,g,E){const I=p.points;let v=0,b=-1;for(let C=0;C<3;C++){const{start:F,end:A}=c;F.copy(I[C]),A.copy(I[(C+1)%3]),c.delta(r);const R=od(g.distanceToPoint(F));if(od(g.normal.dot(r))&&R){E.copy(c),v=2;break}const O=g.intersectLine(c,f);if(!O&&R&&f.copy(F),(O||R)&&!od(f.distanceTo(A))){if(v<=1)(v===1?E.start:E.end).copy(f),R&&(b=v);else if(v>=2){(b===1?E.start:E.end).copy(f),v=2;break}if(v++,v===2&&b===-1)break}}return v}return function(p,g=null,E=!1){this.needsUpdate&&this.update(),p.isExtendedTriangle?p.needsUpdate&&p.update():(l.copy(p),l.update(),p=l);const I=this.plane,v=p.plane;if(Math.abs(I.normal.dot(v.normal))>1-1e-10){const b=this.satBounds,C=this.satAxes;t[0]=p.a,t[1]=p.b,t[2]=p.c;for(let R=0;R<4;R++){const O=b[R],L=C[R];if(s.setFromPoints(L,t),O.isSeparated(s))return!1}const F=p.satBounds,A=p.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let R=0;R<4;R++){const O=F[R],L=A[R];if(s.setFromPoints(L,e),O.isSeparated(s))return!1}for(let R=0;R<4;R++){const O=C[R];for(let L=0;L<4;L++){const k=A[L];if(n.crossVectors(O,k),s.setFromPoints(n,e),i.setFromPoints(n,t),s.isSeparated(i))return!1}}return g&&(E||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}else{const b=m(this,v,d);if(b===1&&p.containsPoint(d.end))return g&&(g.start.copy(d.end),g.end.copy(d.end)),!0;if(b!==2)return!1;const C=m(p,I,u);if(C===1&&this.containsPoint(u.end))return g&&(g.start.copy(u.end),g.end.copy(u.end)),!0;if(C!==2)return!1;if(d.delta(o),u.delta(a),o.dot(a)<0){let x=u.start;u.start=u.end,u.end=x}const F=d.start.dot(o),A=d.end.dot(o),R=u.start.dot(o),O=u.end.dot(o),L=A<R,k=F<O;return F!==O&&R!==A&&L===k?!1:(g&&(h.subVectors(d.start,u.start),h.dot(o)>0?g.start.copy(d.start):g.start.copy(u.start),h.subVectors(d.end,u.end),h.dot(o)<0?g.end.copy(d.end):g.end.copy(u.end)),!0)}}}();Ai.prototype.distanceToPoint=function(){const l=new U;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();Ai.prototype.distanceToTriangle=function(){const l=new U,e=new U,t=["a","b","c"],s=new Et,i=new Et;return function(n,r=null,o=null){const a=r||o?s:null;if(this.intersectsTriangle(n,a))return(r||o)&&(r&&a.getCenter(r),o&&a.getCenter(o)),0;let h=1/0;for(let c=0;c<3;c++){let d;const u=t[c],f=n[u];this.closestPointToPoint(f,l),d=f.distanceToSquared(l),d<h&&(h=d,r&&r.copy(l),o&&o.copy(f));const m=this[u];n.closestPointToPoint(m,l),d=m.distanceToSquared(l),d<h&&(h=d,r&&r.copy(m),o&&o.copy(l))}for(let c=0;c<3;c++){const d=t[c],u=t[(c+1)%3];s.set(this[d],this[u]);for(let f=0;f<3;f++){const m=t[f],p=t[(f+1)%3];i.set(n[m],n[p]),np(s,i,l,e);const g=l.distanceToSquared(e);g<h&&(h=g,r&&r.copy(l),o&&o.copy(e))}}return Math.sqrt(h)}}();class Ns{constructor(e,t,s){this.isOrientedBox=!0,this.min=new U,this.max=new U,this.matrix=new Oe,this.invMatrix=new Oe,this.points=new Array(8).fill().map(()=>new U),this.satAxes=new Array(3).fill().map(()=>new U),this.satBounds=new Array(3).fill().map(()=>new pn),this.alignedSatBounds=new Array(3).fill().map(()=>new pn),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,s){this.min.copy(e),this.max.copy(t),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Ns.prototype.update=function(){return function(){const l=this.matrix,e=this.min,t=this.max,s=this.points;for(let a=0;a<=1;a++)for(let h=0;h<=1;h++)for(let c=0;c<=1;c++){const d=1*a|2*h|4*c,u=s[d];u.x=a?t.x:e.x,u.y=h?t.y:e.y,u.z=c?t.z:e.z,u.applyMatrix4(l)}const i=this.satBounds,n=this.satAxes,r=s[0];for(let a=0;a<3;a++){const h=n[a],c=i[a],d=1<<a,u=s[d];h.subVectors(r,u),c.setFromPoints(h,s)}const o=this.alignedSatBounds;o[0].setFromPointsField(s,"x"),o[1].setFromPointsField(s,"y"),o[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Ns.prototype.intersectsBox=function(){const l=new pn;return function(e){this.needsUpdate&&this.update();const t=e.min,s=e.max,i=this.satBounds,n=this.satAxes,r=this.alignedSatBounds;if(l.min=t.x,l.max=s.x,r[0].isSeparated(l)||(l.min=t.y,l.max=s.y,r[1].isSeparated(l))||(l.min=t.z,l.max=s.z,r[2].isSeparated(l)))return!1;for(let o=0;o<3;o++){const a=n[o],h=i[o];if(l.setFromBox(a,e),h.isSeparated(l))return!1}return!0}}();Ns.prototype.intersectsTriangle=function(){const l=new Ai,e=new Array(3),t=new pn,s=new pn,i=new U;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(l.copy(n),l.update(),n=l);const r=this.satBounds,o=this.satAxes;e[0]=n.a,e[1]=n.b,e[2]=n.c;for(let d=0;d<3;d++){const u=r[d],f=o[d];if(t.setFromPoints(f,e),u.isSeparated(t))return!1}const a=n.satBounds,h=n.satAxes,c=this.points;for(let d=0;d<3;d++){const u=a[d],f=h[d];if(t.setFromPoints(f,c),u.isSeparated(t))return!1}for(let d=0;d<3;d++){const u=o[d];for(let f=0;f<4;f++){const m=h[f];if(i.crossVectors(u,m),t.setFromPoints(i,e),s.setFromPoints(i,c),t.isSeparated(s))return!1}}return!0}}();Ns.prototype.closestPointToPoint=function(){return function(l,e){return this.needsUpdate&&this.update(),e.copy(l).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();Ns.prototype.distanceToPoint=function(){const l=new U;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();Ns.prototype.distanceToBox=function(){const l=["x","y","z"],e=new Array(12).fill().map(()=>new Et),t=new Array(12).fill().map(()=>new Et),s=new U,i=new U;return function(n,r=0,o=null,a=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(o||a)&&(n.getCenter(i),this.closestPointToPoint(i,s),n.closestPointToPoint(s,i),o&&o.copy(s),a&&a.copy(i)),0;const h=r*r,c=n.min,d=n.max,u=this.points;let f=1/0;for(let p=0;p<8;p++){const g=u[p];i.copy(g).clamp(c,d);const E=g.distanceToSquared(i);if(E<f&&(f=E,o&&o.copy(g),a&&a.copy(i),E<h))return Math.sqrt(E)}let m=0;for(let p=0;p<3;p++)for(let g=0;g<=1;g++)for(let E=0;E<=1;E++){const I=(p+1)%3,v=(p+2)%3,b=g<<I|E<<v,C=1<<p|g<<I|E<<v,F=u[b],A=u[C];e[m].set(F,A);const R=l[p],O=l[I],L=l[v],k=t[m],x=k.start,M=k.end;x[R]=c[R],x[O]=g?c[O]:d[O],x[L]=E?c[L]:d[O],M[R]=d[R],M[O]=g?c[O]:d[O],M[L]=E?c[L]:d[O],m++}for(let p=0;p<=1;p++)for(let g=0;g<=1;g++)for(let E=0;E<=1;E++){i.x=p?d.x:c.x,i.y=g?d.y:c.y,i.z=E?d.z:c.z,this.closestPointToPoint(i,s);const I=i.distanceToSquared(s);if(I<f&&(f=I,o&&o.copy(s),a&&a.copy(i),I<h))return Math.sqrt(I)}for(let p=0;p<12;p++){const g=e[p];for(let E=0;E<12;E++){const I=t[E];np(g,I,s,i);const v=s.distanceToSquared(i);if(v<f&&(f=v,o&&o.copy(s),a&&a.copy(i),v<h))return Math.sqrt(v)}}return Math.sqrt(f)}}();class rp{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class Qv extends rp{constructor(){super(()=>new Ai)}}const li=new Qv;function Hs(l,e){return e[l+15]===65535}function Zs(l,e){return e[l+6]}function hi(l,e){return e[l+14]}function ci(l){return l+8}function ui(l,e){return e[l+6]}function LE(l,e){return e[l+7]}class qv{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=s=>{t&&e.push(t),t=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Lt=new qv;let zn,So;const ao=[],Ph=new rp(()=>new Qe);function Jv(l,e,t,s,i,n){zn=Ph.getPrimitive(),So=Ph.getPrimitive(),ao.push(zn,So),Lt.setBuffer(l._roots[e]);const r=hf(0,l.geometry,t,s,i,n);Lt.clearBuffer(),Ph.releasePrimitive(zn),Ph.releasePrimitive(So),ao.pop(),ao.pop();const o=ao.length;return o>0&&(So=ao[o-1],zn=ao[o-2]),r}function hf(l,e,t,s,i=null,n=0,r=0){const{float32Array:o,uint16Array:a,uint32Array:h}=Lt;let c=l*2;if(Hs(c,a)){const d=Zs(l,h),u=hi(c,a);return Gt(l,o,zn),s(d,u,!1,r,n+l,zn)}else{let d=function(k){const{uint16Array:x,uint32Array:M}=Lt;let w=k*2;for(;!Hs(w,x);)k=ci(k),w=k*2;return Zs(k,M)},u=function(k){const{uint16Array:x,uint32Array:M}=Lt;let w=k*2;for(;!Hs(w,x);)k=ui(k,M),w=k*2;return Zs(k,M)+hi(w,x)};const f=ci(l),m=ui(l,h);let p=f,g=m,E,I,v,b;if(i&&(v=zn,b=So,Gt(p,o,v),Gt(g,o,b),E=i(v),I=i(b),I<E)){p=m,g=f;const k=E;E=I,I=k,v=b}v||(v=zn,Gt(p,o,v));const C=Hs(p*2,a),F=t(v,C,E,r+1,n+p);let A;if(F===sg){const k=d(p),x=u(p)-k;A=s(k,x,!0,r+1,n+p,v)}else A=F&&hf(p,e,t,s,i,n,r+1);if(A)return!0;b=So,Gt(g,o,b);const R=Hs(g*2,a),O=t(b,R,I,r+1,n+g);let L;if(O===sg){const k=d(g),x=u(g)-k;L=s(k,x,!0,r+1,n+g,b)}else L=O&&hf(g,e,t,s,i,n,r+1);return!!L}}const za=new U,ad=new U;function $v(l,e,t={},s=0,i=1/0){const n=s*s,r=i*i;let o=1/0,a=null;if(l.shapecast({boundsTraverseOrder:c=>(za.copy(e).clamp(c.min,c.max),za.distanceToSquared(e)),intersectsBounds:(c,d,u)=>u<o&&u<r,intersectsTriangle:(c,d)=>{c.closestPointToPoint(e,za);const u=e.distanceToSquared(za);return u<o&&(ad.copy(za),o=u,a=d),u<n}}),o===1/0)return null;const h=Math.sqrt(o);return t.point?t.point.copy(ad):t.point=ad.clone(),t.distance=h,t.faceIndex=a,t}const lo=new U,ho=new U,co=new U,Mh=new lt,Nh=new lt,Dh=new lt,ag=new U,lg=new U,hg=new U,Lh=new U;function e_(l,e,t,s,i,n){let r;return n===kf?r=l.intersectTriangle(s,t,e,!0,i):r=l.intersectTriangle(e,t,s,n!==Fi,i),r===null?null:{distance:l.origin.distanceTo(i),point:i.clone()}}function t_(l,e,t,s,i,n,r,o,a){lo.fromBufferAttribute(e,n),ho.fromBufferAttribute(e,r),co.fromBufferAttribute(e,o);const h=e_(l,lo,ho,co,Lh,a);if(h){s&&(Mh.fromBufferAttribute(s,n),Nh.fromBufferAttribute(s,r),Dh.fromBufferAttribute(s,o),h.uv=cs.getInterpolation(Lh,lo,ho,co,Mh,Nh,Dh,new lt)),i&&(Mh.fromBufferAttribute(i,n),Nh.fromBufferAttribute(i,r),Dh.fromBufferAttribute(i,o),h.uv1=cs.getInterpolation(Lh,lo,ho,co,Mh,Nh,Dh,new lt)),t&&(ag.fromBufferAttribute(t,n),lg.fromBufferAttribute(t,r),hg.fromBufferAttribute(t,o),h.normal=cs.getInterpolation(Lh,lo,ho,co,ag,lg,hg,new U),h.normal.dot(l.direction)>0&&h.normal.multiplyScalar(-1));const c={a:n,b:r,c:o,normal:new U,materialIndex:0};cs.getNormal(lo,ho,co,c.normal),h.face=c,h.faceIndex=n}return h}function Vc(l,e,t,s,i){const n=s*3;let r=n+0,o=n+1,a=n+2;const h=l.index;l.index&&(r=h.getX(r),o=h.getX(o),a=h.getX(a));const{position:c,normal:d,uv:u,uv1:f}=l.attributes,m=t_(t,c,d,u,f,r,o,a,e);return m?(m.faceIndex=s,i&&i.push(m),m):null}function ts(l,e,t,s){const i=l.a,n=l.b,r=l.c;let o=e,a=e+1,h=e+2;t&&(o=t.getX(o),a=t.getX(a),h=t.getX(h)),i.x=s.getX(o),i.y=s.getY(o),i.z=s.getZ(o),n.x=s.getX(a),n.y=s.getY(a),n.z=s.getZ(a),r.x=s.getX(h),r.y=s.getY(h),r.z=s.getZ(h)}function s_(l,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=s,h=s+i;a<h;a++)Vc(r,e,t,a,n)}function i_(l,e,t,s,i){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let h=s,c=s+i;h<c;h++){let d;d=Vc(n,e,t,h),d&&d.distance<o&&(a=d,o=d.distance)}return a}function n_(l,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,h=o.attributes.position;for(let c=l,d=e+l;c<d;c++){let u;if(u=c,ts(r,u*3,a,h),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}function r_(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,h=0;const c=l._roots;for(let u=0,f=c.length;u<f;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),d(0,h),h+=n.byteLength;function d(u,f,m=!1){const p=u*2;if(o[p+15]===kc){const g=r[u+6],E=o[p+14];let I=1/0,v=1/0,b=1/0,C=-1/0,F=-1/0,A=-1/0;for(let R=3*g,O=3*(g+E);R<O;R++){let L=s[R];const k=i.getX(L),x=i.getY(L),M=i.getZ(L);k<I&&(I=k),k>C&&(C=k),x<v&&(v=x),x>F&&(F=x),M<b&&(b=M),M>A&&(A=M)}return a[u+0]!==I||a[u+1]!==v||a[u+2]!==b||a[u+3]!==C||a[u+4]!==F||a[u+5]!==A?(a[u+0]=I,a[u+1]=v,a[u+2]=b,a[u+3]=C,a[u+4]=F,a[u+5]=A,!0):!1}else{const g=u+8,E=r[u+6],I=g+f,v=E+f;let b=m,C=!1,F=!1;e?b||(C=e.has(I),F=e.has(v),b=!C&&!F):(C=!0,F=!0);const A=b||C,R=b||F;let O=!1;A&&(O=d(g,f,b));let L=!1;R&&(L=d(E,f,b));const k=O||L;if(k)for(let x=0;x<3;x++){const M=g+x,w=E+x,G=a[M],J=a[M+3],Z=a[w],le=a[w+3];a[u+x]=G<Z?G:Z,a[u+x+3]=J>le?J:le}return k}}}const cg=new Qe;function Wn(l,e,t,s){return Gt(l,e,cg),t.intersectBox(cg,s)}function o_(l,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=s,h=s+i;a<h;a++){let c=o?o[a]:a;Vc(r,e,t,c,n)}}function a_(l,e,t,s,i){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let h=s,c=s+i;h<c;h++){let d;d=Vc(n,e,t,r?r[h]:h),d&&d.distance<o&&(a=d,o=d.distance)}return a}function l_(l,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,h=o.attributes.position;for(let c=l,d=e+l;c<d;c++){let u;if(u=t.resolveTriangleIndex(c),ts(r,u*3,a,h),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}const ug=new U;function h_(l,e,t,s,i){Lt.setBuffer(l._roots[e]),cf(0,l,t,s,i),Lt.clearBuffer()}function cf(l,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Lt,a=l*2;if(Hs(a,r)){const h=Zs(l,o),c=hi(a,r);s_(e,t,s,h,c,i)}else{const h=ci(l);Wn(h,n,s,ug)&&cf(h,e,t,s,i);const c=ui(l,o);Wn(c,n,s,ug)&&cf(c,e,t,s,i)}}const dg=new U,c_=["x","y","z"];function u_(l,e,t,s){Lt.setBuffer(l._roots[e]);const i=uf(0,l,t,s);return Lt.clearBuffer(),i}function uf(l,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=Lt;let o=l*2;if(Hs(o,n)){const a=Zs(l,r),h=hi(o,n);return i_(e,t,s,a,h)}else{const a=LE(l,r),h=c_[a],c=s.direction[h]>=0;let d,u;c?(d=ci(l),u=ui(l,r)):(d=ui(l,r),u=ci(l));const f=Wn(d,i,s,dg)?uf(d,e,t,s):null;if(f){const p=f.point[h];if(c?p<=i[u+a]:p>=i[u+a+3])return f}const m=Wn(u,i,s,dg)?uf(u,e,t,s):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}const Uh=new Qe,uo=new Ai,fo=new Ai,ka=new Oe,fg=new Ns,Bh=new Ns;function d_(l,e,t,s){Lt.setBuffer(l._roots[e]);const i=df(0,l,t,s);return Lt.clearBuffer(),i}function df(l,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=Lt;let a=l*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),fg.set(t.boundingBox.min,t.boundingBox.max,s),i=fg),Hs(a,r)){const h=e.geometry,c=h.index,d=h.attributes.position,u=t.index,f=t.attributes.position,m=Zs(l,o),p=hi(a,r);if(ka.copy(s).invert(),t.boundsTree)return Gt(l,n,Bh),Bh.matrix.copy(ka),Bh.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>Bh.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(s),g.b.applyMatrix4(s),g.c.applyMatrix4(s),g.needsUpdate=!0;for(let E=m*3,I=(p+m)*3;E<I;E+=3)if(ts(fo,E,c,d),fo.needsUpdate=!0,g.intersectsTriangle(fo))return!0;return!1}});for(let g=m*3,E=(p+m)*3;g<E;g+=3){ts(uo,g,c,d),uo.a.applyMatrix4(ka),uo.b.applyMatrix4(ka),uo.c.applyMatrix4(ka),uo.needsUpdate=!0;for(let I=0,v=u.count;I<v;I+=3)if(ts(fo,I,u,f),fo.needsUpdate=!0,uo.intersectsTriangle(fo))return!0}}else{const h=l+8,c=o[l+6];return Gt(h,n,Uh),!!(i.intersectsBox(Uh)&&df(h,e,t,s,i)||(Gt(c,n,Uh),i.intersectsBox(Uh)&&df(c,e,t,s,i)))}}const zh=new Oe,ld=new Ns,Va=new Ns,f_=new U,p_=new U,m_=new U,g_=new U;function E_(l,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),ld.set(e.boundingBox.min,e.boundingBox.max,t),ld.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,h=o.index,c=e.attributes.position,d=e.index,u=li.getPrimitive(),f=li.getPrimitive();let m=f_,p=p_,g=null,E=null;i&&(g=m_,E=g_);let I=1/0,v=null,b=null;return zh.copy(t).invert(),Va.matrix.copy(zh),l.shapecast({boundsTraverseOrder:C=>ld.distanceToBox(C),intersectsBounds:(C,F,A)=>A<I&&A<r?(F&&(Va.min.copy(C.min),Va.max.copy(C.max),Va.needsUpdate=!0),!0):!1,intersectsRange:(C,F)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:A=>Va.distanceToBox(A),intersectsBounds:(A,R,O)=>O<I&&O<r,intersectsRange:(A,R)=>{for(let O=A,L=A+R;O<L;O++){ts(f,3*O,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let k=C,x=C+F;k<x;k++){ts(u,3*k,h,a),u.needsUpdate=!0;const M=u.distanceToTriangle(f,m,g);if(M<I&&(p.copy(m),E&&E.copy(g),I=M,v=k,b=O),M<n)return!0}}}});{const A=ra(e);for(let R=0,O=A;R<O;R++){ts(f,3*R,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let L=C,k=C+F;L<k;L++){ts(u,3*L,h,a),u.needsUpdate=!0;const x=u.distanceToTriangle(f,m,g);if(x<I&&(p.copy(m),E&&E.copy(g),I=x,v=L,b=R),x<n)return!0}}}}}),li.releasePrimitive(u),li.releasePrimitive(f),I===1/0?null:(s.point?s.point.copy(p):s.point=p.clone(),s.distance=I,s.faceIndex=v,i&&(i.point?i.point.copy(E):i.point=E.clone(),i.point.applyMatrix4(zh),p.applyMatrix4(zh),i.distance=p.sub(i.point).length(),i.faceIndex=b),s)}function I_(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,h=0;const c=l._roots;for(let u=0,f=c.length;u<f;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),d(0,h),h+=n.byteLength;function d(u,f,m=!1){const p=u*2;if(o[p+15]===kc){const g=r[u+6],E=o[p+14];let I=1/0,v=1/0,b=1/0,C=-1/0,F=-1/0,A=-1/0;for(let R=g,O=g+E;R<O;R++){const L=3*l.resolveTriangleIndex(R);for(let k=0;k<3;k++){let x=L+k;x=s?s[x]:x;const M=i.getX(x),w=i.getY(x),G=i.getZ(x);M<I&&(I=M),M>C&&(C=M),w<v&&(v=w),w>F&&(F=w),G<b&&(b=G),G>A&&(A=G)}}return a[u+0]!==I||a[u+1]!==v||a[u+2]!==b||a[u+3]!==C||a[u+4]!==F||a[u+5]!==A?(a[u+0]=I,a[u+1]=v,a[u+2]=b,a[u+3]=C,a[u+4]=F,a[u+5]=A,!0):!1}else{const g=u+8,E=r[u+6],I=g+f,v=E+f;let b=m,C=!1,F=!1;e?b||(C=e.has(I),F=e.has(v),b=!C&&!F):(C=!0,F=!0);const A=b||C,R=b||F;let O=!1;A&&(O=d(g,f,b));let L=!1;R&&(L=d(E,f,b));const k=O||L;if(k)for(let x=0;x<3;x++){const M=g+x,w=E+x,G=a[M],J=a[M+3],Z=a[w],le=a[w+3];a[u+x]=G<Z?G:Z,a[u+x+3]=J>le?J:le}return k}}}const pg=new U;function b_(l,e,t,s,i){Lt.setBuffer(l._roots[e]),ff(0,l,t,s,i),Lt.clearBuffer()}function ff(l,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Lt,a=l*2;if(Hs(a,r)){const h=Zs(l,o),c=hi(a,r);o_(e,t,s,h,c,i)}else{const h=ci(l);Wn(h,n,s,pg)&&ff(h,e,t,s,i);const c=ui(l,o);Wn(c,n,s,pg)&&ff(c,e,t,s,i)}}const mg=new U,y_=["x","y","z"];function w_(l,e,t,s){Lt.setBuffer(l._roots[e]);const i=pf(0,l,t,s);return Lt.clearBuffer(),i}function pf(l,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=Lt;let o=l*2;if(Hs(o,n)){const a=Zs(l,r),h=hi(o,n);return a_(e,t,s,a,h)}else{const a=LE(l,r),h=y_[a],c=s.direction[h]>=0;let d,u;c?(d=ci(l),u=ui(l,r)):(d=ui(l,r),u=ci(l));const f=Wn(d,i,s,mg)?pf(d,e,t,s):null;if(f){const p=f.point[h];if(c?p<=i[u+a]:p>=i[u+a+3])return f}const m=Wn(u,i,s,mg)?pf(u,e,t,s):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}const kh=new Qe,po=new Ai,mo=new Ai,Ya=new Oe,gg=new Ns,Vh=new Ns;function C_(l,e,t,s){Lt.setBuffer(l._roots[e]);const i=mf(0,l,t,s);return Lt.clearBuffer(),i}function mf(l,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=Lt;let a=l*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),gg.set(t.boundingBox.min,t.boundingBox.max,s),i=gg),Hs(a,r)){const h=e.geometry,c=h.index,d=h.attributes.position,u=t.index,f=t.attributes.position,m=Zs(l,o),p=hi(a,r);if(Ya.copy(s).invert(),t.boundsTree)return Gt(l,n,Vh),Vh.matrix.copy(Ya),Vh.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>Vh.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(s),g.b.applyMatrix4(s),g.c.applyMatrix4(s),g.needsUpdate=!0;for(let E=m,I=p+m;E<I;E++)if(ts(mo,3*e.resolveTriangleIndex(E),c,d),mo.needsUpdate=!0,g.intersectsTriangle(mo))return!0;return!1}});for(let g=m,E=p+m;g<E;g++){const I=e.resolveTriangleIndex(g);ts(po,3*I,c,d),po.a.applyMatrix4(Ya),po.b.applyMatrix4(Ya),po.c.applyMatrix4(Ya),po.needsUpdate=!0;for(let v=0,b=u.count;v<b;v+=3)if(ts(mo,v,u,f),mo.needsUpdate=!0,po.intersectsTriangle(mo))return!0}}else{const h=l+8,c=o[l+6];return Gt(h,n,kh),!!(i.intersectsBox(kh)&&mf(h,e,t,s,i)||(Gt(c,n,kh),i.intersectsBox(kh)&&mf(c,e,t,s,i)))}}const Yh=new Oe,hd=new Ns,Ga=new Ns,v_=new U,__=new U,T_=new U,x_=new U;function A_(l,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),hd.set(e.boundingBox.min,e.boundingBox.max,t),hd.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,h=o.index,c=e.attributes.position,d=e.index,u=li.getPrimitive(),f=li.getPrimitive();let m=v_,p=__,g=null,E=null;i&&(g=T_,E=x_);let I=1/0,v=null,b=null;return Yh.copy(t).invert(),Ga.matrix.copy(Yh),l.shapecast({boundsTraverseOrder:C=>hd.distanceToBox(C),intersectsBounds:(C,F,A)=>A<I&&A<r?(F&&(Ga.min.copy(C.min),Ga.max.copy(C.max),Ga.needsUpdate=!0),!0):!1,intersectsRange:(C,F)=>{if(e.boundsTree){const A=e.boundsTree;return A.shapecast({boundsTraverseOrder:R=>Ga.distanceToBox(R),intersectsBounds:(R,O,L)=>L<I&&L<r,intersectsRange:(R,O)=>{for(let L=R,k=R+O;L<k;L++){const x=A.resolveTriangleIndex(L);ts(f,3*x,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let M=C,w=C+F;M<w;M++){const G=l.resolveTriangleIndex(M);ts(u,3*G,h,a),u.needsUpdate=!0;const J=u.distanceToTriangle(f,m,g);if(J<I&&(p.copy(m),E&&E.copy(g),I=J,v=M,b=L),J<n)return!0}}}})}else{const A=ra(e);for(let R=0,O=A;R<O;R++){ts(f,3*R,d,c),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let L=C,k=C+F;L<k;L++){const x=l.resolveTriangleIndex(L);ts(u,3*x,h,a),u.needsUpdate=!0;const M=u.distanceToTriangle(f,m,g);if(M<I&&(p.copy(m),E&&E.copy(g),I=M,v=L,b=R),M<n)return!0}}}}}),li.releasePrimitive(u),li.releasePrimitive(f),I===1/0?null:(s.point?s.point.copy(p):s.point=p.clone(),s.distance=I,s.faceIndex=v,i&&(i.point?i.point.copy(E):i.point=E.clone(),i.point.applyMatrix4(Yh),p.applyMatrix4(Yh),i.distance=p.sub(i.point).length(),i.faceIndex=b),s)}function F_(){return typeof SharedArrayBuffer<"u"}const ol=new Lt.constructor,Tc=new Lt.constructor,Dn=new rp(()=>new Qe),go=new Qe,Eo=new Qe,cd=new Qe,ud=new Qe;let dd=!1;function R_(l,e,t,s){if(dd)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");dd=!0;const i=l._roots,n=e._roots;let r,o=0,a=0;const h=new Oe().copy(t).invert();for(let c=0,d=i.length;c<d;c++){ol.setBuffer(i[c]),a=0;const u=Dn.getPrimitive();Gt(0,ol.float32Array,u),u.applyMatrix4(h);for(let f=0,m=n.length;f<m&&(Tc.setBuffer(n[c]),r=wi(0,0,t,h,s,o,a,0,0,u),Tc.clearBuffer(),a+=n[f].length,!r);f++);if(Dn.releasePrimitive(u),ol.clearBuffer(),o+=i[c].length,r)break}return dd=!1,r}function wi(l,e,t,s,i,n=0,r=0,o=0,a=0,h=null,c=!1){let d,u;c?(d=Tc,u=ol):(d=ol,u=Tc);const f=d.float32Array,m=d.uint32Array,p=d.uint16Array,g=u.float32Array,E=u.uint32Array,I=u.uint16Array,v=l*2,b=e*2,C=Hs(v,p),F=Hs(b,I);let A=!1;if(F&&C)c?A=i(Zs(e,E),hi(e*2,I),Zs(l,m),hi(l*2,p),a,r+e,o,n+l):A=i(Zs(l,m),hi(l*2,p),Zs(e,E),hi(e*2,I),o,n+l,a,r+e);else if(F){const R=Dn.getPrimitive();Gt(e,g,R),R.applyMatrix4(t);const O=ci(l),L=ui(l,m);Gt(O,f,go),Gt(L,f,Eo);const k=R.intersectsBox(go),x=R.intersectsBox(Eo);A=k&&wi(e,O,s,t,i,r,n,a,o+1,R,!c)||x&&wi(e,L,s,t,i,r,n,a,o+1,R,!c),Dn.releasePrimitive(R)}else{const R=ci(e),O=ui(e,E);Gt(R,g,cd),Gt(O,g,ud);const L=h.intersectsBox(cd),k=h.intersectsBox(ud);if(L&&k)A=wi(l,R,t,s,i,n,r,o,a+1,h,c)||wi(l,O,t,s,i,n,r,o,a+1,h,c);else if(L)if(C)A=wi(l,R,t,s,i,n,r,o,a+1,h,c);else{const x=Dn.getPrimitive();x.copy(cd).applyMatrix4(t);const M=ci(l),w=ui(l,m);Gt(M,f,go),Gt(w,f,Eo);const G=x.intersectsBox(go),J=x.intersectsBox(Eo);A=G&&wi(R,M,s,t,i,r,n,a,o+1,x,!c)||J&&wi(R,w,s,t,i,r,n,a,o+1,x,!c),Dn.releasePrimitive(x)}else if(k)if(C)A=wi(l,O,t,s,i,n,r,o,a+1,h,c);else{const x=Dn.getPrimitive();x.copy(ud).applyMatrix4(t);const M=ci(l),w=ui(l,m);Gt(M,f,go),Gt(w,f,Eo);const G=x.intersectsBox(go),J=x.intersectsBox(Eo);A=G&&wi(O,M,s,t,i,r,n,a,o+1,x,!c)||J&&wi(O,w,s,t,i,r,n,a,o+1,x,!c),Dn.releasePrimitive(x)}}return A}const Gh=new Ns,Eg=new Qe;class op{static serialize(e,t={}){t={cloneBuffers:!0,...t};const s=e.geometry,i=e._roots,n=e._indirectBuffer,r=s.getIndex();let o;return t.cloneBuffers?o={roots:i.map(a=>a.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:i,index:r.array,indirectBuffer:n},o}static deserialize(e,t,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:i,roots:n,indirectBuffer:r}=e,o=new op(t,{...s,[nd]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const a=t.getIndex();if(a===null){const h=new Rt(e.index,1,!1);t.setIndex(h)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:ME,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[nd]:!1},t),t.useSharedArrayBuffer&&!F_())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[nd]||(jv(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Qe)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=t.indirect?i=>s[i]:i=>i}refit(e=null){return(this.indirect?I_:r_)(this,e)}traverse(e,t=0){const s=this._roots[t],i=new Uint32Array(s),n=new Uint16Array(s);r(0);function r(o,a=0){const h=o*2,c=n[h+15]===kc;if(c){const d=i[o+6],u=n[h+14];e(a,c,new Float32Array(s,o*4,6),d,u)}else{const d=o+Ec/4,u=i[o+6],f=i[o+7];e(a,c,new Float32Array(s,o*4,6),f)||(r(d,a+1),r(u,a+1))}}}raycast(e,t=Do){const s=this._roots,i=this.geometry,n=[],r=t.isMaterial,o=Array.isArray(t),a=i.groups,h=r?t.side:t,c=this.indirect?b_:h_;for(let d=0,u=s.length;d<u;d++){const f=o?t[a[d].materialIndex].side:h,m=n.length;if(c(this,d,f,e,n),o){const p=a[d].materialIndex;for(let g=m,E=n.length;g<E;g++)n[g].face.materialIndex=p}}return n}raycastFirst(e,t=Do){const s=this._roots,i=this.geometry,n=t.isMaterial,r=Array.isArray(t);let o=null;const a=i.groups,h=n?t.side:t,c=this.indirect?w_:u_;for(let d=0,u=s.length;d<u;d++){const f=r?t[a[d].materialIndex].side:h,m=c(this,d,f,e);m!=null&&(o==null||m.distance<o.distance)&&(o=m,r&&(m.face.materialIndex=a[d].materialIndex))}return o}intersectsGeometry(e,t){let s=!1;const i=this._roots,n=this.indirect?C_:d_;for(let r=0,o=i.length;r<o&&(s=n(this,r,e,t),!s);r++);return s}shapecast(e){const t=li.getPrimitive(),s=this.indirect?l_:n_;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const d=r;r=(u,f,m,p,g)=>d(u,f,m,p,g)?!0:s(u,f,this,o,m,p,t)}else r||(o?r=(d,u,f,m)=>s(d,u,this,o,f,m,t):r=(d,u,f)=>f);let a=!1,h=0;const c=this._roots;for(let d=0,u=c.length;d<u;d++){const f=c[d];if(a=Jv(this,d,n,r,i,h),a)break;h+=f.byteLength}return li.releasePrimitive(t),a}bvhcast(e,t,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=li.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,h=this.indirect?m=>{const p=this.resolveTriangleIndex(m);ts(r,p*3,o,a)}:m=>{ts(r,m*3,o,a)},c=li.getPrimitive(),d=e.geometry.index,u=e.geometry.attributes.position,f=e.indirect?m=>{const p=e.resolveTriangleIndex(m);ts(c,p*3,d,u)}:m=>{ts(c,m*3,d,u)};if(n){const m=(p,g,E,I,v,b,C,F)=>{for(let A=E,R=E+I;A<R;A++){f(A),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let O=p,L=p+g;O<L;O++)if(h(O),r.needsUpdate=!0,n(r,c,O,A,v,b,C,F))return!0}return!1};if(i){const p=i;i=function(g,E,I,v,b,C,F,A){return p(g,E,I,v,b,C,F,A)?!0:m(g,E,I,v,b,C,F,A)}}else i=m}return R_(this,e,t,i)}intersectsBox(e,t){return Gh.set(e.min,e.max,t),Gh.needsUpdate=!0,this.shapecast({intersectsBounds:s=>Gh.intersectsBox(s),intersectsTriangle:s=>Gh.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,s={},i={},n=0,r=1/0){return(this.indirect?A_:E_)(this,e,t,s,i,n,r)}closestPointToPoint(e,t={},s=0,i=1/0){return $v(this,e,t,s,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Gt(0,new Float32Array(t),Eg),e.union(Eg)}),e}}function Ig(l,e,t){return l===null||(l.point.applyMatrix4(e.matrixWorld),l.distance=l.point.distanceTo(t.ray.origin),l.object=e,l.distance<t.near||l.distance>t.far)?null:l}const fd=new Vf,bg=new Oe,S_=ye.prototype.raycast;function O_(l,e){if(this.geometry.boundsTree){if(this.material===void 0)return;bg.copy(this.matrixWorld).invert(),fd.copy(l.ray).applyMatrix4(bg);const t=this.geometry.boundsTree;if(l.firstHitOnly===!0){const s=Ig(t.raycastFirst(fd,this.material),this,l);s&&e.push(s)}else{const s=t.raycast(fd,this.material);for(let i=0,n=s.length;i<n;i++){const r=Ig(s[i],this,l);r&&e.push(r)}}}else S_.call(this,l,e)}function P_(l){return this.boundsTree=new op(this,l),this.boundsTree}function M_(){this.boundsTree=null}class we{constructor(){z(this,"trigger",e=>{const t=this.handlers.slice(0);for(const s of t)s(e)}),z(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class al{constructor(){z(this,"trigger",async e=>{const t=this.handlers.slice(0);for(const s of t)await s(e)}),z(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class ap{constructor(e){z(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),z(this,"isResizeable",()=>"resize"in this&&"getSize"in this),z(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),z(this,"isHideable",()=>"visible"in this),z(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=e}}class ht extends ap{}class UE extends ap{constructor(e){super(e),z(this,"worlds",new Map),z(this,"onWorldChanged",new we),z(this,"currentWorld",null),this.onWorldChanged.add(({world:t,action:s})=>{s==="removed"&&this.worlds.delete(t.uuid)})}}class N_ extends UE{constructor(){super(...arguments),z(this,"hasCameraControls",()=>"controls"in this)}}class D_ extends UE{constructor(){super(...arguments),z(this,"onAfterUpdate",new we),z(this,"onBeforeUpdate",new we),z(this,"onDisposed",new we),z(this,"onResize",new we),z(this,"onClippingPlanesUpdated",new we),z(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,t,s){t.isLocal=s;const i=this.clippingPlanes.indexOf(t);e&&i===-1?this.clippingPlanes.push(t):!e&&i>-1&&this.clippingPlanes.splice(i,1),this.three.clippingPlanes=this.clippingPlanes.filter(n=>!n.isLocal)}}const BE=class gf extends ht{constructor(e){super(e),z(this,"_disposedComponents",new Set),z(this,"enabled",!0),e.add(gf.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,s=!0){e.removeFromParent();const i=e;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(e,t),s&&i.children&&i.children.length&&this.disposeChildren(i),e.children.length=0}disposeGeometry(e){e.boundsTree&&e.disposeBoundsTree&&e.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){const s=e;s.geometry&&this.disposeGeometry(s.geometry),t&&s.material&&gf.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(e){for(const t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()}};z(BE,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let ji=BE;class No extends Set{constructor(e){super(e),z(this,"onItemAdded",new we),z(this,"onItemDeleted",new we),z(this,"onCleared",new we),z(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...e){for(const t of e)this.has(t)||!this.guard(t)||(super.add(t),this.onItemAdded||(this.onItemAdded=new we),this.onItemAdded.trigger(t));return this}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(),t}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class jn extends Map{constructor(e){super(e),z(this,"onItemSet",new we),z(this,"onItemUpdated",new we),z(this,"onItemDeleted",new we),z(this,"onCleared",new we),z(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(e,t){const s=this.has(e);if(!(this.guard??(()=>!0))(e,t))return this;const i=super.set(e,t);return s?(this.onItemUpdated||(this.onItemUpdated=new we),this.onItemUpdated.trigger({key:e,value:t})):(this.onItemSet||(this.onItemSet=new we),this.onItemSet.trigger({key:e,value:t})),i}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(e),t}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}const Ic=0,L_=1,U_=new U,yg=new Et,pd=new _s,wg=new U,Hh=new cs;class B_{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Cg,this.unassigned=new Cg,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.vertices.push(new z_(e[t]));this.compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(s){const i=s.geometry;if(i!==void 0){const n=i.attributes.position;if(n!==void 0)for(let r=0,o=n.count;r<o;r++){const a=new U;a.fromBufferAttribute(n,r).applyMatrix4(s.matrixWorld),t.push(a)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let s=0,i=t.length;s<i;s++)if(t[s].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const s=this.faces;let i=-1/0,n=1/0;for(let r=0,o=s.length;r<o;r++){const a=s[r],h=a.distanceToPoint(e.origin),c=a.normal.dot(e.direction);if(h>0&&c>=0)return null;const d=c!==0?-h/c:0;if(!(d<=0)&&(c>0?n=Math.min(d,n):i=Math.max(d,i),i>n))return null}return i!==-1/0?e.at(i,t):e.at(n,t),t}intersectsRay(e){return this.intersectRay(e,U_)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let s=e.outside;for(;s.next!==null&&s.next.face===e;)s=s.next;return this.assigned.removeSubList(t,s),t.prev=s.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const s=this.removeAllVerticesFromFace(e);if(s!==void 0)if(t===void 0)this.unassigned.appendChain(s);else{let i=s;do{const n=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=n}while(i!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const s=t.next;let i=this.tolerance,n=null;for(let r=0;r<e.length;r++){const o=e[r];if(o.mark===Ic){const a=o.distanceToPoint(t.point);if(a>i&&(i=a,n=o),i>1e3*this.tolerance)break}}n!==null&&this.addVertexToFace(t,n),t=s}while(t!==null)}return this}computeExtremes(){const e=new U,t=new U,s=[],i=[];for(let n=0;n<3;n++)s[n]=i[n]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let n=0,r=this.vertices.length;n<r;n++){const o=this.vertices[n],a=o.point;for(let h=0;h<3;h++)a.getComponent(h)<e.getComponent(h)&&(e.setComponent(h,a.getComponent(h)),s[h]=o);for(let h=0;h<3;h++)a.getComponent(h)>t.getComponent(h)&&(t.setComponent(h,a.getComponent(h)),i[h]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:s,max:i}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),s=t.min,i=t.max;let n=0,r=0;for(let u=0;u<3;u++){const f=i[u].point.getComponent(u)-s[u].point.getComponent(u);f>n&&(n=f,r=u)}const o=s[r],a=i[r];let h,c;n=0,yg.set(o.point,a.point);for(let u=0,f=this.vertices.length;u<f;u++){const m=e[u];if(m!==o&&m!==a){yg.closestPointToPoint(m.point,!0,wg);const p=wg.distanceToSquared(m.point);p>n&&(n=p,h=m)}}n=-1,pd.setFromCoplanarPoints(o.point,a.point,h.point);for(let u=0,f=this.vertices.length;u<f;u++){const m=e[u];if(m!==o&&m!==a&&m!==h){const p=Math.abs(pd.distanceToPoint(m.point));p>n&&(n=p,c=m)}}const d=[];if(pd.distanceToPoint(c.point)<0){d.push(_i.create(o,a,h),_i.create(c,a,o),_i.create(c,h,a),_i.create(c,o,h));for(let u=0;u<3;u++){const f=(u+1)%3;d[u+1].getEdge(2).setTwin(d[0].getEdge(f)),d[u+1].getEdge(1).setTwin(d[f+1].getEdge(0))}}else{d.push(_i.create(o,h,a),_i.create(c,o,a),_i.create(c,a,h),_i.create(c,h,o));for(let u=0;u<3;u++){const f=(u+1)%3;d[u+1].getEdge(2).setTwin(d[0].getEdge((3-u)%3)),d[u+1].getEdge(0).setTwin(d[f+1].getEdge(1))}}for(let u=0;u<4;u++)this.faces.push(d[u]);for(let u=0,f=e.length;u<f;u++){const m=e[u];if(m!==o&&m!==a&&m!==h&&m!==c){n=this.tolerance;let p=null;for(let g=0;g<4;g++){const E=this.faces[g].distanceToPoint(m.point);E>n&&(n=E,p=this.faces[g])}p!==null&&this.addVertexToFace(m,p)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const s=this.faces[t];s.mark===Ic&&e.push(s)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const s=this.assigned.first().face;let i=s.outside;do{const n=s.distanceToPoint(i.point);n>t&&(t=n,e=i),i=i.next}while(i!==null&&i.face===s);return e}}computeHorizon(e,t,s,i){this.deleteFaceVertices(s),s.mark=L_;let n;t===null?n=t=s.getEdge(0):n=t.next;do{const r=n.twin,o=r.face;o.mark===Ic&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,o,i):i.push(n)),n=n.next}while(n!==t);return this}addAdjoiningFace(e,t){const s=_i.create(e,t.tail(),t.head());return this.faces.push(s),s.getEdge(-1).setTwin(t.twin),s.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let s=null,i=null;for(let n=0;n<t.length;n++){const r=t[n],o=this.addAdjoiningFace(e,r);s===null?s=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return s.next.setTwin(i),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class _i{constructor(){this.normal=new U,this.midpoint=new U,this.area=0,this.constant=0,this.outside=null,this.mark=Ic,this.edge=null}static create(e,t,s){const i=new _i,n=new md(e,i),r=new md(t,i),o=new md(s,i);return n.next=o.prev=r,r.next=n.prev=o,o.next=r.prev=n,i.edge=n,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),s=this.edge.next.head();return Hh.set(e.point,t.point,s.point),Hh.getNormal(this.normal),Hh.getMidpoint(this.midpoint),this.area=Hh.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class md{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class z_{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class Cg{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}const Ef=[2,2,1],If=[1,0,0];function ki(l,e){return l*3+e}function k_(l){const e=l.elements;let t=0;for(let s=0;s<9;s++)t+=e[s]*e[s];return Math.sqrt(t)}function V_(l){const e=l.elements;let t=0;for(let s=0;s<3;s++){const i=e[ki(Ef[s],If[s])];t+=2*i*i}return Math.sqrt(t)}function Y_(l,e){let t=0,s=1;const i=l.elements;for(let h=0;h<3;h++){const c=Math.abs(i[ki(Ef[h],If[h])]);c>t&&(t=c,s=h)}let n=1,r=0;const o=If[s],a=Ef[s];if(Math.abs(i[ki(a,o)])>Number.EPSILON){const h=i[ki(a,a)],c=i[ki(o,o)],d=i[ki(a,o)],u=(h-c)/2/d;let f;u<0?f=-1/(-u+Math.sqrt(1+u*u)):f=1/(u+Math.sqrt(1+u*u)),n=1/Math.sqrt(1+f*f),r=f*n}return e.identity(),e.elements[ki(o,o)]=n,e.elements[ki(a,a)]=n,e.elements[ki(a,o)]=r,e.elements[ki(o,a)]=-r,e}function G_(l,e){let t=0,s=0;const i=10;e.unitary.identity(),e.diagonal.copy(l);const n=e.unitary,r=e.diagonal,o=new Us,a=new Us,h=Number.EPSILON*k_(r);for(;s<i&&V_(r)>h;)Y_(r,o),a.copy(o).transpose(),r.multiply(o),r.premultiply(a),n.multiply(o),++t>2&&(s++,t=0);return e}function H_(l){const e=[];for(let Se=0;Se<l.length-2;Se+=3){const _e=l[Se],Le=l[Se+1],Ge=l[Se+2];e.push(new U(_e,Le,Ge))}const t=new B_;t.setFromPoints(e);const s={unitary:new Us,diagonal:new Us},i=t.faces,n=[],r=[];for(let Se=0,_e=i.length;Se<_e;Se++){const Le=i[Se];let Ge=Le.edge;n.length=0;do n.push(Ge),Ge=Ge.next;while(Ge!==Le.edge);const Ze=n.length-2;for(let $e=1,_=Ze;$e<=_;$e++){const $=n[0].vertex,Q=n[$e+0].vertex,N=n[$e+1].vertex;r.push($.point.x,$.point.y,$.point.z),r.push(Q.point.x,Q.point.y,Q.point.z),r.push(N.point.x,N.point.y,N.point.z)}}const o=new U,a=new U,h=new U,c=new U,d=new U,u=new U,f=new U,m=new U;let p=0,g=0,E=0,I=0,v=0,b=0,C=0;for(let Se=0,_e=r.length;Se<_e;Se+=9){o.fromArray(r,Se),a.fromArray(r,Se+3),h.fromArray(r,Se+6),f.set(0,0,0),f.add(o).add(a).add(h).divideScalar(3),c.subVectors(a,o),d.subVectors(h,o);const Le=u.crossVectors(c,d).length()/2;m.add(u.copy(f).multiplyScalar(Le)),p+=Le,g+=(9*f.x*f.x+o.x*o.x+a.x*a.x+h.x*h.x)*(Le/12),E+=(9*f.x*f.y+o.x*o.y+a.x*a.y+h.x*h.y)*(Le/12),I+=(9*f.x*f.z+o.x*o.z+a.x*a.z+h.x*h.z)*(Le/12),v+=(9*f.y*f.y+o.y*o.y+a.y*a.y+h.y*h.y)*(Le/12),b+=(9*f.y*f.z+o.y*o.z+a.y*a.z+h.y*h.z)*(Le/12),C+=(9*f.z*f.z+o.z*o.z+a.z*a.z+h.z*h.z)*(Le/12)}m.divideScalar(p),g/=p,E/=p,I/=p,v/=p,b/=p,C/=p,g-=m.x*m.x,E-=m.x*m.y,I-=m.x*m.z,v-=m.y*m.y,b-=m.y*m.z,C-=m.z*m.z;const F=new Us;F.elements[0]=g,F.elements[1]=E,F.elements[2]=I,F.elements[3]=E,F.elements[4]=v,F.elements[5]=b,F.elements[6]=I,F.elements[7]=b,F.elements[8]=C,G_(F,s);const A=s.unitary,R=new U,O=new U,L=new U;A.extractBasis(R,O,L);let k=-1/0,x=-1/0,M=-1/0,w=1/0,G=1/0,J=1/0;for(let Se=0,_e=e.length;Se<_e;Se++){const Le=e[Se];k=Math.max(R.dot(Le),k),x=Math.max(O.dot(Le),x),M=Math.max(L.dot(Le),M),w=Math.min(R.dot(Le),w),G=Math.min(O.dot(Le),G),J=Math.min(L.dot(Le),J)}R.multiplyScalar(.5*(w+k)),O.multiplyScalar(.5*(G+x)),L.multiplyScalar(.5*(J+M));const Z=new U,le=new U,ee=new Us;Z.add(R).add(O).add(L),le.x=k-w,le.y=x-G,le.z=M-J,le.multiplyScalar(.5),ee.copy(A);const{x:xe,y:X,z:j}=le,be=new Oe;be.makeScale(xe*2,X*2,j*2);const fe=new Oe;fe.makeTranslation(-xe,-X,-j);const ue=new Oe;ue.makeTranslation(Z.x,Z.y,Z.z);const He=new Oe;He.setFromMatrix3(ee);const Xe=new Oe;return Xe.multiply(ue),Xe.multiply(He),Xe.multiply(fe),Xe.multiply(be),{center:Z,halfSizes:le,rotation:ee,transformation:Xe}}function W_(l,e,t){const s=[l[0]-e[0],l[1]-e[1],l[2]-e[2]];return t[0]*s[0]+t[1]*s[1]+t[2]*s[2]>0}class vg{static isTransparent(e){return e.transparent&&e.opacity<1}}const bf=class ls{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${ls._lut[e&255]+ls._lut[e>>8&255]+ls._lut[e>>16&255]+ls._lut[e>>24&255]}-${ls._lut[t&255]}${ls._lut[t>>8&255]}-${ls._lut[t>>16&15|64]}${ls._lut[t>>24&255]}-${ls._lut[s&63|128]}${ls._lut[s>>8&255]}-${ls._lut[s>>16&255]}${ls._lut[s>>24&255]}${ls._lut[i&255]}${ls._lut[i>>8&255]}${ls._lut[i>>16&255]}${ls._lut[i>>24&255]}`.toLowerCase()}static validate(e){if(!ls._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};z(bf,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),z(bf,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let vr=bf;class j_ extends ht{constructor(e,t){super(e),z(this,"onDisposed",new we),z(this,"onVertexFound",new we),z(this,"onVertexLost",new we),z(this,"onEnabled",new we),z(this,"components"),z(this,"workingPlane",null),z(this,"_pickedPoint",null),z(this,"_config"),z(this,"_enabled",!1),this.components=e,this.config={snapDistance:.25,showOnlyVertex:!1,...t},this.enabled=!1}set enabled(e){this._enabled=e,e||(this._pickedPoint=null),this.onEnabled.trigger(e)}get enabled(){return this._enabled}set config(e){this._config={...this._config,...e}}get config(){return this._config}dispose(){this.onVertexFound.reset(),this.onVertexLost.reset(),this.components=null,this.onDisposed.trigger(),this.onDisposed.reset()}get(e){if(!this.enabled)return this._pickedPoint;const t=this.components.get(di).get(e).castRay();if(!t)return this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint;const s=this.getClosestVertex(t);return s?!this.workingPlane||Math.abs(this.workingPlane.distanceToPoint(s))<.001?((this._pickedPoint===null||!this._pickedPoint.equals(s))&&(this._pickedPoint=s.clone(),this.onVertexFound.trigger(this._pickedPoint)),this._pickedPoint):(this._pickedPoint=null,this._pickedPoint):(this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint)}getClosestVertex(e){let t=new U,s=!1,i=Number.MAX_SAFE_INTEGER;const n=this.getVertices(e);if(n===null)return null;for(const r of n){if(!r)continue;const o=e.point.distanceTo(r);o>i||o>this._config.snapDistance||(s=!0,t=r,i=e.point.distanceTo(r))}return s?t:this.config.showOnlyVertex?null:e.point}getVertices(e){const t=e.object;if(!e.face||!t)return null;const s=t.geometry,i=new Oe,{instanceId:n}=e,r=n!==void 0,o=t instanceof ss;return o&&r&&t.getMatrixAt(n,i),[this.getVertex(e.face.a,s),this.getVertex(e.face.b,s),this.getVertex(e.face.c,s)].map(a=>(a&&(o&&r&&a.applyMatrix4(i),a.applyMatrix4(t.matrixWorld)),a))}getVertex(e,t){if(e===void 0)return null;const s=t.attributes.position;return new U(s.getX(e),s.getY(e),s.getZ(e))}}const zE=class kE{constructor(){z(this,"onDisposed",new we),z(this,"list",new Map),z(this,"enabled",!1),z(this,"_clock"),z(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(e);requestAnimationFrame(this.update)}),this._clock=new Yf,kE.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");vr.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const s=new e(this);return this.list.has(t)||this.add(t,s),s}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){ft.prototype.computeBoundsTree=P_,ft.prototype.disposeBoundsTree=M_,ye.prototype.raycast=O_}};z(zE,"release","2.2.8");let Z_=zE;class X_ extends ap{constructor(){super(...arguments),z(this,"meshes",new Set),z(this,"onAfterUpdate",new we),z(this,"onBeforeUpdate",new we),z(this,"onDisposed",new we),z(this,"isDisposing",!1),z(this,"enabled",!0),z(this,"uuid",vr.create()),z(this,"name"),z(this,"_scene"),z(this,"_camera"),z(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const t=this.components.get(ji);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)t.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}}class K_ extends D_{constructor(e,t,s){super(e),z(this,"enabled",!0),z(this,"container"),z(this,"three"),z(this,"_canvas"),z(this,"_parameters"),z(this,"_resizeObserver",null),z(this,"onContainerUpdated",new we),z(this,"_resizing",!1),z(this,"resize",r=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const o=r?r.x:this.container.clientWidth,a=r?r.y:this.container.clientHeight;this.three.setSize(o,a),this.onResize.trigger(new lt(o,a)),this._resizing=!1}),z(this,"resizeEvent",()=>{this.resize()}),z(this,"onContextLost",r=>{r.preventDefault(),this.enabled=!1}),z(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new Lo({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=t,this._parameters=s,this.three=new Lo({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const i=this.three.getContext(),{canvas:n}=i;n.addEventListener("webglcontextlost",this.onContextLost,!1),n.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.three.render(e,t),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new lt(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const t=this.three.domElement.parentElement;if(!t)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(t),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const st={LEFT:1,RIGHT:2,MIDDLE:4},Fe=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Io={NONE:0,IN:1,OUT:-1};function or(l){return l.isPerspectiveCamera}function Sn(l){return l.isOrthographicCamera}const bo=Math.PI*2,_g=Math.PI/2,VE=1e-5,Ha=Math.PI/180;function Ci(l,e,t){return Math.max(e,Math.min(t,l))}function Ot(l,e=VE){return Math.abs(l)<e}function Ct(l,e,t=VE){return Ot(l-e,t)}function Tg(l,e){return Math.round(l/e)*e}function Wa(l){return isFinite(l)?l:l<0?-Number.MAX_VALUE:Number.MAX_VALUE}function ja(l){return Math.abs(l)<Number.MAX_VALUE?l:l*(1/0)}function Wh(l,e,t,s,i=1/0,n){s=Math.max(1e-4,s);const r=2/s,o=r*n,a=1/(1+o+.48*o*o+.235*o*o*o);let h=l-e;const c=e,d=i*s;h=Ci(h,-d,d),e=l-h;const u=(t.value+r*h)*n;t.value=(t.value-r*u)*a;let f=e+(h+u)*a;return c-l>0==f>c&&(f=c,t.value=(f-c)/n),f}function xg(l,e,t,s,i=1/0,n,r){s=Math.max(1e-4,s);const o=2/s,a=o*n,h=1/(1+a+.48*a*a+.235*a*a*a);let c=e.x,d=e.y,u=e.z,f=l.x-c,m=l.y-d,p=l.z-u;const g=c,E=d,I=u,v=i*s,b=v*v,C=f*f+m*m+p*p;if(C>b){const G=Math.sqrt(C);f=f/G*v,m=m/G*v,p=p/G*v}c=l.x-f,d=l.y-m,u=l.z-p;const F=(t.x+o*f)*n,A=(t.y+o*m)*n,R=(t.z+o*p)*n;t.x=(t.x-o*F)*h,t.y=(t.y-o*A)*h,t.z=(t.z-o*R)*h,r.x=c+(f+F)*h,r.y=d+(m+A)*h,r.z=u+(p+R)*h;const O=g-l.x,L=E-l.y,k=I-l.z,x=r.x-g,M=r.y-E,w=r.z-I;return O*x+L*M+k*w>0&&(r.x=g,r.y=E,r.z=I,t.x=(r.x-g)/n,t.y=(r.y-E)/n,t.z=(r.z-I)/n),r}function gd(l,e){e.set(0,0),l.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=l.length,e.y/=l.length}function Ed(l,e){return Sn(l)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Q_{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const t=this._listeners[e.type];if(t!==void 0){e.target=this;const s=t.slice(0);for(let i=0,n=s.length;i<n;i++)s[i].call(this,e)}}}const q_="2.7.3",jh=1/8,YE=typeof window<"u",J_=YE&&/Mac/.test(navigator.platform),$_=!(YE&&"PointerEvent"in window);let Je,Ag,Zh,Id,Ls,ot,yt,yo,Za,Ni,Di,ar,Fg,Rg,Js,Xa,wo,Sg,bd,Og,yd,wd,Xh;class vs extends Q_{static install(e){Je=e.THREE,Ag=Object.freeze(new Je.Vector3(0,0,0)),Zh=Object.freeze(new Je.Vector3(0,1,0)),Id=Object.freeze(new Je.Vector3(0,0,1)),Ls=new Je.Vector2,ot=new Je.Vector3,yt=new Je.Vector3,yo=new Je.Vector3,Za=new Je.Vector3,Ni=new Je.Vector3,Di=new Je.Vector3,ar=new Je.Vector3,Fg=new Je.Vector3,Rg=new Je.Vector3,Js=new Je.Spherical,Xa=new Je.Spherical,wo=new Je.Box3,Sg=new Je.Box3,bd=new Je.Sphere,Og=new Je.Quaternion,yd=new Je.Quaternion,wd=new Je.Matrix4,Xh=new Je.Raycaster}static get ACTION(){return Fe}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=Fe.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Io.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Je.Vector3,this._focalOffsetVelocity=new Je.Vector3,this._zoomVelocity={value:0},this._truckInternal=(b,C,F)=>{let A,R;if(or(this._camera)){const O=ot.copy(this._camera.position).sub(this._target),L=this._camera.getEffectiveFOV()*Ha,k=O.length()*Math.tan(L*.5);A=this.truckSpeed*b*k/this._elementRect.height,R=this.truckSpeed*C*k/this._elementRect.height}else if(Sn(this._camera)){const O=this._camera;A=b*(O.right-O.left)/O.zoom/this._elementRect.width,R=C*(O.top-O.bottom)/O.zoom/this._elementRect.height}else return;this.verticalDragToForward?(F?this.setFocalOffset(this._focalOffsetEnd.x+A,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(A,0,!0),this.forward(-R,!0)):F?this.setFocalOffset(this._focalOffsetEnd.x+A,this._focalOffsetEnd.y+R,this._focalOffsetEnd.z,!0):this.truck(A,R,!0)},this._rotateInternal=(b,C)=>{const F=bo*this.azimuthRotateSpeed*b/this._elementRect.height,A=bo*this.polarRotateSpeed*C/this._elementRect.height;this.rotate(F,A,!0)},this._dollyInternal=(b,C,F)=>{const A=Math.pow(.95,-b*this.dollySpeed),R=this._sphericalEnd.radius,O=this._sphericalEnd.radius*A,L=Ci(O,this.minDistance,this.maxDistance),k=L-O;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(O,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(k,!0),this._dollyToNoClamp(L,!0)):this._dollyToNoClamp(L,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?O:L)-R,this._dollyControlCoord.set(C,F)),this._lastDollyDirection=Math.sign(-b)},this._zoomInternal=(b,C,F)=>{const A=Math.pow(.95,b*this.dollySpeed),R=this._zoom,O=this._zoom*A;this.zoomTo(O,!0),this.dollyToCursor&&(this._changedZoom+=O-R,this._dollyControlCoord.set(C,F))},typeof Je>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Je.Quaternion().setFromUnitVectors(this._camera.up,Zh),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=Fe.NONE,this._target=new Je.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Je.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Je.Spherical().setFromVector3(ot.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Je.Vector3,new Je.Vector3,new Je.Vector3,new Je.Vector3],this._updateNearPlaneCorners(),this._boundary=new Je.Box3(new Je.Vector3(-1/0,-1/0,-1/0),new Je.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Je.Vector2,this.mouseButtons={left:Fe.ROTATE,middle:Fe.DOLLY,right:Fe.TRUCK,wheel:or(this._camera)?Fe.DOLLY:Sn(this._camera)?Fe.ZOOM:Fe.NONE},this.touches={one:Fe.TOUCH_ROTATE,two:or(this._camera)?Fe.TOUCH_DOLLY_TRUCK:Sn(this._camera)?Fe.TOUCH_ZOOM_TRUCK:Fe.NONE,three:Fe.TOUCH_TRUCK};const s=new Je.Vector2,i=new Je.Vector2,n=new Je.Vector2,r=b=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const A=this._domElement.getBoundingClientRect(),R=b.clientX/A.width,O=b.clientY/A.height;if(R<this._interactiveArea.left||R>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}const C=b.pointerType!=="mouse"?null:(b.buttons&st.LEFT)===st.LEFT?st.LEFT:(b.buttons&st.MIDDLE)===st.MIDDLE?st.MIDDLE:(b.buttons&st.RIGHT)===st.RIGHT?st.RIGHT:null;if(C!==null){const A=this._findPointerByMouseButton(C);A&&this._disposePointer(A)}if((b.buttons&st.LEFT)===st.LEFT&&this._lockedPointer)return;const F={pointerId:b.pointerId,clientX:b.clientX,clientY:b.clientY,deltaX:0,deltaY:0,mouseButton:C};this._activePointers.push(F),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,p(b)},o=b=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const A=this._domElement.getBoundingClientRect(),R=b.clientX/A.width,O=b.clientY/A.height;if(R<this._interactiveArea.left||R>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}const C=(b.buttons&st.LEFT)===st.LEFT?st.LEFT:(b.buttons&st.MIDDLE)===st.MIDDLE?st.MIDDLE:(b.buttons&st.RIGHT)===st.RIGHT?st.RIGHT:null;if(C!==null){const A=this._findPointerByMouseButton(C);A&&this._disposePointer(A)}const F={pointerId:1,clientX:b.clientX,clientY:b.clientY,deltaX:0,deltaY:0,mouseButton:(b.buttons&st.LEFT)===st.LEFT?st.LEFT:(b.buttons&st.MIDDLE)===st.LEFT?st.MIDDLE:(b.buttons&st.RIGHT)===st.LEFT?st.RIGHT:null};this._activePointers.push(F),this._domElement.ownerDocument.removeEventListener("mousemove",h),this._domElement.ownerDocument.removeEventListener("mouseup",d),this._domElement.ownerDocument.addEventListener("mousemove",h),this._domElement.ownerDocument.addEventListener("mouseup",d),this._isDragging=!0,p(b)},a=b=>{b.cancelable&&b.preventDefault();const C=b.pointerId,F=this._lockedPointer||this._findPointerById(C);if(F){if(F.clientX=b.clientX,F.clientY=b.clientY,F.deltaX=b.movementX,F.deltaY=b.movementY,this._state=0,b.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(b.buttons&st.LEFT)===st.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(b.buttons&st.MIDDLE)===st.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(b.buttons&st.RIGHT)===st.RIGHT&&(this._state=this._state|this.mouseButtons.right);g()}},h=b=>{const C=this._lockedPointer||this._findPointerById(1);C&&(C.clientX=b.clientX,C.clientY=b.clientY,C.deltaX=b.movementX,C.deltaY=b.movementY,this._state=0,(this._lockedPointer||(b.buttons&st.LEFT)===st.LEFT)&&(this._state=this._state|this.mouseButtons.left),(b.buttons&st.MIDDLE)===st.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(b.buttons&st.RIGHT)===st.RIGHT&&(this._state=this._state|this.mouseButtons.right),g())},c=b=>{const C=this._findPointerById(b.pointerId);if(!(C&&C===this._lockedPointer)){if(C&&this._disposePointer(C),b.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=Fe.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=Fe.NONE;E()}},d=()=>{const b=this._findPointerById(1);b&&b===this._lockedPointer||(b&&this._disposePointer(b),this._state=Fe.NONE,E())};let u=-1;const f=b=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===Fe.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const O=this._domElement.getBoundingClientRect(),L=b.clientX/O.width,k=b.clientY/O.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||k<this._interactiveArea.top||k>this._interactiveArea.bottom)return}if(b.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===Fe.ROTATE||this.mouseButtons.wheel===Fe.TRUCK){const O=performance.now();u-O<1e3&&this._getClientRect(this._elementRect),u=O}const C=J_?-1:-3,F=b.deltaMode===1?b.deltaY/C:b.deltaY/(C*10),A=this.dollyToCursor?(b.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,R=this.dollyToCursor?(b.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case Fe.ROTATE:{this._rotateInternal(b.deltaX,b.deltaY),this._isUserControllingRotate=!0;break}case Fe.TRUCK:{this._truckInternal(b.deltaX,b.deltaY,!1),this._isUserControllingTruck=!0;break}case Fe.OFFSET:{this._truckInternal(b.deltaX,b.deltaY,!0),this._isUserControllingOffset=!0;break}case Fe.DOLLY:{this._dollyInternal(-F,A,R),this._isUserControllingDolly=!0;break}case Fe.ZOOM:{this._zoomInternal(-F,A,R),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},m=b=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===vs.ACTION.NONE){const C=b instanceof PointerEvent?b.pointerId:0,F=this._findPointerById(C);F&&this._disposePointer(F),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mousemove",h),this._domElement.ownerDocument.removeEventListener("mouseup",d);return}b.preventDefault()}},p=b=>{if(this._enabled){if(gd(this._activePointers,Ls),this._getClientRect(this._elementRect),s.copy(Ls),i.copy(Ls),this._activePointers.length>=2){const C=Ls.x-this._activePointers[1].clientX,F=Ls.y-this._activePointers[1].clientY,A=Math.sqrt(C*C+F*F);n.set(0,A);const R=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,O=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(R,O)}if(this._state=0,!b)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in b&&b.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(b.buttons&st.LEFT)===st.LEFT&&(this._state=this._state|this.mouseButtons.left),(b.buttons&st.MIDDLE)===st.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(b.buttons&st.RIGHT)===st.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&Fe.ROTATE)===Fe.ROTATE||(this._state&Fe.TOUCH_ROTATE)===Fe.TOUCH_ROTATE||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE||(this._state&Fe.TOUCH_ZOOM_ROTATE)===Fe.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&Fe.TRUCK)===Fe.TRUCK||(this._state&Fe.TOUCH_TRUCK)===Fe.TOUCH_TRUCK||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_ZOOM_TRUCK)===Fe.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&Fe.DOLLY)===Fe.DOLLY||(this._state&Fe.TOUCH_DOLLY)===Fe.TOUCH_DOLLY||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&Fe.ZOOM)===Fe.ZOOM||(this._state&Fe.TOUCH_ZOOM)===Fe.TOUCH_ZOOM||(this._state&Fe.TOUCH_ZOOM_TRUCK)===Fe.TOUCH_ZOOM_TRUCK||(this._state&Fe.TOUCH_ZOOM_OFFSET)===Fe.TOUCH_ZOOM_OFFSET||(this._state&Fe.TOUCH_ZOOM_ROTATE)===Fe.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&Fe.OFFSET)===Fe.OFFSET||(this._state&Fe.TOUCH_OFFSET)===Fe.TOUCH_OFFSET||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET||(this._state&Fe.TOUCH_ZOOM_OFFSET)===Fe.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},g=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,gd(this._activePointers,Ls);const b=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,C=b?-b.deltaX:i.x-Ls.x,F=b?-b.deltaY:i.y-Ls.y;if(i.copy(Ls),((this._state&Fe.ROTATE)===Fe.ROTATE||(this._state&Fe.TOUCH_ROTATE)===Fe.TOUCH_ROTATE||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE||(this._state&Fe.TOUCH_ZOOM_ROTATE)===Fe.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(C,F),this._isUserControllingRotate=!0),(this._state&Fe.DOLLY)===Fe.DOLLY||(this._state&Fe.ZOOM)===Fe.ZOOM){const A=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,R=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,O=this.dollyDragInverted?-1:1;(this._state&Fe.DOLLY)===Fe.DOLLY?(this._dollyInternal(O*F*jh,A,R),this._isUserControllingDolly=!0):(this._zoomInternal(O*F*jh,A,R),this._isUserControllingZoom=!0)}if((this._state&Fe.TOUCH_DOLLY)===Fe.TOUCH_DOLLY||(this._state&Fe.TOUCH_ZOOM)===Fe.TOUCH_ZOOM||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_ZOOM_TRUCK)===Fe.TOUCH_ZOOM_TRUCK||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET||(this._state&Fe.TOUCH_ZOOM_OFFSET)===Fe.TOUCH_ZOOM_OFFSET||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE||(this._state&Fe.TOUCH_ZOOM_ROTATE)===Fe.TOUCH_ZOOM_ROTATE){const A=Ls.x-this._activePointers[1].clientX,R=Ls.y-this._activePointers[1].clientY,O=Math.sqrt(A*A+R*R),L=n.y-O;n.set(0,O);const k=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,x=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&Fe.TOUCH_DOLLY)===Fe.TOUCH_DOLLY||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET?(this._dollyInternal(L*jh,k,x),this._isUserControllingDolly=!0):(this._zoomInternal(L*jh,k,x),this._isUserControllingZoom=!0)}((this._state&Fe.TRUCK)===Fe.TRUCK||(this._state&Fe.TOUCH_TRUCK)===Fe.TOUCH_TRUCK||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_ZOOM_TRUCK)===Fe.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(C,F,!1),this._isUserControllingTruck=!0),((this._state&Fe.OFFSET)===Fe.OFFSET||(this._state&Fe.TOUCH_OFFSET)===Fe.TOUCH_OFFSET||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET||(this._state&Fe.TOUCH_ZOOM_OFFSET)===Fe.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(C,F,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},E=()=>{gd(this._activePointers,Ls),i.copy(Ls),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",h),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",d),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",I),this._domElement.ownerDocument.addEventListener("pointerlockerror",v),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),p())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",I),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))};const I=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},v=()=>{this.unlockPointer()};this._addAllEventListeners=b=>{this._domElement=b,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),$_&&this._domElement.addEventListener("mousedown",o),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",m)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("mousedown",o),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",m),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",h),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",d),this._domElement.ownerDocument.removeEventListener("pointerlockchange",I),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))},this.cancel=()=>{this._state!==Fe.NONE&&(this._state=Fe.NONE,this._activePointers.length=0,E())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Ci(e.width,0,1),this._interactiveArea.height=Ci(e.height,0,1),this._interactiveArea.x=Ci(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Ci(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=Ci(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=Ci(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!s||Ct(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Ct(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Io.NONE,this._changedDolly=0,this._dollyToNoClamp(Ci(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),r=Ct(n,this._spherical.radius);if(!(s>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,n)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const i=!t||Ct(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Za).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||Ct(this._target.x,this._targetEnd.x,this.restThreshold)&&Ct(this._target.y,this._targetEnd.y,this.restThreshold)&&Ct(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Ci(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||Ct(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),Ni.setFromMatrixColumn(this._camera.matrix,0),Di.setFromMatrixColumn(this._camera.matrix,1),Ni.multiplyScalar(e),Di.multiplyScalar(-t);const i=ot.copy(Ni).add(Di),n=yt.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,s)}forward(e,t=!1){ot.setFromMatrixColumn(this._camera.matrix,0),ot.crossVectors(this._camera.up,ot),ot.multiplyScalar(e);const s=yt.copy(this._targetEnd).add(ot);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return ot.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ot.x,this._targetEnd.y+ot.y,this._targetEnd.z+ot.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const n=ot.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const r=!i||Ct(this._target.x,this._targetEnd.x,this.restThreshold)&&Ct(this._target.y,this._targetEnd.y,this.restThreshold)&&Ct(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,s,i=!1){const n=ot.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:r=0,paddingTop:o=0}={}){const a=[],h=e.isBox3?wo.copy(e):wo.setFromObject(e);h.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=Tg(this._sphericalEnd.theta,_g),d=Tg(this._sphericalEnd.phi,_g);a.push(this.rotateTo(c,d,t));const u=ot.setFromSpherical(this._sphericalEnd).normalize(),f=Og.setFromUnitVectors(u,Id),m=Ct(Math.abs(u.y),1);m&&f.multiply(yd.setFromAxisAngle(Zh,c)),f.multiply(this._yAxisUpSpaceInverse);const p=Sg.makeEmpty();yt.copy(h.min).applyQuaternion(f),p.expandByPoint(yt),yt.copy(h.min).setX(h.max.x).applyQuaternion(f),p.expandByPoint(yt),yt.copy(h.min).setY(h.max.y).applyQuaternion(f),p.expandByPoint(yt),yt.copy(h.max).setZ(h.min.z).applyQuaternion(f),p.expandByPoint(yt),yt.copy(h.min).setZ(h.max.z).applyQuaternion(f),p.expandByPoint(yt),yt.copy(h.max).setY(h.min.y).applyQuaternion(f),p.expandByPoint(yt),yt.copy(h.max).setX(h.min.x).applyQuaternion(f),p.expandByPoint(yt),yt.copy(h.max).applyQuaternion(f),p.expandByPoint(yt),p.min.x-=i,p.min.y-=r,p.max.x+=n,p.max.y+=o,f.setFromUnitVectors(Id,u),m&&f.premultiply(yd.invert()),f.premultiply(this._yAxisUpSpace);const g=p.getSize(ot),E=p.getCenter(yt).applyQuaternion(f);if(or(this._camera)){const I=this.getDistanceToFitBox(g.x,g.y,g.z,s);a.push(this.moveTo(E.x,E.y,E.z,t)),a.push(this.dollyTo(I,t)),a.push(this.setFocalOffset(0,0,0,t))}else if(Sn(this._camera)){const I=this._camera,v=I.right-I.left,b=I.top-I.bottom,C=s?Math.max(v/g.x,b/g.y):Math.min(v/g.x,b/g.y);a.push(this.moveTo(E.x,E.y,E.z,t)),a.push(this.zoomTo(C,t)),a.push(this.setFocalOffset(0,0,0,t))}return Promise.all(a)}fitToSphere(e,t){const s=[],i=e instanceof Je.Sphere?bd.copy(e):vs.createBoundingSphere(e,bd);if(s.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),or(this._camera)){const n=this.getDistanceToFitSphere(i.radius);s.push(this.dollyTo(n,t))}else if(Sn(this._camera)){const n=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,o=2*i.radius,a=Math.min(n/o,r/o);s.push(this.zoomTo(a,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,n,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Io.NONE,this._changedDolly=0;const a=yt.set(i,n,r),h=ot.set(e,t,s);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(h.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!o||Ct(this._target.x,this._targetEnd.x,this.restThreshold)&&Ct(this._target.y,this._targetEnd.y,this.restThreshold)&&Ct(this._target.z,this._targetEnd.z,this.restThreshold)&&Ct(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Ct(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Ct(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,s,i,n,r,o,a,h,c,d,u,f,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Io.NONE,this._changedDolly=0;const p=ot.set(i,n,r),g=yt.set(e,t,s);Js.setFromVector3(g.sub(p).applyQuaternion(this._yAxisUpSpace));const E=yo.set(c,d,u),I=yt.set(o,a,h);Xa.setFromVector3(I.sub(E).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(E,f));const v=Xa.theta-Js.theta,b=Xa.phi-Js.phi,C=Xa.radius-Js.radius;this._sphericalEnd.set(Js.radius+C*f,Js.phi+b*f,Js.theta+v*f),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const F=!m||Ct(this._target.x,this._targetEnd.x,this.restThreshold)&&Ct(this._target.y,this._targetEnd.y,this.restThreshold)&&Ct(this._target.z,this._targetEnd.z,this.restThreshold)&&Ct(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Ct(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Ct(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(F)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const n=this.getPosition(ot),r=this.setLookAt(n.x,n.y,n.z,e,t,s,i);return this._sphericalEnd.phi=Ci(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const n=!i||Ct(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Ct(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Ct(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),Ni.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Di.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ar.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=ot.set(e,t,s),n=i.distanceTo(this._camera.position),r=i.sub(this._camera.position);Ni.multiplyScalar(r.x),Di.multiplyScalar(r.y),ar.multiplyScalar(r.z),ot.copy(Ni).add(Di).add(ar),ot.z=ot.z+n,this.dollyTo(n,!1),this.setFocalOffset(-ot.x,ot.y,-ot.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Je.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(Ed(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,r=this._camera.getEffectiveFOV()*Ha,o=this._camera.aspect;return((i?n>o:n<o)?t:e/o)*.5/Math.tan(r*.5)+s*.5}getDistanceToFitSphere(e){if(Ed(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Ha,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Je.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Je.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof Je.Spherical?e:new Je.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Je.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%bo,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=bo),this._spherical.theta+=bo*Math.round((this._sphericalEnd.theta-this._spherical.theta)/bo)}reset(e=!1){if(!Ct(this._camera.up.x,this._cameraUp0.x)||!Ct(this._camera.up.y,this._cameraUp0.y)||!Ct(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(ot);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Zh),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ot.subVectors(this._target,this._camera.position).normalize(),t=yt.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(ot);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=Fg.subVectors(this._targetEnd,this._target),r=Rg.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(Ot(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Wh(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,c,1/0,e),this._needsUpdate=!0}if(Ot(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Wh(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,c,1/0,e),this._needsUpdate=!0}if(Ot(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const c=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Wh(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,c,this.maxSpeed,e),this._needsUpdate=!0}if(Ot(n.x)&&Ot(n.y)&&Ot(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const c=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;xg(this._target,this._targetEnd,this._targetVelocity,c,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Ot(r.x)&&Ot(r.y)&&Ot(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const c=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;xg(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,c,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(Ot(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const c=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Wh(this._zoom,this._zoomEnd,this._zoomVelocity,c,1/0,e)}if(this.dollyToCursor){if(or(this._camera)&&this._changedDolly!==0){const c=this._spherical.radius-this._lastDistance,d=this._camera,u=this._getCameraDirection(Za),f=ot.copy(u).cross(d.up).normalize();f.lengthSq()===0&&(f.x=1);const m=yt.crossVectors(f,u),p=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*Ha*.5),g=(this._sphericalEnd.radius-c-this._sphericalEnd.radius)/this._sphericalEnd.radius,E=yo.copy(this._targetEnd).add(f.multiplyScalar(this._dollyControlCoord.x*p*d.aspect)).add(m.multiplyScalar(this._dollyControlCoord.y*p)),I=ot.copy(this._targetEnd).lerp(E,g),v=this._lastDollyDirection===Io.IN&&this._spherical.radius<=this.minDistance,b=this._lastDollyDirection===Io.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(v||b)){this._sphericalEnd.radius-=c,this._spherical.radius-=c;const F=yt.copy(u).multiplyScalar(-c);I.add(F)}this._boundary.clampPoint(I,I);const C=yt.subVectors(I,this._targetEnd);this._targetEnd.copy(I),this._target.add(C),this._changedDolly-=c,Ot(this._changedDolly)&&(this._changedDolly=0)}else if(Sn(this._camera)&&this._changedZoom!==0){const c=this._zoom-this._lastZoom,d=this._camera,u=ot.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),f=yt.set(0,0,-1).applyQuaternion(d.quaternion),m=yo.copy(u).add(f.multiplyScalar(-u.dot(d.up))),p=-(this._zoom-c-this._zoom)/this._zoom,g=this._getCameraDirection(Za),E=this._targetEnd.dot(g),I=ot.copy(this._targetEnd).lerp(m,p),v=I.dot(g),b=g.multiplyScalar(v-E);I.sub(b),this._boundary.clampPoint(I,I);const C=yt.subVectors(I,this._targetEnd);this._targetEnd.copy(I),this._target.add(C),this._changedZoom-=c,Ot(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Ot(this._focalOffset.x)||!Ot(this._focalOffset.y)||!Ot(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Ni.setFromMatrixColumn(this._camera.matrix,0),Di.setFromMatrixColumn(this._camera.matrix,1),ar.setFromMatrixColumn(this._camera.matrix,2),Ni.multiplyScalar(this._focalOffset.x),Di.multiplyScalar(-this._focalOffset.y),ar.multiplyScalar(this._focalOffset.z),ot.copy(Ni).add(Di).add(ar),this._camera.position.add(ot)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ot.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const h=this._needsUpdate;return h&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):h?(this.dispatchEvent({type:"update"}),Ot(t,this.restThreshold)&&Ot(s,this.restThreshold)&&Ot(i,this.restThreshold)&&Ot(n.x,this.restThreshold)&&Ot(n.y,this.restThreshold)&&Ot(n.z,this.restThreshold)&&Ot(r.x,this.restThreshold)&&Ot(r.y,this.restThreshold)&&Ot(r.z,this.restThreshold)&&Ot(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!h&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=h,this._needsUpdate=!1,h}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Wa(this.maxDistance),minZoom:this.minZoom,maxZoom:Wa(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Wa(this.maxPolarAngle),minAzimuthAngle:Wa(this.minAzimuthAngle),maxAzimuthAngle:Wa(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ot.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=ja(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=ja(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=ja(s.maxPolarAngle),this.minAzimuthAngle=ja(s.minAzimuthAngle),this.maxAzimuthAngle=ja(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),Js.setFromVector3(ot.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Js.theta,Js.phi,t),this.dollyTo(Js.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",q_),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const n=yt.copy(t).add(e),r=this._boundary.clampPoint(n,yo).sub(n),o=r.lengthSq();if(o===0)return e.add(t);if(o===i)return e;if(s===0)return e.add(t).add(r);{const a=1+s*o/t.dot(r);return e.add(yt.copy(t).multiplyScalar(a)).add(r.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(or(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*Ha,i=Math.tan(s*.5)*t,n=i*e.aspect;this._nearPlaneCorners[0].set(-n,-i,0),this._nearPlaneCorners[1].set(n,-i,0),this._nearPlaneCorners[2].set(n,i,0),this._nearPlaneCorners[3].set(-n,i,0)}else if(Sn(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,n=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(s,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Ed(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(Za);wd.lookAt(Ag,t,this._camera.up);for(let s=0;s<4;s++){const i=yt.copy(this._nearPlaneCorners[s]);i.applyMatrix4(wd);const n=yo.addVectors(this._target,i);Xh.set(n,t),Xh.far=this._spherical.radius+1;const r=Xh.intersectObjects(this.colliderMeshes);r.length!==0&&r[0].distance<e&&(e=r[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Je.Sphere){const s=t,i=s.center;wo.makeEmpty(),e.traverseVisible(r=>{r.isMesh&&wo.expandByObject(r)}),wo.getCenter(i);let n=0;return e.traverseVisible(r=>{if(!r.isMesh)return;const o=r,a=o.geometry.clone();a.applyMatrix4(o.matrixWorld);const h=a.attributes.position;for(let c=0,d=h.count;c<d;c++)ot.fromBufferAttribute(h,c),n=Math.max(n,i.distanceToSquared(ot))}),s.radius=Math.sqrt(n),s}}class fl extends N_{constructor(e){super(e),z(this,"onBeforeUpdate",new we),z(this,"onAfterUpdate",new we),z(this,"onAspectUpdated",new we),z(this,"onDisposed",new we),z(this,"three"),z(this,"_allControls",new Map),z(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof gi){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:t,world:s})=>{if(t==="added"){const i=this.newCameraControls();this._allControls.set(s.uuid,i)}if(t==="removed"){const i=this._allControls.get(s.uuid);i&&(i.dispose(),this._allControls.delete(s.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.currentWorld!==null&&(this.controls.enabled=e)}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[e,t]of this._allControls)t.dispose()}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}setupCamera(){const e=window.innerWidth/window.innerHeight,t=new Sc(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new U(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");vs.install({THREE:fl.getSubsetOfThree()});const{domElement:e}=this.currentWorld.renderer.three,t=new vs(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t.minDistance=6,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:a0,Vector2:lt,Vector3:U,Vector4:Fr,Quaternion:Ht,Matrix4:Oe,Spherical:o0,Box3:Qe,Sphere:pi,Raycaster:Tr,MathUtils:xr}}}const GE=class HE extends ht{constructor(e){super(e),z(this,"onAfterUpdate",new we),z(this,"onBeforeUpdate",new we),z(this,"onDisposed",new we),z(this,"onWorldCreated",new we),z(this,"onWorldDeleted",new we),z(this,"list",new Map),z(this,"enabled",!0),e.add(HE.uuid,this)}create(){const e=new X_(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),this.onWorldCreated.trigger(e),e}delete(e){if(!this.list.has(e.uuid))throw new Error("The provided world is not found in the list!");const t=e.uuid;this.list.delete(e.uuid),e.dispose(),this.onWorldDeleted.trigger(t)}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[t,s]of this.list)s.update(e)}};z(GE,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let e2=GE;function t2(l,e,t,s){return new Promise((i,n)=>{function r(){const o=l.clientWaitSync(e,t,0);if(o===l.WAIT_FAILED){n();return}if(o===l.TIMEOUT_EXPIRED){setTimeout(r,s);return}i()}r()})}async function s2(l,e,t,s,i,n,r){const o=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0);l.flush(),await t2(l,o,0,10),l.deleteSync(o),l.bindBuffer(e,t),l.getBufferSubData(e,s,i,n,r),l.bindBuffer(e,null)}async function i2(l,e,t,s,i,n,r,o){const a=l.createBuffer();return l.bindBuffer(l.PIXEL_PACK_BUFFER,a),l.bufferData(l.PIXEL_PACK_BUFFER,o.byteLength,l.STREAM_READ),l.readPixels(e,t,s,i,n,r,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await s2(l,l.PIXEL_PACK_BUFFER,a,0,o),l.deleteBuffer(a),o}class WE{constructor(e,t,s){if(z(this,"onDisposed",new we),z(this,"onViewUpdated",new al),z(this,"enabled",!0),z(this,"needsUpdate",!1),z(this,"renderDebugFrame",!1),z(this,"components"),z(this,"world"),z(this,"renderer"),z(this,"autoUpdate",!0),z(this,"updateInterval",1e3),z(this,"worker"),z(this,"scene",new Zi),z(this,"_width",512),z(this,"_height",512),z(this,"_availableColor",1),z(this,"renderTarget"),z(this,"bufferSize"),z(this,"_buffer"),z(this,"_isWorkerBusy",!1),z(this,"updateVisibility",async r=>{if(!this.enabled||!this.needsUpdate&&!r||this._isWorkerBusy)return;this._isWorkerBusy=!0;const o=this.world.camera.three;o.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,o);const a=this.renderer.getContext();try{await i2(a,0,0,this._width,this._height,a.RGBA,a.UNSIGNED_BYTE,this._buffer)}catch{this.needsUpdate=!1,this._isWorkerBusy=!1,this.renderer.setRenderTarget(null);return}this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,o),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.applySettings(s),this.world=t,this.renderer=new Lo,this.renderTarget=new Hi(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=t.renderer.clippingPlanes;const i=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,n=new Blob([i],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n))}dispose(){this.enabled=!1;for(const e of this.scene.children)e.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let e=BigInt(this._availableColor.toString());const t=[];do t.unshift(Number(e%256n)),e/=256n;while(e);for(;t.length!==3;)t.unshift(0);const[s,i,n]=t,r=`${s}-${i}-${n}`;return{r:s,g:i,b:n,code:r}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(e){e&&(e.updateInterval!==void 0&&(this.updateInterval=e.updateInterval),e.height!==void 0&&(this._height=e.height),e.width!==void 0&&(this._width=e.width),e.autoUpdate!==void 0&&(this.autoUpdate=e.autoUpdate))}}class n2 extends WE{constructor(e,t,s){super(e,t,s),z(this,"onViewUpdated",new we),z(this,"threshold",100),z(this,"colorMeshes",new Map),z(this,"isProcessing",!1),z(this,"_interval",null),z(this,"_colorCodeMeshMap",new Map),z(this,"_meshIDColorCodeMap",new Map),z(this,"_currentVisibleMeshes",new Set),z(this,"_recentlyHiddenMeshes",new Set),z(this,"_intervalID",null),z(this,"_transparentMat",new is({transparent:!0,opacity:0})),z(this,"handleWorkerMessage",async i=>{if(this.isProcessing)return;const n=i.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[r,o]of n){if(o<this.threshold)continue;const a=this._colorCodeMeshMap.get(r);a&&(this._currentVisibleMeshes.add(a),this._recentlyHiddenMeshes.delete(a))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._interval=window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval)),this.onViewUpdated.add(({seen:i,unseen:n})=>{for(const r of i)r.visible=!0;for(const r of n)r.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._interval!==null&&(window.clearInterval(this._interval),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const e=this.components.get(ji);for(const t in this.colorMeshes){const s=this.colorMeshes.get(t);s&&e.destroy(s,!0)}this.colorMeshes.clear()}add(e){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=e instanceof ss,{geometry:s,material:i}=e,{colorMaterial:n,code:r}=this.getAvailableMaterial();let o;if(Array.isArray(i)){let c=!0;const d=[];for(const u of i)vg.isTransparent(u)?d.push(this._transparentMat):(c=!1,d.push(n));if(c){n.dispose(),this.isProcessing=!1;return}o=d}else if(vg.isTransparent(i)){n.dispose(),this.isProcessing=!1;return}else o=n;this._colorCodeMeshMap.set(r,e),this._meshIDColorCodeMap.set(e.uuid,r);const a=t?e.count:1,h=new ss(s,o,a);t?h.instanceMatrix=e.instanceMatrix:h.setMatrixAt(0,new Oe),e.visible=!1,e.updateWorldMatrix(!0,!1),h.applyMatrix4(e.matrixWorld),h.updateMatrix(),this.scene.add(h),this.colorMeshes.set(e.uuid,h),this.increaseColor(),this.isProcessing=!1}remove(e){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=this.components.get(ji);this._currentVisibleMeshes.delete(e),this._recentlyHiddenMeshes.delete(e);const s=this.colorMeshes.get(e.uuid),i=this._meshIDColorCodeMap.get(e.uuid);if(!s||!i){this.isProcessing=!1;return}this._colorCodeMeshMap.delete(i),this._meshIDColorCodeMap.delete(e.uuid),this.colorMeshes.delete(e.uuid),s.geometry=void 0,s.material=[],t.destroy(s,!0),this._recentlyHiddenMeshes.delete(e),this._currentVisibleMeshes.delete(e),this.isProcessing=!1}updateInstanced(e){for(const t of e){const s=this.colorMeshes.get(t.uuid);s&&(s.count=t.count)}}getAvailableMaterial(){const{r:e,g:t,b:s,code:i}=this.getAvailableColor(),n=$s.enabled;$s.enabled=!1;const r=new mt(`rgb(${e}, ${t}, ${s})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const o=this.world.renderer.clippingPlanes,a=new is({color:r,clippingPlanes:o,side:Fi});return $s.enabled=n,{colorMaterial:a,code:i}}}const jE=class yf extends ht{constructor(e){super(e),z(this,"onDisposed",new we),z(this,"_enabled",!0),z(this,"list",new Map),e.add(yf.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const[t,s]of this.list)s.enabled=e}create(e,t){if(this.list.has(e.uuid))return this.list.get(e.uuid);const s=new n2(this.components,e,t);return this.list.set(e.uuid,s),s}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(yf.uuid),this.onDisposed.reset();for(const[e,t]of this.list)t.dispose();this.list.clear()}updateInstanced(e){for(const[,t]of this.list)t.updateInstanced(e)}};z(jE,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let r2=jE;class o2{constructor(e){z(this,"_event"),z(this,"_position",new lt),z(this,"onDisposed",new we),z(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event),this._position.y=this.getPositionY(e,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(e,t){return-((t.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t){return(t.clientX-e.left)/(e.right-e.left)*2-1}setupEvents(e){e?this.dom.addEventListener("pointermove",this.updateMouseInfo):this.dom.removeEventListener("pointermove",this.updateMouseInfo)}}class a2{constructor(e,t){z(this,"enabled",!0),z(this,"components"),z(this,"onDisposed",new we),z(this,"mouse"),z(this,"three",new Tr),z(this,"world");const s=t.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new o2(s.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(e=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const t=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,t),this.intersect(e)}castRayFromVector(e,t,s=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(s)}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),s=this.filterClippingPlanes(t);return s.length>0?s[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const s=t.clippingPlanes;return e.length<=0||!s||s?.length<=0?e:e.filter(i=>s.every(n=>n.distanceToPoint(i.point)>0))}}const ZE=class XE extends ht{constructor(e){super(e),z(this,"enabled",!0),z(this,"list",new Map),z(this,"onDisposed",new we),e.add(XE.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new a2(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};z(ZE,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let di=ZE;class l2{constructor(e,t,s){z(this,"onDisposed",new we),z(this,"world"),z(this,"components"),z(this,"three"),z(this,"_fade",3),z(this,"updateZoom",()=>{this.world.camera instanceof fl&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;const{color:i,size1:n,size2:r,distance:o}=s;this.components=e;const a=new Ar(2,2,1,1),h=new ms({side:Fi,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:i},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new ye(a,h),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}dispose(){this.setupEvents(!1),this.components.get(ji).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(this.world.isDisposing||!(this.world.camera instanceof fl))return;const t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}}const h2=class KE extends ht{constructor(e){super(e),z(this,"list",new Map),z(this,"config",{color:new mt(12303291),size1:1,size2:10,distance:500}),z(this,"onDisposed",new we),z(this,"enabled",!0),e.add(KE.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");const t=new l2(this.components,e,this.config);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};z(h2,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const lr=new Tr,ws=new U,An=new U,zt=new Ht,Pg={X:new U(1,0,0),Y:new U(0,1,0),Z:new U(0,0,1)},Cd={type:"change"},Mg={type:"mouseDown"},Ng={type:"mouseUp",mode:null},Dg={type:"objectChange"};class c2 extends Wi{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const s=new g2;this._gizmo=s,this.add(s);const i=new E2;this._plane=i,this.add(i);const n=this;function r(I,v){let b=v;Object.defineProperty(n,I,{get:function(){return b!==void 0?b:v},set:function(C){b!==C&&(b=C,i[I]=C,s[I]=C,n.dispatchEvent({type:I+"-changed",value:C}),n.dispatchEvent(Cd))}}),n[I]=v,i[I]=v,s[I]=v}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new U,a=new U,h=new Ht,c=new Ht,d=new U,u=new Ht,f=new U,m=new U,p=new U,g=0,E=new U;r("worldPosition",o),r("worldPositionStart",a),r("worldQuaternion",h),r("worldQuaternionStart",c),r("cameraPosition",d),r("cameraQuaternion",u),r("pointStart",f),r("pointEnd",m),r("rotationAxis",p),r("rotationAngle",g),r("eye",E),this._offset=new U,this._startNorm=new U,this._endNorm=new U,this._cameraScale=new U,this._parentPosition=new U,this._parentQuaternion=new Ht,this._parentQuaternionInv=new Ht,this._parentScale=new U,this._worldScaleStart=new U,this._worldQuaternionInv=new Ht,this._worldScale=new U,this._positionStart=new U,this._quaternionStart=new Ht,this._scaleStart=new U,this._getPointer=u2.bind(this),this._onPointerDown=f2.bind(this),this._onPointerHover=d2.bind(this),this._onPointerMove=p2.bind(this),this._onPointerUp=m2.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;lr.setFromCamera(e,this.camera);const t=vd(this._gizmo.picker[this.mode],lr);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){lr.setFromCamera(e,this.camera);const t=vd(this._plane,lr,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Mg.mode=this.mode,this.dispatchEvent(Mg)}}pointerMove(e){const t=this.axis,s=this.mode,i=this.object;let n=this.space;if(s==="scale"?n="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(n="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;lr.setFromCamera(e,this.camera);const r=vd(this._plane,lr,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(i.position.applyQuaternion(zt.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),n==="world"&&(i.parent&&i.position.add(ws.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(ws.setFromMatrixPosition(i.parent.matrixWorld))));else if(s==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),An.set(o,o,o)}else ws.copy(this.pointStart),An.copy(this.pointEnd),ws.applyQuaternion(this._worldQuaternionInv),An.applyQuaternion(this._worldQuaternionInv),An.divide(ws),t.search("X")===-1&&(An.x=1),t.search("Y")===-1&&(An.y=1),t.search("Z")===-1&&(An.z=1);i.scale.copy(this._scaleStart).multiply(An),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(ws.setFromMatrixPosition(this.camera.matrixWorld));let a=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(ws.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Pg[t]),ws.copy(Pg[t]),n==="local"&&ws.applyQuaternion(this.worldQuaternion),ws.cross(this.eye),ws.length()===0?a=!0:this.rotationAngle=this._offset.dot(ws.normalize())*o),(t==="E"||a)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(zt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(zt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Cd),this.dispatchEvent(Dg)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Ng.mode=this.mode,this.dispatchEvent(Ng)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Cd),this.dispatchEvent(Dg),this.pointStart.copy(this.pointEnd))}getRaycaster(){return lr}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function u2(l){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:l.button};{const e=this.domElement.getBoundingClientRect();return{x:(l.clientX-e.left)/e.width*2-1,y:-(l.clientY-e.top)/e.height*2+1,button:l.button}}}function d2(l){if(this.enabled)switch(l.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(l));break}}function f2(l){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(l.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(l)),this.pointerDown(this._getPointer(l)))}function p2(l){this.enabled&&this.pointerMove(this._getPointer(l))}function m2(l){this.enabled&&(this.domElement.releasePointerCapture(l.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(l)))}function vd(l,e,t){const s=e.intersectObject(l,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||t)return s[i];return!1}const Kh=new Hf,Ft=new U(0,1,0),Lg=new U(0,0,0),Ug=new Oe,Qh=new Ht,bc=new Ht,Li=new U,Bg=new Oe,sl=new U(1,0,0),mr=new U(0,1,0),il=new U(0,0,1),qh=new U,Ka=new U,Qa=new U;class g2 extends Wi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new is({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new mi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const i=t.clone();i.opacity=.5;const n=e.clone();n.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const a=e.clone();a.color.setHex(16711680),a.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const d=e.clone();d.opacity=.25;const u=e.clone();u.color.setHex(16776960),u.opacity=.25,e.clone().color.setHex(16776960);const f=e.clone();f.color.setHex(7895160);const m=new vt(0,.04,.1,12);m.translate(0,.05,0);const p=new pt(.08,.08,.08);p.translate(0,.04,0);const g=new ft;g.setAttribute("position",new Vn([0,0,0,1,0,0],3));const E=new vt(.0075,.0075,.5,3);E.translate(0,.25,0);function I(w,G){const J=new Vi(w,.0075,3,64,G*Math.PI*2);return J.rotateY(Math.PI/2),J.rotateX(Math.PI/2),J}function v(){const w=new ft;return w.setAttribute("position",new Vn([0,0,0,1,1,1],3)),w}const b={X:[[new ye(m,n),[.5,0,0],[0,0,-Math.PI/2]],[new ye(m,n),[-.5,0,0],[0,0,Math.PI/2]],[new ye(E,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new ye(m,r),[0,.5,0]],[new ye(m,r),[0,-.5,0],[Math.PI,0,0]],[new ye(E,r)]],Z:[[new ye(m,o),[0,0,.5],[Math.PI/2,0,0]],[new ye(m,o),[0,0,-.5],[-Math.PI/2,0,0]],[new ye(E,o),null,[Math.PI/2,0,0]]],XYZ:[[new ye(new Ln(.1,0),d.clone()),[0,0,0]]],XY:[[new ye(new pt(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new ye(new pt(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new pt(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new ye(new vt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new vt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new vt(.2,0,.6,4),s),[0,.3,0]],[new ye(new vt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new vt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ye(new vt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new ye(new Ln(.2,0),s)]],XY:[[new ye(new pt(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ye(new pt(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new pt(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},F={START:[[new ye(new Ln(.01,2),i),null,null,null,"helper"]],END:[[new ye(new Ln(.01,2),i),null,null,null,"helper"]],DELTA:[[new xt(v(),i),null,null,null,"helper"]],X:[[new xt(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new xt(g,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new xt(g,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={XYZE:[[new ye(I(.5,1),f),null,[0,Math.PI/2,0]]],X:[[new ye(I(.5,.5),n)]],Y:[[new ye(I(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new ye(I(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new ye(I(.75,1),u),null,[0,Math.PI/2,0]]]},R={AXIS:[[new xt(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},O={XYZE:[[new ye(new l0(.25,10,8),s)]],X:[[new ye(new Vi(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ye(new Vi(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ye(new Vi(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ye(new Vi(.75,.1,2,24),s)]]},L={X:[[new ye(p,n),[.5,0,0],[0,0,-Math.PI/2]],[new ye(E,n),[0,0,0],[0,0,-Math.PI/2]],[new ye(p,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new ye(p,r),[0,.5,0]],[new ye(E,r)],[new ye(p,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new ye(p,o),[0,0,.5],[Math.PI/2,0,0]],[new ye(E,o),[0,0,0],[Math.PI/2,0,0]],[new ye(p,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new ye(new pt(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new ye(new pt(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new pt(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new pt(.1,.1,.1),d.clone())]]},k={X:[[new ye(new vt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new vt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new vt(.2,0,.6,4),s),[0,.3,0]],[new ye(new vt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new vt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ye(new vt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new ye(new pt(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ye(new pt(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new pt(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new pt(.2,.2,.2),s),[0,0,0]]]},x={X:[[new xt(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new xt(g,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new xt(g,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function M(w){const G=new Wi;for(const J in w)for(let Z=w[J].length;Z--;){const le=w[J][Z][0].clone(),ee=w[J][Z][1],xe=w[J][Z][2],X=w[J][Z][3],j=w[J][Z][4];le.name=J,le.tag=j,ee&&le.position.set(ee[0],ee[1],ee[2]),xe&&le.rotation.set(xe[0],xe[1],xe[2]),X&&le.scale.set(X[0],X[1],X[2]),le.updateMatrix();const be=le.geometry.clone();be.applyMatrix4(le.matrix),le.geometry=be,le.renderOrder=1/0,le.position.set(0,0,0),le.rotation.set(0,0,0),le.scale.set(1,1,1),G.add(le)}return G}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=M(b)),this.add(this.gizmo.rotate=M(A)),this.add(this.gizmo.scale=M(L)),this.add(this.picker.translate=M(C)),this.add(this.picker.rotate=M(O)),this.add(this.picker.scale=M(k)),this.add(this.helper.translate=M(F)),this.add(this.helper.rotate=M(R)),this.add(this.helper.scale=M(x)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:bc;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const n=s[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(zt.setFromEuler(Kh.set(0,0,0)),n.quaternion.copy(t).multiply(zt),Math.abs(Ft.copy(sl).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(zt.setFromEuler(Kh.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(zt),Math.abs(Ft.copy(mr).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(zt.setFromEuler(Kh.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(zt),Math.abs(Ft.copy(il).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(zt.setFromEuler(Kh.set(0,Math.PI/2,0)),Ft.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(Ug.lookAt(Lg,Ft,mr)),n.quaternion.multiply(zt),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),ws.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ws.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(ws),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(Ft.copy(sl).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(Ft.copy(mr).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(Ft.copy(il).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(Ft.copy(il).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(Ft.copy(sl).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(Ft.copy(mr).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(Qh.copy(t),Ft.copy(this.eye).applyQuaternion(zt.copy(t).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(Ug.lookAt(this.eye,Lg,mr)),n.name==="X"&&(zt.setFromAxisAngle(sl,Math.atan2(-Ft.y,Ft.z)),zt.multiplyQuaternions(Qh,zt),n.quaternion.copy(zt)),n.name==="Y"&&(zt.setFromAxisAngle(mr,Math.atan2(Ft.x,Ft.z)),zt.multiplyQuaternions(Qh,zt),n.quaternion.copy(zt)),n.name==="Z"&&(zt.setFromAxisAngle(il,Math.atan2(Ft.y,Ft.x)),zt.multiplyQuaternions(Qh,zt),n.quaternion.copy(zt))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(o){return n.name===o}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(e)}}class E2 extends ye{constructor(){super(new Ar(1e5,1e5,2,2),new is({visible:!1,wireframe:!0,side:Fi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),qh.copy(sl).applyQuaternion(t==="local"?this.worldQuaternion:bc),Ka.copy(mr).applyQuaternion(t==="local"?this.worldQuaternion:bc),Qa.copy(il).applyQuaternion(t==="local"?this.worldQuaternion:bc),Ft.copy(Ka),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ft.copy(this.eye).cross(qh),Li.copy(qh).cross(Ft);break;case"Y":Ft.copy(this.eye).cross(Ka),Li.copy(Ka).cross(Ft);break;case"Z":Ft.copy(this.eye).cross(Qa),Li.copy(Qa).cross(Ft);break;case"XY":Li.copy(Qa);break;case"YZ":Li.copy(qh);break;case"XZ":Ft.copy(Qa),Li.copy(Ka);break;case"XYZ":case"E":Li.set(0,0,0);break}break;case"rotate":default:Li.set(0,0,0)}Li.length()===0?this.quaternion.copy(this.cameraQuaternion):(Bg.lookAt(ws.set(0,0,0),Li,Ft),this.quaternion.setFromRotationMatrix(Bg)),super.updateMatrixWorld(e)}}class Yc{constructor(e,t,s,i,n,r=5,o=!0){if(z(this,"onDraggingStarted",new we),z(this,"onDraggingEnded",new we),z(this,"onDisposed",new we),z(this,"normal"),z(this,"origin"),z(this,"three",new _s),z(this,"components"),z(this,"world"),z(this,"type","default"),z(this,"_helper"),z(this,"_visible",!0),z(this,"_enabled",!0),z(this,"_controlsActive",!1),z(this,"_arrowBoundBox",new ye),z(this,"_planeMesh"),z(this,"_controls"),z(this,"_hiddenMaterial",new is({visible:!1})),z(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),z(this,"changeDrag",a=>{this._visible=!a.value,this.preventCameraMovement(),this.notifyDraggingChanged(a)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,t.renderer.setPlane(!0,this.three),this._planeMesh=Yc.newPlaneMesh(r,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),o&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(e){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,this.world.renderer.setPlane(e,this.three)}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.visible=e,this._helper.visible=e,this.toggleControls(e)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new U(1,0,0),t=new U;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,s=new c2(e,t);return this.initializeControls(s),this.world.scene.three.add(s),s}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new vt(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new Wi;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const s=new Ar(1),i=new ye(s,t);return i.scale.set(e,e,e),i}}const QE=class wf extends ht{constructor(e){super(e),z(this,"onBeforeDrag",new we),z(this,"onAfterDrag",new we),z(this,"onBeforeCreate",new we),z(this,"onBeforeCancel",new we),z(this,"onAfterCancel",new we),z(this,"onBeforeDelete",new we),z(this,"onAfterCreate",new we),z(this,"onAfterDelete",new we),z(this,"onDisposed",new we),z(this,"orthogonalY",!1),z(this,"toleranceOrthogonalY",.7),z(this,"Type",Yc),z(this,"list",[]),z(this,"_material",new is({color:12255487,side:Fi,transparent:!0,opacity:.2})),z(this,"_size",5),z(this,"_enabled",!1),z(this,"_visible",!0),z(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),z(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(wf.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const t of this.list)t.enabled=e;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get material(){return this._material}set material(e){this._material=e;for(const t of this.list)t.planeMaterial=e}get size(){return this._size}set size(e){this._size=e;for(const t of this.list)t.size=e}dispose(){this._enabled=!1;for(const e of this.list)e.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(wf.uuid),this.onDisposed.reset()}create(e){const t=this.components.get(di).get(e).castRay();return t?this.createPlaneFromIntersection(e,t):null}createFromNormalAndCoplanarPoint(e,t,s){const i=this.newPlane(e,s,t);return this.updateMaterialsAndPlanes(),i}delete(e,t){t||(t=this.pickPlane(e)),t&&this.deletePlane(t)}deleteAll(e){const t=[...this.list];for(const s of t)if(!e||e.has(s.type)){this.delete(s.world,s);const i=this.list.indexOf(s);i!==-1&&this.list.splice(i,1)}}deletePlane(e){const t=this.list.indexOf(e);if(t!==-1){if(this.list.splice(t,1),!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(e)}}pickPlane(e){const t=this.components.get(di).get(e),s=this.getAllPlaneMeshes(),i=t.castRay(s);if(i){const n=i.object;return this.list.find(r=>r.meshes.includes(n))}}getAllPlaneMeshes(){const e=[];for(const t of this.list)e.push(...t.meshes);return e}createPlaneFromIntersection(e,t){var s;if(!e.renderer)throw new Error("The given world must have a renderer!");const i=t.point.distanceTo(new U(0,0,0)),n=(s=t.face)==null?void 0:s.normal;if(!i||!n)return null;const r=this.getWorldNormal(t,n),o=this.newPlane(e,t.point,r.negate());return o.visible=this._visible,o.size=this._size,e.renderer.setPlane(!0,o.three),this.updateMaterialsAndPlanes(),o}getWorldNormal(e,t){const s=e.object;let i=e.object.matrixWorld.clone();if(s instanceof ss&&e.instanceId!==void 0){const o=new Oe;s.getMatrixAt(e.instanceId,o),i=o.multiply(i)}const n=new Us().getNormalMatrix(i),r=t.clone().applyMatrix3(n).normalize();return this.normalizePlaneDirectionY(r),r}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,s){const i=new this.Type(this.components,e,t,s,this._material);return i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging),this.list.push(i),this.onAfterCreate.trigger(i),i}updateMaterialsAndPlanes(){const e=this.components.get(e2);for(const[t,s]of e.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:i}=s.renderer;for(const n of s.meshes)if(n.material)if(Array.isArray(n.material))for(const r of n.material)r.clippingPlanes=i;else n.material.clippingPlanes=i}}};z(QE,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let zo=QE;class I2{constructor(e){z(this,"enabled",!1),z(this,"id","FirstPerson"),this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const e=this.camera.controls,t=new U;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=vs.ACTION.DOLLY,e.touches.two=vs.ACTION.TOUCH_ZOOM_TRUCK}}class b2{constructor(e){z(this,"enabled",!0),z(this,"id","Orbit"),this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){const e=this.camera.controls;e.minDistance=1,e.maxDistance=300;const t=new U;e.getPosition(t);const s=t.length();e.distance=s,e.truckSpeed=2;const{rotation:i}=this.camera.three,n=new U(0,0,-1).applyEuler(i),r=t.addScaledVector(n,s);e.moveTo(r.x,r.y,r.z)}}class y2{constructor(e){z(this,"enabled",!1),z(this,"id","Plan"),z(this,"mouseAction1"),z(this,"mouseAction2"),z(this,"mouseInitialized",!1),z(this,"defaultAzimuthSpeed"),z(this,"defaultPolarSpeed"),this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;const t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=vs.ACTION.TRUCK,t.touches.one=vs.ACTION.TOUCH_TRUCK,t.touches.two=vs.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=vs.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}}class w2{constructor(e){z(this,"onChanged",new we),z(this,"current","Perspective"),z(this,"camera"),z(this,"matchOrthoDistanceEnabled",!1),z(this,"_component"),z(this,"_previousDistance",-1),this._component=e,this.camera=e.three}async set(e){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const e=this.getPerspectiveDims();if(!e)return;const{width:t,height:s}=e;this.setupOrthoCamera(s,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const e=this._component.currentWorld;if(!e||!e.renderer)return null;const t=new U;this._component.threePersp.getWorldDirection(t);const s=new U;this._component.controls.getTarget(s);const i=s.clone().sub(this._component.threePersp.position).dot(t),n=e.renderer.getSize(),r=n.x/n.y,o=this._component.threePersp,a=i*2*Math.atan(o.fov*(Math.PI/180)/2);return{width:a*r,height:a}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=vs.ACTION.ZOOM,this._component.controls.mouseButtons.middle=vs.ACTION.ZOOM;const s=this._component.threePersp,i=this._component.threeOrtho;i.zoom=1,i.left=t/-2,i.right=t/2,i.top=e/2,i.bottom=e/-2,i.updateProjectionMatrix(),i.position.copy(s.position),i.quaternion.copy(s.quaternion),this._component.controls.camera=i}getDistance(){const e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=vs.ACTION.DOLLY,this._component.controls.mouseButtons.middle=vs.ACTION.DOLLY;const e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=vs.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"}}class C2 extends fl{constructor(e){super(e),z(this,"projection"),z(this,"threeOrtho"),z(this,"threePersp"),z(this,"_userInputButtons",{}),z(this,"_frustumSize",50),z(this,"_navigationModes",new Map),z(this,"_mode",null),z(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new w2(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t,this.updateAspect()}),this.onWorldChanged.add(({action:t})=>{t==="added"&&(this._navigationModes.clear(),this._navigationModes.set("Orbit",new b2(this)),this._navigationModes.set("FirstPerson",new I2(this)),this._navigationModes.set("Plan",new y2(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone()))})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}async fit(e,t=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,i=Number.MIN_VALUE,n=new U(s,s,s),r=new U(i,i,i);for(const u of e){const f=new Qe().setFromObject(u);f.min.x<n.x&&(n.x=f.min.x),f.min.y<n.y&&(n.y=f.min.y),f.min.z<n.z&&(n.z=f.min.z),f.max.x>r.x&&(r.x=f.max.x),f.max.y>r.y&&(r.y=f.max.y),f.max.z>r.z&&(r.z=f.max.z)}const o=new Qe(n,r),a=new U;o.getSize(a);const h=new U;o.getCenter(h);const c=Math.max(a.x,a.y,a.z)*t,d=new pi(h,c);await this.controls.fitToSphere(d,!0)}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const e=window.innerWidth/window.innerHeight;return new gi(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const e=this.currentWorld.renderer.getSize(),t=this.threeOrtho.top,s=this.threeOrtho.right,i=e.y/this.previousSize.y,n=e.x/this.previousSize.x,r=t*i,o=s*n;this.threeOrtho.left=-o,this.threeOrtho.right=o,this.threeOrtho.top=r,this.threeOrtho.bottom=-r,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(e)}}const zg=new Map([[Xn,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[Vo,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[Yo,{forRelated:"HasAssociations",forRelating:"ClassificationForObjects"}],[Go,{forRelated:"HasAssignments",forRelating:"IsGroupedBy"}],[Xi,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[Ho,{forRelated:"IsTypedBy",forRelating:"Types"}],[Wo,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[Kn,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}],[jo,{forRelated:"AssignedToFlowElement",forRelating:"HasControlElements"}],[Zo,{forRelated:"ConnectedFrom",forRelating:"ConnectedTo"}],[Xo,{forRelated:"HasAssignments",forRelating:"ReferencedBy"}],[Ko,{forRelated:"HasContext",forRelating:"Declares"}],[Qo,{forRelated:"HasAssignments",forRelating:"Controls"}],[qo,{forRelated:"Nests",forRelating:"IsNestedBy"}],[Jo,{forRelated:"HasAssociations",forRelating:"DocumentRefForObjects"}]]),qE={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class Ir{static async getUnits(e){var t,s,i;const{IFCUNITASSIGNMENT:n}=jt,r=await e.getAllPropertiesOfType(n);if(!r)return 1;const o=Object.keys(r),a=r[parseInt(o[0],10)];for(const h of a.Units){if(h.value===void 0||h.value===null)continue;const c=await e.getProperties(h.value);if(!c||!c.UnitType||!c.UnitType.value||c.UnitType.value!=="LENGTHUNIT")continue;let d=1,u=1;return c.Name.value==="METRE"&&(u=1),c.Name.value==="FOOT"&&(u=.3048),((t=c.Prefix)==null?void 0:t.value)==="MILLI"?d=.001:((s=c.Prefix)==null?void 0:s.value)==="CENTI"?d=.01:((i=c.Prefix)==null?void 0:i.value)==="DECI"&&(d=.1),u*d}return 1}static async findItemByGuid(e,t){var s;const i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(r&&((s=r.GlobalId)==null?void 0:s.value)===t)return r}return null}static async getRelationMap(e,t,s){var i;const n=s??(async()=>{}),r={},o=e.getAllPropertiesIDs();for(const a of o){const h=await e.getProperties(a);if(!h)continue;const c=h.type===t,d=Object.keys(h).find(g=>g.startsWith("Relating")),u=Object.keys(h).find(g=>g.startsWith("Related"));if(!(c&&d&&u))continue;const f=await e.getProperties((i=h[d])==null?void 0:i.value),m=h[u];if(!f||!m||!(m&&Array.isArray(m)))continue;const p=m.map(g=>g.value);await n(f.expressID,p),r[f.expressID]=p}return r}static async getQsetQuantities(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==I0?null:(n.Quantities??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetProps(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==Uo?null:(n.HasProperties??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetRel(e,t){var s;if(!await e.getProperties(t))return null;const i=await e.getAllPropertiesOfType(Xi);if(!i)return null;const n=Object.values(i);let r=null;for(const o of n)((s=o.RelatingPropertyDefinition)==null?void 0:s.value)===t&&(r=o.expressID);return r}static async getQsetRel(e,t){return Ir.getPsetRel(e,t)}static async getEntityName(e,t){var s;const i=await e.getProperties(t);if(!i)return{key:null,name:null};const n=Object.keys(i).find(o=>o.endsWith("Name"))??null,r=n?(s=i[n])==null?void 0:s.value:null;return{key:n,name:r}}static async getQuantityValue(e,t){const s=await e.getProperties(t);if(!s)return{key:null,value:null};const i=Object.keys(s).find(r=>r.endsWith("Value"))??null;let n;return i===null||s[i]===void 0||s[i]===null?n=null:n=s[i].value,{key:i,value:n}}static isRel(e){return qE[e].startsWith("IFCREL")}static async attributeExists(e,t,s){const i=await e.getProperties(t);return i?Object.keys(i).includes(s):!1}static async groupEntitiesByType(e,t){var s;const i=new Map;for(const n of t){const r=await e.getProperties(n);if(!r)continue;const o=r.type;i.get(o)||i.set(o,new Set),(s=i.get(o))==null||s.add(n)}return i}}class v2{constructor(){z(this,"factor",1),z(this,"complement",1)}apply(e){const t=this.getScaleMatrix().multiply(e);e.copy(t)}setUp(e){var t,s,i;this.factor=1;const n=this.getLengthUnits(e);if(!n)return;const r=n==null,o=n.Name===void 0||n.Name===null;r||o||(n.Name.value==="FOOT"&&(this.factor=.3048),((t=n.Prefix)==null?void 0:t.value)==="MILLI"?this.complement=.001:((s=n.Prefix)==null?void 0:s.value)==="CENTI"?this.complement=.01:((i=n.Prefix)==null?void 0:i.value)==="DECI"&&(this.complement=.01))}getLengthUnits(e){try{const t=e.GetLineIDsWithType(0,b0).get(0),s=e.GetLine(0,t);for(const i of s.Units){if(!i||i.value===null||i.value===void 0)continue;const n=e.GetLine(0,i.value);if(n.UnitType&&n.UnitType.value==="LENGTHUNIT")return n}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const e=this.factor;return new Oe().fromArray([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])}}class JE{constructor(){z(this,"itemsByFloor",{}),z(this,"_units",new v2)}setUp(e){this._units.setUp(e),this.cleanUp();try{const t=e.GetLineIDsWithType(0,Kn),s=new Set,i=e.GetLineIDsWithType(0,zs);for(let h=0;h<i.size();h++)s.add(i.get(h));const n=e.GetLineIDsWithType(0,Xn),r=n.size();for(let h=0;h<r;h++){const c=n.get(h),d=e.GetLine(0,c);if(!d||!d.RelatingObject||!d.RelatedObjects)continue;const u=d.RelatingObject.value,f=d.RelatedObjects;for(const m of f){const p=m.value;s.has(p)&&(this.itemsByFloor[p]=u)}}const o={},a=t.size();for(let h=0;h<a;h++){const c=t.get(h),d=e.GetLine(0,c);if(!d||!d.RelatingStructure||!d.RelatedElements)continue;const u=d.RelatingStructure.value,f=d.RelatedElements;if(s.has(u))for(const m of f){o[u]||(o[u]=[]);const p=m.value;o[u].push(p)}else for(const m of f){const p=m.value;this.itemsByFloor[p]=u}}for(const h in o){const c=this.itemsByFloor[h];if(c!==void 0){const d=o[h];for(const u of d)this.itemsByFloor[u]=c}}for(let h=0;h<r;h++){const c=n.get(h),d=e.GetLine(0,c);if(!d||!d.RelatingObject||!d.RelatedObjects)continue;const u=d.RelatingObject.value,f=d.RelatedObjects;for(const m of f){const p=m.value,g=this.itemsByFloor[u];g!==void 0&&(this.itemsByFloor[p]=g)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class lp{constructor(){z(this,"includeProperties",!0),z(this,"optionalCategories",[zs]),z(this,"coordinate",!0),z(this,"wasm",{path:"",absolute:!1,logLevel:u0.LOG_LEVEL_OFF}),z(this,"excludedCategories",new Set),z(this,"includedCategories",new Set),z(this,"saveLocations",!1),z(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),z(this,"autoSetWasm",!0),z(this,"customLocateFileHandler",null)}}class $E{constructor(){z(this,"defLineMat",new mi({color:16777215}))}read(e){const t=e.GetAllAlignments(0),s=e.GetAllCrossSections2D(0),i=e.GetAllCrossSections3D(0),n={IfcAlignment:t,IfcCrossSection2D:s,IfcCrossSection3D:i};return this.get(n)}get(e){if(e.IfcAlignment){const t=new Map;for(const s of e.IfcAlignment){const i=new Dc;i.absolute=this.getCurves(s.curve3D,i),i.horizontal=this.getCurves(s.horizontal,i),i.vertical=this.getCurves(s.vertical,i),t.set(t.size,i)}return{alignments:t,coordinationMatrix:new Oe}}}getCurves(e,t){const s=[];let i=0;for(const n of e){const r={};if(n.data)for(const u of n.data){const[f,m]=u.split(": "),p=parseFloat(m);r[f]=p||m}const{points:o}=n,a=new Float32Array(o.length*3);for(let u=0;u<o.length;u++){const{x:f,y:m,z:p}=o[u];a[u*3]=f,a[u*3+1]=m,a[u*3+2]=p||0}const h=new Rt(a,3),c=new Rc;c.setAttribute("position",h);const d=new Lc(i,r,t,c,this.defLineMat);s.push(d.curve),i++}return s}}class e1{getNameInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,d0)||{};if(!i)return s;const[n,r,o,a,h,c,d]=i;if(n!=null&&n.value&&(s.name=n.value),r!=null&&r.value&&(s.creationDate=new Date(r.value)),o){s.author={};const[u,f]=o;u!=null&&u.value&&(s.author.name=u.value),f!=null&&f.value&&(s.author.email=f.value)}return(t=a[0])!=null&&t.value&&(s.organization=a[0].value),h!=null&&h.value&&(s.preprocessorVersion=h?.value),c!=null&&c.value&&(s.originatingSystem=c?.value),d!=null&&d.value&&(s.authorization=d?.value),s}getDescriptionInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,f0)||{};if(!i)return s;const[n,r]=i;if((t=n[0])!=null&&t.value){const o=n[0].value.match(/\[([^\]]+)\]/);o&&o[1]&&(s.viewDefinition=o[1])}return r!=null&&r.value&&(s.implementationLevel=r.value),s}}class t1{static get(e,t){const s=[$o,ea,ta,Rr,zs,p0,m0,g0,E0],i=e.data;for(const n of s){const r=t.GetLineIDsWithType(0,n),o=r.size();for(let a=0;a<o;a++){const h=r.get(a);i.has(h)||i.set(h,[[],[0,n]])}}}}const s1=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),i1=class n1 extends ht{constructor(e){super(e),z(this,"enabled",!0),e.add(n1.uuid,this)}async export(e,t,s=!1,i=!0){const n={},r=new Set(e.GetIfcEntityList(t)),o=new Set([$o,ea,ta,Rr,zs]);for(const a of o)r.add(a);for(const a of r){if(s1.has(a))continue;const h=o.has(a)&&i,c=e.GetLineIDsWithType(t,a);for(const d of c){const u=e.GetLine(0,d,h,s);n[u.expressID]=u}}return n}};z(i1,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let _2=i1;const r1=class Cf extends ht{constructor(e){super(e),z(this,"onDisposed",new we),z(this,"onIfcStartedLoading",new we),z(this,"onSetup",new we),z(this,"settings",new lp),z(this,"webIfc",new fi),z(this,"enabled",!0),z(this,"_material",new kn),z(this,"_spatialTree",new JE),z(this,"_metaData",new e1),z(this,"_fragmentInstances",new Map),z(this,"_civil",new $E),z(this,"_visitedFragments",new Map),z(this,"_materialT",new kn({transparent:!0,opacity:.5})),this.components.add(Cf.uuid,this),this.settings.excludedCategories.add(Oc)}dispose(){this.webIfc=null,this.onDisposed.trigger(Cf.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,t=!0){const s=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(e);const i=await this.getAllGeometries(),n=await this.components.get(_2).export(this.webIfc,0);i.setLocalProperties(n);const r=this.components.get(at);r.groups.set(i.uuid,i);for(const o of i.items)r.list.set(o.id,o),o.mesh.uuid=o.id,o.group=i;r.onFragmentsLoaded.trigger(i),t&&r.coordinate([i]);for(const[o]of i.data){const a=n[o];if(!a||!a.GlobalId)continue;const h=a.GlobalId.value||a.GlobalId;i.globalToExpressIDs.set(h,o)}return t1.get(i,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-s} ms!`),i}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new fi,this._visitedFragments.clear(),this._fragmentInstances.clear()}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const e=this.webIfc.GetIfcEntityList(0),t=new ia;t.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const s=[];for(const n of e){if(!this.webIfc.IsIfcElement(n)&&n!==zs)continue;const r=this.settings.includedCategories;if(r.size>0&&!r.has(n)||this.settings.excludedCategories.has(n))continue;const o=this.webIfc.GetLineIDsWithType(0,n),a=o.size();for(let h=0;h<a;h++){const c=o.get(h);s.push(c);const d=this._spatialTree.itemsByFloor[c]||0;t.data.set(c,[[],[d,n]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,s,n=>{this.getMesh(n,t)});for(const n of this._visitedFragments){const{index:r,fragment:o}=n[1];t.keyFragments.set(r,o.id)}for(const n of t.items){const r=this._fragmentInstances.get(n.id);if(!r)throw new Error("Fragment not found!");const o=[];for(const[a,h]of r)o.push(h);n.add(o)}const i=this.webIfc.GetCoordinationMatrix(0);return t.coordinationMatrix.fromArray(i),t.civilData=this._civil.read(this.webIfc),t}getMesh(e,t){const s=e.geometries.size(),i=e.expressID;for(let n=0;n<s;n++){const r=e.geometries.get(n),{x:o,y:a,z:h,w:c}=r.color,d=c!==1,{geometryExpressID:u}=r,f=`${u}-${d}`;if(!this._visitedFragments.has(f)){const b=this.getGeometry(this.webIfc,u),C=d?this._materialT:this._material,F=new wr(b,C,1);t.add(F.mesh),t.items.push(F);const A=this._visitedFragments.size;this._visitedFragments.set(f,{index:A,fragment:F})}const m=new mt().setRGB(o,a,h,"srgb"),p=new Oe;p.fromArray(r.flatTransformation);const g=this._visitedFragments.get(f);if(g===void 0)throw new Error("Error getting geometry data for streaming!");const E=t.data.get(i);if(!E)throw new Error("Data not found!");E[0].push(g.index);const{fragment:I}=g;this._fragmentInstances.has(I.id)||this._fragmentInstances.set(I.id,new Map);const v=this._fragmentInstances.get(I.id);if(!v)throw new Error("Instances not found!");if(v.has(i)){const b=v.get(i);if(!b)throw new Error("Instance not found!");b.transforms.push(p),b.colors&&b.colors.push(m)}else v.set(i,{id:i,transforms:[p],colors:[m]})}}getGeometry(e,t){const s=e.GetGeometry(0,t),i=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let d=0;d<n.length;d+=6)r[d/2]=n[d],r[d/2+1]=n[d+1],r[d/2+2]=n[d+2],o[d/2]=n[d+3],o[d/2+1]=n[d+4],o[d/2+2]=n[d+5];const a=new ft,h=new Rt(r,3),c=new Rt(o,3);return a.setAttribute("position",h),a.setAttribute("normal",c),a.setIndex(Array.from(i)),s.delete(),a}async autoSetWasm(){const e=await fetch(`https://unpkg.com/@thatopen/components@${Z_.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};z(r1,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let T2=r1;const x2={IfcRelAssignsToControl:{related:5,relating:7},IfcRelAssignsToGroup:{related:5,relating:7},IfcRelAssignsToProduct:{related:5,relating:7},IfcRelAssociatesClassification:{related:5,relating:6},IfcRelAssociatesMaterial:{related:5,relating:6},IfcRelAssociatesDocument:{related:5,relating:6},IfcRelContainedInSpatialStructure:{related:5,relating:6},IfcRelFlowControlElements:{related:5,relating:6},IfcRelConnectsElements:{related:7,relating:6},IfcRelDeclares:{related:6,relating:5},IfcRelAggregates:{related:6,relating:5},IfcRelNests:{related:6,relating:5},IfcRelDefinesByProperties:{related:5,relating:6},IfcRelDefinesByType:{related:5,relating:6},IfcRelDefinesByTemplate:{related:5,relating:6}},A2={[Qo]:"IfcRelAssignsToControl",[Go]:"IfcRelAssignsToGroup",[Xo]:"IfcRelAssignsToProduct",[Yo]:"IfcRelAssociatesClassification",[Vo]:"IfcRelAssociatesMaterial",[Jo]:"IfcRelAssociatesDocument",[Kn]:"IfcRelContainedInSpatialStructure",[Zo]:"IfcRelConnectsElements",[jo]:"IfcRelFlowControlElements",[Ko]:"IfcRelDeclares",[Xn]:"IfcRelAggregates",[qo]:"IfcRelNests",[Xi]:"IfcRelDefinesByProperties",[Ho]:"IfcRelDefinesByType",[Wo]:"IfcRelDefinesByTemplate"},o1=class To extends ht{constructor(e){super(e),z(this,"onDisposed",new we),z(this,"onRequestFile",new we),z(this,"ifcToExport",null),z(this,"onElementToPset",new we),z(this,"onPropToPset",new we),z(this,"onPsetRemoved",new we),z(this,"onDataChanged",new we),z(this,"wasm",{path:"/",absolute:!1}),z(this,"enabled",!0),z(this,"attributeListeners",{}),z(this,"selectedModel"),z(this,"changeMap",{}),this.components.add(To.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(To.uuid),this.onDisposed.reset()}static getIFCSchema(e){const t=e.ifcMetadata.schema;if(!t)throw new Error("IFC Schema not found");return t.startsWith("IFC2X3")?"IFC2X3":t.startsWith("IFC4")&&t.replace("IFC4","")===""?"IFC4":t.startsWith("IFC4X3")?"IFC4X3":t}async setData(e,...t){for(const s of t){const{expressID:i}=s;(!i||i===-1)&&(s.expressID=this.getNewExpressID(e)),await e.setProperties(s.expressID,s),this.registerChange(e,s.expressID)}}async newPset(e,t,s){const i=To.getIFCSchema(e),{ownerHistoryHandle:n}=await this.getOwnerHistory(e),r=this.newGUID(e),o=new jt[i].IfcLabel(t),a=s?new jt[i].IfcText(s):null,h=new jt[i].IfcPropertySet(r,n,o,a,[]);h.expressID=this.getNewExpressID(e);const c=this.newGUID(e),d=new jt[i].IfcRelDefinesByProperties(c,n,null,null,[],new hs(h.expressID));return d.expressID=this.getNewExpressID(e),await this.setData(e,h,d),{pset:h,rel:d}}async removePset(e,...t){for(const s of t){const i=await e.getProperties(s);if(i?.type!==Uo)continue;const n=await Ir.getPsetRel(e,s);if(n&&(await e.setProperties(n,null),this.registerChange(e,n)),i){for(const r of i.HasProperties)await e.setProperties(r.value,null);await e.setProperties(s,null),this.onPsetRemoved.trigger({model:e,psetID:s}),this.registerChange(e,s)}}}newSingleStringProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleNumericProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleBooleanProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}async removePsetProp(e,t,s){const i=await e.getProperties(t),n=await e.getProperties(s);!i||!n||i.type===Uo&&n&&(i.HasProperties=i.HasProperties.filter(r=>r.value!==s),await e.setProperties(s,null),this.registerChange(e,t,s))}addElementToPset(e,t,...s){this.components.get(ko).addEntitiesRelation(e,t,{type:Xi,inv:"IsDefinedBy"},...s)}async addPropToPset(e,t,...s){const i=await e.getProperties(t);if(i){for(const n of s){if(i.HasProperties.includes(n))continue;const r=new hs(n);i.HasProperties.push(r),this.onPropToPset.trigger({model:e,psetID:t,propID:n})}this.registerChange(e,t)}}async createIfcRel(e,t,s,i){const n=A2[t];if(!n)throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const r=e.ifcMetadata.schema,o=x2[n],a=jt[r][n];if(!(o&&a))throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const h=[new jt[r].IfcGloballyUniqueId(vr.create())],{related:c,relating:d}=o,u=[...new Set(i)].map(p=>new hs(p)),f=(p,g)=>{for(let E=p;E<g-1;E++)h.push(null)};c<d?(f(1,c),h.push(u),f(c,d),h.push(new hs(s))):(f(1,d),f(d,c),h.push(new hs(s)),h.push(u));const m=new a(...h);return await this.setData(e,m),m}async saveToIfc(e,t){const s=this.components.get(T2),i=s.webIfc,n=await s.readIfcFile(t);await this.components.get(ko).applyRelationChanges();const r=this.changeMap[e.uuid]??[];for(const a of r){const h=await e.getProperties(a);h?i.WriteLine(n,h):i.DeleteLine(n,a)}const o=i.SaveModel(n);return s.webIfc.CloseModel(n),s.cleanUp(),o}async getEntityRef(e,t){const s=await e.getAllPropertiesOfType(t);if(!s)return null;const i=[];for(const n in s){const r=new hs(Number(n));i.push(r)}return i}async setAttributeListener(e,t,s){this.attributeListeners[e.uuid]||(this.attributeListeners[e.uuid]={});const i=this.attributeListeners[e.uuid][t]?this.attributeListeners[e.uuid][t][s]:null;if(i)return i;const n=await e.getProperties(t);if(!n)throw new Error(`Entity with expressID ${t} doesn't exists.`);const r=n[s];if(Array.isArray(r)||!r)throw new Error(`Attribute ${s} is array or null, and it can't have a listener.`);const o=r.value;if(o===void 0||o==null)throw new Error(`Attribute ${s} has a badly defined handle.`);const a=new we;return Object.defineProperty(n[s],"value",{get(){return this._value},async set(h){this._value=h,a.trigger(h)}}),n[s].value=o,this.attributeListeners[e.uuid][t]||(this.attributeListeners[e.uuid][t]={}),this.attributeListeners[e.uuid][t][s]=a,a}getNewExpressID(e){return e.ifcMetadata.maxExpressID++,e.ifcMetadata.maxExpressID}newGUID(e){const t=To.getIFCSchema(e);return new jt[t].IfcGloballyUniqueId(vr.create())}async getOwnerHistory(e){const t=await e.getAllPropertiesOfType(c0);if(!t)throw new Error("No OwnerHistory was found.");const s=Object.keys(t).map(r=>parseInt(r,10)),i=t[s[0]],n=new hs(i.expressID);return{ownerHistory:i,ownerHistoryHandle:n}}registerChange(e,...t){this.changeMap[e.uuid]||(this.changeMap[e.uuid]=new Set);for(const s of t)this.changeMap[e.uuid].add(s),this.onDataChanged.trigger({model:e,expressID:s})}async newSingleProperty(e,t,s,i){const n=To.getIFCSchema(e),r=new jt[n].IfcIdentifier(s),o=new jt[n][t](i),a=new jt[n].IfcPropertySingleValue(r,null,o,null);return a.expressID=this.getNewExpressID(e),await this.setData(e,a),a}};z(o1,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");let F2=o1;const a1=class vf extends ht{constructor(e){super(e),z(this,"onDisposed",new we),z(this,"onRelationsIndexed",new we),z(this,"relationMaps",{}),z(this,"enabled",!0),z(this,"_relToAttributesMap",zg),z(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements","HasControlElements","AssignedToFlowElement","ConnectedTo","ConnectedFrom","ReferencedBy","Declares","HasContext","Controls","IsNestedBy","Nests","DocumentRefForObjects"]),z(this,"_ifcRels",[Xn,Vo,Yo,Go,Xi,Ho,Wo,Kn,jo,Zo,Xo,Ko,Qo,qo,Jo]),z(this,"onFragmentsDisposed",t=>{delete this.relationMaps[t.groupID]}),z(this,"_changeMap",{}),z(this,"onEntitiesRelated",new we),this.components.add(vf.uuid,this),e.get(at).onFragmentsDisposed.add(this.onFragmentsDisposed)}indexRelations(e,t,s,i){const n=Object.keys(t).find(c=>c.startsWith("Relating")),r=Object.keys(t).find(c=>c.startsWith("Related"));if(!(n&&r))return;const o=t[n].value,a=t[r].map(c=>c.value),h=this.getAttributeIndex(i);if(h!==null){let c=e.get(o);c||(c=new Map,e.set(o,c));let d=c.get(h);d||(d=[],c.set(h,d)),d.push(...a)}for(const c of a){const d=this.getAttributeIndex(s);if(d===null)continue;let u=e.get(c);u||(u=new Map,e.set(c,u));let f=u.get(d);f||(f=[],u.set(d,f)),f.push(o)}}getAttributeIndex(e){const t=this._inverseAttributes.indexOf(e);return t===-1?null:t}setRelationMap(e,t){this.relationMaps[e.uuid]=t,this.onRelationsIndexed.trigger({modelID:e.uuid,relationsMap:t})}async process(e){if(!e.hasProperties)throw new Error("FragmentsGroup properties not found");let t=this.relationMaps[e.uuid];if(t)return t;t=new Map;for(const s of this._ifcRels){const i=await e.getAllPropertiesOfType(s);if(!i)continue;const n=this._relToAttributesMap.get(s);if(!n)continue;const{forRelated:r,forRelating:o}=n;for(const a in i){const h=i[a];this.indexRelations(t,h,r,o)}}return this.setRelationMap(e,t),t}async processFromWebIfc(e,t){const s=new Map;for(const i of this._ifcRels){const n=this._relToAttributesMap.get(i);if(!n)continue;const{forRelated:r,forRelating:o}=n,a=e.GetLineIDsWithType(t,i);for(let h=0;h<a.size();h++){const c=await e.properties.getItemProperties(t,a.get(h));this.indexRelations(s,c,r,o)}}return this.onRelationsIndexed.trigger({modelID:t.toString(),relationsMap:s}),s}getEntityRelations(e,t,s){const i=this.relationMaps[e.uuid];if(!i)throw new Error(`IfcRelationsIndexer: model ${e.uuid} has no relations indexed.`);const n=i.get(t),r=this.getAttributeIndex(s);return n===void 0||r===null?null:n.get(r)||null}serializeRelations(e){const t={};for(const[s,i]of e.entries()){t[s]||(t[s]={});for(const[n,r]of i.entries())t[s][n]=r}return JSON.stringify(t)}serializeModelRelations(e){const t=this.relationMaps[e.uuid];return t?this.serializeRelations(t):null}serializeAllRelations(){const e={};for(const t in this.relationMaps){const s=this.relationMaps[t],i={};for(const[n,r]of s.entries()){i[n]||(i[n]={});for(const[o,a]of r.entries())i[n][o]=a}e[t]=i}return JSON.stringify(e)}getRelationsMapFromJSON(e){const t=JSON.parse(e),s=new Map;for(const i in t){const n=t[i],r=new Map;for(const o in n)r.set(Number(o),n[o]);s.set(Number(i),r)}return s}dispose(){this.relationMaps={},this.components.get(at).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(vf.uuid),this.onDisposed.reset()}getEntitiesWithRelation(e,t,s){const i=this.relationMaps[e.uuid];if(!i)throw new Error("IfcRelationsIndexer: the model relations are not indexed!");const n=new Set;for(const[r,o]of i){const a=this.getAttributeIndex(t);if(a===null)throw new Error("IfcRelationsIndexer: invalid inverse attribute name");const h=o.get(a);h&&h.includes(s)&&n.add(r)}return n}addEntityRelations(e,t,s,...i){const n=this.getEntityRelations(e,t,s);if(n)n.push(...i);else{const r=this.getAttributeIndex(s);if(!r)throw new Error(`IfcRelationsIndexer: ${s} is not a valid relation name.`);const o=this.relationMaps[e.uuid].get(t);o?.set(r,i)}}async applyRelationChanges(){const e=this.components.get(at),t=this.components.get(F2);for(const s in this._changeMap){const i=e.groups.get(s);if(!i)continue;const n=this._changeMap[s];for(const[r,o]of n)for(const[a,h]of o){const{related:c,relID:d}=h;if(d){const u=await i.getProperties(d);if(!u)continue;const f=Object.keys(u),m=f.find(g=>g.startsWith("Related")),p=f.find(g=>g.startsWith("Relating"));if(!(m&&p))continue;u[m]=[...c].map(g=>new hs(g)),u[p]=new hs(a),await t.setData(i,u)}else{const u=await t.createIfcRel(i,r,a,[...c]);if(!u)continue;h.relID=u.expressID}}}}addEntitiesRelation(e,t,s,...i){const{type:n,inv:r}=s,o=this.relationMaps[e.uuid];if(!o||!this._ifcRels.includes(n))return;const a=zg.get(n);if(!a)return;const{forRelated:h,forRelating:c}=a;if(!(h===r||c===r))return;let d=this._changeMap[e.uuid];d||(d=new jn,this._changeMap[e.uuid]=d);const u=c===r?[t]:i,f=h===r?[t]:i;let m=d.get(n);m||(m=new jn,m.onItemSet.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:u,relatedIDs:f})),m.onItemUpdated.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:u,relatedIDs:f})),d.set(n,m));for(const p of u){let g=m.get(p);g||(g={related:new No},m.set(p,g)),g.related.add(...f)}for(const p of u){let g=o.get(p);g||(g=new Map,o.set(p,g));const E=this.getAttributeIndex(c);if(E!==null){let I=g.get(E);I||(I=[],g.set(E,I)),I.push(...f)}}for(const p of f){let g=o.get(p);g||(g=new Map,o.set(p,g));const E=this.getAttributeIndex(h);if(E===null)continue;let I=g.get(E);I||(I=[],g.set(E,I)),I.push(...u)}}getEntityChildren(e,t,s=new Set){if(s.add(t),this.relationMaps[e.uuid]===void 0)throw new Error("The provided model has no indices. You have to generate them first.");const i=this.getEntityRelations(e,t,"IsDecomposedBy");if(i)for(const r of i)this.getEntityChildren(e,r,s);const n=this.getEntityRelations(e,t,"ContainsElements");if(n)for(const r of n)this.getEntityChildren(e,r,s);return s}};z(a1,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let ko=a1;const l1=class h1 extends ht{constructor(e){super(e),z(this,"onDisposed",new we),z(this,"onFragmentsLoaded",new we),z(this,"onFragmentsDisposed",new we),z(this,"list",new jn),z(this,"groups",new jn),z(this,"baseCoordinationModel",""),z(this,"baseCoordinationMatrix",new Oe),z(this,"enabled",!0),z(this,"_loader",new Nc),this.components.add(h1.uuid,this)}get meshes(){const e=[];for(const[t,s]of this.list)e.push(s.mesh);return e}dispose(){for(const[e,t]of this.groups)t.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(e){const{uuid:t}=e,s=[];for(const i of e.items)s.push(i.id),this.list.delete(i.id);e.dispose(!0),this.groups.delete(e.uuid),this.groups.size===0&&(this.baseCoordinationModel="",this.baseCoordinationMatrix=new Oe),this.onFragmentsDisposed.trigger({groupID:t,fragmentIDs:s})}load(e,t){const s={coordinate:!0,...t},{coordinate:i,name:n,properties:r,relationsMap:o}=s,a=this._loader.import(e);t&&(a.isStreamed=t.isStreamed||!1),n&&(a.name=n);for(const h of a.items)h.group=a,this.list.set(h.id,h);return i&&this.coordinate([a]),this.groups.set(a.uuid,a),r&&a.setLocalProperties(r),o&&this.components.get(ko).setRelationMap(a,o),this.onFragmentsLoaded.trigger(a),a}export(e){return this._loader.export(e)}getModelIdMap(e){const t={};for(const s in e){const i=this.list.get(s);if(!(i&&i.group))continue;const n=i.group;n.uuid in t||(t[n.uuid]=new Set);const r=e[s];for(const o of r)t[n.uuid].add(o)}return t}modelIdToFragmentIdMap(e){let t={};for(const s in e){const i=this.groups.get(s);if(!i)continue;const n=e[s],r=i.getFragmentMap(n);t={...t,...r}}return t}guidToFragmentIdMap(e){const t={};for(const[s,i]of this.groups){s in t||(t[s]=new Set);for(const n of e){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return this.modelIdToFragmentIdMap(t)}coordinate(e=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const t=e.pop();if(!t)return;this.baseCoordinationModel=t.uuid,this.baseCoordinationMatrix=t.coordinationMatrix.clone()}if(e.length)for(const t of e)t.coordinationMatrix.equals(this.baseCoordinationMatrix)||(t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrix(),this.applyBaseCoordinateSystem(t,t.coordinationMatrix))}applyBaseCoordinateSystem(e,t){t&&e.applyMatrix4(t.clone().invert()),e.applyMatrix4(this.baseCoordinationMatrix)}clone(e,t){const s=e.cloneGroup(t);this.groups.set(s.uuid,s);for(const i of s.items)this.list.set(i.id,i);return s}};z(l1,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let at=l1;var Jh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function R2(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function $h(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var c1={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(l,e){(function(t){l.exports=t()})(function(){return function t(s,i,n){function r(h,c){if(!i[h]){if(!s[h]){var d=typeof $h=="function"&&$h;if(!c&&d)return d(h,!0);if(o)return o(h,!0);var u=new Error("Cannot find module '"+h+"'");throw u.code="MODULE_NOT_FOUND",u}var f=i[h]={exports:{}};s[h][0].call(f.exports,function(m){var p=s[h][1][m];return r(p||m)},f,f.exports,t,s,i,n)}return i[h].exports}for(var o=typeof $h=="function"&&$h,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,s,i){var n=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(a){for(var h,c,d,u,f,m,p,g=[],E=0,I=a.length,v=I,b=n.getTypeOf(a)!=="string";E<a.length;)v=I-E,d=b?(h=a[E++],c=E<I?a[E++]:0,E<I?a[E++]:0):(h=a.charCodeAt(E++),c=E<I?a.charCodeAt(E++):0,E<I?a.charCodeAt(E++):0),u=h>>2,f=(3&h)<<4|c>>4,m=1<v?(15&c)<<2|d>>6:64,p=2<v?63&d:64,g.push(o.charAt(u)+o.charAt(f)+o.charAt(m)+o.charAt(p));return g.join("")},i.decode=function(a){var h,c,d,u,f,m,p=0,g=0,E="data:";if(a.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var I,v=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===o.charAt(64)&&v--,a.charAt(a.length-2)===o.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(I=r.uint8array?new Uint8Array(0|v):new Array(0|v);p<a.length;)h=o.indexOf(a.charAt(p++))<<2|(u=o.indexOf(a.charAt(p++)))>>4,c=(15&u)<<4|(f=o.indexOf(a.charAt(p++)))>>2,d=(3&f)<<6|(m=o.indexOf(a.charAt(p++))),I[g++]=h,f!==64&&(I[g++]=c),m!==64&&(I[g++]=d);return I}},{"./support":30,"./utils":32}],2:[function(t,s,i){var n=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function h(c,d,u,f,m){this.compressedSize=c,this.uncompressedSize=d,this.crc32=u,this.compression=f,this.compressedContent=m}h.prototype={getContentWorker:function(){var c=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),d=this;return c.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(c,d,u){return c.pipe(new o).pipe(new a("uncompressedSize")).pipe(d.compressWorker(u)).pipe(new a("compressedSize")).withStreamInfo("compression",d)},s.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,i){var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,i){var n=t("./utils"),r=function(){for(var o,a=[],h=0;h<256;h++){o=h;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[h]=o}return a}();s.exports=function(o,a){return o!==void 0&&o.length?n.getTypeOf(o)!=="string"?function(h,c,d,u){var f=r,m=u+d;h^=-1;for(var p=u;p<m;p++)h=h>>>8^f[255&(h^c[p])];return-1^h}(0|a,o,o.length,0):function(h,c,d,u){var f=r,m=u+d;h^=-1;for(var p=u;p<m;p++)h=h>>>8^f[255&(h^c.charCodeAt(p))];return-1^h}(0|a,o,o.length,0):0}},{"./utils":32}],5:[function(t,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,s,i){var n=null;n=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:n}},{lie:37}],7:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),h=n?"uint8array":"array";function c(d,u){a.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=u,this.meta={}}i.magic="\b\0",o.inherits(c,a),c.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,d.data),!1)},c.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(u){d.push({data:u,meta:d.meta})}},i.compressWorker=function(d){return new c("Deflate",d)},i.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,i){function n(f,m){var p,g="";for(p=0;p<m;p++)g+=String.fromCharCode(255&f),f>>>=8;return g}function r(f,m,p,g,E,I){var v,b,C=f.file,F=f.compression,A=I!==h.utf8encode,R=o.transformTo("string",I(C.name)),O=o.transformTo("string",h.utf8encode(C.name)),L=C.comment,k=o.transformTo("string",I(L)),x=o.transformTo("string",h.utf8encode(L)),M=O.length!==C.name.length,w=x.length!==L.length,G="",J="",Z="",le=C.dir,ee=C.date,xe={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(xe.crc32=f.crc32,xe.compressedSize=f.compressedSize,xe.uncompressedSize=f.uncompressedSize);var X=0;m&&(X|=8),A||!M&&!w||(X|=2048);var j=0,be=0;le&&(j|=16),E==="UNIX"?(be=798,j|=function(ue,He){var Xe=ue;return ue||(Xe=He?16893:33204),(65535&Xe)<<16}(C.unixPermissions,le)):(be=20,j|=function(ue){return 63&(ue||0)}(C.dosPermissions)),v=ee.getUTCHours(),v<<=6,v|=ee.getUTCMinutes(),v<<=5,v|=ee.getUTCSeconds()/2,b=ee.getUTCFullYear()-1980,b<<=4,b|=ee.getUTCMonth()+1,b<<=5,b|=ee.getUTCDate(),M&&(J=n(1,1)+n(c(R),4)+O,G+="up"+n(J.length,2)+J),w&&(Z=n(1,1)+n(c(k),4)+x,G+="uc"+n(Z.length,2)+Z);var fe="";return fe+=`
\0`,fe+=n(X,2),fe+=F.magic,fe+=n(v,2),fe+=n(b,2),fe+=n(xe.crc32,4),fe+=n(xe.compressedSize,4),fe+=n(xe.uncompressedSize,4),fe+=n(R.length,2),fe+=n(G.length,2),{fileRecord:d.LOCAL_FILE_HEADER+fe+R+G,dirRecord:d.CENTRAL_FILE_HEADER+n(be,2)+fe+n(k.length,2)+"\0\0\0\0"+n(j,4)+n(g,4)+R+G+k}}var o=t("../utils"),a=t("../stream/GenericWorker"),h=t("../utf8"),c=t("../crc32"),d=t("../signature");function u(f,m,p,g){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=g,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(u,a),u.prototype.push=function(f){var m=f.meta.percent||0,p=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,a.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-g-1))/p:100}}))},u.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var p=r(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,p=r(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(g){return d.DATA_DESCRIPTOR+n(g.crc32,4)+n(g.compressedSize,4)+n(g.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-f,g=function(E,I,v,b,C){var F=o.transformTo("string",C(b));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(E,2)+n(E,2)+n(I,4)+n(v,4)+n(F.length,2)+F}(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(p){m.processChunk(p)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(p){m.error(p)}),this},u.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(f){var m=this._sources;if(!a.prototype.error.call(this,f))return!1;for(var p=0;p<m.length;p++)try{m[p].error(f)}catch{}return!0},u.prototype.lock=function(){a.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},s.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,i){var n=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(o,a,h){var c=new r(a.streamFiles,h,a.platform,a.encodeFileName),d=0;try{o.forEach(function(u,f){d++;var m=function(I,v){var b=I||v,C=n[b];if(!C)throw new Error(b+" is not a valid compression method !");return C}(f.options.compression,a.compression),p=f.options.compressionOptions||a.compressionOptions||{},g=f.dir,E=f.date;f._compressWorker(m,p).withStreamInfo("file",{name:u,dir:g,date:E,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(c)}),c.entriesCount=d}catch(u){c.error(u)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,i){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,o){return new n().loadAsync(r,o)},n.external=t("./external"),s.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,i){var n=t("./utils"),r=t("./external"),o=t("./utf8"),a=t("./zipEntries"),h=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function d(u){return new r.Promise(function(f,m){var p=u.decompressed.getContentWorker().pipe(new h);p.on("error",function(g){m(g)}).on("end",function(){p.streamInfo.crc32!==u.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}s.exports=function(u,f){var m=this;return f=n.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(u)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",u,!0,f.optimizedBinaryString,f.base64).then(function(p){var g=new a(f);return g.load(p),g}).then(function(p){var g=[r.Promise.resolve(p)],E=p.files;if(f.checkCRC32)for(var I=0;I<E.length;I++)g.push(d(E[I]));return r.Promise.all(g)}).then(function(p){for(var g=p.shift(),E=g.files,I=0;I<E.length;I++){var v=E[I],b=v.fileNameStr,C=n.resolve(v.fileNameStr);m.file(C,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:f.createFolders}),v.dir||(m.file(C).unsafeOriginalName=b)}return g.zipComment.length&&(m.comment=g.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,i){var n=t("../utils"),r=t("../stream/GenericWorker");function o(a,h){r.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(h)}n.inherits(o,r),o.prototype._bindStream=function(a){var h=this;(this._stream=a).pause(),a.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,i){var n=t("readable-stream").Readable;function r(o,a,h){n.call(this,a),this._helper=o;var c=this;o.on("data",function(d,u){c.push(d)||c._helper.pause(),h&&h(u)}).on("error",function(d){c.emit("error",d)}).on("end",function(){c.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},s.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,s,i){function n(C,F,A){var R,O=o.getTypeOf(F),L=o.extend(A||{},c);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(C=E(C)),L.createFolders&&(R=g(C))&&I.call(this,R,!0);var k=O==="string"&&L.binary===!1&&L.base64===!1;A&&A.binary!==void 0||(L.binary=!k),(F instanceof d&&F.uncompressedSize===0||L.dir||!F||F.length===0)&&(L.base64=!1,L.binary=!0,F="",L.compression="STORE",O="string");var x=null;x=F instanceof d||F instanceof a?F:m.isNode&&m.isStream(F)?new p(C,F):o.prepareContent(C,F,L.binary,L.optimizedBinaryString,L.base64);var M=new u(C,x,L);this.files[C]=M}var r=t("./utf8"),o=t("./utils"),a=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),c=t("./defaults"),d=t("./compressedObject"),u=t("./zipObject"),f=t("./generate"),m=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),g=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var F=C.lastIndexOf("/");return 0<F?C.substring(0,F):""},E=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},I=function(C,F){return F=F!==void 0?F:c.createFolders,C=E(C),this.files[C]||n.call(this,C,null,{dir:!0,createFolders:F}),this.files[C]};function v(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var b={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var F,A,R;for(F in this.files)R=this.files[F],(A=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&C(A,R)},filter:function(C){var F=[];return this.forEach(function(A,R){C(A,R)&&F.push(R)}),F},file:function(C,F,A){if(arguments.length!==1)return C=this.root+C,n.call(this,C,F,A),this;if(v(C)){var R=C;return this.filter(function(L,k){return!k.dir&&R.test(L)})}var O=this.files[this.root+C];return O&&!O.dir?O:null},folder:function(C){if(!C)return this;if(v(C))return this.filter(function(O,L){return L.dir&&C.test(O)});var F=this.root+C,A=I.call(this,F),R=this.clone();return R.root=A.name,R},remove:function(C){C=this.root+C;var F=this.files[C];if(F||(C.slice(-1)!=="/"&&(C+="/"),F=this.files[C]),F&&!F.dir)delete this.files[C];else for(var A=this.filter(function(O,L){return L.name.slice(0,C.length)===C}),R=0;R<A.length;R++)delete this.files[A[R].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var F,A={};try{if((A=o.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");o.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var R=A.comment||this.comment||"";F=f.generateWorker(this,A,R)}catch(O){(F=new a("error")).error(O)}return new h(F,A.type||"string",A.mimeType)},generateAsync:function(C,F){return this.generateInternalStream(C).accumulate(F)},generateNodeStream:function(C,F){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(F)}};s.exports=b},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,i){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o);for(var a=0;a<this.data.length;a++)o[a]=255&o[a]}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var a=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===a&&this.data[u+1]===h&&this.data[u+2]===c&&this.data[u+3]===d)return u-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var a=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),u=this.readData(4);return a===u[0]&&h===u[1]&&c===u[2]&&d===u[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,s,i){var n=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var a,h=0;for(this.checkOffset(o),a=this.index+o-1;a>=this.index;a--)h=(h<<8)+this.byteAt(a);return this.index+=o,h},readString:function(o){return n.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=r},{"../utils":32}],19:[function(t,s,i){var n=t("./Uint8ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,s,i){var n=t("./ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,i){var n=t("../utils"),r=t("../support"),o=t("./ArrayReader"),a=t("./StringReader"),h=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");s.exports=function(d){var u=n.getTypeOf(d);return n.checkSupport(u),u!=="string"||r.uint8array?u==="nodebuffer"?new h(d):r.uint8array?new c(n.transformTo("uint8array",d)):new o(n.transformTo("array",d)):new a(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,i){var n=t("./GenericWorker"),r=t("../utils");function o(a){n.call(this,"ConvertWorker to "+a),this.destType=a}r.inherits(o,n),o.prototype.processChunk=function(a){this.push({data:r.transformTo(this.destType,a.data),meta:a.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,i){var n=t("./GenericWorker"),r=t("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n),o.prototype.processChunk=function(a){this.streamInfo.crc32=r(a.data,this.streamInfo.crc32||0),this.push(a)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}n.inherits(o,r),o.prototype.processChunk=function(a){if(a){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+a.data.length}r.prototype.processChunk.call(this,a)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=n.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,h);break;case"uint8array":a=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":a=this.data.slice(this.index,h)}return this.index=h,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,i){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var a=0;a<this._listeners[r].length;a++)this._listeners[r][a].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(a){o.processChunk(a)}),r.on("end",function(){o.end()}),r.on("error",function(a){o.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},s.exports=n},{}],29:[function(t,s,i){var n=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),a=t("../base64"),h=t("../support"),c=t("../external"),d=null;if(h.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(m,p){return new c.Promise(function(g,E){var I=[],v=m._internalType,b=m._outputType,C=m._mimeType;m.on("data",function(F,A){I.push(F),p&&p(A)}).on("error",function(F){I=[],E(F)}).on("end",function(){try{var F=function(A,R,O){switch(A){case"blob":return n.newBlob(n.transformTo("arraybuffer",R),O);case"base64":return a.encode(R);default:return n.transformTo(A,R)}}(b,function(A,R){var O,L=0,k=null,x=0;for(O=0;O<R.length;O++)x+=R[O].length;switch(A){case"string":return R.join("");case"array":return Array.prototype.concat.apply([],R);case"uint8array":for(k=new Uint8Array(x),O=0;O<R.length;O++)k.set(R[O],L),L+=R[O].length;return k;case"nodebuffer":return Buffer.concat(R);default:throw new Error("concat : unsupported type '"+A+"'")}}(v,I),C);g(F)}catch(A){E(A)}I=[]}).resume()})}function f(m,p,g){var E=p;switch(p){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=p,this._mimeType=g,n.checkSupport(E),this._worker=m.pipe(new r(E)),m.lock()}catch(I){this._worker=new o("error"),this._worker.error(I)}}f.prototype={accumulate:function(m){return u(this,m)},on:function(m,p){var g=this;return m==="data"?this._worker.on(m,function(E){p.call(g,E.data,E.meta)}):this._worker.on(m,function(){n.delay(p,arguments,g)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},s.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=r.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,i){for(var n=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),a=t("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function d(){a.call(this,"utf-8 decode"),this.leftOver=null}function u(){a.call(this,"utf-8 encode")}i.utf8encode=function(f){return r.nodebuffer?o.newBufferFrom(f,"utf-8"):function(m){var p,g,E,I,v,b=m.length,C=0;for(I=0;I<b;I++)(64512&(g=m.charCodeAt(I)))==55296&&I+1<b&&(64512&(E=m.charCodeAt(I+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),I++),C+=g<128?1:g<2048?2:g<65536?3:4;for(p=r.uint8array?new Uint8Array(C):new Array(C),I=v=0;v<C;I++)(64512&(g=m.charCodeAt(I)))==55296&&I+1<b&&(64512&(E=m.charCodeAt(I+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),I++),g<128?p[v++]=g:(g<2048?p[v++]=192|g>>>6:(g<65536?p[v++]=224|g>>>12:(p[v++]=240|g>>>18,p[v++]=128|g>>>12&63),p[v++]=128|g>>>6&63),p[v++]=128|63&g);return p}(f)},i.utf8decode=function(f){return r.nodebuffer?n.transformTo("nodebuffer",f).toString("utf-8"):function(m){var p,g,E,I,v=m.length,b=new Array(2*v);for(p=g=0;p<v;)if((E=m[p++])<128)b[g++]=E;else if(4<(I=h[E]))b[g++]=65533,p+=I-1;else{for(E&=I===2?31:I===3?15:7;1<I&&p<v;)E=E<<6|63&m[p++],I--;1<I?b[g++]=65533:E<65536?b[g++]=E:(E-=65536,b[g++]=55296|E>>10&1023,b[g++]=56320|1023&E)}return b.length!==g&&(b.subarray?b=b.subarray(0,g):b.length=g),n.applyFromCharCode(b)}(f=n.transformTo(r.uint8array?"uint8array":"array",f))},n.inherits(d,a),d.prototype.processChunk=function(f){var m=n.transformTo(r.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var g=function(I,v){var b;for((v=v||I.length)>I.length&&(v=I.length),b=v-1;0<=b&&(192&I[b])==128;)b--;return b<0||b===0?v:b+h[I[b]]>v?b:v}(m),E=m;g!==m.length&&(r.uint8array?(E=m.subarray(0,g),this.leftOver=m.subarray(g,m.length)):(E=m.slice(0,g),this.leftOver=m.slice(g,m.length))),this.push({data:i.utf8decode(E),meta:f.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,n.inherits(u,a),u.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,i){var n=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),a=t("./external");function h(p){return p}function c(p,g){for(var E=0;E<p.length;++E)g[E]=255&p.charCodeAt(E);return g}t("setimmediate"),i.newBlob=function(p,g){i.checkSupport("blob");try{return new Blob([p],{type:g})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(p),E.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(p,g,E){var I=[],v=0,b=p.length;if(b<=E)return String.fromCharCode.apply(null,p);for(;v<b;)g==="array"||g==="nodebuffer"?I.push(String.fromCharCode.apply(null,p.slice(v,Math.min(v+E,b)))):I.push(String.fromCharCode.apply(null,p.subarray(v,Math.min(v+E,b)))),v+=E;return I.join("")},stringifyByChar:function(p){for(var g="",E=0;E<p.length;E++)g+=String.fromCharCode(p[E]);return g},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function u(p){var g=65536,E=i.getTypeOf(p),I=!0;if(E==="uint8array"?I=d.applyCanBeUsed.uint8array:E==="nodebuffer"&&(I=d.applyCanBeUsed.nodebuffer),I)for(;1<g;)try{return d.stringifyByChunk(p,E,g)}catch{g=Math.floor(g/2)}return d.stringifyByChar(p)}function f(p,g){for(var E=0;E<p.length;E++)g[E]=p[E];return g}i.applyFromCharCode=u;var m={};m.string={string:h,array:function(p){return c(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return c(p,new Uint8Array(p.length))},nodebuffer:function(p){return c(p,o.allocBuffer(p.length))}},m.array={string:u,array:h,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},m.arraybuffer={string:function(p){return u(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:h,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:u,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:h,nodebuffer:function(p){return o.newBufferFrom(p)}},m.nodebuffer={string:u,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:h},i.transformTo=function(p,g){if(g=g||"",!p)return g;i.checkSupport(p);var E=i.getTypeOf(g);return m[E][p](g)},i.resolve=function(p){for(var g=p.split("/"),E=[],I=0;I<g.length;I++){var v=g[I];v==="."||v===""&&I!==0&&I!==g.length-1||(v===".."?E.pop():E.push(v))}return E.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":n.nodebuffer&&o.isBuffer(p)?"nodebuffer":n.uint8array&&p instanceof Uint8Array?"uint8array":n.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!n[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var g,E,I="";for(E=0;E<(p||"").length;E++)I+="\\x"+((g=p.charCodeAt(E))<16?"0":"")+g.toString(16).toUpperCase();return I},i.delay=function(p,g,E){setImmediate(function(){p.apply(E||null,g||[])})},i.inherits=function(p,g){function E(){}E.prototype=g.prototype,p.prototype=new E},i.extend=function(){var p,g,E={};for(p=0;p<arguments.length;p++)for(g in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],g)&&E[g]===void 0&&(E[g]=arguments[p][g]);return E},i.prepareContent=function(p,g,E,I,v){return a.Promise.resolve(g).then(function(b){return n.blob&&(b instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(b))!==-1)&&typeof FileReader<"u"?new a.Promise(function(C,F){var A=new FileReader;A.onload=function(R){C(R.target.result)},A.onerror=function(R){F(R.target.error)},A.readAsArrayBuffer(b)}):b}).then(function(b){var C=i.getTypeOf(b);return C?(C==="arraybuffer"?b=i.transformTo("uint8array",b):C==="string"&&(v?b=r.decode(b):E&&I!==!0&&(b=function(F){return c(F,n.uint8array?new Uint8Array(F.length):new Array(F.length))}(b))),b):a.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),a=t("./zipEntry"),h=t("./support");function c(d){this.files=[],this.loadOptions=d}c.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(u)+", expected "+r.pretty(d)+")")}},isSignature:function(d,u){var f=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===u;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),u=h.uint8array?"uint8array":"array",f=r.transformTo(u,d);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,u,f,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),u=this.reader.readInt(4),f=this.reader.readData(u),this.zip64ExtensibleData[d]={id:d,length:u,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,u;for(d=0;d<this.files.length;d++)u=this.files[d],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var u=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=u-f;if(0<m)this.isSignature(u,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=n(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),a=t("./crc32"),h=t("./utf8"),c=t("./compressions"),d=t("./support");function u(f,m){this.options=f,this.loadOptions=m}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(g){for(var E in c)if(Object.prototype.hasOwnProperty.call(c,E)&&c[E].magic===g)return c[E];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,p,g,E=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<E;)m=f.readInt(2),p=f.readInt(2),g=f.readData(p),this.extraFields[m]={id:m,length:p,value:g};f.setIndex(E)},handleUTF8:function(){var f=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=r.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var E=r.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=n(f.value);return m.readInt(1)!==1||a(this.fileName)!==m.readInt(4)?null:h.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=n(f.value);return m.readInt(1)!==1||a(this.fileComment)!==m.readInt(4)?null:h.utf8decode(m.readData(f.length-5))}return null}},s.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,i){function n(m,p,g){this.name=m,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=p,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),a=t("./utf8"),h=t("./compressedObject"),c=t("./stream/GenericWorker");n.prototype={internalStream:function(m){var p=null,g="string";try{if(!m)throw new Error("No output type specified.");var E=(g=m.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),p=this._decompressWorker();var I=!this._dataBinary;I&&!E&&(p=p.pipe(new a.Utf8EncodeWorker)),!I&&E&&(p=p.pipe(new a.Utf8DecodeWorker))}catch(v){(p=new c("error")).error(v)}return new r(p,g,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof h&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new a.Utf8EncodeWorker)),h.createWorkerFrom(g,m,p)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<d.length;f++)n.prototype[d[f]]=u;s.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,i){(function(n){var r,o,a=n.MutationObserver||n.WebKitMutationObserver;if(a){var h=0,c=new a(m),d=n.document.createTextNode("");c.observe(d,{characterData:!0}),r=function(){d.data=h=++h%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var p=n.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},n.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var u=new n.MessageChannel;u.port1.onmessage=m,r=function(){u.port2.postMessage(0)}}var f=[];function m(){var p,g;o=!0;for(var E=f.length;E;){for(g=f,f=[],p=-1;++p<E;)g[p]();E=f.length}o=!1}s.exports=function(p){f.push(p)!==1||o||r()}}).call(this,typeof Jh<"u"?Jh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,i){var n=t("immediate");function r(){}var o={},a=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function d(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,E!==r&&p(this,E)}function u(E,I,v){this.promise=E,typeof I=="function"&&(this.onFulfilled=I,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function f(E,I,v){n(function(){var b;try{b=I(v)}catch(C){return o.reject(E,C)}b===E?o.reject(E,new TypeError("Cannot resolve promise with itself")):o.resolve(E,b)})}function m(E){var I=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof I=="function")return function(){I.apply(E,arguments)}}function p(E,I){var v=!1;function b(A){v||(v=!0,o.reject(E,A))}function C(A){v||(v=!0,o.resolve(E,A))}var F=g(function(){I(C,b)});F.status==="error"&&b(F.value)}function g(E,I){var v={};try{v.value=E(I),v.status="success"}catch(b){v.status="error",v.value=b}return v}(s.exports=d).prototype.finally=function(E){if(typeof E!="function")return this;var I=this.constructor;return this.then(function(v){return I.resolve(E()).then(function(){return v})},function(v){return I.resolve(E()).then(function(){throw v})})},d.prototype.catch=function(E){return this.then(null,E)},d.prototype.then=function(E,I){if(typeof E!="function"&&this.state===h||typeof I!="function"&&this.state===a)return this;var v=new this.constructor(r);return this.state!==c?f(v,this.state===h?E:I,this.outcome):this.queue.push(new u(v,E,I)),v},u.prototype.callFulfilled=function(E){o.resolve(this.promise,E)},u.prototype.otherCallFulfilled=function(E){f(this.promise,this.onFulfilled,E)},u.prototype.callRejected=function(E){o.reject(this.promise,E)},u.prototype.otherCallRejected=function(E){f(this.promise,this.onRejected,E)},o.resolve=function(E,I){var v=g(m,I);if(v.status==="error")return o.reject(E,v.value);var b=v.value;if(b)p(E,b);else{E.state=h,E.outcome=I;for(var C=-1,F=E.queue.length;++C<F;)E.queue[C].callFulfilled(I)}return E},o.reject=function(E,I){E.state=a,E.outcome=I;for(var v=-1,b=E.queue.length;++v<b;)E.queue[v].callRejected(I);return E},d.resolve=function(E){return E instanceof this?E:o.resolve(new this(r),E)},d.reject=function(E){var I=new this(r);return o.reject(I,E)},d.all=function(E){var I=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=E.length,b=!1;if(!v)return this.resolve([]);for(var C=new Array(v),F=0,A=-1,R=new this(r);++A<v;)O(E[A],A);return R;function O(L,k){I.resolve(L).then(function(x){C[k]=x,++F!==v||b||(b=!0,o.resolve(R,C))},function(x){b||(b=!0,o.reject(R,x))})}},d.race=function(E){var I=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=E.length,b=!1;if(!v)return this.resolve([]);for(var C=-1,F=new this(r);++C<v;)A=E[C],I.resolve(A).then(function(R){b||(b=!0,o.resolve(F,R))},function(R){b||(b=!0,o.reject(F,R))});var A;return F}},{immediate:36}],38:[function(t,s,i){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,i){var n=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),h=t("./zlib/zstream"),c=Object.prototype.toString,d=0,u=-1,f=0,m=8;function p(E){if(!(this instanceof p))return new p(E);this.options=r.assign({level:u,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},E||{});var I=this.options;I.raw&&0<I.windowBits?I.windowBits=-I.windowBits:I.gzip&&0<I.windowBits&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var v=n.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(v!==d)throw new Error(a[v]);if(I.header&&n.deflateSetHeader(this.strm,I.header),I.dictionary){var b;if(b=typeof I.dictionary=="string"?o.string2buf(I.dictionary):c.call(I.dictionary)==="[object ArrayBuffer]"?new Uint8Array(I.dictionary):I.dictionary,(v=n.deflateSetDictionary(this.strm,b))!==d)throw new Error(a[v]);this._dict_set=!0}}function g(E,I){var v=new p(I);if(v.push(E,!0),v.err)throw v.msg||a[v.err];return v.result}p.prototype.push=function(E,I){var v,b,C=this.strm,F=this.options.chunkSize;if(this.ended)return!1;b=I===~~I?I:I===!0?4:0,typeof E=="string"?C.input=o.string2buf(E):c.call(E)==="[object ArrayBuffer]"?C.input=new Uint8Array(E):C.input=E,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new r.Buf8(F),C.next_out=0,C.avail_out=F),(v=n.deflate(C,b))!==1&&v!==d)return this.onEnd(v),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||b!==4&&b!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(C.output,C.next_out))):this.onData(r.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&v!==1);return b===4?(v=n.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===d):b!==2||(this.onEnd(d),!(C.avail_out=0))},p.prototype.onData=function(E){this.chunks.push(E)},p.prototype.onEnd=function(E){E===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=p,i.deflate=g,i.deflateRaw=function(E,I){return(I=I||{}).raw=!0,g(E,I)},i.gzip=function(E,I){return(I=I||{}).gzip=!0,g(E,I)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,i){var n=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),h=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),u=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},p||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||p&&p.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var E=n.inflateInit2(this.strm,g.windowBits);if(E!==a.Z_OK)throw new Error(h[E]);this.header=new d,n.inflateGetHeader(this.strm,this.header)}function m(p,g){var E=new f(g);if(E.push(p,!0),E.err)throw E.msg||h[E.err];return E.result}f.prototype.push=function(p,g){var E,I,v,b,C,F,A=this.strm,R=this.options.chunkSize,O=this.options.dictionary,L=!1;if(this.ended)return!1;I=g===~~g?g:g===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof p=="string"?A.input=o.binstring2buf(p):u.call(p)==="[object ArrayBuffer]"?A.input=new Uint8Array(p):A.input=p,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new r.Buf8(R),A.next_out=0,A.avail_out=R),(E=n.inflate(A,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&O&&(F=typeof O=="string"?o.string2buf(O):u.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,E=n.inflateSetDictionary(this.strm,F)),E===a.Z_BUF_ERROR&&L===!0&&(E=a.Z_OK,L=!1),E!==a.Z_STREAM_END&&E!==a.Z_OK)return this.onEnd(E),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&E!==a.Z_STREAM_END&&(A.avail_in!==0||I!==a.Z_FINISH&&I!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=o.utf8border(A.output,A.next_out),b=A.next_out-v,C=o.buf2string(A.output,v),A.next_out=b,A.avail_out=R-b,b&&r.arraySet(A.output,A.output,v,b,0),this.onData(C)):this.onData(r.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(L=!0)}while((0<A.avail_in||A.avail_out===0)&&E!==a.Z_STREAM_END);return E===a.Z_STREAM_END&&(I=a.Z_FINISH),I===a.Z_FINISH?(E=n.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===a.Z_OK):I!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(A.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=f,i.inflate=m,i.inflateRaw=function(p,g){return(g=g||{}).raw=!0,m(p,g)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(a){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},i.shrinkBuf=function(a,h){return a.length===h?a:a.subarray?a.subarray(0,h):(a.length=h,a)};var r={arraySet:function(a,h,c,d,u){if(h.subarray&&a.subarray)a.set(h.subarray(c,c+d),u);else for(var f=0;f<d;f++)a[u+f]=h[c+f]},flattenChunks:function(a){var h,c,d,u,f,m;for(h=d=0,c=a.length;h<c;h++)d+=a[h].length;for(m=new Uint8Array(d),h=u=0,c=a.length;h<c;h++)f=a[h],m.set(f,u),u+=f.length;return m}},o={arraySet:function(a,h,c,d,u){for(var f=0;f<d;f++)a[u+f]=h[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};i.setTyped=function(a){a?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(n)},{}],42:[function(t,s,i){var n=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var a=new n.Buf8(256),h=0;h<256;h++)a[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(d,u){if(u<65537&&(d.subarray&&o||!d.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(d,u));for(var f="",m=0;m<u;m++)f+=String.fromCharCode(d[m]);return f}a[254]=a[254]=1,i.string2buf=function(d){var u,f,m,p,g,E=d.length,I=0;for(p=0;p<E;p++)(64512&(f=d.charCodeAt(p)))==55296&&p+1<E&&(64512&(m=d.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),I+=f<128?1:f<2048?2:f<65536?3:4;for(u=new n.Buf8(I),p=g=0;g<I;p++)(64512&(f=d.charCodeAt(p)))==55296&&p+1<E&&(64512&(m=d.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),f<128?u[g++]=f:(f<2048?u[g++]=192|f>>>6:(f<65536?u[g++]=224|f>>>12:(u[g++]=240|f>>>18,u[g++]=128|f>>>12&63),u[g++]=128|f>>>6&63),u[g++]=128|63&f);return u},i.buf2binstring=function(d){return c(d,d.length)},i.binstring2buf=function(d){for(var u=new n.Buf8(d.length),f=0,m=u.length;f<m;f++)u[f]=d.charCodeAt(f);return u},i.buf2string=function(d,u){var f,m,p,g,E=u||d.length,I=new Array(2*E);for(f=m=0;f<E;)if((p=d[f++])<128)I[m++]=p;else if(4<(g=a[p]))I[m++]=65533,f+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&f<E;)p=p<<6|63&d[f++],g--;1<g?I[m++]=65533:p<65536?I[m++]=p:(p-=65536,I[m++]=55296|p>>10&1023,I[m++]=56320|1023&p)}return c(I,m)},i.utf8border=function(d,u){var f;for((u=u||d.length)>d.length&&(u=d.length),f=u-1;0<=f&&(192&d[f])==128;)f--;return f<0||f===0?u:f+a[d[f]]>u?f:u}},{"./common":41}],43:[function(t,s,i){s.exports=function(n,r,o,a){for(var h=65535&n|0,c=n>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;c=c+(h=h+r[a++]|0)|0,--d;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(t,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,i){var n=function(){for(var r,o=[],a=0;a<256;a++){r=a;for(var h=0;h<8;h++)r=1&r?3988292384^r>>>1:r>>>1;o[a]=r}return o}();s.exports=function(r,o,a,h){var c=n,d=h+a;r^=-1;for(var u=h;u<d;u++)r=r>>>8^c[255&(r^o[u])];return-1^r}},{}],46:[function(t,s,i){var n,r=t("../utils/common"),o=t("./trees"),a=t("./adler32"),h=t("./crc32"),c=t("./messages"),d=0,u=4,f=0,m=-2,p=-1,g=4,E=2,I=8,v=9,b=286,C=30,F=19,A=2*b+1,R=15,O=3,L=258,k=L+O+1,x=42,M=113,w=1,G=2,J=3,Z=4;function le(_,$){return _.msg=c[$],$}function ee(_){return(_<<1)-(4<_?9:0)}function xe(_){for(var $=_.length;0<=--$;)_[$]=0}function X(_){var $=_.state,Q=$.pending;Q>_.avail_out&&(Q=_.avail_out),Q!==0&&(r.arraySet(_.output,$.pending_buf,$.pending_out,Q,_.next_out),_.next_out+=Q,$.pending_out+=Q,_.total_out+=Q,_.avail_out-=Q,$.pending-=Q,$.pending===0&&($.pending_out=0))}function j(_,$){o._tr_flush_block(_,0<=_.block_start?_.block_start:-1,_.strstart-_.block_start,$),_.block_start=_.strstart,X(_.strm)}function be(_,$){_.pending_buf[_.pending++]=$}function fe(_,$){_.pending_buf[_.pending++]=$>>>8&255,_.pending_buf[_.pending++]=255&$}function ue(_,$){var Q,N,P=_.max_chain_length,W=_.strstart,se=_.prev_length,ie=_.nice_match,K=_.strstart>_.w_size-k?_.strstart-(_.w_size-k):0,de=_.window,Te=_.w_mask,pe=_.prev,Pe=_.strstart+L,Ke=de[W+se-1],Ye=de[W+se];_.prev_length>=_.good_match&&(P>>=2),ie>_.lookahead&&(ie=_.lookahead);do if(de[(Q=$)+se]===Ye&&de[Q+se-1]===Ke&&de[Q]===de[W]&&de[++Q]===de[W+1]){W+=2,Q++;do;while(de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&de[++W]===de[++Q]&&W<Pe);if(N=L-(Pe-W),W=Pe-L,se<N){if(_.match_start=$,ie<=(se=N))break;Ke=de[W+se-1],Ye=de[W+se]}}while(($=pe[$&Te])>K&&--P!=0);return se<=_.lookahead?se:_.lookahead}function He(_){var $,Q,N,P,W,se,ie,K,de,Te,pe=_.w_size;do{if(P=_.window_size-_.lookahead-_.strstart,_.strstart>=pe+(pe-k)){for(r.arraySet(_.window,_.window,pe,pe,0),_.match_start-=pe,_.strstart-=pe,_.block_start-=pe,$=Q=_.hash_size;N=_.head[--$],_.head[$]=pe<=N?N-pe:0,--Q;);for($=Q=pe;N=_.prev[--$],_.prev[$]=pe<=N?N-pe:0,--Q;);P+=pe}if(_.strm.avail_in===0)break;if(se=_.strm,ie=_.window,K=_.strstart+_.lookahead,de=P,Te=void 0,Te=se.avail_in,de<Te&&(Te=de),Q=Te===0?0:(se.avail_in-=Te,r.arraySet(ie,se.input,se.next_in,Te,K),se.state.wrap===1?se.adler=a(se.adler,ie,Te,K):se.state.wrap===2&&(se.adler=h(se.adler,ie,Te,K)),se.next_in+=Te,se.total_in+=Te,Te),_.lookahead+=Q,_.lookahead+_.insert>=O)for(W=_.strstart-_.insert,_.ins_h=_.window[W],_.ins_h=(_.ins_h<<_.hash_shift^_.window[W+1])&_.hash_mask;_.insert&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[W+O-1])&_.hash_mask,_.prev[W&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=W,W++,_.insert--,!(_.lookahead+_.insert<O)););}while(_.lookahead<k&&_.strm.avail_in!==0)}function Xe(_,$){for(var Q,N;;){if(_.lookahead<k){if(He(_),_.lookahead<k&&$===d)return w;if(_.lookahead===0)break}if(Q=0,_.lookahead>=O&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,Q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),Q!==0&&_.strstart-Q<=_.w_size-k&&(_.match_length=ue(_,Q)),_.match_length>=O)if(N=o._tr_tally(_,_.strstart-_.match_start,_.match_length-O),_.lookahead-=_.match_length,_.match_length<=_.max_lazy_match&&_.lookahead>=O){for(_.match_length--;_.strstart++,_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,Q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart,--_.match_length!=0;);_.strstart++}else _.strstart+=_.match_length,_.match_length=0,_.ins_h=_.window[_.strstart],_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+1])&_.hash_mask;else N=o._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++;if(N&&(j(_,!1),_.strm.avail_out===0))return w}return _.insert=_.strstart<O-1?_.strstart:O-1,$===u?(j(_,!0),_.strm.avail_out===0?J:Z):_.last_lit&&(j(_,!1),_.strm.avail_out===0)?w:G}function Se(_,$){for(var Q,N,P;;){if(_.lookahead<k){if(He(_),_.lookahead<k&&$===d)return w;if(_.lookahead===0)break}if(Q=0,_.lookahead>=O&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,Q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),_.prev_length=_.match_length,_.prev_match=_.match_start,_.match_length=O-1,Q!==0&&_.prev_length<_.max_lazy_match&&_.strstart-Q<=_.w_size-k&&(_.match_length=ue(_,Q),_.match_length<=5&&(_.strategy===1||_.match_length===O&&4096<_.strstart-_.match_start)&&(_.match_length=O-1)),_.prev_length>=O&&_.match_length<=_.prev_length){for(P=_.strstart+_.lookahead-O,N=o._tr_tally(_,_.strstart-1-_.prev_match,_.prev_length-O),_.lookahead-=_.prev_length-1,_.prev_length-=2;++_.strstart<=P&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,Q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),--_.prev_length!=0;);if(_.match_available=0,_.match_length=O-1,_.strstart++,N&&(j(_,!1),_.strm.avail_out===0))return w}else if(_.match_available){if((N=o._tr_tally(_,0,_.window[_.strstart-1]))&&j(_,!1),_.strstart++,_.lookahead--,_.strm.avail_out===0)return w}else _.match_available=1,_.strstart++,_.lookahead--}return _.match_available&&(N=o._tr_tally(_,0,_.window[_.strstart-1]),_.match_available=0),_.insert=_.strstart<O-1?_.strstart:O-1,$===u?(j(_,!0),_.strm.avail_out===0?J:Z):_.last_lit&&(j(_,!1),_.strm.avail_out===0)?w:G}function _e(_,$,Q,N,P){this.good_length=_,this.max_lazy=$,this.nice_length=Q,this.max_chain=N,this.func=P}function Le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*A),this.dyn_dtree=new r.Buf16(2*(2*C+1)),this.bl_tree=new r.Buf16(2*(2*F+1)),xe(this.dyn_ltree),xe(this.dyn_dtree),xe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(R+1),this.heap=new r.Buf16(2*b+1),xe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*b+1),xe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ge(_){var $;return _&&_.state?(_.total_in=_.total_out=0,_.data_type=E,($=_.state).pending=0,$.pending_out=0,$.wrap<0&&($.wrap=-$.wrap),$.status=$.wrap?x:M,_.adler=$.wrap===2?0:1,$.last_flush=d,o._tr_init($),f):le(_,m)}function Ze(_){var $=Ge(_);return $===f&&function(Q){Q.window_size=2*Q.w_size,xe(Q.head),Q.max_lazy_match=n[Q.level].max_lazy,Q.good_match=n[Q.level].good_length,Q.nice_match=n[Q.level].nice_length,Q.max_chain_length=n[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=O-1,Q.match_available=0,Q.ins_h=0}(_.state),$}function $e(_,$,Q,N,P,W){if(!_)return m;var se=1;if($===p&&($=6),N<0?(se=0,N=-N):15<N&&(se=2,N-=16),P<1||v<P||Q!==I||N<8||15<N||$<0||9<$||W<0||g<W)return le(_,m);N===8&&(N=9);var ie=new Le;return(_.state=ie).strm=_,ie.wrap=se,ie.gzhead=null,ie.w_bits=N,ie.w_size=1<<ie.w_bits,ie.w_mask=ie.w_size-1,ie.hash_bits=P+7,ie.hash_size=1<<ie.hash_bits,ie.hash_mask=ie.hash_size-1,ie.hash_shift=~~((ie.hash_bits+O-1)/O),ie.window=new r.Buf8(2*ie.w_size),ie.head=new r.Buf16(ie.hash_size),ie.prev=new r.Buf16(ie.w_size),ie.lit_bufsize=1<<P+6,ie.pending_buf_size=4*ie.lit_bufsize,ie.pending_buf=new r.Buf8(ie.pending_buf_size),ie.d_buf=1*ie.lit_bufsize,ie.l_buf=3*ie.lit_bufsize,ie.level=$,ie.strategy=W,ie.method=Q,Ze(_)}n=[new _e(0,0,0,0,function(_,$){var Q=65535;for(Q>_.pending_buf_size-5&&(Q=_.pending_buf_size-5);;){if(_.lookahead<=1){if(He(_),_.lookahead===0&&$===d)return w;if(_.lookahead===0)break}_.strstart+=_.lookahead,_.lookahead=0;var N=_.block_start+Q;if((_.strstart===0||_.strstart>=N)&&(_.lookahead=_.strstart-N,_.strstart=N,j(_,!1),_.strm.avail_out===0)||_.strstart-_.block_start>=_.w_size-k&&(j(_,!1),_.strm.avail_out===0))return w}return _.insert=0,$===u?(j(_,!0),_.strm.avail_out===0?J:Z):(_.strstart>_.block_start&&(j(_,!1),_.strm.avail_out),w)}),new _e(4,4,8,4,Xe),new _e(4,5,16,8,Xe),new _e(4,6,32,32,Xe),new _e(4,4,16,16,Se),new _e(8,16,32,32,Se),new _e(8,16,128,128,Se),new _e(8,32,128,256,Se),new _e(32,128,258,1024,Se),new _e(32,258,258,4096,Se)],i.deflateInit=function(_,$){return $e(_,$,I,15,8,0)},i.deflateInit2=$e,i.deflateReset=Ze,i.deflateResetKeep=Ge,i.deflateSetHeader=function(_,$){return _&&_.state?_.state.wrap!==2?m:(_.state.gzhead=$,f):m},i.deflate=function(_,$){var Q,N,P,W;if(!_||!_.state||5<$||$<0)return _?le(_,m):m;if(N=_.state,!_.output||!_.input&&_.avail_in!==0||N.status===666&&$!==u)return le(_,_.avail_out===0?-5:m);if(N.strm=_,Q=N.last_flush,N.last_flush=$,N.status===x)if(N.wrap===2)_.adler=0,be(N,31),be(N,139),be(N,8),N.gzhead?(be(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),be(N,255&N.gzhead.time),be(N,N.gzhead.time>>8&255),be(N,N.gzhead.time>>16&255),be(N,N.gzhead.time>>24&255),be(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),be(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(be(N,255&N.gzhead.extra.length),be(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(_.adler=h(_.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(be(N,0),be(N,0),be(N,0),be(N,0),be(N,0),be(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),be(N,3),N.status=M);else{var se=I+(N.w_bits-8<<4)<<8;se|=(2<=N.strategy||N.level<2?0:N.level<6?1:N.level===6?2:3)<<6,N.strstart!==0&&(se|=32),se+=31-se%31,N.status=M,fe(N,se),N.strstart!==0&&(fe(N,_.adler>>>16),fe(N,65535&_.adler)),_.adler=1}if(N.status===69)if(N.gzhead.extra){for(P=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),X(_),P=N.pending,N.pending!==N.pending_buf_size));)be(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(N.status===73)if(N.gzhead.name){P=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),X(_),P=N.pending,N.pending===N.pending_buf_size)){W=1;break}W=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,be(N,W)}while(W!==0);N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),W===0&&(N.gzindex=0,N.status=91)}else N.status=91;if(N.status===91)if(N.gzhead.comment){P=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),X(_),P=N.pending,N.pending===N.pending_buf_size)){W=1;break}W=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,be(N,W)}while(W!==0);N.gzhead.hcrc&&N.pending>P&&(_.adler=h(_.adler,N.pending_buf,N.pending-P,P)),W===0&&(N.status=103)}else N.status=103;if(N.status===103&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&X(_),N.pending+2<=N.pending_buf_size&&(be(N,255&_.adler),be(N,_.adler>>8&255),_.adler=0,N.status=M)):N.status=M),N.pending!==0){if(X(_),_.avail_out===0)return N.last_flush=-1,f}else if(_.avail_in===0&&ee($)<=ee(Q)&&$!==u)return le(_,-5);if(N.status===666&&_.avail_in!==0)return le(_,-5);if(_.avail_in!==0||N.lookahead!==0||$!==d&&N.status!==666){var ie=N.strategy===2?function(K,de){for(var Te;;){if(K.lookahead===0&&(He(K),K.lookahead===0)){if(de===d)return w;break}if(K.match_length=0,Te=o._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,Te&&(j(K,!1),K.strm.avail_out===0))return w}return K.insert=0,de===u?(j(K,!0),K.strm.avail_out===0?J:Z):K.last_lit&&(j(K,!1),K.strm.avail_out===0)?w:G}(N,$):N.strategy===3?function(K,de){for(var Te,pe,Pe,Ke,Ye=K.window;;){if(K.lookahead<=L){if(He(K),K.lookahead<=L&&de===d)return w;if(K.lookahead===0)break}if(K.match_length=0,K.lookahead>=O&&0<K.strstart&&(pe=Ye[Pe=K.strstart-1])===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]){Ke=K.strstart+L;do;while(pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&pe===Ye[++Pe]&&Pe<Ke);K.match_length=L-(Ke-Pe),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=O?(Te=o._tr_tally(K,1,K.match_length-O),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(Te=o._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),Te&&(j(K,!1),K.strm.avail_out===0))return w}return K.insert=0,de===u?(j(K,!0),K.strm.avail_out===0?J:Z):K.last_lit&&(j(K,!1),K.strm.avail_out===0)?w:G}(N,$):n[N.level].func(N,$);if(ie!==J&&ie!==Z||(N.status=666),ie===w||ie===J)return _.avail_out===0&&(N.last_flush=-1),f;if(ie===G&&($===1?o._tr_align(N):$!==5&&(o._tr_stored_block(N,0,0,!1),$===3&&(xe(N.head),N.lookahead===0&&(N.strstart=0,N.block_start=0,N.insert=0))),X(_),_.avail_out===0))return N.last_flush=-1,f}return $!==u?f:N.wrap<=0?1:(N.wrap===2?(be(N,255&_.adler),be(N,_.adler>>8&255),be(N,_.adler>>16&255),be(N,_.adler>>24&255),be(N,255&_.total_in),be(N,_.total_in>>8&255),be(N,_.total_in>>16&255),be(N,_.total_in>>24&255)):(fe(N,_.adler>>>16),fe(N,65535&_.adler)),X(_),0<N.wrap&&(N.wrap=-N.wrap),N.pending!==0?f:1)},i.deflateEnd=function(_){var $;return _&&_.state?($=_.state.status)!==x&&$!==69&&$!==73&&$!==91&&$!==103&&$!==M&&$!==666?le(_,m):(_.state=null,$===M?le(_,-3):f):m},i.deflateSetDictionary=function(_,$){var Q,N,P,W,se,ie,K,de,Te=$.length;if(!_||!_.state||(W=(Q=_.state).wrap)===2||W===1&&Q.status!==x||Q.lookahead)return m;for(W===1&&(_.adler=a(_.adler,$,Te,0)),Q.wrap=0,Te>=Q.w_size&&(W===0&&(xe(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0),de=new r.Buf8(Q.w_size),r.arraySet(de,$,Te-Q.w_size,Q.w_size,0),$=de,Te=Q.w_size),se=_.avail_in,ie=_.next_in,K=_.input,_.avail_in=Te,_.next_in=0,_.input=$,He(Q);Q.lookahead>=O;){for(N=Q.strstart,P=Q.lookahead-(O-1);Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[N+O-1])&Q.hash_mask,Q.prev[N&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=N,N++,--P;);Q.strstart=N,Q.lookahead=O-1,He(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=O-1,Q.match_available=0,_.next_in=ie,_.input=K,_.avail_in=se,Q.wrap=W,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,i){s.exports=function(n,r){var o,a,h,c,d,u,f,m,p,g,E,I,v,b,C,F,A,R,O,L,k,x,M,w,G;o=n.state,a=n.next_in,w=n.input,h=a+(n.avail_in-5),c=n.next_out,G=n.output,d=c-(r-n.avail_out),u=c+(n.avail_out-257),f=o.dmax,m=o.wsize,p=o.whave,g=o.wnext,E=o.window,I=o.hold,v=o.bits,b=o.lencode,C=o.distcode,F=(1<<o.lenbits)-1,A=(1<<o.distbits)-1;e:do{v<15&&(I+=w[a++]<<v,v+=8,I+=w[a++]<<v,v+=8),R=b[I&F];t:for(;;){if(I>>>=O=R>>>24,v-=O,(O=R>>>16&255)===0)G[c++]=65535&R;else{if(!(16&O)){if(!(64&O)){R=b[(65535&R)+(I&(1<<O)-1)];continue t}if(32&O){o.mode=12;break e}n.msg="invalid literal/length code",o.mode=30;break e}L=65535&R,(O&=15)&&(v<O&&(I+=w[a++]<<v,v+=8),L+=I&(1<<O)-1,I>>>=O,v-=O),v<15&&(I+=w[a++]<<v,v+=8,I+=w[a++]<<v,v+=8),R=C[I&A];s:for(;;){if(I>>>=O=R>>>24,v-=O,!(16&(O=R>>>16&255))){if(!(64&O)){R=C[(65535&R)+(I&(1<<O)-1)];continue s}n.msg="invalid distance code",o.mode=30;break e}if(k=65535&R,v<(O&=15)&&(I+=w[a++]<<v,(v+=8)<O&&(I+=w[a++]<<v,v+=8)),f<(k+=I&(1<<O)-1)){n.msg="invalid distance too far back",o.mode=30;break e}if(I>>>=O,v-=O,(O=c-d)<k){if(p<(O=k-O)&&o.sane){n.msg="invalid distance too far back",o.mode=30;break e}if(M=E,(x=0)===g){if(x+=m-O,O<L){for(L-=O;G[c++]=E[x++],--O;);x=c-k,M=G}}else if(g<O){if(x+=m+g-O,(O-=g)<L){for(L-=O;G[c++]=E[x++],--O;);if(x=0,g<L){for(L-=O=g;G[c++]=E[x++],--O;);x=c-k,M=G}}}else if(x+=g-O,O<L){for(L-=O;G[c++]=E[x++],--O;);x=c-k,M=G}for(;2<L;)G[c++]=M[x++],G[c++]=M[x++],G[c++]=M[x++],L-=3;L&&(G[c++]=M[x++],1<L&&(G[c++]=M[x++]))}else{for(x=c-k;G[c++]=G[x++],G[c++]=G[x++],G[c++]=G[x++],2<(L-=3););L&&(G[c++]=G[x++],1<L&&(G[c++]=G[x++]))}break}}break}}while(a<h&&c<u);a-=L=v>>3,I&=(1<<(v-=L<<3))-1,n.next_in=a,n.next_out=c,n.avail_in=a<h?h-a+5:5-(a-h),n.avail_out=c<u?u-c+257:257-(c-u),o.hold=I,o.bits=v}},{}],49:[function(t,s,i){var n=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),a=t("./inffast"),h=t("./inftrees"),c=1,d=2,u=0,f=-2,m=1,p=852,g=592;function E(x){return(x>>>24&255)+(x>>>8&65280)+((65280&x)<<8)+((255&x)<<24)}function I(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(x){var M;return x&&x.state?(M=x.state,x.total_in=x.total_out=M.total=0,x.msg="",M.wrap&&(x.adler=1&M.wrap),M.mode=m,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new n.Buf32(p),M.distcode=M.distdyn=new n.Buf32(g),M.sane=1,M.back=-1,u):f}function b(x){var M;return x&&x.state?((M=x.state).wsize=0,M.whave=0,M.wnext=0,v(x)):f}function C(x,M){var w,G;return x&&x.state?(G=x.state,M<0?(w=0,M=-M):(w=1+(M>>4),M<48&&(M&=15)),M&&(M<8||15<M)?f:(G.window!==null&&G.wbits!==M&&(G.window=null),G.wrap=w,G.wbits=M,b(x))):f}function F(x,M){var w,G;return x?(G=new I,(x.state=G).window=null,(w=C(x,M))!==u&&(x.state=null),w):f}var A,R,O=!0;function L(x){if(O){var M;for(A=new n.Buf32(512),R=new n.Buf32(32),M=0;M<144;)x.lens[M++]=8;for(;M<256;)x.lens[M++]=9;for(;M<280;)x.lens[M++]=7;for(;M<288;)x.lens[M++]=8;for(h(c,x.lens,0,288,A,0,x.work,{bits:9}),M=0;M<32;)x.lens[M++]=5;h(d,x.lens,0,32,R,0,x.work,{bits:5}),O=!1}x.lencode=A,x.lenbits=9,x.distcode=R,x.distbits=5}function k(x,M,w,G){var J,Z=x.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new n.Buf8(Z.wsize)),G>=Z.wsize?(n.arraySet(Z.window,M,w-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(G<(J=Z.wsize-Z.wnext)&&(J=G),n.arraySet(Z.window,M,w-G,J,Z.wnext),(G-=J)?(n.arraySet(Z.window,M,w-G,G,0),Z.wnext=G,Z.whave=Z.wsize):(Z.wnext+=J,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=J))),0}i.inflateReset=b,i.inflateReset2=C,i.inflateResetKeep=v,i.inflateInit=function(x){return F(x,15)},i.inflateInit2=F,i.inflate=function(x,M){var w,G,J,Z,le,ee,xe,X,j,be,fe,ue,He,Xe,Se,_e,Le,Ge,Ze,$e,_,$,Q,N,P=0,W=new n.Buf8(4),se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!x||!x.state||!x.output||!x.input&&x.avail_in!==0)return f;(w=x.state).mode===12&&(w.mode=13),le=x.next_out,J=x.output,xe=x.avail_out,Z=x.next_in,G=x.input,ee=x.avail_in,X=w.hold,j=w.bits,be=ee,fe=xe,$=u;e:for(;;)switch(w.mode){case m:if(w.wrap===0){w.mode=13;break}for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(2&w.wrap&&X===35615){W[w.check=0]=255&X,W[1]=X>>>8&255,w.check=o(w.check,W,2,0),j=X=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&X)<<8)+(X>>8))%31){x.msg="incorrect header check",w.mode=30;break}if((15&X)!=8){x.msg="unknown compression method",w.mode=30;break}if(j-=4,_=8+(15&(X>>>=4)),w.wbits===0)w.wbits=_;else if(_>w.wbits){x.msg="invalid window size",w.mode=30;break}w.dmax=1<<_,x.adler=w.check=1,w.mode=512&X?10:12,j=X=0;break;case 2:for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(w.flags=X,(255&w.flags)!=8){x.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){x.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=X>>8&1),512&w.flags&&(W[0]=255&X,W[1]=X>>>8&255,w.check=o(w.check,W,2,0)),j=X=0,w.mode=3;case 3:for(;j<32;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.head&&(w.head.time=X),512&w.flags&&(W[0]=255&X,W[1]=X>>>8&255,W[2]=X>>>16&255,W[3]=X>>>24&255,w.check=o(w.check,W,4,0)),j=X=0,w.mode=4;case 4:for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.head&&(w.head.xflags=255&X,w.head.os=X>>8),512&w.flags&&(W[0]=255&X,W[1]=X>>>8&255,w.check=o(w.check,W,2,0)),j=X=0,w.mode=5;case 5:if(1024&w.flags){for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.length=X,w.head&&(w.head.extra_len=X),512&w.flags&&(W[0]=255&X,W[1]=X>>>8&255,w.check=o(w.check,W,2,0)),j=X=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(ee<(ue=w.length)&&(ue=ee),ue&&(w.head&&(_=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),n.arraySet(w.head.extra,G,Z,ue,_)),512&w.flags&&(w.check=o(w.check,G,ue,Z)),ee-=ue,Z+=ue,w.length-=ue),w.length))break e;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(ee===0)break e;for(ue=0;_=G[Z+ue++],w.head&&_&&w.length<65536&&(w.head.name+=String.fromCharCode(_)),_&&ue<ee;);if(512&w.flags&&(w.check=o(w.check,G,ue,Z)),ee-=ue,Z+=ue,_)break e}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(ee===0)break e;for(ue=0;_=G[Z+ue++],w.head&&_&&w.length<65536&&(w.head.comment+=String.fromCharCode(_)),_&&ue<ee;);if(512&w.flags&&(w.check=o(w.check,G,ue,Z)),ee-=ue,Z+=ue,_)break e}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;j<16;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(X!==(65535&w.check)){x.msg="header crc mismatch",w.mode=30;break}j=X=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),x.adler=w.check=0,w.mode=12;break;case 10:for(;j<32;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}x.adler=w.check=E(X),j=X=0,w.mode=11;case 11:if(w.havedict===0)return x.next_out=le,x.avail_out=xe,x.next_in=Z,x.avail_in=ee,w.hold=X,w.bits=j,2;x.adler=w.check=1,w.mode=12;case 12:if(M===5||M===6)break e;case 13:if(w.last){X>>>=7&j,j-=7&j,w.mode=27;break}for(;j<3;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}switch(w.last=1&X,j-=1,3&(X>>>=1)){case 0:w.mode=14;break;case 1:if(L(w),w.mode=20,M!==6)break;X>>>=2,j-=2;break e;case 2:w.mode=17;break;case 3:x.msg="invalid block type",w.mode=30}X>>>=2,j-=2;break;case 14:for(X>>>=7&j,j-=7&j;j<32;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if((65535&X)!=(X>>>16^65535)){x.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&X,j=X=0,w.mode=15,M===6)break e;case 15:w.mode=16;case 16:if(ue=w.length){if(ee<ue&&(ue=ee),xe<ue&&(ue=xe),ue===0)break e;n.arraySet(J,G,Z,ue,le),ee-=ue,Z+=ue,xe-=ue,le+=ue,w.length-=ue;break}w.mode=12;break;case 17:for(;j<14;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(w.nlen=257+(31&X),X>>>=5,j-=5,w.ndist=1+(31&X),X>>>=5,j-=5,w.ncode=4+(15&X),X>>>=4,j-=4,286<w.nlen||30<w.ndist){x.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;j<3;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.lens[se[w.have++]]=7&X,X>>>=3,j-=3}for(;w.have<19;)w.lens[se[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,Q={bits:w.lenbits},$=h(0,w.lens,0,19,w.lencode,0,w.work,Q),w.lenbits=Q.bits,$){x.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;_e=(P=w.lencode[X&(1<<w.lenbits)-1])>>>16&255,Le=65535&P,!((Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(Le<16)X>>>=Se,j-=Se,w.lens[w.have++]=Le;else{if(Le===16){for(N=Se+2;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(X>>>=Se,j-=Se,w.have===0){x.msg="invalid bit length repeat",w.mode=30;break}_=w.lens[w.have-1],ue=3+(3&X),X>>>=2,j-=2}else if(Le===17){for(N=Se+3;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}j-=Se,_=0,ue=3+(7&(X>>>=Se)),X>>>=3,j-=3}else{for(N=Se+7;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}j-=Se,_=0,ue=11+(127&(X>>>=Se)),X>>>=7,j-=7}if(w.have+ue>w.nlen+w.ndist){x.msg="invalid bit length repeat",w.mode=30;break}for(;ue--;)w.lens[w.have++]=_}}if(w.mode===30)break;if(w.lens[256]===0){x.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,Q={bits:w.lenbits},$=h(c,w.lens,0,w.nlen,w.lencode,0,w.work,Q),w.lenbits=Q.bits,$){x.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,Q={bits:w.distbits},$=h(d,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,Q),w.distbits=Q.bits,$){x.msg="invalid distances set",w.mode=30;break}if(w.mode=20,M===6)break e;case 20:w.mode=21;case 21:if(6<=ee&&258<=xe){x.next_out=le,x.avail_out=xe,x.next_in=Z,x.avail_in=ee,w.hold=X,w.bits=j,a(x,fe),le=x.next_out,J=x.output,xe=x.avail_out,Z=x.next_in,G=x.input,ee=x.avail_in,X=w.hold,j=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;_e=(P=w.lencode[X&(1<<w.lenbits)-1])>>>16&255,Le=65535&P,!((Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(_e&&!(240&_e)){for(Ge=Se,Ze=_e,$e=Le;_e=(P=w.lencode[$e+((X&(1<<Ge+Ze)-1)>>Ge)])>>>16&255,Le=65535&P,!(Ge+(Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}X>>>=Ge,j-=Ge,w.back+=Ge}if(X>>>=Se,j-=Se,w.back+=Se,w.length=Le,_e===0){w.mode=26;break}if(32&_e){w.back=-1,w.mode=12;break}if(64&_e){x.msg="invalid literal/length code",w.mode=30;break}w.extra=15&_e,w.mode=22;case 22:if(w.extra){for(N=w.extra;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.length+=X&(1<<w.extra)-1,X>>>=w.extra,j-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;_e=(P=w.distcode[X&(1<<w.distbits)-1])>>>16&255,Le=65535&P,!((Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(!(240&_e)){for(Ge=Se,Ze=_e,$e=Le;_e=(P=w.distcode[$e+((X&(1<<Ge+Ze)-1)>>Ge)])>>>16&255,Le=65535&P,!(Ge+(Se=P>>>24)<=j);){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}X>>>=Ge,j-=Ge,w.back+=Ge}if(X>>>=Se,j-=Se,w.back+=Se,64&_e){x.msg="invalid distance code",w.mode=30;break}w.offset=Le,w.extra=15&_e,w.mode=24;case 24:if(w.extra){for(N=w.extra;j<N;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}w.offset+=X&(1<<w.extra)-1,X>>>=w.extra,j-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){x.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(xe===0)break e;if(ue=fe-xe,w.offset>ue){if((ue=w.offset-ue)>w.whave&&w.sane){x.msg="invalid distance too far back",w.mode=30;break}He=ue>w.wnext?(ue-=w.wnext,w.wsize-ue):w.wnext-ue,ue>w.length&&(ue=w.length),Xe=w.window}else Xe=J,He=le-w.offset,ue=w.length;for(xe<ue&&(ue=xe),xe-=ue,w.length-=ue;J[le++]=Xe[He++],--ue;);w.length===0&&(w.mode=21);break;case 26:if(xe===0)break e;J[le++]=w.length,xe--,w.mode=21;break;case 27:if(w.wrap){for(;j<32;){if(ee===0)break e;ee--,X|=G[Z++]<<j,j+=8}if(fe-=xe,x.total_out+=fe,w.total+=fe,fe&&(x.adler=w.check=w.flags?o(w.check,J,fe,le-fe):r(w.check,J,fe,le-fe)),fe=xe,(w.flags?X:E(X))!==w.check){x.msg="incorrect data check",w.mode=30;break}j=X=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;j<32;){if(ee===0)break e;ee--,X+=G[Z++]<<j,j+=8}if(X!==(4294967295&w.total)){x.msg="incorrect length check",w.mode=30;break}j=X=0}w.mode=29;case 29:$=1;break e;case 30:$=-3;break e;case 31:return-4;case 32:default:return f}return x.next_out=le,x.avail_out=xe,x.next_in=Z,x.avail_in=ee,w.hold=X,w.bits=j,(w.wsize||fe!==x.avail_out&&w.mode<30&&(w.mode<27||M!==4))&&k(x,x.output,x.next_out,fe-x.avail_out)?(w.mode=31,-4):(be-=x.avail_in,fe-=x.avail_out,x.total_in+=be,x.total_out+=fe,w.total+=fe,w.wrap&&fe&&(x.adler=w.check=w.flags?o(w.check,J,fe,x.next_out-fe):r(w.check,J,fe,x.next_out-fe)),x.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(be==0&&fe===0||M===4)&&$===u&&($=-5),$)},i.inflateEnd=function(x){if(!x||!x.state)return f;var M=x.state;return M.window&&(M.window=null),x.state=null,u},i.inflateGetHeader=function(x,M){var w;return x&&x.state&&2&(w=x.state).wrap?((w.head=M).done=!1,u):f},i.inflateSetDictionary=function(x,M){var w,G=M.length;return x&&x.state?(w=x.state).wrap!==0&&w.mode!==11?f:w.mode===11&&r(1,M,G,0)!==w.check?-3:k(x,M,G,G)?(w.mode=31,-4):(w.havedict=1,u):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,i){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(c,d,u,f,m,p,g,E){var I,v,b,C,F,A,R,O,L,k=E.bits,x=0,M=0,w=0,G=0,J=0,Z=0,le=0,ee=0,xe=0,X=0,j=null,be=0,fe=new n.Buf16(16),ue=new n.Buf16(16),He=null,Xe=0;for(x=0;x<=15;x++)fe[x]=0;for(M=0;M<f;M++)fe[d[u+M]]++;for(J=k,G=15;1<=G&&fe[G]===0;G--);if(G<J&&(J=G),G===0)return m[p++]=20971520,m[p++]=20971520,E.bits=1,0;for(w=1;w<G&&fe[w]===0;w++);for(J<w&&(J=w),x=ee=1;x<=15;x++)if(ee<<=1,(ee-=fe[x])<0)return-1;if(0<ee&&(c===0||G!==1))return-1;for(ue[1]=0,x=1;x<15;x++)ue[x+1]=ue[x]+fe[x];for(M=0;M<f;M++)d[u+M]!==0&&(g[ue[d[u+M]]++]=M);if(A=c===0?(j=He=g,19):c===1?(j=r,be-=257,He=o,Xe-=257,256):(j=a,He=h,-1),x=w,F=p,le=M=X=0,b=-1,C=(xe=1<<(Z=J))-1,c===1&&852<xe||c===2&&592<xe)return 1;for(;;){for(R=x-le,L=g[M]<A?(O=0,g[M]):g[M]>A?(O=He[Xe+g[M]],j[be+g[M]]):(O=96,0),I=1<<x-le,w=v=1<<Z;m[F+(X>>le)+(v-=I)]=R<<24|O<<16|L|0,v!==0;);for(I=1<<x-1;X&I;)I>>=1;if(I!==0?(X&=I-1,X+=I):X=0,M++,--fe[x]==0){if(x===G)break;x=d[u+g[M]]}if(J<x&&(X&C)!==b){for(le===0&&(le=J),F+=w,ee=1<<(Z=x-le);Z+le<G&&!((ee-=fe[Z+le])<=0);)Z++,ee<<=1;if(xe+=1<<Z,c===1&&852<xe||c===2&&592<xe)return 1;m[b=X&C]=J<<24|Z<<16|F-p|0}}return X!==0&&(m[F+X]=x-le<<24|64<<16|0),E.bits=J,0}},{"../utils/common":41}],51:[function(t,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,i){var n=t("../utils/common"),r=0,o=1;function a(P){for(var W=P.length;0<=--W;)P[W]=0}var h=0,c=29,d=256,u=d+1+c,f=30,m=19,p=2*u+1,g=15,E=16,I=7,v=256,b=16,C=17,F=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(2*(u+2));a(k);var x=new Array(2*f);a(x);var M=new Array(512);a(M);var w=new Array(256);a(w);var G=new Array(c);a(G);var J,Z,le,ee=new Array(f);function xe(P,W,se,ie,K){this.static_tree=P,this.extra_bits=W,this.extra_base=se,this.elems=ie,this.max_length=K,this.has_stree=P&&P.length}function X(P,W){this.dyn_tree=P,this.max_code=0,this.stat_desc=W}function j(P){return P<256?M[P]:M[256+(P>>>7)]}function be(P,W){P.pending_buf[P.pending++]=255&W,P.pending_buf[P.pending++]=W>>>8&255}function fe(P,W,se){P.bi_valid>E-se?(P.bi_buf|=W<<P.bi_valid&65535,be(P,P.bi_buf),P.bi_buf=W>>E-P.bi_valid,P.bi_valid+=se-E):(P.bi_buf|=W<<P.bi_valid&65535,P.bi_valid+=se)}function ue(P,W,se){fe(P,se[2*W],se[2*W+1])}function He(P,W){for(var se=0;se|=1&P,P>>>=1,se<<=1,0<--W;);return se>>>1}function Xe(P,W,se){var ie,K,de=new Array(g+1),Te=0;for(ie=1;ie<=g;ie++)de[ie]=Te=Te+se[ie-1]<<1;for(K=0;K<=W;K++){var pe=P[2*K+1];pe!==0&&(P[2*K]=He(de[pe]++,pe))}}function Se(P){var W;for(W=0;W<u;W++)P.dyn_ltree[2*W]=0;for(W=0;W<f;W++)P.dyn_dtree[2*W]=0;for(W=0;W<m;W++)P.bl_tree[2*W]=0;P.dyn_ltree[2*v]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0}function _e(P){8<P.bi_valid?be(P,P.bi_buf):0<P.bi_valid&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0}function Le(P,W,se,ie){var K=2*W,de=2*se;return P[K]<P[de]||P[K]===P[de]&&ie[W]<=ie[se]}function Ge(P,W,se){for(var ie=P.heap[se],K=se<<1;K<=P.heap_len&&(K<P.heap_len&&Le(W,P.heap[K+1],P.heap[K],P.depth)&&K++,!Le(W,ie,P.heap[K],P.depth));)P.heap[se]=P.heap[K],se=K,K<<=1;P.heap[se]=ie}function Ze(P,W,se){var ie,K,de,Te,pe=0;if(P.last_lit!==0)for(;ie=P.pending_buf[P.d_buf+2*pe]<<8|P.pending_buf[P.d_buf+2*pe+1],K=P.pending_buf[P.l_buf+pe],pe++,ie===0?ue(P,K,W):(ue(P,(de=w[K])+d+1,W),(Te=A[de])!==0&&fe(P,K-=G[de],Te),ue(P,de=j(--ie),se),(Te=R[de])!==0&&fe(P,ie-=ee[de],Te)),pe<P.last_lit;);ue(P,v,W)}function $e(P,W){var se,ie,K,de=W.dyn_tree,Te=W.stat_desc.static_tree,pe=W.stat_desc.has_stree,Pe=W.stat_desc.elems,Ke=-1;for(P.heap_len=0,P.heap_max=p,se=0;se<Pe;se++)de[2*se]!==0?(P.heap[++P.heap_len]=Ke=se,P.depth[se]=0):de[2*se+1]=0;for(;P.heap_len<2;)de[2*(K=P.heap[++P.heap_len]=Ke<2?++Ke:0)]=1,P.depth[K]=0,P.opt_len--,pe&&(P.static_len-=Te[2*K+1]);for(W.max_code=Ke,se=P.heap_len>>1;1<=se;se--)Ge(P,de,se);for(K=Pe;se=P.heap[1],P.heap[1]=P.heap[P.heap_len--],Ge(P,de,1),ie=P.heap[1],P.heap[--P.heap_max]=se,P.heap[--P.heap_max]=ie,de[2*K]=de[2*se]+de[2*ie],P.depth[K]=(P.depth[se]>=P.depth[ie]?P.depth[se]:P.depth[ie])+1,de[2*se+1]=de[2*ie+1]=K,P.heap[1]=K++,Ge(P,de,1),2<=P.heap_len;);P.heap[--P.heap_max]=P.heap[1],function(Ye,_t){var gs,Tt,Es,et,ns,je,Pt=_t.dyn_tree,ks=_t.max_code,mn=_t.stat_desc.static_tree,Ve=_t.stat_desc.has_stree,Qn=_t.stat_desc.extra_bits,gn=_t.stat_desc.extra_base,Ts=_t.stat_desc.max_length,Ks=0;for(et=0;et<=g;et++)Ye.bl_count[et]=0;for(Pt[2*Ye.heap[Ye.heap_max]+1]=0,gs=Ye.heap_max+1;gs<p;gs++)Ts<(et=Pt[2*Pt[2*(Tt=Ye.heap[gs])+1]+1]+1)&&(et=Ts,Ks++),Pt[2*Tt+1]=et,ks<Tt||(Ye.bl_count[et]++,ns=0,gn<=Tt&&(ns=Qn[Tt-gn]),je=Pt[2*Tt],Ye.opt_len+=je*(et+ns),Ve&&(Ye.static_len+=je*(mn[2*Tt+1]+ns)));if(Ks!==0){do{for(et=Ts-1;Ye.bl_count[et]===0;)et--;Ye.bl_count[et]--,Ye.bl_count[et+1]+=2,Ye.bl_count[Ts]--,Ks-=2}while(0<Ks);for(et=Ts;et!==0;et--)for(Tt=Ye.bl_count[et];Tt!==0;)ks<(Es=Ye.heap[--gs])||(Pt[2*Es+1]!==et&&(Ye.opt_len+=(et-Pt[2*Es+1])*Pt[2*Es],Pt[2*Es+1]=et),Tt--)}}(P,W),Xe(de,Ke,P.bl_count)}function _(P,W,se){var ie,K,de=-1,Te=W[1],pe=0,Pe=7,Ke=4;for(Te===0&&(Pe=138,Ke=3),W[2*(se+1)+1]=65535,ie=0;ie<=se;ie++)K=Te,Te=W[2*(ie+1)+1],++pe<Pe&&K===Te||(pe<Ke?P.bl_tree[2*K]+=pe:K!==0?(K!==de&&P.bl_tree[2*K]++,P.bl_tree[2*b]++):pe<=10?P.bl_tree[2*C]++:P.bl_tree[2*F]++,de=K,Ke=(pe=0)===Te?(Pe=138,3):K===Te?(Pe=6,3):(Pe=7,4))}function $(P,W,se){var ie,K,de=-1,Te=W[1],pe=0,Pe=7,Ke=4;for(Te===0&&(Pe=138,Ke=3),ie=0;ie<=se;ie++)if(K=Te,Te=W[2*(ie+1)+1],!(++pe<Pe&&K===Te)){if(pe<Ke)for(;ue(P,K,P.bl_tree),--pe!=0;);else K!==0?(K!==de&&(ue(P,K,P.bl_tree),pe--),ue(P,b,P.bl_tree),fe(P,pe-3,2)):pe<=10?(ue(P,C,P.bl_tree),fe(P,pe-3,3)):(ue(P,F,P.bl_tree),fe(P,pe-11,7));de=K,Ke=(pe=0)===Te?(Pe=138,3):K===Te?(Pe=6,3):(Pe=7,4)}}a(ee);var Q=!1;function N(P,W,se,ie){fe(P,(h<<1)+(ie?1:0),3),function(K,de,Te,pe){_e(K),be(K,Te),be(K,~Te),n.arraySet(K.pending_buf,K.window,de,Te,K.pending),K.pending+=Te}(P,W,se)}i._tr_init=function(P){Q||(function(){var W,se,ie,K,de,Te=new Array(g+1);for(K=ie=0;K<c-1;K++)for(G[K]=ie,W=0;W<1<<A[K];W++)w[ie++]=K;for(w[ie-1]=K,K=de=0;K<16;K++)for(ee[K]=de,W=0;W<1<<R[K];W++)M[de++]=K;for(de>>=7;K<f;K++)for(ee[K]=de<<7,W=0;W<1<<R[K]-7;W++)M[256+de++]=K;for(se=0;se<=g;se++)Te[se]=0;for(W=0;W<=143;)k[2*W+1]=8,W++,Te[8]++;for(;W<=255;)k[2*W+1]=9,W++,Te[9]++;for(;W<=279;)k[2*W+1]=7,W++,Te[7]++;for(;W<=287;)k[2*W+1]=8,W++,Te[8]++;for(Xe(k,u+1,Te),W=0;W<f;W++)x[2*W+1]=5,x[2*W]=He(W,5);J=new xe(k,A,d+1,u,g),Z=new xe(x,R,0,f,g),le=new xe(new Array(0),O,0,m,I)}(),Q=!0),P.l_desc=new X(P.dyn_ltree,J),P.d_desc=new X(P.dyn_dtree,Z),P.bl_desc=new X(P.bl_tree,le),P.bi_buf=0,P.bi_valid=0,Se(P)},i._tr_stored_block=N,i._tr_flush_block=function(P,W,se,ie){var K,de,Te=0;0<P.level?(P.strm.data_type===2&&(P.strm.data_type=function(pe){var Pe,Ke=4093624447;for(Pe=0;Pe<=31;Pe++,Ke>>>=1)if(1&Ke&&pe.dyn_ltree[2*Pe]!==0)return r;if(pe.dyn_ltree[18]!==0||pe.dyn_ltree[20]!==0||pe.dyn_ltree[26]!==0)return o;for(Pe=32;Pe<d;Pe++)if(pe.dyn_ltree[2*Pe]!==0)return o;return r}(P)),$e(P,P.l_desc),$e(P,P.d_desc),Te=function(pe){var Pe;for(_(pe,pe.dyn_ltree,pe.l_desc.max_code),_(pe,pe.dyn_dtree,pe.d_desc.max_code),$e(pe,pe.bl_desc),Pe=m-1;3<=Pe&&pe.bl_tree[2*L[Pe]+1]===0;Pe--);return pe.opt_len+=3*(Pe+1)+5+5+4,Pe}(P),K=P.opt_len+3+7>>>3,(de=P.static_len+3+7>>>3)<=K&&(K=de)):K=de=se+5,se+4<=K&&W!==-1?N(P,W,se,ie):P.strategy===4||de===K?(fe(P,2+(ie?1:0),3),Ze(P,k,x)):(fe(P,4+(ie?1:0),3),function(pe,Pe,Ke,Ye){var _t;for(fe(pe,Pe-257,5),fe(pe,Ke-1,5),fe(pe,Ye-4,4),_t=0;_t<Ye;_t++)fe(pe,pe.bl_tree[2*L[_t]+1],3);$(pe,pe.dyn_ltree,Pe-1),$(pe,pe.dyn_dtree,Ke-1)}(P,P.l_desc.max_code+1,P.d_desc.max_code+1,Te+1),Ze(P,P.dyn_ltree,P.dyn_dtree)),Se(P),ie&&_e(P)},i._tr_tally=function(P,W,se){return P.pending_buf[P.d_buf+2*P.last_lit]=W>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&W,P.pending_buf[P.l_buf+P.last_lit]=255&se,P.last_lit++,W===0?P.dyn_ltree[2*se]++:(P.matches++,W--,P.dyn_ltree[2*(w[se]+d+1)]++,P.dyn_dtree[2*j(W)]++),P.last_lit===P.lit_bufsize-1},i._tr_align=function(P){fe(P,2,3),ue(P,v,k),function(W){W.bi_valid===16?(be(W,W.bi_buf),W.bi_buf=0,W.bi_valid=0):8<=W.bi_valid&&(W.pending_buf[W.pending++]=255&W.bi_buf,W.bi_buf>>=8,W.bi_valid-=8)}(P)}},{"../utils/common":41}],53:[function(t,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,i){(function(n){(function(r,o){if(!r.setImmediate){var a,h,c,d,u=1,f={},m=!1,p=r.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(r);g=g&&g.setTimeout?g:r,a={}.toString.call(r.process)==="[object process]"?function(b){process.nextTick(function(){I(b)})}:function(){if(r.postMessage&&!r.importScripts){var b=!0,C=r.onmessage;return r.onmessage=function(){b=!1},r.postMessage("","*"),r.onmessage=C,b}}()?(d="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",v,!1):r.attachEvent("onmessage",v),function(b){r.postMessage(d+b,"*")}):r.MessageChannel?((c=new MessageChannel).port1.onmessage=function(b){I(b.data)},function(b){c.port2.postMessage(b)}):p&&"onreadystatechange"in p.createElement("script")?(h=p.documentElement,function(b){var C=p.createElement("script");C.onreadystatechange=function(){I(b),C.onreadystatechange=null,h.removeChild(C),C=null},h.appendChild(C)}):function(b){setTimeout(I,0,b)},g.setImmediate=function(b){typeof b!="function"&&(b=new Function(""+b));for(var C=new Array(arguments.length-1),F=0;F<C.length;F++)C[F]=arguments[F+1];var A={callback:b,args:C};return f[u]=A,a(u),u++},g.clearImmediate=E}function E(b){delete f[b]}function I(b){if(m)setTimeout(I,0,b);else{var C=f[b];if(C){m=!0;try{(function(F){var A=F.callback,R=F.args;switch(R.length){case 0:A();break;case 1:A(R[0]);break;case 2:A(R[0],R[1]);break;case 3:A(R[0],R[1],R[2]);break;default:A.apply(o,R)}})(C)}finally{E(b),m=!1}}}}function v(b){b.source===r&&typeof b.data=="string"&&b.data.indexOf(d)===0&&I(+b.data.slice(d.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof Jh<"u"?Jh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(c1);var S2=c1.exports;const kg=R2(S2);var u1={},Gc={};(function(l){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+e+"]["+t+"]*",i=new RegExp("^"+s+"$"),n=function(o,a){const h=[];let c=a.exec(o);for(;c;){const d=[];d.startIndex=a.lastIndex-c[0].length;const u=c.length;for(let f=0;f<u;f++)d.push(c[f]);h.push(d),c=a.exec(o)}return h},r=function(o){const a=i.exec(o);return!(a===null||typeof a>"u")};l.isExist=function(o){return typeof o<"u"},l.isEmptyObject=function(o){return Object.keys(o).length===0},l.merge=function(o,a,h){if(a){const c=Object.keys(a),d=c.length;for(let u=0;u<d;u++)h==="strict"?o[c[u]]=[a[c[u]]]:o[c[u]]=a[c[u]]}},l.getValue=function(o){return l.isExist(o)?o:""},l.isName=r,l.getAllMatches=n,l.nameRegexp=s})(Gc);const hp=Gc,O2={allowBooleanAttributes:!1,unpairedTags:[]};u1.validate=function(l,e){e=Object.assign({},O2,e);const t=[];let s=!1,i=!1;l[0]==="\uFEFF"&&(l=l.substr(1));for(let n=0;n<l.length;n++)if(l[n]==="<"&&l[n+1]==="?"){if(n+=2,n=Yg(l,n),n.err)return n}else if(l[n]==="<"){let r=n;if(n++,l[n]==="!"){n=Gg(l,n);continue}else{let o=!1;l[n]==="/"&&(o=!0,n++);let a="";for(;n<l.length&&l[n]!==">"&&l[n]!==" "&&l[n]!=="	"&&l[n]!==`
`&&l[n]!=="\r";n++)a+=l[n];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),n--),!z2(a)){let d;return a.trim().length===0?d="Invalid space after '<'.":d="Tag '"+a+"' is an invalid name.",Qt("InvalidTag",d,Rs(l,n))}const h=N2(l,n);if(h===!1)return Qt("InvalidAttr","Attributes for '"+a+"' have open quote.",Rs(l,n));let c=h.value;if(n=h.index,c[c.length-1]==="/"){const d=n-c.length;c=c.substring(0,c.length-1);const u=Hg(c,e);if(u===!0)s=!0;else return Qt(u.err.code,u.err.msg,Rs(l,d+u.err.line))}else if(o)if(h.tagClosed){if(c.trim().length>0)return Qt("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",Rs(l,r));if(t.length===0)return Qt("InvalidTag","Closing tag '"+a+"' has not been opened.",Rs(l,r));{const d=t.pop();if(a!==d.tagName){let u=Rs(l,d.tagStartPos);return Qt("InvalidTag","Expected closing tag '"+d.tagName+"' (opened in line "+u.line+", col "+u.col+") instead of closing tag '"+a+"'.",Rs(l,r))}t.length==0&&(i=!0)}}else return Qt("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",Rs(l,n));else{const d=Hg(c,e);if(d!==!0)return Qt(d.err.code,d.err.msg,Rs(l,n-c.length+d.err.line));if(i===!0)return Qt("InvalidXml","Multiple possible root nodes found.",Rs(l,n));e.unpairedTags.indexOf(a)!==-1||t.push({tagName:a,tagStartPos:r}),s=!0}for(n++;n<l.length;n++)if(l[n]==="<")if(l[n+1]==="!"){n++,n=Gg(l,n);continue}else if(l[n+1]==="?"){if(n=Yg(l,++n),n.err)return n}else break;else if(l[n]==="&"){const d=U2(l,n);if(d==-1)return Qt("InvalidChar","char '&' is not expected.",Rs(l,n));n=d}else if(i===!0&&!Vg(l[n]))return Qt("InvalidXml","Extra text at the end",Rs(l,n));l[n]==="<"&&n--}}else{if(Vg(l[n]))continue;return Qt("InvalidChar","char '"+l[n]+"' is not expected.",Rs(l,n))}if(s){if(t.length==1)return Qt("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",Rs(l,t[0].tagStartPos));if(t.length>0)return Qt("InvalidXml","Invalid '"+JSON.stringify(t.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Qt("InvalidXml","Start tag expected.",1);return!0};function Vg(l){return l===" "||l==="	"||l===`
`||l==="\r"}function Yg(l,e){const t=e;for(;e<l.length;e++)if(l[e]=="?"||l[e]==" "){const s=l.substr(t,e-t);if(e>5&&s==="xml")return Qt("InvalidXml","XML declaration allowed only at the start of the document.",Rs(l,e));if(l[e]=="?"&&l[e+1]==">"){e++;break}else continue}return e}function Gg(l,e){if(l.length>e+5&&l[e+1]==="-"&&l[e+2]==="-"){for(e+=3;e<l.length;e++)if(l[e]==="-"&&l[e+1]==="-"&&l[e+2]===">"){e+=2;break}}else if(l.length>e+8&&l[e+1]==="D"&&l[e+2]==="O"&&l[e+3]==="C"&&l[e+4]==="T"&&l[e+5]==="Y"&&l[e+6]==="P"&&l[e+7]==="E"){let t=1;for(e+=8;e<l.length;e++)if(l[e]==="<")t++;else if(l[e]===">"&&(t--,t===0))break}else if(l.length>e+9&&l[e+1]==="["&&l[e+2]==="C"&&l[e+3]==="D"&&l[e+4]==="A"&&l[e+5]==="T"&&l[e+6]==="A"&&l[e+7]==="["){for(e+=8;e<l.length;e++)if(l[e]==="]"&&l[e+1]==="]"&&l[e+2]===">"){e+=2;break}}return e}const P2='"',M2="'";function N2(l,e){let t="",s="",i=!1;for(;e<l.length;e++){if(l[e]===P2||l[e]===M2)s===""?s=l[e]:s!==l[e]||(s="");else if(l[e]===">"&&s===""){i=!0;break}t+=l[e]}return s!==""?!1:{value:t,index:e,tagClosed:i}}const D2=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Hg(l,e){const t=hp.getAllMatches(l,D2),s={};for(let i=0;i<t.length;i++){if(t[i][1].length===0)return Qt("InvalidAttr","Attribute '"+t[i][2]+"' has no space in starting.",qa(t[i]));if(t[i][3]!==void 0&&t[i][4]===void 0)return Qt("InvalidAttr","Attribute '"+t[i][2]+"' is without value.",qa(t[i]));if(t[i][3]===void 0&&!e.allowBooleanAttributes)return Qt("InvalidAttr","boolean attribute '"+t[i][2]+"' is not allowed.",qa(t[i]));const n=t[i][2];if(!B2(n))return Qt("InvalidAttr","Attribute '"+n+"' is an invalid name.",qa(t[i]));if(!s.hasOwnProperty(n))s[n]=1;else return Qt("InvalidAttr","Attribute '"+n+"' is repeated.",qa(t[i]))}return!0}function L2(l,e){let t=/\d/;for(l[e]==="x"&&(e++,t=/[\da-fA-F]/);e<l.length;e++){if(l[e]===";")return e;if(!l[e].match(t))break}return-1}function U2(l,e){if(e++,l[e]===";")return-1;if(l[e]==="#")return e++,L2(l,e);let t=0;for(;e<l.length;e++,t++)if(!(l[e].match(/\w/)&&t<20)){if(l[e]===";")break;return-1}return e}function Qt(l,e,t){return{err:{code:l,msg:e,line:t.line||t,col:t.col}}}function B2(l){return hp.isName(l)}function z2(l){return hp.isName(l)}function Rs(l,e){const t=l.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function qa(l){return l.startIndex+l[1].length}var cp={};const d1={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(l,e){return e},attributeValueProcessor:function(l,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(l,e,t){return l}},k2=function(l){return Object.assign({},d1,l)};cp.buildOptions=k2;cp.defaultOptions=d1;class V2{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}var Y2=V2;const G2=Gc;function H2(l,e){const t={};if(l[e+3]==="O"&&l[e+4]==="C"&&l[e+5]==="T"&&l[e+6]==="Y"&&l[e+7]==="P"&&l[e+8]==="E"){e=e+9;let s=1,i=!1,n=!1,r="";for(;e<l.length;e++)if(l[e]==="<"&&!n){if(i&&Z2(l,e))e+=7,[entityName,val,e]=W2(l,e+1),val.indexOf("&")===-1&&(t[q2(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&X2(l,e))e+=8;else if(i&&K2(l,e))e+=8;else if(i&&Q2(l,e))e+=9;else if(j2)n=!0;else throw new Error("Invalid DOCTYPE");s++,r=""}else if(l[e]===">"){if(n?l[e-1]==="-"&&l[e-2]==="-"&&(n=!1,s--):s--,s===0)break}else l[e]==="["?i=!0:r+=l[e];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function W2(l,e){let t="";for(;e<l.length&&l[e]!=="'"&&l[e]!=='"';e++)t+=l[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=l[e++];let i="";for(;e<l.length&&l[e]!==s;e++)i+=l[e];return[t,i,e]}function j2(l,e){return l[e+1]==="!"&&l[e+2]==="-"&&l[e+3]==="-"}function Z2(l,e){return l[e+1]==="!"&&l[e+2]==="E"&&l[e+3]==="N"&&l[e+4]==="T"&&l[e+5]==="I"&&l[e+6]==="T"&&l[e+7]==="Y"}function X2(l,e){return l[e+1]==="!"&&l[e+2]==="E"&&l[e+3]==="L"&&l[e+4]==="E"&&l[e+5]==="M"&&l[e+6]==="E"&&l[e+7]==="N"&&l[e+8]==="T"}function K2(l,e){return l[e+1]==="!"&&l[e+2]==="A"&&l[e+3]==="T"&&l[e+4]==="T"&&l[e+5]==="L"&&l[e+6]==="I"&&l[e+7]==="S"&&l[e+8]==="T"}function Q2(l,e){return l[e+1]==="!"&&l[e+2]==="N"&&l[e+3]==="O"&&l[e+4]==="T"&&l[e+5]==="A"&&l[e+6]==="T"&&l[e+7]==="I"&&l[e+8]==="O"&&l[e+9]==="N"}function q2(l){if(G2.isName(l))return l;throw new Error(`Invalid entity name ${l}`)}var J2=H2;const $2=/^[-+]?0x[a-fA-F0-9]+$/,eT=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const tT={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function sT(l,e={}){if(e=Object.assign({},tT,e),!l||typeof l!="string")return l;let t=l.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return l;if(e.hex&&$2.test(t))return Number.parseInt(t,16);{const s=eT.exec(t);if(s){const i=s[1],n=s[2];let r=iT(s[3]);const o=s[4]||s[6];if(!e.leadingZeros&&n.length>0&&i&&t[2]!=="."||!e.leadingZeros&&n.length>0&&!i&&t[1]!==".")return l;{const a=Number(t),h=""+a;return h.search(/[eE]/)!==-1||o?e.eNotation?a:l:t.indexOf(".")!==-1?h==="0"&&r===""||h===r||i&&h==="-"+r?a:l:n?r===h||i+r===h?a:l:t===h||t===i+h?a:l}}else return l}}function iT(l){return l&&l.indexOf(".")!==-1&&(l=l.replace(/0+$/,""),l==="."?l="0":l[0]==="."?l="0"+l:l[l.length-1]==="."&&(l=l.substr(0,l.length-1))),l}var nT=sT;const f1=Gc,Ja=Y2,rT=J2,oT=nT;let aT=class{constructor(l){this.options=l,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=lT,this.parseXml=fT,this.parseTextData=hT,this.resolveNameSpace=cT,this.buildAttributesMap=dT,this.isItStopNode=ET,this.replaceEntitiesValue=mT,this.readStopNodeData=bT,this.saveTextToParentTag=gT,this.addChild=pT}};function lT(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const s=e[t];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:l[s]}}}function hT(l,e,t,s,i,n,r){if(l!==void 0&&(this.options.trimValues&&!s&&(l=l.trim()),l.length>0)){r||(l=this.replaceEntitiesValue(l));const o=this.options.tagValueProcessor(e,l,t,i,n);return o==null?l:typeof o!=typeof l||o!==l?o:this.options.trimValues?Tf(l,this.options.parseTagValue,this.options.numberParseOptions):l.trim()===l?Tf(l,this.options.parseTagValue,this.options.numberParseOptions):l}}function cT(l){if(this.options.removeNSPrefix){const e=l.split(":"),t=l.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(l=t+e[1])}return l}const uT=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function dT(l,e,t){if(!this.options.ignoreAttributes&&typeof l=="string"){const s=f1.getAllMatches(l,uT),i=s.length,n={};for(let r=0;r<i;r++){const o=this.resolveNameSpace(s[r][1]);let a=s[r][4],h=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(h=this.options.transformAttributeName(h)),h==="__proto__"&&(h="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const c=this.options.attributeValueProcessor(o,a,e);c==null?n[h]=a:typeof c!=typeof a||c!==a?n[h]=c:n[h]=Tf(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[h]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const r={};return r[this.options.attributesGroupName]=n,r}return n}}const fT=function(l){l=l.replace(/\r\n?/g,`
`);const e=new Ja("!xml");let t=e,s="",i="";for(let n=0;n<l.length;n++)if(l[n]==="<")if(l[n+1]==="/"){const r=Er(l,">",n,"Closing Tag is not closed.");let o=l.substring(n+2,r).trim();if(this.options.removeNSPrefix){const c=o.indexOf(":");c!==-1&&(o=o.substr(c+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&(s=this.saveTextToParentTag(s,t,i));const a=i.substring(i.lastIndexOf(".")+1);if(o&&this.options.unpairedTags.indexOf(o)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${o}>`);let h=0;a&&this.options.unpairedTags.indexOf(a)!==-1?(h=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):h=i.lastIndexOf("."),i=i.substring(0,h),t=this.tagsNodeStack.pop(),s="",n=r}else if(l[n+1]==="?"){let r=_f(l,n,!1,"?>");if(!r)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,t,i),!(this.options.ignoreDeclaration&&r.tagName==="?xml"||this.options.ignorePiTags)){const o=new Ja(r.tagName);o.add(this.options.textNodeName,""),r.tagName!==r.tagExp&&r.attrExpPresent&&(o[":@"]=this.buildAttributesMap(r.tagExp,i,r.tagName)),this.addChild(t,o,i)}n=r.closeIndex+1}else if(l.substr(n+1,3)==="!--"){const r=Er(l,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const o=l.substring(n+4,r-2);s=this.saveTextToParentTag(s,t,i),t.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}n=r}else if(l.substr(n+1,2)==="!D"){const r=rT(l,n);this.docTypeEntities=r.entities,n=r.i}else if(l.substr(n+1,2)==="!["){const r=Er(l,"]]>",n,"CDATA is not closed.")-2,o=l.substring(n+9,r);s=this.saveTextToParentTag(s,t,i);let a=this.parseTextData(o,t.tagname,i,!0,!1,!0,!0);a==null&&(a=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):t.add(this.options.textNodeName,a),n=r+2}else{let r=_f(l,n,this.options.removeNSPrefix),o=r.tagName;const a=r.rawTagName;let h=r.tagExp,c=r.attrExpPresent,d=r.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&s&&t.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,t,i,!1));const u=t;if(u&&this.options.unpairedTags.indexOf(u.tagname)!==-1&&(t=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),o!==e.tagname&&(i+=i?"."+o:o),this.isItStopNode(this.options.stopNodes,i,o)){let f="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),h=o):h=h.substr(0,h.length-1),n=r.closeIndex;else if(this.options.unpairedTags.indexOf(o)!==-1)n=r.closeIndex;else{const p=this.readStopNodeData(l,a,d+1);if(!p)throw new Error(`Unexpected end of ${a}`);n=p.i,f=p.tagContent}const m=new Ja(o);o!==h&&c&&(m[":@"]=this.buildAttributesMap(h,i,o)),f&&(f=this.parseTextData(f,o,i,!0,c,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),m.add(this.options.textNodeName,f),this.addChild(t,m,i)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),h=o):h=h.substr(0,h.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const f=new Ja(o);o!==h&&c&&(f[":@"]=this.buildAttributesMap(h,i,o)),this.addChild(t,f,i),i=i.substr(0,i.lastIndexOf("."))}else{const f=new Ja(o);this.tagsNodeStack.push(t),o!==h&&c&&(f[":@"]=this.buildAttributesMap(h,i,o)),this.addChild(t,f,i),t=f}s="",n=d}}else s+=l[n];return e.child};function pT(l,e,t){const s=this.options.updateTag(e.tagname,t,e[":@"]);s===!1||(typeof s=="string"&&(e.tagname=s),l.addChild(e))}const mT=function(l){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];l=l.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];l=l.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];l=l.replace(t.regex,t.val)}l=l.replace(this.ampEntity.regex,this.ampEntity.val)}return l};function gT(l,e,t,s){return l&&(s===void 0&&(s=Object.keys(e.child).length===0),l=this.parseTextData(l,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,s),l!==void 0&&l!==""&&e.add(this.options.textNodeName,l),l=""),l}function ET(l,e,t){const s="*."+t;for(const i in l){const n=l[i];if(s===n||e===n)return!0}return!1}function IT(l,e,t=">"){let s,i="";for(let n=e;n<l.length;n++){let r=l[n];if(s)r===s&&(s="");else if(r==='"'||r==="'")s=r;else if(r===t[0])if(t[1]){if(l[n+1]===t[1])return{data:i,index:n}}else return{data:i,index:n};else r==="	"&&(r=" ");i+=r}}function Er(l,e,t,s){const i=l.indexOf(e,t);if(i===-1)throw new Error(s);return i+e.length-1}function _f(l,e,t,s=">"){const i=IT(l,e+1,s);if(!i)return;let n=i.data;const r=i.index,o=n.search(/\s/);let a=n,h=!0;o!==-1&&(a=n.substring(0,o),n=n.substring(o+1).trimStart());const c=a;if(t){const d=a.indexOf(":");d!==-1&&(a=a.substr(d+1),h=a!==i.data.substr(d+1))}return{tagName:a,tagExp:n,closeIndex:r,attrExpPresent:h,rawTagName:c}}function bT(l,e,t){const s=t;let i=1;for(;t<l.length;t++)if(l[t]==="<")if(l[t+1]==="/"){const n=Er(l,">",t,`${e} is not closed`);if(l.substring(t+2,n).trim()===e&&(i--,i===0))return{tagContent:l.substring(s,t),i:n};t=n}else if(l[t+1]==="?")t=Er(l,"?>",t+1,"StopNode is not closed.");else if(l.substr(t+1,3)==="!--")t=Er(l,"-->",t+3,"StopNode is not closed.");else if(l.substr(t+1,2)==="![")t=Er(l,"]]>",t,"StopNode is not closed.")-2;else{const n=_f(l,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&i++,t=n.closeIndex)}}function Tf(l,e,t){if(e&&typeof l=="string"){const s=l.trim();return s==="true"?!0:s==="false"?!1:oT(l,t)}else return f1.isExist(l)?l:""}var yT=aT,p1={};function wT(l,e){return m1(l,e)}function m1(l,e,t){let s;const i={};for(let n=0;n<l.length;n++){const r=l[n],o=CT(r);let a="";if(t===void 0?a=o:a=t+"."+o,o===e.textNodeName)s===void 0?s=r[o]:s+=""+r[o];else{if(o===void 0)continue;if(r[o]){let h=m1(r[o],e,a);const c=_T(h,e);r[":@"]?vT(h,r[":@"],a,e):Object.keys(h).length===1&&h[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?h=h[e.textNodeName]:Object.keys(h).length===0&&(e.alwaysCreateTextNode?h[e.textNodeName]="":h=""),i[o]!==void 0&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(h)):e.isArray(o,a,c)?i[o]=[h]:i[o]=h}}}return typeof s=="string"?s.length>0&&(i[e.textNodeName]=s):s!==void 0&&(i[e.textNodeName]=s),i}function CT(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const s=e[t];if(s!==":@")return s}}function vT(l,e,t,s){if(e){const i=Object.keys(e),n=i.length;for(let r=0;r<n;r++){const o=i[r];s.isArray(o,t+"."+o,!0,!0)?l[o]=[e[o]]:l[o]=e[o]}}}function _T(l,e){const{textNodeName:t}=e,s=Object.keys(l).length;return!!(s===0||s===1&&(l[t]||typeof l[t]=="boolean"||l[t]===0))}p1.prettify=wT;const{buildOptions:TT}=cp,xT=yT,{prettify:AT}=p1,FT=u1;let RT=class{constructor(l){this.externalEntities={},this.options=TT(l)}parse(l,e){if(typeof l!="string")if(l.toString)l=l.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const i=FT.validate(l,e);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const t=new xT(this.options);t.addExternalEntities(this.externalEntities);const s=t.parseXml(l);return this.options.preserveOrder||s===void 0?s:AT(s,this.options)}addEntity(l,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(l.indexOf("&")!==-1||l.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[l]=e}};var ST=RT;const OT=ST;var PT={XMLParser:OT};class xf{constructor(e,t){z(this,"date",new Date),z(this,"author"),z(this,"guid",vr.create()),z(this,"viewpoint"),z(this,"modifiedAuthor"),z(this,"modifiedDate"),z(this,"topic"),z(this,"_components"),z(this,"_comment",""),this._components=e,this._comment=t;const s=this._components.get(Os);this.author=s.config.author}set comment(e){var t;const s=this._components.get(Os);this._comment=e,this.modifiedDate=new Date,this.modifiedAuthor=s.config.author,(t=this.topic)==null||t.comments.set(this.guid,this)}get comment(){return this._comment}serialize(){let e=null;this.viewpoint&&(e=`<Viewpoint Guid="${this.viewpoint.guid}"/>`);let t=null;this.modifiedDate&&(t=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let s=null;return this.modifiedAuthor&&(s=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`),`
      <Comment Guid="${this.guid}">
        <Date>${this.date.toISOString()}</Date>
        <Author>${this.author}</Author>
        <Comment>${this.comment}</Comment>
        ${e??""}
        ${s??""}
        ${t??""}
      </Comment>
    `}}const g1=class On{constructor(e){z(this,"guid",vr.create()),z(this,"title",On.default.title),z(this,"creationDate",new Date),z(this,"creationAuthor",""),z(this,"viewpoints",new No),z(this,"relatedTopics",new No),z(this,"comments",new jn),z(this,"customData",{}),z(this,"description"),z(this,"serverAssignedId"),z(this,"dueDate"),z(this,"modifiedAuthor"),z(this,"modifiedDate"),z(this,"index"),z(this,"_type",On.default.type),z(this,"_status",On.default.status),z(this,"_priority",On.default.priority),z(this,"_stage",On.default.priority),z(this,"_assignedTo",On.default.assignedTo),z(this,"_labels",On.default.labels),z(this,"_components"),this._components=e;const t=e.get(Os);this.creationAuthor=t.config.author,this.relatedTopics.guard=s=>s!==this.guid}set type(e){const t=this._components.get(Os),{strict:s,types:i}=t.config;(!s||i.has(e))&&(this._type=e)}get type(){return this._type}set status(e){const t=this._components.get(Os),{strict:s,statuses:i}=t.config;(!s||i.has(e))&&(this._status=e)}get status(){return this._status}set priority(e){const t=this._components.get(Os);if(e){const{strict:s,priorities:i}=t.config;if(!(!s||i.has(e)))return;this._priority=e}else this._priority=e}get priority(){return this._priority}set stage(e){const t=this._components.get(Os);if(e){const{strict:s,stages:i}=t.config;if(!(!s||i.has(e)))return;this._stage=e}else this._stage=e}get stage(){return this._stage}set assignedTo(e){const t=this._components.get(Os);if(e){const{strict:s,users:i}=t.config;if(!(!s||i.has(e)))return;this._assignedTo=e}else this._assignedTo=e}get assignedTo(){return this._assignedTo}set labels(e){const t=this._components.get(Os),{strict:s,labels:i}=t.config;if(s){const n=new Set;for(const r of e)(!s||i.has(r))&&n.add(r);this._labels=n}else this._labels=e}get labels(){return this._labels}get _managerVersion(){return this._components.get(Os).config.version}set(e){const t=e,s=this;for(const i in e){if(i==="guid")continue;const n=t[i];i in this&&(s[i]=n)}return this._components.get(Os).list.set(this.guid,this),this}createComment(e,t){const s=new xf(this._components,e);return s.viewpoint=t,s.topic=this,this.comments.set(s.guid,s),s}createLabelTags(e=this._managerVersion){let t="Labels";e==="2.1"&&(t="Labels"),e==="3"&&(t="Label");let s=[...this.labels].map(i=>`<${t}>${i}</${t}>`).join(`
`);for(const i in this.customData){const n=this.customData[i];typeof n=="string"&&(s+=`
<${t}>${n}</${t}>`)}return e==="2.1"?s:e==="3"?s.length!==0?`<Labels>
${s}
</Labels>`:"<Labels/>":s}createCommentTags(e=this._managerVersion){const t=[...this.comments.values()].map(s=>s.serialize()).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<Comments>
${t}
</Comments>`:"<Comments/>":t}createViewpointTags(e=this._managerVersion){let t="Viewpoints";e==="2.1"&&(t="Viewpoints"),e==="3"&&(t="ViewPoint");const s=this._components.get(un),i=[...this.viewpoints].map(n=>s.list.get(n)).filter(n=>n).map(n=>`<${t} Guid="${n.guid}">
          <Viewpoint>${n.guid}.bcfv</Viewpoint>
          <Snapshot>${n.guid}.jpeg</Snapshot>
        </${t}>
      `).join(`
`);return e==="2.1"?i:e==="3"?i.length!==0?`<Viewpoints>
${i}
</Viewpoints>`:"<Viewpoints />":i}createRelatedTopicTags(e=this._managerVersion){const t=[...this.relatedTopics].map(s=>`<RelatedTopic Guid="${s}"></RelatedTopic>
      `).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<RelatedTopics>
${t}
</RelatedTopics>`:"<RelatedTopics />":t}serialize(){const e=this._managerVersion;let t=null;this.serverAssignedId&&(t=`ServerAssignedId="${this.serverAssignedId}"`);let s=null;this.priority&&(s=`<Priority>${this.priority}</Priority>`);let i=null;this.index&&e==="2.1"&&(i=`<Index>${this.index}</Index>`);let n=null;this.modifiedDate&&(n=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let r=null;this.modifiedAuthor&&(r=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`);let o=null;this.dueDate&&(o=`<DueDate>${this.dueDate.toISOString()}</DueDate>`);let a=null;this.assignedTo&&(a=`<AssignedTo>${this.assignedTo}</AssignedTo>`);let h=null;this.description&&(h=`<Description>${this.description}</Description>`);let c=null;this.stage&&(c=`<Stage>${this.stage}</Stage>`);const d=this.createCommentTags(e),u=this.createViewpointTags(e),f=this.createLabelTags(e),m=this.createRelatedTopicTags(e);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Markup>
        <Topic Guid="${this.guid}" TopicType="${this.type}" TopicStatus="${this.status}" ${t??""}>
          <Title>${this.title}</Title>
          <CreationDate>${this.creationDate.toISOString()}</CreationDate>
          <CreationAuthor>${this.creationAuthor}</CreationAuthor>
          ${s??""}
          ${i??""}
          ${n??""}
          ${r??""}
          ${o??""}
          ${a??""}
          ${h??""}
          ${c??""}
          ${f}
          ${m}
          ${e==="3"?d:""}
          ${e==="3"?u:""}
        </Topic>
        ${e==="2.1"?d:""}
        ${e==="2.1"?u:""}
      </Markup>
    `}};z(g1,"default",{title:"BCF Topic",type:"Issue",status:"Active",labels:new Set});let Wg=g1;const MT=(l,e)=>{if(e.trim()==="")return;const t=Os.xmlParser.parse(e).Extensions;if(!t)return;const{Priorities:s,TopicStatuses:i,TopicTypes:n,Users:r}=t;if(s&&s.Priority){const o=Array.isArray(s.Priority)?s.Priority:[s.Priority];for(const a of o)l.config.priorities.add(a)}if(i&&i.TopicStatus){const o=Array.isArray(i.TopicStatus)?i.TopicStatus:[i.TopicStatus];for(const a of o)l.config.statuses.add(a)}if(n&&n.TopicType){const o=Array.isArray(n.TopicType)?n.TopicType:[n.TopicType];for(const a of o)l.config.types.add(a)}if(r&&r.User){const o=Array.isArray(r.User)?r.User:[r.User];for(const a of o)l.config.users.add(a)}},Af=class yc extends ht{constructor(){super(...arguments),z(this,"enabled",!1),z(this,"config",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1}),z(this,"list",new jn),z(this,"onSetup",new we),z(this,"isSetup",!1),z(this,"onBCFImported",new we),z(this,"onDisposed",new we)}setup(e){this.isSetup||(this.config={...this.config,...e},this.isSetup=!0,this.enabled=!0,this.onSetup.trigger())}create(e){const t=new Wg(this.components);return e&&(t.guid=e.guid??t.guid,t.set(e)),this.list.set(t.guid,t),t}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const e=[...this.list].map(([t,s])=>s.type);return new Set(e)}get usedStatuses(){const e=[...this.list].map(([t,s])=>s.status);return new Set(e)}get usedPriorities(){const e=[...this.list].map(([t,s])=>s.priority).filter(t=>t);return new Set(e)}get usedStages(){const e=[...this.list].map(([t,s])=>s.stage).filter(t=>t);return new Set(e)}get usedUsers(){const e=[];for(const[t,s]of this.list){e.push(s.creationAuthor),s.assignedTo&&e.push(s.assignedTo),s.modifiedAuthor&&e.push(s.modifiedAuthor);for(const[i,n]of s.comments)e.push(n.author),n.modifiedAuthor&&e.push(n.modifiedAuthor)}return new Set(e)}get usedLabels(){const e=[];for(const[t,s]of this.list)e.push(...s.labels);return new Set(e)}updateExtensions(){for(const[e,t]of this.list){for(const s of t.labels)this.config.labels.add(s);this.config.types.add(t.type),t.priority&&this.config.priorities.add(t.priority),t.stage&&this.config.stages.add(t.stage),this.config.statuses.add(t.status),this.config.users.add(t.creationAuthor),t.assignedTo&&this.config.users.add(t.assignedTo),t.modifiedAuthor&&this.config.users.add(t.modifiedAuthor);for(const[s,i]of t.comments)this.config.users.add(i.author),i.modifiedAuthor&&this.config.users.add(i.modifiedAuthor)}}updateViewpointReferences(){const e=this.components.get(un);for(const[t,s]of this.list)for(const i of s.viewpoints)e.list.has(i)||s.viewpoints.delete(i)}async export(e=this.list.values()){const t=new kg;t.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`),t.file("bcf.extensions",this.serializeExtensions());const s=await(await fetch("https://thatopen.github.io/engine_components/resources/favicon.ico")).blob(),i=this.components.get(un);for(const n of e){const r=t.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const a=i.list.get(o);a&&(r.file(`${o}.jpeg`,s,{binary:!0}),r.file(`${o}.bcfv`,await a.serialize()))}}return await t.generateAsync({type:"blob"})}serializeExtensions(){const e=[...this.config.types].map(o=>`<TopicType>${o}</TopicType>`).join(`
`),t=[...this.config.statuses].map(o=>`<TopicStatus>${o}</TopicStatus>`).join(`
`),s=[...this.config.priorities].map(o=>`<Priority>${o}</Priority>`).join(`
`),i=[...this.config.labels].map(o=>`<TopicLabel>${o}</TopicLabel>`).join(`
`),n=[...this.config.stages].map(o=>`<Stage>${o}</Stage>`).join(`
`),r=[...this.config.users].map(o=>`<User>${o}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${e.length!==0?`<TopicTypes>
${e}
</TopicTypes>`:""}
        ${t.length!==0?`<TopicStatuses>
${t}
</TopicStatuses>`:""}
        ${s.length!==0?`<Priorities>
${s}
</Priorities>`:""}
        ${i.length!==0?`<TopicLabels>
${i}
</TopicLabels>`:""}
        ${n.length!==0?`<Stages>
${n}
</Stages>`:""}
        ${r.length!==0?`<Users>
${r}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(e){const{Guid:t,Date:s,Author:i,Comment:n,Viewpoint:r}=e;if(!(t&&s&&i&&(xf||r)))return null;const o=this.components.get(un),a=new xf(this.components,n??"");return a.guid=t,a.date=new Date(s),a.author=i,a.viewpoint=r!=null&&r.Guid?o.list.get(r.Guid):void 0,a.modifiedAuthor=e.ModifiedAuthor,a.modifiedDate=e.ModifiedDate?new Date(e.ModifiedDate):void 0,a}getMarkupComments(e,t){var s;let i;if(t==="2.1"&&(i=e.Comment),t==="3"&&(i=(s=e.Topic.Comments)==null?void 0:s.Comment),!i)return[];i=Array.isArray(i)?i:[i];const n=i.map(r=>this.processMarkupComment(r)).filter(r=>r);return Array.isArray(n)?n:[n]}getMarkupLabels(e,t){var s;let i;return t==="2.1"&&(i=e.Topic.Labels),t==="3"&&(i=(s=e.Topic.Labels)==null?void 0:s.Label),i?Array.isArray(i)?i:[i]:[]}getMarkupViewpoints(e,t){var s;let i;return t==="2.1"&&(i=e.Viewpoints),t==="3"&&(i=(s=e.Topic.Viewpoints)==null?void 0:s.ViewPoint),i?(i=Array.isArray(i)?i:[i],i):[]}getMarkupRelatedTopics(e,t){var s;let i;return t==="2.1"&&(i=e.Topic.RelatedTopic),t==="3"&&(i=(s=e.Topic.RelatedTopics)==null?void 0:s.RelatedTopic),i?(Array.isArray(i)?i:[i]).map(n=>n.Guid):[]}async load(e,t){var s;const{fallbackVersionOnImport:i,ignoreIncompleteTopicsOnImport:n,updateExtensionsOnImport:r}=this.config,o=new kg;await o.loadAsync(e);const a=Object.values(o.files);let h=i;const c=a.find(I=>I.name.endsWith(".version"));if(c){const I=await c.async("string"),v=yc.xmlParser.parse(I).Version.VersionId;h=String(v)}if(!(h&&(h==="2.1"||h==="3")))throw new Error(`BCFTopics: ${h} is not supported.`);const d=a.find(I=>I.name.endsWith(".extensions"));if(r&&d){const I=await d.async("string");MT(this,I)}const u=[],f=this.components.get(un),m=a.filter(I=>I.name.endsWith(".bcfv"));for(const I of m){const v=await I.async("string"),b=yc.xmlParser.parse(v).VisualizationInfo;if(!b){console.warn("Missing VisualizationInfo in Viewpoint");continue}const C={},{Guid:F,ClippingPlanes:A,Components:R,OrthogonalCamera:O,PerspectiveCamera:L}=b;if(F&&(C.guid=F),R){const{Selection:x,Visibility:M}=R;if(x&&x.Component){const G=Array.isArray(x.Component)?x.Component:[x.Component];C.selectionComponents=G.map(J=>J.IfcGuid).filter(J=>J)}if(M&&"DefaultVisibility"in M&&(C.defaultVisibility=M.DefaultVisibility),M&&M.Exceptions&&"Component"in M.Exceptions){const{Component:G}=M.Exceptions,J=Array.isArray(G)?G:[G];C.exceptionComponents=J.map(Z=>Z.IfcGuid).filter(Z=>Z)}let w;h==="2.1"&&(w=R.ViewSetupHints),h==="3"&&(w=(s=R.Visibility)==null?void 0:s.ViewSetupHints),w&&("OpeningsVisible"in w&&(C.openingsVisible=w.OpeningsVisible),"SpacesVisible"in w&&(C.spacesVisible=w.SpacesVisible),"SpaceBoundariesVisible"in w&&(C.spaceBoundariesVisible=w.SpaceBoundariesVisible))}if(O||L){const x=b.PerspectiveCamera??b.OrthogonalCamera,{CameraViewPoint:M,CameraDirection:w}=x,G=new U(Number(M.X),Number(M.Z),Number(-M.Y)),J=new U(Number(w.X),Number(w.Z),Number(-w.Y)),Z={position:{x:G.x,y:G.y,z:G.z},direction:{x:J.x,y:J.y,z:J.z},aspectRatio:"AspectRatio"in x?x.AspectRatio:1};"ViewToWorldScale"in x&&(C.camera={...Z,viewToWorldScale:x.ViewToWorldScale}),"FieldOfView"in x&&(C.camera={...Z,fov:x.FieldOfView})}const k=new _1(this.components,t,{data:C,setCamera:!1});if(R){const{Coloring:x}=R;if(x&&x.Color){const M=Array.isArray(x.Color)?x.Color:[x.Color];for(const w of M){const{Color:G,Component:J}=w,Z=(Array.isArray(J)?J:[J]).map(le=>le.IfcGuid);k.componentColors.set(G,Z)}}}if(u.push(k),A){const x=this.components.get(zo),M=Array.isArray(A.ClippingPlane)?A.ClippingPlane:[A.ClippingPlane];for(const w of M){const{Location:G,Direction:J}=w;if(!(G&&J))continue;const Z=new U(G.X,G.Z,-G.Y),le=new U(J.X,-J.Z,J.Y),ee=x.createFromNormalAndCoplanarPoint(t,le,Z);ee.visible=!1,ee.enabled=!1,k.clippingPlanes.add(ee)}}}const p={},g=[],E=a.filter(I=>I.name.endsWith(".bcf"));for(const I of E){const v=await I.async("string"),b=yc.xmlParser.parse(v).Markup,C=b.Topic,{Guid:F,TopicType:A,TopicStatus:R,Title:O,CreationDate:L,CreationAuthor:k}=C;if(n&&!(F&&A&&R&&O&&L&&k))continue;const x=new Wg(this.components);x.guid=F??x.guid;const M=this.getMarkupRelatedTopics(b,h);p[x.guid]=new Set(M),x.type=A??x.type,x.status=R??x.status,x.title=O??x.title,x.creationDate=L?new Date(L):x.creationDate,x.creationAuthor=k??x.creationAuthor,x.serverAssignedId=C.ServerAssignedId,x.priority=C.Priority,x.index=C.Index,x.modifiedDate=C.ModifiedDate?new Date(C.ModifiedDate):void 0,x.modifiedAuthor=C.ModifiedAuthor,x.dueDate=C.DueDate?new Date(C.DueDate):void 0,x.assignedTo=C.AssignedTo,x.description=C.Description,x.stage=C.Stage;const w=this.getMarkupLabels(b,h);for(const Z of w)x.labels.add(Z);const G=this.getMarkupComments(b,h);for(const Z of G)x.comments.set(Z.guid,Z);const J=this.getMarkupViewpoints(b,h);for(const Z of J){if(!(Z&&Z.Guid))continue;const le=f.list.get(Z.Guid);le&&x.viewpoints.add(le.guid)}this.list.set(x.guid,x),g.push(x)}for(const I in p){const v=this.list.get(I);if(!v)continue;const b=p[I];for(const C of b)v.relatedTopics.add(C)}return this.onBCFImported.trigger(g),{viewpoints:u,topics:g}}};z(Af,"uuid","de977976-e4f6-4e4f-a01a-204727839802"),z(Af,"xmlParser",new PT.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Os=Af;const E1=class on extends ht{constructor(e){super(e),z(this,"enabled",!0),z(this,"onDisposed",new we),z(this,"_absoluteMin"),z(this,"_absoluteMax"),z(this,"_meshes",[]),this.components.add(on.uuid,this),this._absoluteMin=on.newBound(!0),this._absoluteMax=on.newBound(!1)}static getDimensions(e){const{min:t,max:s}=e,i=Math.abs(s.x-t.x),n=Math.abs(s.y-t.y),r=Math.abs(s.z-t.z),o=new U;return o.subVectors(s,t).divideScalar(2).add(t),{width:i,height:n,depth:r,center:o}}static newBound(e){const t=e?1:-1;return new U(t*Number.MAX_VALUE,t*Number.MAX_VALUE,t*Number.MAX_VALUE)}static getBounds(e,t,s){const i=s||this.newBound(!1),n=t||this.newBound(!0);for(const r of e)r.x<n.x&&(n.x=r.x),r.y<n.y&&(n.y=r.y),r.z<n.z&&(n.z=r.z),r.x>i.x&&(i.x=r.x),r.y>i.y&&(i.y=r.y),r.z>i.z&&(i.z=r.z);return new Qe(t,s)}dispose(){const e=this.components.get(ji);for(const t of this._meshes)e.destroy(t);this._meshes=[],this.onDisposed.trigger(on.uuid),this.onDisposed.reset()}get(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone();return new Qe(e,t)}getSphere(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone(),s=Math.abs((t.x-e.x)/2),i=Math.abs((t.y-e.y)/2),n=Math.abs((t.z-e.z)/2),r=new U(e.x+s,e.y+i,e.z+n),o=r.distanceTo(e);return new pi(r,o)}getMesh(){const e=new Qe(this._absoluteMin,this._absoluteMax),t=on.getDimensions(e),{width:s,height:i,depth:n,center:r}=t,o=new pt(s,i,n),a=new ye(o);return this._meshes.push(a),a.position.copy(r),a}reset(){this._absoluteMin=on.newBound(!0),this._absoluteMax=on.newBound(!1)}add(e){for(const t of e.items)this.addMesh(t.mesh)}addMesh(e,t){if(!e.geometry.index)return;const s=on.getFragmentBounds(e);e.updateMatrixWorld();const i=e.matrixWorld,n=new Oe,r=e instanceof ss,o=new Set;if(e instanceof cl){t||(t=e.fragment.ids);for(const a of t){const h=e.fragment.getInstancesIDs(a);if(h)for(const c of h)o.add(c)}}else o.add(0);for(const a of o){const h=s.min.clone(),c=s.max.clone();r&&(e.getMatrixAt(a,n),h.applyMatrix4(n),c.applyMatrix4(n)),h.applyMatrix4(i),c.applyMatrix4(i),h.x<this._absoluteMin.x&&(this._absoluteMin.x=h.x),h.y<this._absoluteMin.y&&(this._absoluteMin.y=h.y),h.z<this._absoluteMin.z&&(this._absoluteMin.z=h.z),h.x>this._absoluteMax.x&&(this._absoluteMax.x=h.x),h.y>this._absoluteMax.y&&(this._absoluteMax.y=h.y),h.z>this._absoluteMax.z&&(this._absoluteMax.z=h.z),c.x>this._absoluteMax.x&&(this._absoluteMax.x=c.x),c.y>this._absoluteMax.y&&(this._absoluteMax.y=c.y),c.z>this._absoluteMax.z&&(this._absoluteMax.z=c.z),c.x<this._absoluteMin.x&&(this._absoluteMin.x=c.x),c.y<this._absoluteMin.y&&(this._absoluteMin.y=c.y),c.z<this._absoluteMin.z&&(this._absoluteMin.z=c.z)}}addFragmentIdMap(e){const t=this.components.get(at);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];this.addMesh(i.mesh,n)}}static getFragmentBounds(e){const t=e.geometry.attributes.position,s=Number.MAX_VALUE,i=-s,n=new U(s,s,s),r=new U(i,i,i);if(!e.geometry.index)throw new Error("Geometry must be indexed!");const o=Array.from(e.geometry.index.array);for(let a=0;a<o.length;a++){if(a%3===0&&o[a]===0&&o[a+1]===0&&o[a+2]===0){a+=2;continue}const h=o[a],c=t.getX(h),d=t.getY(h),u=t.getZ(h);c<n.x&&(n.x=c),d<n.y&&(n.y=d),u<n.z&&(n.z=u),c>r.x&&(r.x=c),d>r.y&&(r.y=d),u>r.z&&(r.z=u)}return new Qe(n,r)}};z(E1,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let xc=E1;const I1=class b1 extends ht{constructor(e){super(e),z(this,"enabled",!0),z(this,"list",{}),z(this,"onDisposed",new we),z(this,"onFragmentsDisposed",t=>{const{groupID:s,fragmentIDs:i}=t;for(const n in this.list){const r=this.list[n],o=Object.keys(r);if(o.includes(s))delete r[s],Object.values(r).length===0&&delete this.list[n];else for(const a of o){const h=r[a];for(const c of i)delete h.map[c];Object.values(h).length===0&&delete r[a]}}}),e.add(b1.uuid,this),e.get(at).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(at).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(e){for(const t in this.list){const s=this.list[t];for(const i in s){const n=s[i];delete n.map[e]}}}find(e){const t=this.components.get(at);if(!e){const r={};for(const[o,a]of t.list)r[o]=new Set(a.ids);return r}const s=Object.keys(e).length,i={};for(const r in e){const o=e[r];if(!this.list[r]){console.warn(`Classification ${r} does not exist.`);continue}for(const a of o){const h=this.list[r][a];if(h)for(const c in h.map){i[c]||(i[c]=new Map);for(const d of h.map[c]){const u=i[c].get(d);u===void 0?i[c].set(d,1):i[c].set(d,u+1)}}}}const n={};for(const r in i){const o=i[r];for(const[a,h]of o){if(h===void 0)throw new Error("Malformed fragments map!");h===s&&(n[r]||(n[r]=new Set),n[r].add(a))}}return n}byModel(e,t){this.list.models||(this.list.models={});const s=this.list.models;s[e]||(s[e]={map:{},id:null,name:e});const i=s[e];for(const[n,r]of t.data){const o=r[0];for(const a of o){const h=t.keyFragments.get(a);h&&(i.map[h]||(i.map[h]=new Set),i.map[h].add(n))}}}async byPredefinedType(e){var t;this.list.predefinedTypes||(this.list.predefinedTypes={});const s=this.list.predefinedTypes,i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(!r)continue;const o=String((t=r.PredefinedType)==null?void 0:t.value).toUpperCase();s[o]||(s[o]={map:{},id:null,name:o});const a=s[o];for(const[h,c]of e.data){const d=c[0];for(const u of d){const f=e.keyFragments.get(u);if(!f)throw new Error("Fragment ID not found!");a.map[f]||(a.map[f]=new Set),a.map[f].add(r.expressID)}}}}byEntity(e){this.list.entities||(this.list.entities={});for(const[t,s]of e.data){const i=s[1][1],n=qE[i];this.saveItem(e,"entities",n,t)}}async byIfcRel(e,t,s){Ir.isRel(t)&&await Ir.getRelationMap(e,t,async(i,n)=>{const{name:r}=await Ir.getEntityName(e,i);for(const o of n)this.saveItem(e,s,r??"NO REL NAME",o)})}async bySpatialStructure(e,t={}){var s,i;const n=this.components.get(ko),r=n.relationMaps[e.uuid];if(!r)throw new Error(`Classifier: model relations of ${e.name||e.uuid} have to exists to group by spatial structure.`);const o="spatialStructures",a=t.useProperties===void 0||t.useProperties;for(const[h]of r){if(t.isolate){const f=e.data.get(h);if(!f)continue;const m=f[1][1];if(m===void 0||!t.isolate.has(m))continue}const c=n.getEntityRelations(e,h,"Decomposes");if(c)for(const f of c){let m=f.toString();if(a){const p=await e.getProperties(f);if(!p)continue;m=(s=p.Name)==null?void 0:s.value}this.saveItem(e,o,m,h,f)}const d=n.getEntityRelations(e,h,"ContainsElements");if(!d)continue;let u=h.toString();if(a){const f=await e.getProperties(h);if(!f)continue;u=(i=f.Name)==null?void 0:i.value}for(const f of d){this.saveItem(e,o,u,f,h);const m=n.getEntityRelations(e,Number(f),"IsDecomposedBy");if(m)for(const p of m)this.saveItem(e,o,u,p,h)}}}setColor(e,t,s=!1){const i=this.components.get(at);for(const n in e){const r=i.list.get(n);if(!r)continue;const o=e[n];r.setColor(t,o,s)}}resetColor(e){const t=this.components.get(at);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];i.resetColor(n)}}saveItem(e,t,s,i,n=null){this.list[t]||(this.list[t]={});const r=e.data.get(i);if(r)for(const o of r[0]){const a=e.keyFragments.get(o);if(a){const h=this.list[t];h[s]||(h[s]={map:{},id:n,name:s}),h[s].map[a]||(h[s].map[a]=new Set),h[s].map[a].add(i)}}}};z(I1,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let Ff=I1;const NT=class y1 extends ht{constructor(e){super(e),z(this,"onDisposed",new we),z(this,"enabled",!0),z(this,"height",10),z(this,"groupName","spatialStructures"),z(this,"list",new Set),e.add(y1.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(e){if(!this.enabled)return;const t=this.components.get(Ff),s=this.components.get(at),i=e?1:-1;let n=0;const r=t.list[this.groupName],o=new Oe;for(const a in r){o.elements[13]=n*i*this.height;for(const h in r[a].map){const c=s.list.get(h),d=a+h,u=this.list.has(d);if(!c||e&&u||!e&&!u)continue;e?this.list.add(d):this.list.delete(d);const f=r[a].map[h];c.applyTransform(f,o),c.mesh.computeBoundingSphere(),c.mesh.computeBoundingBox()}n++}}};z(NT,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");const w1=class C1 extends ht{constructor(e){super(e),z(this,"enabled",!0),this.components.add(C1.uuid,this)}set(e,t){const s=this.components.get(at);if(!t){for(const[i,n]of s.list)n&&(n.setVisibility(e),this.updateCulledVisibility(n));return}for(const i in t){const n=t[i],r=s.list.get(i);r&&(r.setVisibility(e,n),this.updateCulledVisibility(r))}}isolate(e){this.set(!1),this.set(!0,e)}updateCulledVisibility(e){const t=this.components.get(r2);for(const[s,i]of t.list){const n=i.colorMeshes.get(e.id);n&&(n.count=e.mesh.count)}}};z(w1,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let DT=w1;class LT extends lp{constructor(){super(...arguments),z(this,"minGeometrySize",10),z(this,"minAssetsSize",1e3)}}const UT=class v1 extends ht{constructor(e){super(e),z(this,"onGeometryStreamed",new we),z(this,"onAssetStreamed",new we),z(this,"onProgress",new we),z(this,"onIfcLoaded",new we),z(this,"onDisposed",new we),z(this,"settings",new LT),z(this,"enabled",!0),z(this,"webIfc",new fi),z(this,"_spatialTree",new JE),z(this,"_metaData",new e1),z(this,"_visitedGeometries",new Map),z(this,"_streamSerializer",new Qf),z(this,"_geometries",new Map),z(this,"_geometryCount",0),z(this,"_civil",new $E),z(this,"_groupSerializer",new Nc),z(this,"_assets",[]),z(this,"_meshesWithHoles",new Set),this.components.add(v1.uuid,this),this.settings.excludedCategories.add(Oc)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:e,minAssetsSize:t}=this.settings;this._spatialTree.setUp(this.webIfc);const s=this.webIfc.GetIfcEntityList(0),i=[[]],n=new ia;n.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let r=0,o=0;for(const m of s){if(!this.webIfc.IsIfcElement(m)&&m!==zs||this.settings.excludedCategories.has(m))continue;const p=this.webIfc.GetLineIDsWithType(0,m),g=p.size();for(let E=0;E<g;E++){r>e&&(r=0,o++,i.push([]));const I=p.get(E);i[o].push(I);const v=this.webIfc.GetLine(0,I);if(v.GlobalId){const C=v?.GlobalId.value||v?.GlobalId;n.globalToExpressIDs.set(C,I)}const b=this._spatialTree.itemsByFloor[I]||0;n.data.set(I,[[],[b,m]]),r++}}this._spatialTree.cleanUp();let a=.01,h=0;for(const m of i){h++,this.webIfc.StreamMeshes(0,m,g=>{this.getMesh(this.webIfc,g,n)}),this._geometryCount>e&&await this.streamGeometries(),this._assets.length>t&&await this.streamAssets();const p=h/i.length;p>a&&(a+=.01,a=Math.max(a,p),this.onProgress.trigger(Math.round(a*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:c,transparent:d}=n.geometryIDs;for(const[m,{index:p,uuid:g}]of this._visitedGeometries)n.keyFragments.set(p,g),(m>1?c:d).set(m,p);t1.get(n,this.webIfc);const u=this.webIfc.GetCoordinationMatrix(0);n.coordinationMatrix.fromArray(u),n.civilData=this._civil.read(this.webIfc);const f=this._groupSerializer.export(n);this.onIfcLoaded.trigger(f),n.dispose(!0)}cleanUp(){try{this.webIfc.Dispose()}catch{}this.webIfc=null,this.webIfc=new fi,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(e,t,s){const i=t.geometries.size(),n=t.expressID,r={id:n,geometries:[]};for(let o=0;o<i;o++){const a=t.geometries.get(o),h=a.geometryExpressID,c=a.color.w===1?1:-1,d=h*c;if(!this._visitedGeometries.has(d)){this._visitedGeometries.has(h)||this.getGeometry(e,h);const b=this._visitedGeometries.size,C=xr.generateUUID();this._visitedGeometries.set(d,{uuid:C,index:b})}const u=this._visitedGeometries.get(d);if(u===void 0)throw new Error("Error getting geometry data for streaming!");const f=s.data.get(n);if(!f)throw new Error("Data not found!");f[0].push(u.index);const{x:m,y:p,z:g,w:E}=a.color,I=[m,p,g,E],v=a.flatTransformation;r.geometries.push({color:I,geometryID:h,transformation:v})}this._assets.push(r)}getGeometry(e,t){const s=e.GetGeometry(0,t),i=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let u=0;u<n.length;u+=6)r[u/2]=n[u],r[u/2+1]=n[u+1],r[u/2+2]=n[u+2],o[u/2]=n[u+3],o[u/2+1]=n[u+4],o[u/2+2]=n[u+5];const a=H_(r),h=new Float32Array(a.transformation.elements),c=[a.center.x,a.center.y,a.center.z];let d=!1;for(let u=0;u<r.length-2;u+=3){const f=r[u],m=r[u+1],p=r[u+2],g=o[u],E=o[u+1],I=o[u+2];if(W_(c,[f,m,p],[g,E,I])){d=!0;break}}this._geometries.set(t,{position:r,normal:o,index:i,boundingBox:h,hasHoles:d}),s.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let e=this._streamSerializer.export(this._geometries),t={};for(const[s,{boundingBox:i,hasHoles:n}]of this._geometries)t[s]={boundingBox:i,hasHoles:n};this.onGeometryStreamed.trigger({data:t,buffer:e}),t=null,e=null,this._geometries.clear(),this._geometryCount=0}};z(UT,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");class BT extends lp{constructor(){super(...arguments),z(this,"propertiesSize",100)}}class zT extends ht{constructor(){super(...arguments),z(this,"onPropertiesStreamed",new al),z(this,"onProgress",new al),z(this,"onIndicesStreamed",new al),z(this,"onDisposed",new we),z(this,"enabled",!0),z(this,"settings",new BT),z(this,"webIfc",new fi)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:e}=this.settings,t=new Set(this.webIfc.GetIfcEntityList(0)),s=new Set([$o,ea,ta,Rr,zs]);for(const o of s)t.add(o);let i=.01,n=0;for(const o of t){if(n++,s1.has(o))continue;const a=s.has(o),h=this.webIfc.GetLineIDsWithType(0,o),c=h.size();let d=0;for(let u=0;u<c-e;u+=e){const f={};for(let m=0;m<e;m++){d++;const p=h.get(u+m);try{const g=this.webIfc.GetLine(0,p,a);f[g.expressID]=g}catch{console.log(`Could not get property: ${p}`)}}await this.onPropertiesStreamed.trigger({type:o,data:f})}if(d!==c){const u={};for(let f=d;f<c;f++){const m=h.get(f);try{const p=this.webIfc.GetLine(0,m,a);u[p.expressID]=p}catch{console.log(`Could not get property: ${m}`)}}await this.onPropertiesStreamed.trigger({type:o,data:u})}n/t.size>i&&(i=Math.round(i*100)/100,await this.onProgress.trigger(i),i+=.01)}await this.onProgress.trigger(1);const r=await this.components.get(ko).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(r)}cleanUp(){this.webIfc.Dispose(),this.webIfc=null,this.webIfc=new fi}}z(zT,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");class _1{constructor(e,t,s){z(this,"title"),z(this,"guid",vr.create()),z(this,"clippingPlanes",new No),z(this,"camera",{aspectRatio:0,fov:0,direction:{x:0,y:0,z:80},position:{x:0,y:0,z:0}}),z(this,"exceptionComponents",new No),z(this,"selectionComponents",new No),z(this,"componentColors",new jn),z(this,"spacesVisible",!1),z(this,"spaceBoundariesVisible",!1),z(this,"openingsVisible",!1),z(this,"defaultVisibility",!0),z(this,"_components"),z(this,"world");const i={setCamera:!0,...s},{data:n,setCamera:r}=i;this._components=e,this.world=t,n&&(this.guid=n.guid??this.guid,this.set(n)),r&&this.updateCamera()}get _selectionModelIdMap(){const e=this._components.get(at),t={};for(const[s,i]of e.groups){s in t||(t[s]=new Set);for(const n of this.selectionComponents){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return t}get _exceptionModelIdMap(){const e=this._components.get(at),t={};for(const[s,i]of e.groups){s in t||(t[s]=new Set);for(const n of this.exceptionComponents){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return t}get selection(){return this._components.get(at).modelIdToFragmentIdMap(this._selectionModelIdMap)}get exception(){return this._components.get(at).modelIdToFragmentIdMap(this._exceptionModelIdMap)}get projection(){return"fov"in this.camera?"Perspective":"Orthographic"}get position(){const e=this._components.get(at),{position:t}=this.camera,{x:s,y:i,z:n}=t,r=new U(s,i,n);return e.applyBaseCoordinateSystem(r,new Oe),r}get direction(){const{direction:e}=this.camera,{x:t,y:s,z:i}=e;return new U(t,s,i)}get _managerVersion(){return this._components.get(Os).config.version}get topics(){return[...this._components.get(Os).list.values()].filter(e=>e.viewpoints.has(this.guid))}async addComponentsFromMap(e){var t;const s=this._components.get(at);for(const i in e){const n=s.list.get(i);if(!(n&&n.group))continue;const r=n.group,o=e[i];for(const a of o){const h=await r.getProperties(a);if(!h)continue;const c=(t=h.GlobalId)==null?void 0:t.value;c&&this.selectionComponents.add(c)}}this._components.get(un).list.set(this.guid,this)}set(e){const t=e,s=this;for(const i in e){if(i==="guid")continue;const n=t[i];i in this&&(s[i]=n)}return this._components.get(un).list.set(this.guid,this),this}async go(e=!0){const{camera:t}=this.world;if(!t.hasCameraControls())throw new Error("Viewpoint: the world's camera need controls to set the viewpoint.");t instanceof C2&&t.projection.set(this.projection);const s=this.position,i=this.direction;let n={x:s.x+i.x*80,y:s.y+i.y*80,z:s.z+i.z*80};const r=this.selection;if(Object.keys(r).length===0){const a=this._components.get(di).get(this.world).castRayFromVector(s,this.direction);a&&(n=a.point)}else{const a=this._components.get(xc);a.reset(),a.addFragmentIdMap(r),n=a.getSphere().center,a.reset()}const o=this._components.get(DT);o.set(this.defaultVisibility),o.set(!this.defaultVisibility,this.exception),o.set(!0,r),await t.controls.setLookAt(s.x,s.y,s.z,n.x,n.y,n.z,e)}updateCamera(){const{camera:e,renderer:t}=this.world;if(!t)throw new Error("Viewpoint: the world needs to have a renderer!");if(!e.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const s=new U;e.controls.getPosition(s);const i=e.three,n=new U(0,0,-1).applyEuler(i.rotation),{width:r,height:o}=t.getSize();let a=r/o;Number.isNaN(a)&&(a=1);const h=this._components.get(at);s.applyMatrix4(h.baseCoordinationMatrix.clone().invert());const c={aspectRatio:a,position:{x:s.x,y:s.y,z:s.z},direction:{x:n.x,y:n.y,z:n.z}};i instanceof Sc?this.camera={...c,fov:i.fov}:i instanceof gi&&(this.camera={...c,viewToWorldScale:i.top-i.bottom}),this._components.get(un).list.set(this.guid,this)}colorize(){const e=this._components.get(un),t=this._components.get(at),s=this._components.get(Ff);for(const[i,n]of this.componentColors){const r=t.guidToFragmentIdMap(n),o=new mt(`#${i}`);s.setColor(r,o,e.config.overwriteColors)}}resetColors(){const e=this._components.get(at),t=this._components.get(Ff);for(const[s,i]of this.componentColors){const n=e.guidToFragmentIdMap(i);t.resetColor(n)}}async createComponentTags(e){var t,s;const i=this._components.get(at),n=this._components.get(Os);let r="";if(n.config.includeSelectionTag){const o=e==="selection"?this._selectionModelIdMap:this._exceptionModelIdMap;for(const a in o){const h=i.groups.get(a);if(!h)continue;const c=o[a];for(const d of c){const u=await h.getProperties(d);if(!u)continue;const f=(t=u.GlobalId)==null?void 0:t.value;if(!f)continue;const m=(s=u.Tag)==null?void 0:s.value;let p=null;m&&(p=`AuthoringToolId="${m}"`),r+=`
<Component IfcGuid="${f}" ${p??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}async serialize(e=this._managerVersion){const t=this._components.get(at),s=this.position;s.applyMatrix4(t.baseCoordinationMatrix.clone().invert());const i=this.direction;i.normalize();const n=new Oe().makeRotationX(Math.PI/2),r=i.clone().applyMatrix4(n);r.normalize();const o=`<CameraViewPoint>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraViewPoint>`,a=`<CameraDirection>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraDirection>`,h=`<CameraUpVector>
      <X>${r.x}</X>
      <Y>${-r.z}</Y>
      <Z>${r.y}</Z>
    </CameraUpVector>`,c=`<AspectRatio>${this.camera.aspectRatio}</AspectRatio>`;let d="";"viewToWorld"in this.camera?d=`<OrthogonalCamera>
        ${o}
        ${a}
        ${h}
        ${c}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(d=`<PerspectiveCamera>
        ${o}
        ${a}
        ${h}
        ${c}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const u=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,f=(await this.createComponentTags("selection")).trim(),m=(await this.createComponentTags("exception")).trim();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${e==="2.1"?u:""}
        ${f.length!==0?`<Selection>${f}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${e==="3"?u:""}
          ${m.length!==0?`<Exceptions>${m}</Exceptions>`:""}
        </Visibility>
      </Components>
      ${d}
    </VisualizationInfo>`}}const T1=class x1 extends ht{constructor(e){super(e),z(this,"enabled",!0),z(this,"list",new jn),z(this,"isSetup",!1),z(this,"onSetup",new we),z(this,"config",{overwriteColors:!1}),z(this,"onDisposed",new we),e.add(x1.uuid,this)}create(e,t){const s=new _1(this.components,e,{data:t});return t||this.list.set(s.guid,s),s}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};z(T1,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let un=T1;class kT{constructor(e){if(z(this,"onDisposed",new we),z(this,"onAfterUpdate",new we),z(this,"onBeforeUpdate",new we),z(this,"onResize",new we),z(this,"frontOffset",0),z(this,"overrideMaterial",new Gf),z(this,"backgroundColor",new mt(395274)),z(this,"renderer"),z(this,"enabled",!0),z(this,"world"),z(this,"_lockRotation",!0),z(this,"_camera"),z(this,"_plane"),z(this,"_size",new lt(320,160)),z(this,"_tempVector1",new U),z(this,"_tempVector2",new U),z(this,"_tempTarget",new U),z(this,"down",new U(0,-1,0)),z(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");const i=[],n=this.world.renderer.three;for(const r of n.clippingPlanes)i.push(r);i.push(this._plane),this.renderer.clippingPlanes=i}),this.world=e,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new Lo,this.renderer.setSize(this._size.x,this._size.y);const t=1,s=this._size.x/this._size.y;this._camera=new gi(t*s/-2,t*s/2,t/2,t/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new _s(this.down,200),this.updatePlanes()}get lockRotation(){return this._lockRotation}set lockRotation(e){this._lockRotation=e,e&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(e){this._camera.zoom=e,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();const e=this.world.scene.three,t=this.world.camera;if(!t.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(e instanceof Zi))throw new Error("The given world must have a THREE.Scene as a root!");const s=t.controls;if(s.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(s.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){s.getTarget(this._tempTarget);const n=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=n+Math.PI}this._plane.set(this.down,this._tempVector1.y);const i=e.background;e.background=this.backgroundColor,this.renderer.render(e,this._camera),e.background=i,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(e=this._size){this._size.copy(e),this.renderer.setSize(e.x,e.y);const t=e.x/e.y,s=1;this._camera.left=s*t/-2,this._camera.right=s*t/2,this._camera.top=s/2,this._camera.bottom=-1/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(e)}}const VT=class A1 extends ht{constructor(e){super(e),z(this,"onAfterUpdate",new we),z(this,"onBeforeUpdate",new we),z(this,"onDisposed",new we),z(this,"enabled",!0),z(this,"list",new Map),this.components.add(A1.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a minimap!");const t=new kT(e);return this.list.set(e.uuid,t),t}delete(e){const t=this.list.get(e);t&&t.dispose(),this.list.delete(e)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(const[e,t]of this.list)t.update()}};z(VT,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");const F1=class R1 extends ht{constructor(e){super(e),z(this,"enabled",!0),e.add(R1.uuid,this)}static distanceFromPointToLine(e,t,s,i=!1){const n=new Et,r=new U;return n.set(t,s),n.closestPointToPoint(e,i,r),r.distanceTo(e)}getFace(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=new Map,n=e.geometry.index.array,{plane:r}=this.getFaceData(t,s,e),o=[];for(let d=0;d<n.length/3;d++){const{plane:u,edges:f}=this.getFaceData(d,s,e);if(u.equals(r)){o.push({index:d,edges:f});for(const{id:m,points:p,distance:g}of f)i.set(m,{points:p,distance:g})}}let a=0;const h=new Map,c=new Map;for(const{index:d,edges:u}of o){const f=new Map;for(const{id:b}of u)if(h.has(b)){const C=h.get(b);f.set(b,C)}const m=u.map(b=>b.id);if(!f.size){const b=a++;for(const{id:C}of u)h.set(C,b);c.set(b,{edges:new Set(m),indices:new Set([d])});continue}let p=null;const g=new Set,E=new Set(m);for(const[b,C]of f){p===null?p=C:C!==p&&g.add(C),h.delete(b);const{edges:F}=c.get(C);F.delete(b),E.delete(b)}if(p===null)throw new Error("Error computing face!");const I=c.get(p),{indices:v}=I;v.add(d);for(const b of E){h.set(b,p);const{edges:C}=I;C.add(b)}for(const b of g){const C=c.get(b),{edges:F,indices:A}=C,R=c.get(p),{edges:O,indices:L}=R;for(const k of F)O.add(k),h.set(k,p);for(const k of A)L.add(k);c.delete(b)}}for(const[d,{indices:u,edges:f}]of c)if(u.has(t)){const m=[];for(const p of f){const g=i.get(p);m.push(g)}return{edges:m,indices:u}}return null}getVerticesAndNormal(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=e.geometry.index.array,n=e.geometry.attributes.position.array,r=e.geometry.attributes.normal.array,o=i[t*3]*3,a=i[t*3+1]*3,h=i[t*3+2]*3,c=new U(n[o],n[o+1],n[o+2]),d=new U(n[a],n[a+1],n[a+2]),u=new U(n[h],n[h+1],n[h+2]),f=new U(r[o],r[o+1],r[o+2]),m=new U(r[a],r[a+1],r[a+2]),p=new U(r[h],r[h+1],r[h+2]),g=(f.x+m.x+p.x)/3,E=(f.y+m.y+p.y)/3,I=(f.z+m.z+p.z)/3,v=new U(g,E,I);if(s!==void 0&&e instanceof ss){const b=new Oe;e.getMatrixAt(s,b);const C=new Oe;C.extractRotation(b),v.applyMatrix4(C),c.applyMatrix4(b),d.applyMatrix4(b),u.applyMatrix4(b)}return{p1:c,p2:d,p3:u,faceNormal:v}}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}getVolumeFromFragments(e){const t=this.components.get(at),s=new Oe,i=[];for(const r in e){const o=t.list.get(r);if(!o)continue;const a=e[r];let h=0;for(const u of a){const f=o.getInstancesIDs(u);f&&(h+=f.size)}const c=new ss(o.mesh.geometry,void 0,h);let d=0;for(const u of a){const f=o.getInstancesIDs(u);if(f)for(const m of f)o.mesh.getMatrixAt(m,s),c.setMatrixAt(d++,s)}i.push(c)}const n=this.getVolumeFromMeshes(i);for(const r of i)r.geometry=null,r.material=[],r.dispose();return n}getVolumeFromMeshes(e){let t=0;for(const s of e)t+=this.getVolumeOfMesh(s);return t}getFaceData(e,t,s){const i=this.getVerticesAndNormal(s,e,t),{p1:n,p2:r,p3:o,faceNormal:a}=i;this.round(n),this.round(r),this.round(o),this.round(a);const h=[{id:`${n.x}|${n.y}|${n.z}`,value:n},{id:`${r.x}|${r.y}|${r.z}`,value:r},{id:`${o.x}|${o.y}|${o.z}`,value:o}];h.sort((I,v)=>I.id<v.id?-1:I.id>v.id?1:0);const[{id:c,value:d},{id:u,value:f},{id:m,value:p}]=h,g=[{id:`${c}|${u}`,distance:d.distanceTo(f),points:[d,f]},{id:`${u}|${m}`,distance:f.distanceTo(p),points:[f,p]},{id:`${c}|${m}`,distance:d.distanceTo(p),points:[d,p]}],E=new _s;return E.setFromNormalAndCoplanarPoint(a,n),E.constant=Math.round(E.constant*10)/10,{plane:E,edges:g}}getVolumeOfMesh(e){let t=0;const s=new U,i=new U,n=new U,{index:r}=e.geometry,o=e.geometry.attributes.position.array;if(!r)return console.warn("Geometry must be indexed to compute its volume!"),0;const a=[];if(e instanceof ss)for(let c=0;c<e.count;c++){const d=new Oe;e.getMatrixAt(c,d),a.push(d)}else a.push(new Oe().identity());const{matrixWorld:h}=e;for(let c=0;c<r.array.length-2;c+=3)for(const d of a){const u=d.multiply(h),f=r.array[c]*3,m=r.array[c+1]*3,p=r.array[c+2]*3;s.set(o[f],o[f+1],o[f+2]).applyMatrix4(u),i.set(o[m],o[m+1],o[m+2]).applyMatrix4(u),n.set(o[p],o[p+1],o[p+2]).applyMatrix4(u),t+=this.getSignedVolumeOfTriangle(s,i,n)}return Math.abs(t)}getSignedVolumeOfTriangle(e,t,s){const i=s.x*t.y*e.z,n=t.x*s.y*e.z,r=s.x*e.y*t.z,o=e.x*s.y*t.z,a=t.x*e.y*s.z,h=e.x*t.y*s.z;return 1/6*(-i+n+r-o-a+h)}};z(F1,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let br=F1;const jg=new Qe,ec=new U;class S1 extends BI{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new Vn(e,3)),this.setAttribute("uv",new Vn(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,s=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),s.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new xd(t,6,1);return this.setAttribute("instanceStart",new Ao(s,3,0)),this.setAttribute("instanceEnd",new Ao(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new xd(t,6,1);return this.setAttribute("instanceColorStart",new Ao(s,3,0)),this.setAttribute("instanceColorEnd",new Ao(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new zI(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Qe);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),jg.setFromBufferAttribute(t),this.boundingBox.union(jg))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new pi),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let i=0;for(let n=0,r=e.count;n<r;n++)ec.fromBufferAttribute(e,n),i=Math.max(i,s.distanceToSquared(ec)),ec.fromBufferAttribute(t,n),i=Math.max(i,s.distanceToSquared(ec));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}ac.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new lt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};lc.line={uniforms:Wf.merge([ac.common,ac.fog,ac.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class El extends ms{constructor(e){super({type:"LineMaterial",uniforms:Wf.clone(lc.line.uniforms),vertexShader:lc.line.vertexShader,fragmentShader:lc.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const Zg=new U,Xg=new U,us=new Fr,ds=new Fr,Ui=new Fr,_d=new U,Td=new Oe,ps=new Et,Kg=new U,tc=new Qe,sc=new pi,Bi=new Fr;let Gi,yr;function Qg(l,e,t){return Bi.set(0,0,-e,1).applyMatrix4(l.projectionMatrix),Bi.multiplyScalar(1/Bi.w),Bi.x=yr/t.width,Bi.y=yr/t.height,Bi.applyMatrix4(l.projectionMatrixInverse),Bi.multiplyScalar(1/Bi.w),Math.abs(Math.max(Bi.x,Bi.y))}function YT(l,e){const t=l.matrixWorld,s=l.geometry,i=s.attributes.instanceStart,n=s.attributes.instanceEnd,r=Math.min(s.instanceCount,i.count);for(let o=0,a=r;o<a;o++){ps.start.fromBufferAttribute(i,o),ps.end.fromBufferAttribute(n,o),ps.applyMatrix4(t);const h=new U,c=new U;Gi.distanceSqToSegment(ps.start,ps.end,c,h),c.distanceTo(h)<yr*.5&&e.push({point:c,pointOnLine:h,distance:Gi.origin.distanceTo(c),object:l,face:null,faceIndex:o,uv:null,uv1:null})}}function GT(l,e,t){const s=e.projectionMatrix,i=l.material.resolution,n=l.matrixWorld,r=l.geometry,o=r.attributes.instanceStart,a=r.attributes.instanceEnd,h=Math.min(r.instanceCount,o.count),c=-e.near;Gi.at(1,Ui),Ui.w=1,Ui.applyMatrix4(e.matrixWorldInverse),Ui.applyMatrix4(s),Ui.multiplyScalar(1/Ui.w),Ui.x*=i.x/2,Ui.y*=i.y/2,Ui.z=0,_d.copy(Ui),Td.multiplyMatrices(e.matrixWorldInverse,n);for(let d=0,u=h;d<u;d++){if(us.fromBufferAttribute(o,d),ds.fromBufferAttribute(a,d),us.w=1,ds.w=1,us.applyMatrix4(Td),ds.applyMatrix4(Td),us.z>c&&ds.z>c)continue;if(us.z>c){const E=us.z-ds.z,I=(us.z-c)/E;us.lerp(ds,I)}else if(ds.z>c){const E=ds.z-us.z,I=(ds.z-c)/E;ds.lerp(us,I)}us.applyMatrix4(s),ds.applyMatrix4(s),us.multiplyScalar(1/us.w),ds.multiplyScalar(1/ds.w),us.x*=i.x/2,us.y*=i.y/2,ds.x*=i.x/2,ds.y*=i.y/2,ps.start.copy(us),ps.start.z=0,ps.end.copy(ds),ps.end.z=0;const f=ps.closestPointToPointParameter(_d,!0);ps.at(f,Kg);const m=xr.lerp(us.z,ds.z,f),p=m>=-1&&m<=1,g=_d.distanceTo(Kg)<yr*.5;if(p&&g){ps.start.fromBufferAttribute(o,d),ps.end.fromBufferAttribute(a,d),ps.start.applyMatrix4(n),ps.end.applyMatrix4(n);const E=new U,I=new U;Gi.distanceSqToSegment(ps.start,ps.end,I,E),t.push({point:I,pointOnLine:E,distance:Gi.origin.distanceTo(I),object:l,face:null,faceIndex:d,uv:null,uv1:null})}}}class HT extends ye{constructor(e=new S1,t=new El({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,s=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let r=0,o=0,a=t.count;r<a;r++,o+=2)Zg.fromBufferAttribute(t,r),Xg.fromBufferAttribute(s,r),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+Zg.distanceTo(Xg);const n=new xd(i,2,1);return e.setAttribute("instanceDistanceStart",new Ao(n,1,0)),e.setAttribute("instanceDistanceEnd",new Ao(n,1,1)),this}raycast(e,t){const s=this.material.worldUnits,i=e.camera;i===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const n=e.params.Line2!==void 0&&e.params.Line2.threshold||0;Gi=e.ray;const r=this.matrixWorld,o=this.geometry,a=this.material;yr=a.linewidth+n,o.boundingSphere===null&&o.computeBoundingSphere(),sc.copy(o.boundingSphere).applyMatrix4(r);let h;if(s)h=yr*.5;else{const d=Math.max(i.near,sc.distanceToPoint(Gi.origin));h=Qg(i,d,a.resolution)}if(sc.radius+=h,Gi.intersectsSphere(sc)===!1)return;o.boundingBox===null&&o.computeBoundingBox(),tc.copy(o.boundingBox).applyMatrix4(r);let c;if(s)c=yr*.5;else{const d=Math.max(i.near,tc.distanceToPoint(Gi.origin));c=Qg(i,d,a.resolution)}tc.expandByScalar(c),Gi.intersectsBox(tc)!==!1&&(s?YT(this,t):GT(this,i,t))}}class Ac extends S1{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,s=new Float32Array(2*t);for(let i=0;i<t;i+=3)s[2*i]=e[i],s[2*i+1]=e[i+1],s[2*i+2]=e[i+2],s[2*i+3]=e[i+3],s[2*i+4]=e[i+4],s[2*i+5]=e[i+5];return super.setPositions(s),this}setColors(e){const t=e.length-3,s=new Float32Array(2*t);for(let i=0;i<t;i+=3)s[2*i]=e[i],s[2*i+1]=e[i+1],s[2*i+2]=e[i+2],s[2*i+3]=e[i+3],s[2*i+4]=e[i+4],s[2*i+5]=e[i+5];return super.setColors(s),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class O1 extends HT{constructor(e=new Ac,t=new El({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}const P1=class M1{constructor(e,t){Y(this,"scene"),Y(this,"onSelect",new we),Y(this,"type"),Y(this,"selectCurve"),Y(this,"selectPoints"),Y(this,"hoverCurve"),Y(this,"hoverPoints"),Y(this,"caster",new Tr),this.scene=e,this.type=t,this.hoverCurve=this.newCurve(.003,4473924,!1),this.hoverPoints=this.newPoints(5,4473924),this.selectCurve=this.newCurve(.005,16777215,!0),this.selectPoints=this.newPoints(7,16777215)}dispose(){this.selectCurve&&this.scene.remove(this.selectCurve),this.selectCurve.material.dispose(),this.selectCurve.geometry.dispose(),this.selectCurve=null,this.hoverCurve.material.dispose(),this.hoverCurve.geometry.dispose(),this.hoverCurve=null,this.hoverPoints.material.dispose(),this.hoverPoints.geometry.dispose(),this.selectPoints.material.dispose(),this.selectPoints.geometry.dispose(),this.scene=null}castRay(e,t,s,i){const n=new lt,r=s.getBoundingClientRect();n.x=(e.clientX-r.left)/r.width*2-1,n.y=-((e.clientY-r.top)/r.height)*2+1,this.caster.setFromCamera(n,t);const o=this.caster.intersectObjects(i);return o.length?o[0]:null}select(e){this.highlight(e,this.selectCurve,this.selectPoints,!0),this.onSelect.trigger(e)}unSelect(){this.selectCurve.removeFromParent(),this.selectPoints.removeFromParent()}hover(e){this.highlight(e,this.hoverCurve,this.hoverPoints,!1)}unHover(){this.hoverCurve.removeFromParent(),this.hoverPoints.removeFromParent()}setResolution({x:e,y:t}){this.selectCurve.material.resolution.set(e/t,1),this.hoverCurve.material.resolution.set(e/t,1)}highlight(e,t,s,i){const{alignment:n}=e.curve;this.scene.add(t),this.scene.add(s);const r=[],o=[],a=[];for(const u of n[this.type]){const f=u.mesh.geometry.attributes.position;for(const E of f.array)r.push(E);if(i){let E;if(this.type==="absolute"){const{horizontal:v}=u.alignment;E=v[u.index].data.TYPE}else E=u.data.TYPE;const I=M1.settings.colors[E]||[1,1,1];for(let v=0;v<f.count;v++)o.push(...I)}const[m,p,g]=f.array;a.push(new U(m,p,g))}const h=r[r.length-3],c=r[r.length-2],d=r[r.length-1];a.push(new U(h,c,d)),r.length/3>t.geometry.attributes.position.count&&(t.geometry.dispose(),t.geometry=new Ac),t.geometry.setPositions(r),i&&t.geometry.setColors(o),s.geometry.setFromPoints(a)}newCurve(e,t,s){const i=new Ac,n=new El({color:t,linewidth:e,vertexColors:s,worldUnits:!1,depthTest:!1}),r=new O1(i,n);return this.scene.add(r),r}newPoints(e,t){const s=new ft,i=new Rt(new Float32Array,3);s.setAttribute("position",i);const n=new DI({size:e,color:t,sizeAttenuation:!1,depthTest:!1}),r=new LI(s,n);return r.frustumCulled=!1,this.scene.add(r),r}};Y(P1,"settings",{colors:{LINE:[213/255,0/255,255/255],CIRCULARARC:[0/255,46,255/255],CLOTHOID:[0/255,255/255,0/255],PARABOLICARC:[0/255,255/255,72/255],CONSTANTGRADIENT:[213/255,0/255,255/255]}});let N1=P1;class WT extends Wi{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new lt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Co=new U,qg=new Oe,Jg=new Oe,$g=new U,e0=new U;class jT{constructor(e={}){const t=this;let s,i,n,r;const o={objects:new WeakMap},a=e.element!==void 0?e.element:document.createElement("div");a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:s,height:i}},this.render=function(f,m){f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),qg.copy(m.matrixWorldInverse),Jg.multiplyMatrices(m.projectionMatrix,qg),h(f,f,m),u(f)},this.setSize=function(f,m){s=f,i=m,n=s/2,r=i/2,a.style.width=f+"px",a.style.height=m+"px"};function h(f,m,p){if(f.isCSS2DObject){Co.setFromMatrixPosition(f.matrixWorld),Co.applyMatrix4(Jg);const g=f.visible===!0&&Co.z>=-1&&Co.z<=1&&f.layers.test(p.layers)===!0;if(f.element.style.display=g===!0?"":"none",g===!0){f.onBeforeRender(t,m,p);const I=f.element;I.style.transform="translate("+-100*f.center.x+"%,"+-100*f.center.y+"%)translate("+(Co.x*n+n)+"px,"+(-Co.y*r+r)+"px)",I.parentNode!==a&&a.appendChild(I),f.onAfterRender(t,m,p)}const E={distanceToCameraSquared:c(p,f)};o.objects.set(f,E)}for(let g=0,E=f.children.length;g<E;g++)h(f.children[g],m,p)}function c(f,m){return $g.setFromMatrixPosition(f.matrixWorld),e0.setFromMatrixPosition(m.matrixWorld),$g.distanceToSquared(e0)}function d(f){const m=[];return f.traverse(function(p){p.isCSS2DObject&&m.push(p)}),m}function u(f){const m=d(f).sort(function(g,E){if(g.renderOrder!==E.renderOrder)return E.renderOrder-g.renderOrder;const I=o.objects.get(g).distanceToCameraSquared,v=o.objects.get(E).distanceToCameraSquared;return I-v}),p=m.length;for(let g=0,E=m.length;g<E;g++)m[g].element.style.zIndex=p-g}}}class Bs{constructor(e,t,s){Y(this,"three"),Y(this,"world"),Y(this,"onDisposed",new we),this.world=e;let i;t?i=t:(i=document.createElement("div"),i.style.width="15px",i.style.height="15px",i.style.border="5px solid red"),this.three=new WT(i),(s||e.scene.three).add(this.three),this.visible=!0}set visible(e){this.three.visible=e}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}}class ZT extends K_{constructor(e,t,s){super(e,t,s),Y(this,"three2D",new jT),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const i=this.currentWorld.scene.three,n=this.currentWorld.camera.three;i instanceof Zi&&this.three2D.render(i,n)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:i,y:n})=>{this.three2D.setSize(i,n)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&this.container.appendChild(this.three2D.domElement)}}const D1=class L1 extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"enabled",!0),Y(this,"threshold",50),Y(this,"autoCluster",!0),Y(this,"list",new Map),Y(this,"clusterLabels",new Set),Y(this,"currentKeys",new Set),Y(this,"_color","white"),Y(this,"_markerKey",0),Y(this,"_clusterKey",0),Y(this,"_worldEvents",new Map),Y(this,"_setupWorlds",new Set),e.add(L1.uuid,this)}get color(){return this._color}set color(e){this._color=e;for(const[t,s]of this.list)for(const[i,n]of s)n.label.three.element.style.color=e}create(e,t,s,i=!1){this.setupEvents(e,!0);const n=this._markerKey.toString(),r=this.getWorldMarkerList(e);if(r.has(n))return;const o=document.createElement("span");o.innerHTML=t,o.style.color=this._color;const a=new Bs(e,o);return a.three.position.copy(s),r.set(n,{key:n,label:a,merged:!1,static:i}),this._markerKey++,n}delete(e){for(const[t,s]of this.list){const i=s.get(e);i&&i.label.dispose(),s.delete(e)}}getWorldMarkerList(e){return this.list.has(e.uuid)||this.list.set(e.uuid,new Map),this.list.get(e.uuid)}dispose(e){for(const[t,s]of this.list){const i=[...s.keys()];for(const n of i){const r=s.get(n);e&&r.type!==e||(r.label.dispose(),s.delete(n))}}if(!e){this.list.clear(),this._markerKey=0;for(const t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(e,t){if(t&&this._setupWorlds.has(e.uuid)||!e.camera.hasCameraControls())return;const s=this.getWorldEvent(e);e.camera.controls.removeEventListener("sleep",s),e.camera.controls.removeEventListener("rest",s),t&&(e.camera.controls.addEventListener("sleep",s),e.camera.controls.addEventListener("rest",s))}cluster(e){if(!this.autoCluster)return;this.resetMarkers();const t=this.list.get(e.uuid);if(t){for(const[s,i]of t)if(!i.merged&&!i.static){this.currentKeys.clear();for(const[n,r]of t)r.static||i.key!==r.key&&!r.merged&&this.distance(i.label,r.label)<this.threshold&&(this.currentKeys.add(r.key),r.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(i.key),i.merged=!0;const n=Array.from(this.currentKeys),r=this.getAveragePositionFromLabels(n),o=new Bs(i.label.world,this.createClusterElement(this._clusterKey.toString())),{element:a}=o.three;a.textContent=n.length.toString(),o.three.position.copy(r),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:n,label:o}),this._clusterKey++}}this.removeMergeMarkers(e)}}getWorldEvent(e){if(!this._worldEvents.has(e.uuid)){const t=()=>{this.cluster(e)};this._worldEvents.set(e.uuid,t)}return this._worldEvents.get(e.uuid)}resetMarkers(){for(const[e,t]of this.list)for(const[s,i]of t)i.merged=!1;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(e){const t=this.list.get(e.uuid);if(t){for(const[s,i]of t)i.merged?i.label.dispose():i.label.world.scene.three.add(i.label.three);for(const s of this.clusterLabels)if(s.markerKeys.length===1){for(const[i,n]of this.list){const r=n.get(s.markerKeys[0]);r&&(r.label.world.scene.three.add(r.label.three),r.merged=!1)}s.label.dispose(),this.clusterLabels.delete(s)}}}getAveragePositionFromLabels(e){const t=e.map(s=>{for(const[i,n]of this.list){const r=n.get(s);if(r)return r.label.three.position}return new U});return t.reduce((s,i)=>s.add(i),new U).divideScalar(t.length)}createClusterElement(e){const t=document.createElement("div");return t.textContent=e,t.style.color="#000000",t.style.background="#FFFFFF",t.style.fontSize="1.2rem",t.style.fontWeight="500",t.style.pointerEvents="auto",t.style.borderRadius="50%",t.style.padding="5px 11px",t.style.textAlign="center",t.style.cursor="pointer",t.addEventListener("pointerdown",()=>{this.navigateToCluster(e)}),t.addEventListener("pointerover",()=>{t.style.background="#BCF124"}),t.addEventListener("pointerout",()=>{t.style.background="#FFFFFF"}),t}getScreenPosition(e){const t=new U;if(!e.world.renderer)throw new Error("Renderer not found!");const s=e.three.position.clone();s.project(e.world.camera.three);const i=e.world.renderer.getSize();return t.x=s.x*i.x/2+i.x/2,t.y=-(s.y*i.y/2)+i.y/2,t}distance(e,t){const s=this.getScreenPosition(e),i=this.getScreenPosition(t),n=s.x-i.x,r=s.y-i.y,o=Math.sqrt(n*n+r*r)*.5;return o===0?this.threshold+1:o}navigateToCluster(e){const t=[],s=Array.from(this.clusterLabels).find(h=>h.key===e);if(!s)return;const i=s.label.world.camera;if(!i.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const h of s.markerKeys)for(const[c,d]of this.list){const u=d.get(h);if(u){const{x:f,y:m,z:p}=u.label.three.position;t.push(f,m,p)}}s.label.dispose(),this.clusterLabels.delete(s);const n=new ft,r=new Float32Array(t),o=new Rt(r,3);n.setAttribute("position",o);const a=new ye(n);a.geometry.computeBoundingSphere(),a.geometry.boundingSphere&&i.controls.fitToSphere(a,!0),n.dispose(),a.clear(),t.length=0}};Y(D1,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");let hr=D1;var t0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function U1(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var up={exports:{}};up.exports=Hc;up.exports.default=Hc;function Hc(l,e,t){t=t||2;var s=e&&e.length,i=s?e[0]*t:l.length,n=B1(l,0,i,t,!0),r=[];if(!n||n.next===n.prev)return r;var o,a,h,c,d,u,f;if(s&&(n=JT(l,e,n,t)),l.length>80*t){o=h=l[0],a=c=l[1];for(var m=t;m<i;m+=t)d=l[m],u=l[m+1],d<o&&(o=d),u<a&&(a=u),d>h&&(h=d),u>c&&(c=u);f=Math.max(h-o,c-a),f=f!==0?32767/f:0}return pl(n,r,t,o,a,f,0),r}function B1(l,e,t,s,i){var n,r;if(i===Of(l,e,t,s)>0)for(n=e;n<t;n+=s)r=s0(n,l[n],l[n+1],r);else for(n=t-s;n>=e;n-=s)r=s0(n,l[n],l[n+1],r);return r&&Wc(r,r.next)&&(gl(r),r=r.next),r}function _r(l,e){if(!l)return l;e||(e=l);var t=l,s;do if(s=!1,!t.steiner&&(Wc(t,t.next)||Wt(t.prev,t,t.next)===0)){if(gl(t),t=e=t.prev,t===t.next)break;s=!0}else t=t.next;while(s||t!==e);return e}function pl(l,e,t,s,i,n,r){if(l){!r&&n&&i3(l,s,i,n);for(var o=l,a,h;l.prev!==l.next;){if(a=l.prev,h=l.next,n?KT(l,s,i,n):XT(l)){e.push(a.i/t|0),e.push(l.i/t|0),e.push(h.i/t|0),gl(l),l=h.next,o=h.next;continue}if(l=h,l===o){r?r===1?(l=QT(_r(l),e,t),pl(l,e,t,s,i,n,2)):r===2&&qT(l,e,t,s,i,n):pl(_r(l),e,t,s,i,n,1);break}}}}function XT(l){var e=l.prev,t=l,s=l.next;if(Wt(e,t,s)>=0)return!1;for(var i=e.x,n=t.x,r=s.x,o=e.y,a=t.y,h=s.y,c=i<n?i<r?i:r:n<r?n:r,d=o<a?o<h?o:h:a<h?a:h,u=i>n?i>r?i:r:n>r?n:r,f=o>a?o>h?o:h:a>h?a:h,m=s.next;m!==e;){if(m.x>=c&&m.x<=u&&m.y>=d&&m.y<=f&&Oo(i,o,n,a,r,h,m.x,m.y)&&Wt(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function KT(l,e,t,s){var i=l.prev,n=l,r=l.next;if(Wt(i,n,r)>=0)return!1;for(var o=i.x,a=n.x,h=r.x,c=i.y,d=n.y,u=r.y,f=o<a?o<h?o:h:a<h?a:h,m=c<d?c<u?c:u:d<u?d:u,p=o>a?o>h?o:h:a>h?a:h,g=c>d?c>u?c:u:d>u?d:u,E=Rf(f,m,e,t,s),I=Rf(p,g,e,t,s),v=l.prevZ,b=l.nextZ;v&&v.z>=E&&b&&b.z<=I;){if(v.x>=f&&v.x<=p&&v.y>=m&&v.y<=g&&v!==i&&v!==r&&Oo(o,c,a,d,h,u,v.x,v.y)&&Wt(v.prev,v,v.next)>=0||(v=v.prevZ,b.x>=f&&b.x<=p&&b.y>=m&&b.y<=g&&b!==i&&b!==r&&Oo(o,c,a,d,h,u,b.x,b.y)&&Wt(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;v&&v.z>=E;){if(v.x>=f&&v.x<=p&&v.y>=m&&v.y<=g&&v!==i&&v!==r&&Oo(o,c,a,d,h,u,v.x,v.y)&&Wt(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=I;){if(b.x>=f&&b.x<=p&&b.y>=m&&b.y<=g&&b!==i&&b!==r&&Oo(o,c,a,d,h,u,b.x,b.y)&&Wt(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function QT(l,e,t){var s=l;do{var i=s.prev,n=s.next.next;!Wc(i,n)&&z1(i,s,s.next,n)&&ml(i,n)&&ml(n,i)&&(e.push(i.i/t|0),e.push(s.i/t|0),e.push(n.i/t|0),gl(s),gl(s.next),s=l=n),s=s.next}while(s!==l);return _r(s)}function qT(l,e,t,s,i,n){var r=l;do{for(var o=r.next.next;o!==r.prev;){if(r.i!==o.i&&o3(r,o)){var a=k1(r,o);r=_r(r,r.next),a=_r(a,a.next),pl(r,e,t,s,i,n,0),pl(a,e,t,s,i,n,0);return}o=o.next}r=r.next}while(r!==l)}function JT(l,e,t,s){var i=[],n,r,o,a,h;for(n=0,r=e.length;n<r;n++)o=e[n]*s,a=n<r-1?e[n+1]*s:l.length,h=B1(l,o,a,s,!1),h===h.next&&(h.steiner=!0),i.push(r3(h));for(i.sort($T),n=0;n<i.length;n++)t=e3(i[n],t);return t}function $T(l,e){return l.x-e.x}function e3(l,e){var t=t3(l,e);if(!t)return e;var s=k1(t,l);return _r(s,s.next),_r(t,t.next)}function t3(l,e){var t=e,s=l.x,i=l.y,n=-1/0,r;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var o=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=s&&o>n&&(n=o,r=t.x<t.next.x?t:t.next,o===s))return r}t=t.next}while(t!==e);if(!r)return null;var a=r,h=r.x,c=r.y,d=1/0,u;t=r;do s>=t.x&&t.x>=h&&s!==t.x&&Oo(i<c?s:n,i,h,c,i<c?n:s,i,t.x,t.y)&&(u=Math.abs(i-t.y)/(s-t.x),ml(t,l)&&(u<d||u===d&&(t.x>r.x||t.x===r.x&&s3(r,t)))&&(r=t,d=u)),t=t.next;while(t!==a);return r}function s3(l,e){return Wt(l.prev,l,e.prev)<0&&Wt(e.next,l,l.next)<0}function i3(l,e,t,s){var i=l;do i.z===0&&(i.z=Rf(i.x,i.y,e,t,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==l);i.prevZ.nextZ=null,i.prevZ=null,n3(i)}function n3(l){var e,t,s,i,n,r,o,a,h=1;do{for(t=l,l=null,n=null,r=0;t;){for(r++,s=t,o=0,e=0;e<h&&(o++,s=s.nextZ,!!s);e++);for(a=h;o>0||a>0&&s;)o!==0&&(a===0||!s||t.z<=s.z)?(i=t,t=t.nextZ,o--):(i=s,s=s.nextZ,a--),n?n.nextZ=i:l=i,i.prevZ=n,n=i;t=s}n.nextZ=null,h*=2}while(r>1);return l}function Rf(l,e,t,s,i){return l=(l-t)*i|0,e=(e-s)*i|0,l=(l|l<<8)&16711935,l=(l|l<<4)&252645135,l=(l|l<<2)&858993459,l=(l|l<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,l|e<<1}function r3(l){var e=l,t=l;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==l);return t}function Oo(l,e,t,s,i,n,r,o){return(i-r)*(e-o)>=(l-r)*(n-o)&&(l-r)*(s-o)>=(t-r)*(e-o)&&(t-r)*(n-o)>=(i-r)*(s-o)}function o3(l,e){return l.next.i!==e.i&&l.prev.i!==e.i&&!a3(l,e)&&(ml(l,e)&&ml(e,l)&&l3(l,e)&&(Wt(l.prev,l,e.prev)||Wt(l,e.prev,e))||Wc(l,e)&&Wt(l.prev,l,l.next)>0&&Wt(e.prev,e,e.next)>0)}function Wt(l,e,t){return(e.y-l.y)*(t.x-e.x)-(e.x-l.x)*(t.y-e.y)}function Wc(l,e){return l.x===e.x&&l.y===e.y}function z1(l,e,t,s){var i=nc(Wt(l,e,t)),n=nc(Wt(l,e,s)),r=nc(Wt(t,s,l)),o=nc(Wt(t,s,e));return!!(i!==n&&r!==o||i===0&&ic(l,t,e)||n===0&&ic(l,s,e)||r===0&&ic(t,l,s)||o===0&&ic(t,e,s))}function ic(l,e,t){return e.x<=Math.max(l.x,t.x)&&e.x>=Math.min(l.x,t.x)&&e.y<=Math.max(l.y,t.y)&&e.y>=Math.min(l.y,t.y)}function nc(l){return l>0?1:l<0?-1:0}function a3(l,e){var t=l;do{if(t.i!==l.i&&t.next.i!==l.i&&t.i!==e.i&&t.next.i!==e.i&&z1(t,t.next,l,e))return!0;t=t.next}while(t!==l);return!1}function ml(l,e){return Wt(l.prev,l,l.next)<0?Wt(l,e,l.next)>=0&&Wt(l,l.prev,e)>=0:Wt(l,e,l.prev)<0||Wt(l,l.next,e)<0}function l3(l,e){var t=l,s=!1,i=(l.x+e.x)/2,n=(l.y+e.y)/2;do t.y>n!=t.next.y>n&&t.next.y!==t.y&&i<(t.next.x-t.x)*(n-t.y)/(t.next.y-t.y)+t.x&&(s=!s),t=t.next;while(t!==l);return s}function k1(l,e){var t=new Sf(l.i,l.x,l.y),s=new Sf(e.i,e.x,e.y),i=l.next,n=e.prev;return l.next=e,e.prev=l,t.next=i,i.prev=t,s.next=t,t.prev=s,n.next=s,s.prev=n,s}function s0(l,e,t,s){var i=new Sf(l,e,t);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function gl(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Sf(l,e,t){this.i=l,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Hc.deviation=function(l,e,t,s){var i=e&&e.length,n=i?e[0]*t:l.length,r=Math.abs(Of(l,0,n,t));if(i)for(var o=0,a=e.length;o<a;o++){var h=e[o]*t,c=o<a-1?e[o+1]*t:l.length;r-=Math.abs(Of(l,h,c,t))}var d=0;for(o=0;o<s.length;o+=3){var u=s[o]*t,f=s[o+1]*t,m=s[o+2]*t;d+=Math.abs((l[u]-l[m])*(l[f+1]-l[u+1])-(l[u]-l[f])*(l[m+1]-l[u+1]))}return r===0&&d===0?0:Math.abs((d-r)/r)};function Of(l,e,t,s){for(var i=0,n=e,r=t-s;n<t;n+=s)i+=(l[r]-l[n])*(l[n+1]+l[r+1]),r=n;return i}Hc.flatten=function(l){for(var e=l[0][0].length,t={vertices:[],holes:[],dimensions:e},s=0,i=0;i<l.length;i++){for(var n=0;n<l[i].length;n++)for(var r=0;r<e;r++)t.vertices.push(l[i][n][r]);i>0&&(s+=l[i-1].length,t.holes.push(s))}return t};var h3=up.exports;const c3=U1(h3),u3={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class oa{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const d3=new gi(-1,1,1,-1,0,1);class f3 extends ft{constructor(){super(),this.setAttribute("position",new Vn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Vn([0,2,0,0,2,0],2))}}const p3=new f3;class V1{constructor(e){this._mesh=new ye(p3,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,d3)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Y1 extends oa{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof ms?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Wf.clone(e.uniforms),this.material=new ms({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new V1(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class i0 extends oa{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const i=e.getContext(),n=e.state;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0);let r,o;this.inverse?(r=0,o=1):(r=1,o=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),n.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),n.buffers.stencil.setClear(o),n.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(i.EQUAL,1,4294967295),n.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),n.buffers.stencil.setLocked(!0)}}class m3 extends oa{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class g3{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const s=e.getSize(new lt);this._width=s.width,this._height=s.height,t=new Hi(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:jf}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Y1(u3),this.copyPass.material.blending=YI,this.clock=new Yf}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let i=0,n=this.passes.length;i<n;i++){const r=this.passes[i];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),r.needsSwap){if(s){const o=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}i0!==void 0&&(r instanceof i0?s=!0:r instanceof m3&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new lt);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(s,i),this.renderTarget2.setSize(s,i);for(let n=0;n<this.passes.length;n++)this.passes[n].setSize(s,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class E3 extends oa{constructor(e,t,s=null,i=null,n=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=i,this.clearAlpha=n,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new mt}render(e,t,s){const i=e.autoClear;e.autoClear=!1;let n,r;this.overrideMaterial!==null&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(n=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(n),this.overrideMaterial!==null&&(this.scene.overrideMaterial=r),e.autoClear=i}}const Il=new ft;Il.setAttribute("position",new Rt(new Float32Array([-1,-1,3,-1,-1,3]),2));Il.setAttribute("uv",new Rt(new Float32Array([0,0,2,0,0,2]),2));Il.boundingSphere=new pi;Il.computeBoundingSphere=function(){};const I3=new gi;class rc{constructor(e){this._mesh=new ye(Il,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,I3)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const b3={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new Oe},viewMat:{value:new Oe},projViewMat:{value:new Oe},projectionMatrixInv:{value:new Oe},viewMatrixInv:{value:new Oe},cameraPos:{value:new U},resolution:{value:new lt},time:{value:0},samples:{value:[]},samplesR:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float[SAMPLES] samplesR;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
    //  vec3 normal = texture2D(sceneNormal, vUv).rgb;//computeNormal(worldPos, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec3 randomVec = normalize(noise.rgb * 2.0 - 1.0);
      vec3 tangent = normalize(randomVec - normal * dot(randomVec, normal));
      vec3 bitangent = cross(normal, tangent);
      mat3 tbn = mat3(tangent, bitangent, normal);
      float occluded = 0.0;
      float totalWeight = 0.0;
     /* float radiusScreen = distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(48.0, 0.0) / resolution)
      );/*vUv.x < 0.5 ? radius : min(distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(100.0, 0.0) / resolution)
      ), radius);
      float distanceFalloffScreen = radiusScreen * 0.2;*/
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
      float bias = (0.1 / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = 
        tbn * 
        samples[int(i)];
        ;
        float moveAmt = samplesR[int(mod(i + noise.a * FSAMPLES, FSAMPLES))];
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projViewMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;
        /*float distSample = logDepth ? linearize_depth_log(sampleDepth, near, far) 
         (ortho ?  linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far));*/
        #ifdef LOGDEPTH
        float distSample = linearize_depth_log(sampleDepth, near, far);
        #else
        float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
        #endif
        float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
        float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
        vec2 diff = gl_FragCoord.xy - ( offset.xy * resolution);
        float weight = dot(sampleDirection, normal);
          occluded += rangeCheck * weight * 
            (distSample + bias
               < distWorld ? 1.0 : 0.0) * (
          (dot(
            diff,
            diff
             
            ) < 1.0 || (sampleDepth == depth) || (
              offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0
            ) ? 0.0 : 1.0)
          );
          totalWeight += weight;
      }
      float occ = clamp(1.0 - occluded / totalWeight, 0.0, 1.0);
      gl_FragColor = vec4(0.5 + 0.5 * normal, occ);
}`},y3={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new Oe},viewMat:{value:new Oe},projectionMatrixInv:{value:new Oe},viewMatrixInv:{value:new Oe},cameraPos:{value:new U},resolution:{value:new lt},color:{value:new U(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform sampler2D sceneDepth;
    uniform sampler2D downsampledDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform float radius;
    uniform float distanceFalloff;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);

        #ifdef HALFRES 
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.xyz * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

     
        float finalAo = pow(texel.a, intensity);
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},w3={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new Oe},viewMat:{value:new Oe},projectionMatrixInv:{value:new Oe},viewMatrixInv:{value:new Oe},cameraPos:{value:new U},resolution:{value:new lt},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.a;
        float baseOcc = data.a;
        vec3 normal = data.rgb * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
            radiusToUse * distanceFalloff
        : distanceFalloff;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.a;
            vec3 normalSample = dataSample.rgb * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
            float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        occlusion /= count;
        gl_FragColor = vec4(0.5 + 0.5 * normal, occlusion);
    }
    `},C3={uniforms:{sceneDepth:{value:null},resolution:{value:new lt},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new Oe},projectionMatrixInv:{value:new Oe},logDepth:{value:!1}},vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        vec2[] uvSamples = vec2[4](
            uv,
            uv + vec2(pixelSize.x, 0.0),
            uv + vec2(0.0, pixelSize.y),
            uv + pixelSize
        );
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[] samples = float[4](depth00, depth10, depth01, depth11);
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
       /* float[] samples = float[4](depth00, depth10, depth01, depth11);
        float c = 0.25 * (depth00 + depth10 + depth01 + depth11);
        float[] distances = float[4](depth00, depth10, depth01, depth11);
        float maxDistance = max(max(distances[0], distances[1]), max(distances[2], distances[3]));

        int remaining[3];
        int rejected[3];
        int i, j, k;

        for(i = 0, j = 0, k = 0; i < 4; ++i) {
            if (distances[i] < maxDistance) {
                remaining[j++] = i;
            } else {
                rejected[k++] = i;
            }
        }
        for(;j < 3;++j) {
            remaining[j] = rejected[--k];
        }
        vec3 s = vec3(
            samples[remaining[0]],
            samples[remaining[1]],
            samples[remaining[2]]
        );
        c = (s.x + s.y + s.z) / 3.0;

        distances[0] = abs(c - s.x);
        distances[1] = abs(c - s.y);
        distances[2] = abs(c - s.z);

        float minDistance = min(min(distances[0], distances[1]), distances[2]);

        for(i = 0; i < 3; ++i) {
            if (distances[i] == minDistance) {
                break;
            }
        }*/
      /*  gl_FragColor = vec4(samples[remaining[i]], 0.0, 0.0, 0.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[remaining[i]], uvSamples[remaining[i]]), uvSamples[remaining[i]]
        ), 0.0);*/
    }`};var G1="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";Uint8Array.from(atob(G1),l=>l.charCodeAt(0));const v3=Uint8Array.from(atob(G1),l=>l.charCodeAt(0));function H1(l,e,t){if(e.getQueryParameter(l,e.QUERY_RESULT_AVAILABLE)){const s=e.getQueryParameter(l,e.QUERY_RESULT)/1e6;t.lastTime=s}else setTimeout(()=>{H1(l,e,t)},1)}class _3 extends oa{constructor(e,t,s=512,i=512){super(),this.width=s,this.height=i,this.clear=!0,this.camera=t,this.scene=e,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new mt(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0},{set:(n,r,o)=>{const a=n[r];return n[r]=o,r==="aoSamples"&&a!==o&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),r==="denoiseSamples"&&a!==o&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),r==="halfRes"&&a!==o&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),r==="depthAwareUpsampling"&&a!==o&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),!0}}),this.samples=[],this.samplesR=[],this.samplesDenoise=[],this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.beautyRenderTarget=new Hi(this.width,this.height,{minFilter:ga,magFilter:ln}),this.beautyRenderTarget.depthTexture=new GI(this.width,this.height,HI),this.beautyRenderTarget.depthTexture.format=WI,this.writeTargetInternal=new Hi(this.width,this.height,{minFilter:ga,magFilter:ga,depthBuffer:!1}),this.readTargetInternal=new Hi(this.width,this.height,{minFilter:ga,magFilter:ga,depthBuffer:!1}),this.bluenoise=new jI(v3,128,128),this.bluenoise.colorSpace=ZI,this.bluenoise.wrapS=Gp,this.bluenoise.wrapT=Gp,this.bluenoise.minFilter=ln,this.bluenoise.magFilter=ln,this.bluenoise.needsUpdate=!0,this.lastTime=0,this._r=new lt,this._c=new mt}configureHalfResTargets(){this.configuration.halfRes?(this.depthDownsampleTarget=new XI(this.width/2,this.height/2,2),this.depthDownsampleTarget.texture[0].format=KI,this.depthDownsampleTarget.texture[0].type=QI,this.depthDownsampleTarget.texture[0].minFilter=ln,this.depthDownsampleTarget.texture[0].magFilter=ln,this.depthDownsampleTarget.texture[0].depthBuffer=!1,this.depthDownsampleTarget.texture[1].format=h0,this.depthDownsampleTarget.texture[1].type=jf,this.depthDownsampleTarget.texture[1].minFilter=ln,this.depthDownsampleTarget.texture[1].magFilter=ln,this.depthDownsampleTarget.texture[1].depthBuffer=!1,this.depthDownsampleQuad=new rc(new ms(C3))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.samples=this.generateHemisphereSamples(this.configuration.aoSamples),this.samplesR=this.generateHemisphereSamplesR(this.configuration.aoSamples);const t={...b3};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new ms(t)):this.effectShaderQuad=new rc(new ms(t))}configureDenoisePass(e=!1){this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const t={...w3};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new ms(t)):this.poissonBlurQuad=new rc(new ms(t))}configureEffectCompositer(e=!1){const t={...y3};e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new ms(t)):this.effectCompositerQuad=new rc(new ms(t))}generateHemisphereSamples(e){const t=[];for(let s=0;s<e;s++){const i=2.399963*s,n=Math.sqrt(s+.5)/Math.sqrt(e),r=n*Math.cos(i),o=n*Math.sin(i),a=Math.sqrt(1-(r*r+o*o));t.push(new U(r,o,a))}return t}generateHemisphereSamplesR(e){let t=[];for(let s=0;s<e;s++)t.push((s+1)/e);return t}generateDenoiseSamples(e,t){const s=2*Math.PI*t/e,i=1/e,n=i,r=[];let o=i,a=0;for(let h=0;h<e;h++)r.push(new lt(Math.cos(a),Math.sin(a)).multiplyScalar(Math.pow(o,.75))),o+=n,a+=s;return r}setSize(e,t){this.width=e,this.height=t;const s=this.configuration.halfRes?.5:1;this.beautyRenderTarget.setSize(e,t),this.writeTargetInternal.setSize(e*s,t*s),this.readTargetInternal.setSize(e*s,t*s),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*s,t*s)}render(e,t,s,i,n){e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer));let r,o,a;this.debugMode&&(r=e.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),e.setRenderTarget(this.beautyRenderTarget),e.render(this.scene,this.camera),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a));const h=e.xr.enabled;e.xr.enabled=!1,this.camera.updateMatrixWorld(),this._r.set(this.width,this.height);let c=this.configuration.aoRadius;this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(c*=.5),this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.position,this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.samplesR.value=this.samplesR,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=c,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let d=0;d<this.configuration.denoiseIterations;d++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.position,this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=c,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=d,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=c,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),e.setRenderTarget(this.renderToScreen?null:t),this.effectCompositerQuad.render(e),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),H1(a,r,this)),e.xr.enabled=h}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}const T3={name:"GammaCorrectionShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = sRGBTransferOETF( tex );

		}`};function x3(){return new ms({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
    
       vec4 absPosition = vec4(position, 1.0);
       vec3 trueNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          trueNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       trueNormal = (normalize(modelMatrix * vec4(trueNormal, 0.))).xyz;
       
       vec3 planePosition = absPosition.xyz / 40.;
       float d = abs(dot(trueNormal, planePosition));
       vColor = vec4(abs(trueNormal), d);
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      gl_FragColor = vColor;
    }
    `})}function A3(){return new ms({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
       
       vec4 absPosition = vec4(position, 1.0);
       vNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          vNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       vNormal = (normalize(modelMatrix * vec4(vNormal, 0.))).xyz;
       
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       vCameraPosition = cameraPosition;
       vPosition = absPosition.xyz;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      vec3 cameraPixelVec = normalize(vCameraPosition - vPosition);
      float difference = abs(dot(vNormal, cameraPixelVec));
      
      // This achieves a double gloss effect: when the surface is perpendicular and when it's parallel
      difference = abs((difference * 2.) - 1.);
      
      gl_FragColor = vec4(difference, difference, difference, 1.);
    }
    `})}class F3 extends oa{constructor(e,t,s,i,n){if(super(),Y(this,"components"),Y(this,"resolution"),Y(this,"renderScene"),Y(this,"renderCamera"),Y(this,"fsQuad"),Y(this,"normalOverrideMaterial"),Y(this,"glossOverrideMaterial"),Y(this,"planeBuffer"),Y(this,"glossBuffer"),Y(this,"outlineBuffer"),Y(this,"excludedMeshes",[]),Y(this,"outlinedMeshes",{}),Y(this,"outlineScene",new Zi),Y(this,"_outlineEnabled",!1),Y(this,"_lineColor",10066329),Y(this,"_opacity",.4),Y(this,"_tolerance",3),Y(this,"_glossEnabled",!0),Y(this,"_glossExponent",1.9),Y(this,"_minGloss",-.1),Y(this,"_maxGloss",.1),!s.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.renderScene=i,this.renderCamera=n,this.resolution=new lt(e.x,e.y),this.fsQuad=new V1,this.fsQuad.material=this.createOutlinePostProcessMaterial(),this.planeBuffer=this.newRenderTarget(),this.glossBuffer=this.newRenderTarget(),this.outlineBuffer=this.newRenderTarget();const r=x3();r.clippingPlanes=s.renderer.clippingPlanes,this.normalOverrideMaterial=r;const o=A3();o.clippingPlanes=s.renderer.clippingPlanes,this.glossOverrideMaterial=o}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this.fsQuad.material.uniforms.lineColor.value.set(e)}get tolerance(){return this._tolerance}set tolerance(e){this._tolerance=e;const t=this.fsQuad.material;t.uniforms.tolerance.value=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;const t=this.fsQuad.material;t.uniforms.opacity.value=e}get glossEnabled(){return this._glossEnabled}set glossEnabled(e){if(e===this._glossEnabled)return;this._glossEnabled=e;const t=this.fsQuad.material;t.uniforms.glossEnabled.value=e?1:0}get glossExponent(){return this._glossExponent}set glossExponent(e){this._glossExponent=e;const t=this.fsQuad.material;t.uniforms.glossExponent.value=e}get minGloss(){return this._minGloss}set minGloss(e){this._minGloss=e;const t=this.fsQuad.material;t.uniforms.minGloss.value=e}get maxGloss(){return new is().color.convertLinearToSRGB(),this._maxGloss}set maxGloss(e){this._maxGloss=e;const t=this.fsQuad.material;t.uniforms.maxGloss.value=e}get outlineEnabled(){return this._outlineEnabled}set outlineEnabled(e){if(e===this._outlineEnabled)return;this._outlineEnabled=e;const t=this.fsQuad.material;t.uniforms.outlineEnabled.value=e?1:0}async dispose(){this.planeBuffer.dispose(),this.glossBuffer.dispose(),this.outlineBuffer.dispose(),this.normalOverrideMaterial.dispose(),this.glossOverrideMaterial.dispose(),this.fsQuad.material.dispose(),this.fsQuad.dispose(),this.excludedMeshes=[],this.outlineScene.children=[];const e=this.components.get(ji);for(const t in this.outlinedMeshes){const s=this.outlinedMeshes[t];for(const i of s.meshes){e.destroy(i,!0,!0);const n=i;n.fragment&&n.fragment.dispose(!0)}s.material.dispose()}}setSize(e,t){this.planeBuffer.setSize(e,t),this.glossBuffer.setSize(e,t),this.outlineBuffer.setSize(e,t),this.resolution.set(e,t);const s=this.fsQuad.material;s.uniforms.screenSize.value.set(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y),s.uniformsNeedUpdate=!0}render(e,t,s){const i=t.depthBuffer;t.depthBuffer=!1;const n=this.renderScene.overrideMaterial,r=this.renderScene.background;this.renderScene.background=null;for(const a of this.excludedMeshes)a.visible=!1;e.setRenderTarget(this.planeBuffer),this.renderScene.overrideMaterial=this.normalOverrideMaterial,e.render(this.renderScene,this.renderCamera),this._glossEnabled&&(e.setRenderTarget(this.glossBuffer),this.renderScene.overrideMaterial=this.glossOverrideMaterial,e.render(this.renderScene,this.renderCamera)),this.renderScene.overrideMaterial=n,e.setRenderTarget(this.outlineBuffer),this._outlineEnabled?e.render(this.outlineScene,this.renderCamera):e.clear();for(const a of this.excludedMeshes)a.visible=!0;this.renderScene.background=r;const o=this.fsQuad.material;o.uniforms.planeBuffer.value=this.planeBuffer.texture,o.uniforms.glossBuffer.value=this.glossBuffer.texture,o.uniforms.outlineBuffer.value=this.outlineBuffer.texture,o.uniforms.sceneColorBuffer.value=s.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.fsQuad.render(e)),t.depthBuffer=i}get vertexShader(){return`
	  varying vec2 vUv;
	  void main() {
	  	vUv = uv;
	  	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	  }
	`}get fragmentShader(){return`
	  uniform sampler2D sceneColorBuffer;
	  uniform sampler2D planeBuffer;
	  uniform sampler2D glossBuffer;
	  uniform sampler2D outlineBuffer;
	  uniform vec4 screenSize;
	  uniform vec3 lineColor;
	  
	  uniform float outlineEnabled;
	  
      uniform int width;
	  uniform float opacity;
      uniform float tolerance;
      uniform float glossExponent;
      uniform float minGloss;
      uniform float maxGloss;
      uniform float glossEnabled;

	  varying vec2 vUv;

	  vec4 getValue(sampler2D buffer, int x, int y) {
	  	return texture2D(buffer, vUv + screenSize.zw * vec2(x, y));
	  }

      float normalDiff(vec3 normal1, vec3 normal2) {
        return ((dot(normal1, normal2) - 1.) * -1.) / 2.;
      }

      // Returns 0 if it's background, 1 if it's not
      float getIsBackground(vec3 normal) {
        float background = 1.0;
        background *= step(normal.x, 0.);
        background *= step(normal.y, 0.);
        background *= step(normal.z, 0.);
        background = (background - 1.) * -1.;
        return background;
      }

	  void main() {
	  
	    vec4 sceneColor = getValue(sceneColorBuffer, 0, 0);
	    vec3 normSceneColor = normalize(sceneColor.rgb);
  
        vec4 plane = getValue(planeBuffer, 0, 0);
	    vec3 normal = plane.xyz;
        float distance = plane.w;
  
        vec3 normalTop = getValue(planeBuffer, 0, width).rgb;
        vec3 normalBottom = getValue(planeBuffer, 0, -width).rgb;
        vec3 normalRight = getValue(planeBuffer, width, 0).rgb;
        vec3 normalLeft = getValue(planeBuffer, -width, 0).rgb;
        vec3 normalTopRight = getValue(planeBuffer, width, width).rgb;
        vec3 normalTopLeft = getValue(planeBuffer, -width, width).rgb;
        vec3 normalBottomRight = getValue(planeBuffer, width, -width).rgb;
        vec3 normalBottomLeft = getValue(planeBuffer, -width, -width).rgb;
  
        float distanceTop = getValue(planeBuffer, 0, width).a;
        float distanceBottom = getValue(planeBuffer, 0, -width).a;
        float distanceRight = getValue(planeBuffer, width, 0).a;
        float distanceLeft = getValue(planeBuffer, -width, 0).a;
        float distanceTopRight = getValue(planeBuffer, width, width).a;
        float distanceTopLeft = getValue(planeBuffer, -width, width).a;
        float distanceBottomRight = getValue(planeBuffer, width, -width).a;
        float distanceBottomLeft = getValue(planeBuffer, -width, -width).a;
        
        vec3 sceneColorTop = normalize(getValue(sceneColorBuffer, 1, 0).rgb);
        vec3 sceneColorBottom = normalize(getValue(sceneColorBuffer, -1, 0).rgb);
        vec3 sceneColorLeft = normalize(getValue(sceneColorBuffer, 0, -1).rgb);
        vec3 sceneColorRight = normalize(getValue(sceneColorBuffer, 0, 1).rgb);
        vec3 sceneColorTopRight = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomRight = normalize(getValue(sceneColorBuffer, -1, 1).rgb);
        vec3 sceneColorTopLeft = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomLeft = normalize(getValue(sceneColorBuffer, -1, 1).rgb);

        // Checks if the planes of this texel and the neighbour texels are different

        float planeDiff = 0.0;

        planeDiff += step(0.001, normalDiff(normal, normalTop));
        planeDiff += step(0.001, normalDiff(normal, normalBottom));
        planeDiff += step(0.001, normalDiff(normal, normalLeft));
        planeDiff += step(0.001, normalDiff(normal, normalRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopLeft));
        planeDiff += step(0.001, normalDiff(normal, normalBottomRight));
        planeDiff += step(0.001, normalDiff(normal, normalBottomLeft));
        
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTop));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottom));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorRight));
       	planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomLeft));

        planeDiff += step(0.001, abs(distance - distanceTop));
        planeDiff += step(0.001, abs(distance - distanceBottom));
        planeDiff += step(0.001, abs(distance - distanceLeft));
        planeDiff += step(0.001, abs(distance - distanceRight));
        planeDiff += step(0.001, abs(distance - distanceTopRight));
        planeDiff += step(0.001, abs(distance - distanceTopLeft));
        planeDiff += step(0.001, abs(distance - distanceBottomRight));
        planeDiff += step(0.001, abs(distance - distanceBottomLeft));

        // Add extra background outline

        int width2 = width + 1;
        vec3 normalTop2 = getValue(planeBuffer, 0, width2).rgb;
        vec3 normalBottom2 = getValue(planeBuffer, 0, -width2).rgb;
        vec3 normalRight2 = getValue(planeBuffer, width2, 0).rgb;
        vec3 normalLeft2 = getValue(planeBuffer, -width2, 0).rgb;
        vec3 normalTopRight2 = getValue(planeBuffer, width2, width2).rgb;
        vec3 normalTopLeft2 = getValue(planeBuffer, -width2, width2).rgb;
        vec3 normalBottomRight2 = getValue(planeBuffer, width2, -width2).rgb;
        vec3 normalBottomLeft2 = getValue(planeBuffer, -width2, -width2).rgb;

        planeDiff += -(getIsBackground(normalTop2) - 1.);
        planeDiff += -(getIsBackground(normalBottom2) - 1.);
        planeDiff += -(getIsBackground(normalRight2) - 1.);
        planeDiff += -(getIsBackground(normalLeft2) - 1.);
        planeDiff += -(getIsBackground(normalTopRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomLeft2) - 1.);

        // Tolerance sets the minimum amount of differences to consider
        // this texel an edge

        float line = step(tolerance, planeDiff);

        // Exclude background and apply opacity

        float background = getIsBackground(normal);
        line *= background;
        line *= opacity;
        
        // Add gloss
        
        vec3 gloss = getValue(glossBuffer, 0, 0).xyz;
        float diffGloss = abs(maxGloss - minGloss);
        vec3 glossExpVector = vec3(glossExponent,glossExponent,glossExponent);
        gloss = min(pow(gloss, glossExpVector), vec3(1.,1.,1.));
        gloss *= diffGloss;
        gloss += minGloss;
        vec4 glossedColor = sceneColor + vec4(gloss, 1.) * glossEnabled;
        
        vec4 corrected = mix(sceneColor, glossedColor, background);
        
        // Draw lines
        
        corrected = mix(corrected, vec4(lineColor, 1.), line);
        
        // Add outline
        
        vec4 outlinePreview =getValue(outlineBuffer, 0, 0);
        float outlineColorCorrection = 1. / max(0.2, outlinePreview.a);
        vec3 outlineColor = outlinePreview.rgb * outlineColorCorrection;
        
        // thickness between 10 and 2, opacity between 1 and 0.2
	    int outlineThickness = int(outlinePreview.a * 10.);
	    
	    float outlineDiff = 0.;
        
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, -outlineThickness).a);
        
        float outLine = step(4., outlineDiff) * step(outlineDiff, 12.) * outlineEnabled;
        corrected = mix(corrected, vec4(outlineColor, 1.), outLine);
        
        gl_FragColor = corrected;
	}
			`}createOutlinePostProcessMaterial(){return new ms({uniforms:{opacity:{value:this._opacity},debugVisualize:{value:0},sceneColorBuffer:{value:null},tolerance:{value:this._tolerance},planeBuffer:{value:null},glossBuffer:{value:null},outlineBuffer:{value:null},glossEnabled:{value:1},minGloss:{value:this._minGloss},maxGloss:{value:this._maxGloss},outlineEnabled:{value:0},glossExponent:{value:this._glossExponent},width:{value:1},lineColor:{value:new mt(this._lineColor)},screenSize:{value:new Fr(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})}newRenderTarget(){const e=new Hi(this.resolution.x,this.resolution.y);return e.texture.colorSpace="srgb-linear",e.texture.format=h0,e.texture.type=jf,e.texture.minFilter=ln,e.texture.magFilter=ln,e.texture.generateMipmaps=!1,e.stencilBuffer=!1,e}}class R3{constructor(e,t,s){if(Y(this,"composer"),Y(this,"overrideClippingPlanes",!1),Y(this,"_components"),Y(this,"_world"),Y(this,"_renderTarget"),Y(this,"_enabled",!1),Y(this,"_initialized",!1),Y(this,"_n8ao"),Y(this,"_customEffects"),Y(this,"_basePass"),Y(this,"_gammaPass"),Y(this,"_depthTexture"),Y(this,"_renderer"),Y(this,"_settings",{gamma:!0,custom:!0,ao:!1}),!s.renderer)throw new Error("The given world must have a renderer!");this._components=e,this._renderer=t,this._world=s,this._renderTarget=new Hi(window.innerWidth,window.innerHeight),this._renderTarget.texture.colorSpace="srgb-linear",this.composer=new g3(t,this._renderTarget),this.composer.setSize(window.innerWidth,window.innerHeight)}get basePass(){if(!this._basePass)throw new Error("Custom effects not initialized!");return this._basePass}get gammaPass(){if(!this._gammaPass)throw new Error("Custom effects not initialized!");return this._gammaPass}get customEffects(){if(!this._customEffects)throw new Error("Custom effects not initialized!");return this._customEffects}get n8ao(){if(!this._n8ao)throw new Error("Custom effects not initialized!");return this._n8ao}get enabled(){return this._enabled}set enabled(e){this._initialized||this.initialize(),this._enabled=e}get settings(){return{...this._settings}}dispose(){var e,t,s,i;this.composer.dispose(),this._renderTarget.dispose(),(e=this._depthTexture)==null||e.dispose(),(t=this._customEffects)==null||t.dispose(),(s=this._gammaPass)==null||s.dispose(),(i=this._n8ao)==null||i.dispose()}setPasses(e){let t=!1;for(const s in e){const i=s;if(this.settings[i]!==e[i]){t=!0;break}}if(t){for(const s in e){const i=s;this._settings[i]!==void 0&&(this._settings[i]=e[i])}this.updatePasses()}}setSize(e,t){if(!(e===0||t===0)&&this._initialized){const s=this._settings.custom;s&&this.setPasses({custom:!1}),this.setPasses({custom:!1}),this.composer.setSize(e,t),this.basePass.setSize(e,t),this.n8ao.setSize(e,t),this.customEffects.setSize(e,t),this.gammaPass.setSize(e,t),s&&this.setPasses({custom:!0})}}update(){this._enabled&&this.composer.render()}updateCamera(){const e=this._world.camera.three;this._n8ao&&(this._n8ao.camera=e),this._customEffects&&(this._customEffects.renderCamera=e),this._basePass&&(this._basePass.camera=e)}updateProjection(e){this.composer.passes.forEach(t=>{t.camera=e}),this.update()}initialize(){if(!this._world.renderer)throw new Error("The given world must have a renderer!");const e=this._world.scene.three,t=this._world.camera.three;if(!(e instanceof Zi))throw new Error("The given scene must have a THREE.Scene as core!");const s=this._world.camera;s.projection&&s.projection.onChanged.add(()=>{this.updateCamera()});const i=this._world.renderer;this.overrideClippingPlanes||(this._renderer.clippingPlanes=i.clippingPlanes),this._renderer.outputColorSpace="srgb",this._renderer.toneMapping=VI,this.newBasePass(e,t),this.newSaoPass(e,t),this.newGammaPass(),this.newCustomPass(e,t),this._initialized=!0,this.updatePasses()}updatePasses(){for(const e of this.composer.passes)this.composer.removePass(e);this._basePass&&this.composer.addPass(this.basePass),this._settings.gamma&&this.composer.addPass(this.gammaPass),this._settings.ao&&this.composer.addPass(this.n8ao),this._settings.custom&&this.composer.addPass(this.customEffects)}newCustomPass(e,t){this._customEffects=new F3(new lt(window.innerWidth,window.innerHeight),this._components,this._world,e,t)}newGammaPass(){this._gammaPass=new Y1(T3)}newSaoPass(e,t){if(!this._world.renderer)throw new Error("The given world must have a renderer!");const{width:s,height:i}=this._world.renderer.getSize();this._n8ao=new _3(e,t,s,i);const{configuration:n}=this._n8ao;n.aoSamples=16,n.denoiseSamples=1,n.denoiseRadius=13,n.aoRadius=1,n.distanceFalloff=4,n.aoRadius=1,n.intensity=4,n.halfRes=!0,n.color=new mt().setHex(13421772,"srgb-linear")}newBasePass(e,t){this._basePass=new E3(e,t)}}class Pf extends ZT{constructor(e,t,s){super(e,t,s),Y(this,"_postproduction"),this.onResize.add(i=>this.resizePostproduction(i)),this.onWorldChanged.add(()=>{this.currentWorld&&(this._postproduction&&this._postproduction.dispose(),this._postproduction=new R3(e,this.three,this.currentWorld),this.setPostproductionSize())})}get postproduction(){if(!this._postproduction)throw new Error("Renderer not initialized yet with a world!");return this._postproduction}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger();const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.postproduction.enabled?this.postproduction.composer.render():this.three.render(e,t),e instanceof Zi&&this.three2D.render(e,t),this.onAfterUpdate.trigger()}dispose(){super.dispose(),this.postproduction.dispose()}resizePostproduction(e){this.postproduction&&this.setPostproductionSize(e)}setPostproductionSize(e){if(!this.container)return;const t=e?e.x:this.container.clientWidth,s=e?e.y:this.container.clientHeight;this.postproduction.setSize(t,s)}}class S3{constructor(e,t,s,i,n){Y(this,"mesh",new ye(new ft)),Y(this,"components"),Y(this,"world"),Y(this,"styleName"),Y(this,"_precission",1e4),Y(this,"_tempVector",new U),Y(this,"_plane"),Y(this,"_geometry"),Y(this,"_outlinedMesh"),Y(this,"_plane2DCoordinateSystem",new Oe),Y(this,"_planeAxis"),this.components=e,this.world=t,this.mesh.material=n,this.mesh.frustumCulled=!1,this.mesh.userData.indexFragmentMap=new Map,this._plane=s;const{x:r,y:o,z:a}=s.normal;Math.abs(r)===1?this._planeAxis="x":Math.abs(o)===1?this._planeAxis="y":Math.abs(a)===1&&(this._planeAxis="z"),this._geometry=i,this.mesh.geometry.attributes.position=i.attributes.position;const h=s.normal.clone().multiplyScalar(.01);this._outlinedMesh=new ye(this.mesh.geometry),this.mesh.position.copy(h),this._outlinedMesh.position.copy(h),this.visible=!0}get visible(){return this.mesh.parent!==null}set visible(e){const t=this.getStyleAndScene();if(e){if(this.world.scene.three.add(this.mesh),t){const{style:s,outlineScene:i}=t;this._outlinedMesh.material=s.material,s.meshes.add(this._outlinedMesh),i.add(this._outlinedMesh)}}else if(this.mesh.removeFromParent(),t){const{style:s}=t;s.meshes.delete(this._outlinedMesh),this._outlinedMesh.removeFromParent()}}set geometry(e){this._geometry=e,this.mesh.geometry.attributes.position=e.attributes.position}dispose(){const e=this.getStyleAndScene();if(e){const{style:t}=e;t.meshes.delete(this._outlinedMesh),this._outlinedMesh.removeFromParent()}this.mesh.material=[],this._outlinedMesh.material=[],this.mesh.userData.indexFragmentMap.clear(),this.mesh.userData={},this.mesh.geometry.dispose(),this.mesh.removeFromParent(),this.mesh.geometry=null,this._outlinedMesh.geometry=null,this.mesh=null,this._plane=null,this._geometry=null,this.components=null}update(e,t){const s=this._geometry.attributes.position.array;if(!s)return;this.updatePlane2DCoordinateSystem();const{userData:i}=this.mesh,n=i.indexFragmentMap;n.clear();let r=0;const o=[];let a=0;const h=this.components.get(at);for(const[c,d]of t)for(const u in d){const f=h.list.get(u);f&&(f.mesh.userData.fills||(f.mesh.userData.fills=new Set),f.mesh.userData.fills.add(this.mesh))}for(let c=0;c<e.length;c++){const d=e[c],u=[];for(let g=a;g<d;g+=2)u.push(g*3);const f=this.computeFill(u,s),m=t.get(d);let p=0;for(const g of f)o.push(g),m&&p%3===0&&n.set(r++,m),p++;a=d}this.mesh.geometry.setIndex(o)}computeFill(e,t){const s=new Map,i={},n=new Map;let r=0;const o=new Map,a=new Map,h=new Set,c=this._precission;for(let u=0;u<e.length;u++){const f=e[u];let m=0,p=0,g=0,E=0;const I=t[f],v=t[f+1],b=t[f+2],C=t[f+3],F=t[f+4],A=t[f+5];if(this._tempVector.set(I,v,b),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),m=Math.trunc(this._tempVector.x*c)/c,p=Math.trunc(this._tempVector.y*c)/c,this._tempVector.set(C,F,A),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),g=Math.trunc(this._tempVector.x*c)/c,E=Math.trunc(this._tempVector.y*c)/c,m===g&&p===E)continue;const R=`${m}|${p}`,O=`${g}|${E}`;s.has(R)||s.set(R,f/3),s.has(O)||s.set(O,f/3+1);const L=s.get(R),k=s.get(O);i[L]=[m,p],i[k]=[g,E];const x=a.has(L),M=o.has(L),w=a.has(k),G=o.has(k);if(!x&&!M&&!w&&!G)a.set(L,r),o.set(k,r),h.add(r),n.set(r,[L,k]),r++;else if(x&&G){const J=a.get(L),Z=o.get(k);if(J!==Z){const le=n.get(Z),ee=n.get(J);if(!le||!ee)continue;n.delete(J),h.delete(J),o.set(ee[ee.length-1],Z),o.delete(le[le.length-1]);for(const xe of ee)le.push(xe)}else h.delete(Z);a.delete(L),o.delete(k)}else if(M&&w){const J=a.get(k),Z=o.get(L);if(J!==Z){const le=n.get(Z),ee=n.get(J);if(!le||!ee)continue;n.delete(J),h.delete(J),o.set(ee[ee.length-1],Z),o.delete(le[le.length-1]);for(const xe of ee)le.push(xe)}else h.delete(Z);a.delete(k),o.delete(L)}else if(x&&w){const J=a.get(k),Z=a.get(L),le=n.get(Z),ee=n.get(J);if(!le||!ee)continue;n.delete(J),h.delete(J),a.delete(le[0]),a.delete(ee[0]),o.delete(ee[ee.length-1]),a.set(ee[ee.length-1],Z),ee.reverse(),le.splice(0,0,...ee)}else if(M&&G){const J=o.get(k),Z=o.get(L),le=n.get(Z),ee=n.get(J);if(!le||!ee)continue;n.delete(J),h.delete(J),o.delete(le[le.length-1]),o.delete(ee[ee.length-1]),a.delete(ee[0]),o.set(ee[0],Z),ee.reverse(),le.push(...ee)}else if(x){const J=a.get(L),Z=n.get(J);if(!Z)continue;Z.unshift(k),a.delete(L),a.set(k,J)}else if(M){const J=o.get(L),Z=n.get(J);if(!Z)continue;Z.push(k),o.delete(L),o.set(k,J)}else if(w){const J=a.get(k),Z=n.get(J);if(!Z)continue;Z.unshift(L),a.delete(k),a.set(L,J)}else if(G){const J=o.get(k),Z=n.get(J);if(!Z)continue;Z.push(L),o.delete(k),o.set(L,J)}}const d=[];for(const[u,f]of n){if(h.has(u))continue;const m=[],p=new Map;let g=0;for(const I of f){const v=i[I];m.push(v[0],v[1]),p.set(g++,I)}const E=c3(m);for(const I of E){const v=p.get(I);if(v===void 0)throw new Error("Map error!");d.push(v)}}return d}updatePlane2DCoordinateSystem(){this._plane2DCoordinateSystem=new Oe;const e=new U(1,0,0),t=new U(0,1,0),s=this._plane.normal,i=new U;this._plane.coplanarPoint(i),this._planeAxis==="x"?e.crossVectors(t,s):this._planeAxis==="y"?t.crossVectors(s,e):this._planeAxis==="z"||(e.crossVectors(t,s).normalize(),t.crossVectors(s,e)),this._plane2DCoordinateSystem.fromArray([e.x,e.y,e.z,0,t.x,t.y,t.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,1]),this._plane2DCoordinateSystem.invert()}getStyleAndScene(){if(!this.world.renderer)return null;const e=this.world.renderer instanceof Pf;if(this.styleName&&e){const t=this.world.renderer,s=t.postproduction.customEffects.outlinedMeshes[this.styleName],i=t.postproduction.customEffects.outlineScene;return{style:s,outlineScene:i}}return null}}class O3{constructor(e,t,s){Y(this,"onDisposed",new we),Y(this,"onAfterUpdate",new we),Y(this,"onBeforeUpdate",new we),Y(this,"enabled",!0),Y(this,"fillNeedsUpdate",!1),Y(this,"components"),Y(this,"world"),Y(this,"_edges",{}),Y(this,"_visible",!0),Y(this,"_inverseMatrix",new Oe),Y(this,"_localPlane",new _s),Y(this,"_tempLine",new Et),Y(this,"_tempVector",new U),Y(this,"_plane"),this.components=e,this.world=t,this._plane=s}get visible(){return this._visible}set visible(e){this._visible=e;for(const t in this._edges){const s=this._edges[t];e?this.world.scene.three.add(s.mesh):s.mesh.removeFromParent(),s.fill&&(s.fill.visible=e)}}get fillMeshes(){const e=[];for(const t in this._edges){const s=this._edges[t];s.fill&&e.push(s.fill.mesh)}return e}update(){const e=this.components.get(oc).styles.list;this.updateDeletedEdges(e);for(const t in e)this.drawEdges(t);this.fillNeedsUpdate=!1}get(){return this._edges}dispose(){const e=Object.keys(this._edges);for(const t of e)this.disposeEdge(t);this.onDisposed.trigger(),this.onDisposed.reset()}newEdgesMesh(e){const t=this.components.get(oc).styles.list[e].lineMaterial,s=new ft,i=new Float32Array(3e5),n=new Rt(i,3,!1);n.setUsage(kI),s.setAttribute("position",n);const r=new r0(s,t);return r.frustumCulled=!1,r}newFillMesh(e,t){const s=this.components.get(oc).styles.list[e],i=s.fillMaterial;if(i){const n=new S3(this.components,this.world,this._plane,t,i);return this.newFillOutline(e,n,s),n}}newFillOutline(e,t,s){if(!s.outlineMaterial||!this.world.renderer)return;const i=this.world.renderer;if(i instanceof Pf){const n=i.postproduction.customEffects.outlinedMeshes;n[e]||(n[e]={meshes:new Set,material:s.outlineMaterial}),t.styleName=e}}drawEdges(e){const t=this.components.get(oc).styles.list[e];this._edges[e]||this.initializeStyle(e);const s=this._edges[e];let i=0;const n=s.mesh.geometry.attributes.position;n.array.fill(0);const r=[];let o=0;const a=new Map;for(const c of t.meshes)if(c.geometry){if(!c.geometry.boundsTree)throw new Error("Bounds tree not found for clipping edges subset.");if(c instanceof ss){if(c.count===0)continue;const d=c;for(let u=0;u<d.count;u++){const f=d instanceof cl,m=d,p=t.fragments[m.fragment.id];if(f&&p){const I=m.fragment.getItemID(u);if(I===null||!p.has(I))continue}const g=new ye(c.geometry);g.matrix.copy(c.matrix);const E=new Oe;if(d.getMatrixAt(u,E),g.applyMatrix4(E),g.applyMatrix4(c.matrixWorld),g.updateMatrix(),g.updateMatrixWorld(),this._inverseMatrix.copy(g.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(g,n,i),i!==o){if(f&&p){const I=m.fragment.getItemID(u);I!==null&&a.set(i,{[m.fragment.id]:new Set([I])})}r.push(i),o=i}}}else this._inverseMatrix.copy(c.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(c,n,i),i!==o&&(r.push(i),o=i)}s.mesh.geometry.setDrawRange(0,i),s.mesh.position.copy(this._plane.normal).multiplyScalar(1e-4),n.needsUpdate=!0;const h=s.mesh.geometry.attributes.position;Number.isNaN(h.array[0])||this.fillNeedsUpdate&&s.fill&&(s.fill.geometry=s.mesh.geometry,s.fill.update(r,a),s.fill.visible=this._visible)}initializeStyle(e){const t=this.newEdgesMesh(e),s=t.geometry,i=this.newFillMesh(e,s);this._edges[e]={mesh:t,name:e,fill:i}}shapecast(e,t,s){return e.geometry.boundsTree.shapecast({intersectsBounds:i=>this._localPlane.intersectsBox(i),intersectsTriangle:i=>{let n=0;if(this._tempLine.start.copy(i.a),this._tempLine.end.copy(i.b),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(s,r.x,r.y,r.z),n++,s++}if(this._tempLine.start.copy(i.b),this._tempLine.end.copy(i.c),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(s,r.x,r.y,r.z),n++,s++}if(this._tempLine.start.copy(i.c),this._tempLine.end.copy(i.a),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(s,r.x,r.y,r.z),n++,s++}n!==2&&(s-=n)}}),s}updateDeletedEdges(e){const t=Object.keys(this._edges);for(const s of t)e[s]===void 0&&(this.disposeEdge(s),this.disposeOutline(s))}disposeOutline(e){if(!this.world.renderer)return;const t=this.world.renderer;if(t instanceof Pf){const s=t.postproduction.customEffects.outlinedMeshes;delete s[e]}}disposeEdge(e){const t=this.components.get(ji),s=this._edges[e];s.fill&&s.fill.dispose(),t.destroy(s.mesh,!1),delete this._edges[e]}}class Fc extends Yc{constructor(e,t,s,i,n,r=5,o=!0){super(e,t,s,i,n,r,o),Y(this,"edges"),Y(this,"edgesMaxUpdateRate",50),Y(this,"_visible",!0),Y(this,"_edgesVisible",!0),Y(this,"updateFill",()=>{this.edges.fillNeedsUpdate=!0,this.edges.update()}),this.edges=new O3(e,t,this.three),this.toggleControls(!0),this.edges.visible=!0,this.onDraggingEnded.add(()=>{this.updateFill(),this.edges.visible=!0}),this.onDraggingStarted.add(()=>this.edges.visible=!1)}get visible(){return this._visible}set visible(e){super.visible=e,this.toggleControls(e)}set enabled(e){this._enabled=e,this.world.renderer&&this.world.renderer.setPlane(e,this.three)}get enabled(){return super.enabled}dispose(){super.dispose(),this.edges.dispose()}}class P3{constructor(){Y(this,"onDisposed",new we),Y(this,"enabled",!0),Y(this,"list",{}),Y(this,"_defaultLineMaterial",new mi({color:0,linewidth:.001})),Y(this,"onAfterUpdate",new we),Y(this,"onBeforeUpdate",new we)}update(e){this.onBeforeUpdate.trigger(this.list),this.onAfterUpdate.trigger(this.list)}create(e,t,s,i,n,r){if(!s.renderer)throw new Error("The given world doesn't have a renderer!");i||(i=this._defaultLineMaterial);for(const h of t)h.geometry.boundsTree||h.geometry.computeBoundsTree();const o=s.renderer;i.clippingPlanes=o.clippingPlanes;const a={name:e,lineMaterial:i,meshes:t,fillMaterial:n,outlineMaterial:r,fragments:{}};return this.list[e]=a,a}dispose(){const e=Object.keys(this.list);for(const t of e)this.deleteStyle(t);this.list={},this.onDisposed.trigger(),this.onDisposed.reset()}deleteStyle(e,t=!0){var s,i;const n=this.list[e];n&&(n.meshes.clear(),t&&(n.lineMaterial.dispose(),(s=n.fillMaterial)==null||s.dispose(),(i=n.outlineMaterial)==null||i.dispose())),delete this.list[e]}}const W1=class j1 extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"enabled",!0),Y(this,"styles"),Y(this,"fillsNeedUpdate",!1),Y(this,"_visible",!0),this.components.list.set(j1.uuid,this),this.styles=new P3}get visible(){return this._visible}set visible(e){this._visible=e;const t=this.components.get(zo);for(const s of t.list)s instanceof Fc&&(s.edges.visible=e)}dispose(){this.styles.dispose(),this.onDisposed.trigger()}async update(e=!1){if(!this.enabled)return;const t=this.components.get(zo);for(const s of t.list)s instanceof Fc&&(e||this.fillsNeedUpdate?s.updateFill():s.update());this.fillsNeedUpdate=!1}};Y(W1,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let oc=W1;const M3={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},N3={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`},D3=class xo extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"enabled",!0),Y(this,"cameraHeight",10),Y(this,"darkness",1.2),Y(this,"opacity",1),Y(this,"resolution",512),Y(this,"amount",3.5),Y(this,"planeColor",16777215),Y(this,"shadowOffset",0),Y(this,"shadowExtraScaleFactor",1.5),Y(this,"list",{}),Y(this,"tempMaterial",new is({visible:!1})),Y(this,"depthMaterial",new Gf),this.components.add(xo.uuid,this),this.initializeDepthMaterial()}dispose(){for(const e in this.list)this.deleteShadow(e);this.tempMaterial.dispose(),this.depthMaterial.dispose(),this.components=null,this.onDisposed.trigger(xo.uuid),this.onDisposed.reset()}create(e,t,s){if(this.list[t])throw new Error(`There is already a shadow with ID ${t}`);const{size:i,center:n,min:r}=this.getSizeCenterMin(e),o=this.createShadow(t,i,s);return this.initializeShadow(o,n,r),this.createPlanes(o,i),this.bakeShadow(e,o),o.root}deleteShadow(e){const t=this.components.get(ji),s=this.list[e];if(delete this.list[e],!s)throw new Error(`No shadow with ID ${e} was found.`);t.destroy(s.root),t.destroy(s.blurPlane),s.rt.dispose(),s.rtBlur.dispose()}createPlanes(e,t){const s=new Ar(t.x,t.z).rotateX(Math.PI/2);this.createBasePlane(e,s),xo.createBlurPlane(e,s)}initializeShadow(e,t,s){this.initializeRoot(e,t,s),xo.initializeRenderTargets(e),xo.initializeCamera(e)}bakeShadow(e,t){const s=t.world.scene.three;if(!(s instanceof Zi))throw new Error("The core of the scene of the world must be a scene!");if(!t.world.renderer)throw new Error("The given world must have a renderer!");const i=t.world.renderer.three,n=e.map(h=>!!h.parent);for(let h=0;h<e.length;h++)n[h]||s.add(e[h]);const r=s.children.filter(h=>!e.includes(h)&&h!==t.root);for(let h=r.length-1;h>=0;h--)s.remove(r[h]);const o=s.background;s.background=null,s.overrideMaterial=this.depthMaterial;const a=[];for(const h of e)a.push(h.visible),h.visible=!0;i.setRenderTarget(t.rt),i.render(s,t.camera),s.overrideMaterial=null,this.blurShadow(t,this.amount),this.blurShadow(t,this.amount*.4),i.setRenderTarget(null),s.background=o;for(let h=0;h<e.length;h++)e[h].visible=a[h];for(let h=r.length-1;h>=0;h--)s.add(r[h]);for(let h=0;h<e.length;h++)n[h]||s.remove(e[h])}static initializeCamera(e){e.camera.rotation.x=Math.PI/2,e.root.add(e.camera)}static initializeRenderTargets(e){e.rt.texture.generateMipmaps=!1,e.rtBlur.texture.generateMipmaps=!1}initializeRoot(e,t,s){const i=e.world.scene.three;e.root.position.set(t.x,s.y-this.shadowOffset,t.z),i.add(e.root)}createBasePlane(e,t){const s=this.createPlaneMaterial(e),i=new ye(t,s);i.renderOrder=2,e.root.add(i),i.scale.y=-1}static createBlurPlane(e,t){e.blurPlane.geometry=t,e.blurPlane.visible=!1,e.root.add(e.blurPlane)}createPlaneMaterial(e){if(!e.world.renderer)throw new Error("The given world must have a renderer!");const t=e.world.renderer.three;return new is({map:e.rt.texture,opacity:this.opacity,transparent:!0,depthWrite:!1,clippingPlanes:t.clippingPlanes})}initializeDepthMaterial(){this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1;const e="gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );",t="gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );";this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.onBeforeCompile=s=>{s.uniforms.darkness=this.depthMaterial.userData.darkness,s.fragmentShader=`
						uniform float darkness;
						${s.fragmentShader.replace(e,t)}
					`}}createShadow(e,t,s){return this.list[e]={root:new hl,world:s,rt:new Hi(this.resolution,this.resolution),rtBlur:new Hi(this.resolution,this.resolution),blurPlane:new ye,camera:this.createCamera(t)},this.list[e]}createCamera(e){return new gi(-e.x/2,e.x/2,e.z/2,-e.z/2,0,this.cameraHeight)}getSizeCenterMin(e){const t=e[0].parent,s=new hl;s.children=e;const i=new Qe().setFromObject(s);t?.add(...e);const n=new U;i.getSize(n),n.x*=this.shadowExtraScaleFactor,n.z*=this.shadowExtraScaleFactor;const r=new U;i.getCenter(r);const o=i.min;return{size:n,center:r,min:o}}blurShadow(e,t){if(!e.world.renderer)throw new Error("The given world must have a renderer!");const s=new ms(M3);s.depthTest=!1;const i=new ms(N3);i.depthTest=!1,e.blurPlane.visible=!0,e.blurPlane.material=s,e.blurPlane.material.uniforms.tDiffuse.value=e.rt.texture,s.uniforms.h.value=t*1/256;const n=e.world.renderer.three;n.setRenderTarget(e.rtBlur),n.render(e.blurPlane,e.camera),e.blurPlane.material=i,e.blurPlane.material.uniforms.tDiffuse.value=e.rtBlur.texture,i.uniforms.v.value=t*1/256,n.setRenderTarget(e.rt),n.render(e.blurPlane,e.camera),e.blurPlane.visible=!1}};Y(D3,"uuid","f833a09a-a3ab-4c58-b03e-da5298c7a1b6");const L3=["Station","Radius","Length","InitialKP","FinalKP","KP","Slope","Height","InitialKPV","FinalKPV"],Z1=class X1 extends ht{constructor(e){super(e),Y(this,"enabled",!0),Y(this,"world",null),Y(this,"_markerKey",0),Y(this,"_list",new Map),Y(this,"type","horizontal"),Y(this,"divisionLength",100),e.add(X1.uuid,this)}addKPStation(e,t,s){const i=this.components.get(hr),n=document.createElement("div"),r=document.createElement("div");n.appendChild(r),r.innerHTML=t,r.style.color=i.color,r.style.borderBottom="1px dotted white",r.style.width="160px",r.style.textAlign="left";const o=new Bs(e,n),a=new U;a.x=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-1),a.y=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-1),a.z=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-1);const h=new U;h.x=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-2),h.y=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-2),h.z=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-2);const c=new U;c.x=(a.x+h.x)/2,c.y=(a.y+h.y)/2,c.z=(a.z+h.z)/2,o.three.position.copy(c);const d=new U;d.subVectors(a,h).normalize();const u=new Ht;u.setFromUnitVectors(new U(0,1,0),d);const f=new Hf().setFromQuaternion(u).z,m=xr.radToDeg(f);r.style.transform=`rotate(${-m-90}deg) translate(-35%, -50%)`;const p=this._markerKey.toString();i.setupEvents(e,!0),i.getWorldMarkerList(e).set(p,{label:o,key:p,merged:!1,static:!1}),this._markerKey++,this.save(p,"KP")}addVerticalMarker(e,t,s,i,n){const r=this.components.get(hr),o=document.createElement("span");o.innerHTML=t,o.style.color=r.color;const a=new Bs(e,o,n);if(i==="Height"){const c=document.createElement("span");c.innerHTML=t,c.style.color=r.color;const{position:d}=s.geometry.attributes,u=(d.array.length/3-1)*3,f=d.array.slice(u,u+3);a.three.position.set(f[0],f[1]+10,f[2])}else if(i==="InitialKPV"){const{position:c}=s.geometry.attributes,d=c.getX(0),u=c.getY(0),f=c.getZ(0);a.three.position.set(d-20,u,f)}else if(i==="FinalKPV"){const{position:c}=s.geometry.attributes,d=c.getX(s.geometry.attributes.position.count-1),u=c.getY(s.geometry.attributes.position.count-1),f=c.getZ(s.geometry.attributes.position.count-1);a.three.position.set(d+20,u,f)}else if(i==="Slope"){o.style.color="grey";const{position:c}=s.geometry.attributes,d=new U;d.x=c.getX(0),d.y=c.getY(0),d.z=c.getZ(0);const u=new U;u.x=c.getX(c.count-1),u.y=c.getY(c.count-1),u.z=c.getZ(c.count-1);const f=new U;f.addVectors(d,u).multiplyScalar(.5),a.three.position.set(f.x,f.y-10,f.z)}const h=this._markerKey.toString();return r.setupEvents(e,!0),r.getWorldMarkerList(e).set(h,{label:a,key:h,type:i,merged:!1,static:!1}),this._markerKey++,this.save(h,i),a}addCivilMarker(e,t,s,i){const n=this.components.get(hr),r=document.createElement("span");r.innerHTML=t,r.style.color=n.color;const o=new Bs(e,r);if(i==="InitialKP"){const h=s.geometry.attributes.position.getX(0),c=s.geometry.attributes.position.getY(0),d=s.geometry.attributes.position.getZ(0);o.three.position.set(h+2,c+2,d)}else if(i==="FinalKP"){const h=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-1),c=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-1),d=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-1);o.three.position.set(h+2,c-2,d)}else if(i==="Length"){const h=new U;h.x=s.geometry.attributes.position.getX(0),h.y=s.geometry.attributes.position.getY(0),h.z=s.geometry.attributes.position.getZ(0);const c=new U;c.x=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-1),c.y=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-1),c.z=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-1);const d=h.distanceTo(c);o.three.element.innerText=d.toFixed(2);const u=c.clone().add(h).divideScalar(2);o.three.position.copy(u)}const a=this._markerKey.toString();return n.setupEvents(e,!0),n.getWorldMarkerList(e).set(a,{label:o,key:a,type:i,merged:!1,static:!1}),this._markerKey++,this.save(a,i),o}showKPStations(e){if(!this.world)throw new Error("A world is needed for this component to work!");if(this.type==="horizontal"){const t=this.generateStartAndEndKP(e);for(const[,i]of t)this.addKPStation(this.world,i.value,i.normal);const s=this.generateConstantKP(e);for(const[,i]of s)this.addKPStation(this.world,i.value,i.normal)}}showCurveLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const s=this.components.get(hr),i=e.length,n=`${t.toFixed(2)} m`,r=Math.round(i/2),o=e[r],a=s.create(this.world,n,o,!0);a!==void 0&&this.save(a,"Radius")}showLineLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const s=this.components.get(hr),i=new U;i.x=e.geometry.getAttribute("position").getX(0),i.y=e.geometry.getAttribute("position").getY(0),i.z=e.geometry.getAttribute("position").getZ(0);const n=new U;n.x=e.geometry.getAttribute("position").getX(1),n.y=e.geometry.getAttribute("position").getY(1),n.z=e.geometry.getAttribute("position").getZ(1);const r=`${t.toFixed(2)} m`,o=new U;o.addVectors(i,n).multiplyScalar(.5);const a=s.create(this.world,r,o,!0);a!==void 0&&this.save(a,"Radius")}showCurveRadius(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const s=this.components.get(hr),i=new U;i.x=e.geometry.getAttribute("position").getX(0),i.y=e.geometry.getAttribute("position").getY(0),i.z=e.geometry.getAttribute("position").getZ(0);const n=new U;n.x=e.geometry.getAttribute("position").getX(1),n.y=e.geometry.getAttribute("position").getY(1),n.z=e.geometry.getAttribute("position").getZ(1);const r=`R = ${t.toFixed(2)} m`,o=new U;o.addVectors(i,n).multiplyScalar(.5);const a=s.create(this.world,r,o,!0);a!==void 0&&this.save(a,"Radius")}deleteByType(e=L3){const t=this.components.get(hr);for(const s of e){const i=this._list.get(s);if(i){for(const n of i)t.delete(n);this._list.delete(s)}}}generateStartAndEndKP(e){const{alignment:t}=e.curve,s=new Map;for(const i of t.horizontal){const n=i.getLength();if(s.size>0){const r=i.index-1,o=s.get(r).distance+n,a=i.mesh.geometry.getAttribute("position"),h=a.count-1,c=new U;c.x=a.getX(h),c.y=a.getY(h),c.z=a.getZ(h);const d=this.createNormalLine(i.mesh);s.set(i.index,{value:this.getShortendKPValue(o),distance:o,point:c,normal:d})}else{const r=i.mesh.geometry.getAttribute("position"),o=r.count-1,a=new U;a.x=r.getX(o),a.y=r.getY(o),a.z=r.getZ(o);const h=this.createNormalLine(i.mesh);s.set(i.index,{value:this.getShortendKPValue(n),distance:n,point:a,normal:h})}}return s}createNormalLine(e){const t=e.geometry.attributes.position.count-1,s=t-1,i=new U;i.x=e.geometry.attributes.position.getX(t),i.y=e.geometry.attributes.position.getY(t),i.z=e.geometry.attributes.position.getZ(t);const n=new U;n.x=e.geometry.attributes.position.getX(s),n.y=e.geometry.attributes.position.getY(s),n.z=e.geometry.attributes.position.getZ(s);const r=new U().subVectors(i,n).clone().applyAxisAngle(new U(0,0,1),Math.PI*.5).normalize(),o=new ft().setFromPoints([r.clone().setLength(10).add(i),r.clone().setLength(-10).add(i)]);return new xt(o)}generateConstantKP(e){const{alignment:t}=e.curve,s=new Map,i=t.getLength("horizontal"),n=Math.floor(i/this.divisionLength);for(let r=0;r<n;r++){const o=r/n,a=t.getPointAt(o,"horizontal"),h=i*o,c=this.getNormal(t,a);s.set(r,{value:this.getShortendKPValue(h),distance:h,point:a,normal:c})}return s}getNormal(e,t){const s=[],i={start:new U,end:new U};for(let o=0;o<e.horizontal.length;o++){const a=e.horizontal[o].mesh.geometry.attributes.position,h=a.count;for(let c=0;c<h;c++){const d=a.getX(c),u=a.getY(c),f=a.getZ(c);s.push(new U(d,u,f))}}for(let o=0;o<s.length-1;o++){const a=s[o],h=s[o+1],c=a.distanceTo(t),d=h.distanceTo(t),u=a.distanceTo(h);Math.abs(c+d-u)<1e-5&&(i.start=a,i.end=h)}const n=new U().subVectors(i.end,i.start).clone().applyAxisAngle(new U(0,0,1),Math.PI*.5).normalize(),r=new ft().setFromPoints([n.clone().setLength(10).add(t),n.clone().setLength(-10).add(t)]);return new xt(r,new mi({color:16711680}))}getShortendKPValue(e){const t=e.toFixed(2),[s,i]=t.toString().split("."),n=i||"00";if(parseInt(s,10)>1e3&&parseInt(s,10)<1e4){const[r,...o]=s;return`${r}+${o.join("")}.${n}`}if(parseInt(s,10)>1e4){const[r,o,...a]=s;return`${r}${o}+${a.join("")}.${n}`}return`0+${s.padStart(3,"0")}.${n}`}save(e,t){this._list.has(t)||this._list.set(t,new Set),this._list.get(t).add(e)}};Y(Z1,"uuid","0af12c32-81ee-4100-a030-e9ae546f6170");let ll=Z1;class K1 extends ht{constructor(e){super(e),Y(this,"onHighlight",new we),Y(this,"onMarkerChange",new we),Y(this,"onMarkerHidden",new we),Y(this,"onDisposed",new we),Y(this,"enabled",!0),Y(this,"mouseMarkers"),Y(this,"_curves",[]),Y(this,"_previousAlignment",null),Y(this,"_highlighter"),Y(this,"_world",null),Y(this,"updateLinesResolution",t=>{var s;(s=this._highlighter)==null||s.setResolution(t)}),Y(this,"onMouseMove",t=>{var s,i,n;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;const r=this._world.renderer.three.domElement.parentElement,o=this._world.camera.three,a=(s=this._highlighter)==null?void 0:s.castRay(t,o,r,this._curves);if(a){const{object:h}=a;(i=this._highlighter)==null||i.hover(h),this.updateMarker(a,"hover");return}this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),(n=this._highlighter)==null||n.unHover(),this.onMarkerHidden.trigger({type:"hover"})}),Y(this,"onClick",t=>{var s,i;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;const n=this._world.renderer.three.domElement.parentElement,r=this._world.camera.three,o=(s=this._highlighter)==null?void 0:s.castRay(t,r,n,this._curves);if(o){const a=o,h=a.object;if((i=this._highlighter)==null||i.select(h),this.updateMarker(a,"select"),this._world.camera.hasCameraControls()&&(h.geometry.boundingBox||h.geometry.computeBoundingBox(),h.geometry.boundingBox)){const c=this.getScaledBox(h.geometry.boundingBox,2);this._world.camera.controls.fitToBox(c,!0)}this.onHighlight.trigger({mesh:h,point:a.point}),this._previousAlignment!==h.curve.alignment&&(this.components.get(ll).showKPStations(h),this._previousAlignment=h.curve.alignment)}}),Y(this,"onControlsUpdated",()=>{if(!this._world)throw new Error("No world was given for this navigator!");if(!(this._world.camera.three instanceof gi)||!this._highlighter)return;const{zoom:t,left:s,right:i,top:n,bottom:r}=this._world.camera.three,o=s-i,a=n-r,h=Math.max(o,a)/t,c=40,{caster:d}=this._highlighter;d.params.Line.threshold=h/c})}get highlighter(){if(!this._highlighter)throw new Error("Highlighter not initialized. You must set a world first!");return this._highlighter}get world(){return this._world}set world(e){var t,s,i;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._highlighter)==null||t.dispose(),(s=this.mouseMarkers)==null||s.hover.dispose(),(i=this.mouseMarkers)==null||i.select.dispose(),!e))return;const n=e.scene.three;this._highlighter=new N1(n,this.view),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}async draw(e,t){if(!e.civilData)throw new Error("The provided model doesn't have civil data!");if(!this._world)throw new Error("No world was given for this navigator!");const{alignments:s}=e.civilData,i=t||s.values(),n=this._world.scene.three,r=new Qe;r.makeEmpty(),r.min.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.max.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const a of i){if(!a)throw new Error("Alignment not found!");for(const h of a[this.view])if(n.add(h.mesh),this._curves.push(h.mesh),!r.isEmpty())r.expandByObject(h.mesh);else{h.mesh.geometry.computeBoundingBox();const c=h.mesh.geometry.boundingBox;c instanceof Qe&&r.copy(c).applyMatrix4(h.mesh.matrixWorld)}}const o=this.getScaledBox(r,1.2);this._world.camera.hasCameraControls()&&await this._world.camera.controls.fitToBox(o,!1)}async dispose(){var e;(e=this._highlighter)==null||e.dispose(),this.clear(),this.onHighlight.reset(),this._curves=[],this.onDisposed.trigger(),this.onDisposed.reset()}clear(){var e,t;(e=this._highlighter)==null||e.unSelect(),(t=this._highlighter)==null||t.unHover();for(const s of this._curves)s.removeFromParent();this._curves=[]}setMarker(e,t,s){if(!this._curves.length)return;const i=e.getCurveAt(t,this.view),n=e.getPointAt(t,this.view),{index:r}=i.curve.getSegmentAt(i.percentage);this.setMouseMarker(n,i.curve.mesh,r,s)}setDefSegments(e){const t=[],s=[],i=(n,r)=>{const o=r[1]-n[1],a=r[0]-n[0];return o/a};for(let n=0;n<e.length;n++){const r=e[n];let o,a,h,c;for(let u=0;u<Object.keys(r).length/3;u++)if(r[u*3]!==void 0&&r[u*3+1]!==void 0){o=r[u*3],a=r[u*3+1];break}for(let u=Object.keys(r).length/3-1;u>=0;u--)if(r[u*3]!==void 0&&r[u*3+1]!==void 0){h=r[u*3],c=r[u*3+1];break}const d=(i([o,a],[h,c])*100).toFixed(2);s.push({slope:d})}for(const n of e)for(let r=0;r<n.length-3;r+=3){const o=n[r],a=n[r+1],h=n[r+2],c=n[r+3],d=n[r+4],u=n[r+5];t.push({start:new U(o,a,h),end:new U(c,d,u)})}return{defSegments:t,slope:s}}hideMarker(e){this.mouseMarkers&&(this.mouseMarkers[e].visible=!1)}setupEvents(e){var t,s;if(!this._world)throw new Error("No world was given for this navigator!");if(this._world.isDisposing||!this._world.renderer)return;const i=this._world.renderer.three.domElement.parentElement;(t=this._world.renderer)==null||t.onResize.remove(this.updateLinesResolution),i.removeEventListener("pointermove",this.onMouseMove),i.removeEventListener("click",this.onClick),this._world.camera.hasCameraControls()&&this._world.camera.controls.removeEventListener("update",this.onControlsUpdated),e&&(i.addEventListener("pointermove",this.onMouseMove),i.addEventListener("click",this.onClick),(s=this._world.renderer)==null||s.onResize.add(this.updateLinesResolution),this._world.camera.hasCameraControls()&&this._world.camera.controls.addEventListener("update",this.onControlsUpdated))}newMouseMarker(e,t){if(!this._world)throw new Error("No world was given for this navigator!");const s=t.scene.three,i=document.createElement("div"),n=document.createElement("div");i.appendChild(n),n.style.backgroundColor=e,n.style.width="3rem",n.style.height="3px";const r=new Bs(this._world,i,s);return r.visible=!1,r}setMouseMarker(e,t,s,i){if(s===void 0||!this.mouseMarkers)return;this.mouseMarkers[i].visible=!0;const n=this.mouseMarkers[i].three;n.position.copy(e);const r=t,{startPoint:o,endPoint:a}=r.curve.getSegment(s),h=Math.atan2(a.y-o.y,a.x-o.x),c=n.element.children[0],d=90-h/Math.PI*180;c.style.transform=`rotate(${d}deg)`}updateMarker(e,t){const{point:s,index:i,object:n}=e,r=n,o=r.curve,a=r.curve.alignment,h=a.getPercentageAt(s,this.view),c=s.clone();this.setMouseMarker(c,r,i,t),h!==null&&this.onMarkerChange.trigger({alignment:a,percentage:h,type:t,curve:o})}getScaledBox(e,t){const s=new Qe,i=new U,n=new U;return e.getCenter(n),e.getSize(i),i.multiplyScalar(t),s.setFromCenterAndSize(n,i),s}}class U3{constructor(e,t,s){Y(this,"components"),Y(this,"_scene"),Y(this,"_world"),Y(this,"offset",10),Y(this,"markupLines",[]),Y(this,"currentCurveMesh"),Y(this,"markupMaterial",new mi({color:6842472})),this.components=e,this._scene=t,this._world=s}showCurveInfo(e){switch(this.disposeMarkups(),this.currentCurveMesh=e,e.curve.data.TYPE){case"LINE":this.showLineInfo(e,this.offset);break;case"CIRCULARARC":this.showCircularArcInfo(e,this.offset);break;case"CLOTHOID":this.showClothoidInfo(e,this.offset);break;default:console.log("Unknown curve type:",e.curve.data.TYPE);break}}updateOffset(e,t,s){const i=Math.max(e.height,e.width)/(t*150);i!==this.offset&&(this.offset=i,s&&this.currentCurveMesh&&this.showCurveInfo(this.currentCurveMesh))}dispose(){for(const e of this.markupLines)e.removeFromParent();this.disposeMarkups(),this.markupMaterial.dispose()}disposeMarkups(){for(const e of this.markupLines)e.geometry.dispose(),e.removeFromParent();this.markupLines=[]}unSelect(){this.disposeMarkups()}calculateTangent(e,t){const s=t*3,i=Math.max(0,s-3),n=Math.min(e.length-3,s+3),r=new U().fromArray(e,i);return new U().fromArray(e,n).clone().sub(r).normalize()}calculateParallelCurve(e,t,s){const i=[];for(let n=0;n<t;n++){const r=this.calculateTangent(e,n).clone().applyAxisAngle(new U(0,0,1),Math.PI/2);r.normalize();const o=r.clone().multiplyScalar(s),a=n*3,h=new U().fromArray(e,a).add(o);i.push(h)}return i}calculateDimensionLines(e,t){const s=[],i=e.geometry.attributes.position.array,n=t.geometry.attributes.position.array;if(i.length<6&&n.length<6)throw new Error("Line must have at least two vertices");const r=new U(i[0],i[1],i[2]),o=new U(n[0],n[1],n[2]),a=[],h=i.length-3,c=new U(i[h],i[h+1],i[h+2]),d=n.length-3,u=new U(n[d],n[d+1],n[d+2]);return s.push(r,o),a.push(c,u),{startDimensionPoints:s,endDimensionPoints:a}}offsetDimensionLine(e,t){const s=new U().copy(e[e.length-1]).sub(e[0]).normalize().clone().multiplyScalar(t);return e.map(i=>i.clone().add(s))}showLineInfo(e,t){const s=this.components.get(ll);s.world=this._world,s.deleteByType(["Length","Radius"]);const i=e.geometry.attributes.position.array,n=this.calculateParallelCurve(i,i.length/3,t),r=new ft().setFromPoints(n),o=new xt(r,this.markupMaterial);s.showLineLength(o,e.curve.getLength()),this._scene.add(o),this.markupLines.push(o);const{startDimensionPoints:a,endDimensionPoints:h}=this.calculateDimensionLines(e,o),c=this.offsetDimensionLine(a,t*.1),d=this.offsetDimensionLine(h,t*.1),u=new ft().setFromPoints(c),f=new ft().setFromPoints(d),m=new xt(u,this.markupMaterial);this._scene.add(m),this.markupLines.push(m);const p=new xt(f,this.markupMaterial);this._scene.add(p),this.markupLines.push(p)}showClothoidInfo(e,t){const s=this.components.get(ll);s.world=this._world,s.deleteByType(["Length","Radius"]);const i=e.geometry.attributes.position.array,n=this.calculateParallelCurve(i,i.length/3,t),r=new ft().setFromPoints(n);s.showCurveLength(n,e.curve.getLength());const o=new xt(r,this.markupMaterial);this._scene.add(o),this.markupLines.push(o);const{startDimensionPoints:a,endDimensionPoints:h}=this.calculateDimensionLines(e,o),c=this.offsetDimensionLine(a,t*.1),d=this.offsetDimensionLine(h,t*.1),u=new ft().setFromPoints(c),f=new ft().setFromPoints(d),m=new xt(u,this.markupMaterial);this._scene.add(m),this.markupLines.push(m);const p=new xt(f,this.markupMaterial);this._scene.add(p),this.markupLines.push(p)}showCircularArcInfo(e,t){const s=this.components.get(ll);s.world=this._world,s.deleteByType(["Length","Radius"]);const i=e.curve.data.RADIUS,n=e.geometry.attributes.position.array,r=e.geometry.attributes.position.count,o=[],a=new U(n[0],n[1],n[2]),h=(r-1)*3,c=new U(n[h],n[h+1],n[h+2]),d=r/2*3,u=new U(n[d],n[d+1],n[d+2]),f=c.clone().sub(a).normalize(),m=new U(-f.y,f.x,0);m.multiplyScalar(i);const p=u.clone().add(m);o.push(u),o.push(p);const g=new ft().setFromPoints(o),E=new xt(g,this.markupMaterial);s.showCurveRadius(E,Math.abs(i)),this._scene.add(E),this.markupLines.push(E);const I=[];for(let M=0;M<r;M++){const w=this.calculateTangent(n,M),G=e.curve.data.RADIUS,J=new U(w.y,-w.x,0);J.normalize(),G<0&&J.negate();const Z=J.clone().multiplyScalar(t),le=M*3,ee=new U(n[le]+Z.x,n[le+1]+Z.y,n[le+2]+Z.z);I.push(ee)}const v=new ft().setFromPoints(I);s.showCurveLength(I,e.curve.getLength());const b=new xt(v,this.markupMaterial);this._scene.add(b),this.markupLines.push(b);const{startDimensionPoints:C,endDimensionPoints:F}=this.calculateDimensionLines(e,b),A=this.offsetDimensionLine(C,t*.1),R=this.offsetDimensionLine(F,t*.1),O=new ft().setFromPoints(A),L=new ft().setFromPoints(R),k=new xt(O,this.markupMaterial);this._scene.add(k),this.markupLines.push(k);const x=new xt(L,this.markupMaterial);this._scene.add(x),this.markupLines.push(x)}}const B3=class Q1 extends K1{constructor(e){super(e),Y(this,"view","horizontal"),Y(this,"planHighlighter"),this.components.add(Q1.uuid,this),this.onHighlight.add(({mesh:t})=>{!this._highlighter||!this.planHighlighter||this.planHighlighter.showCurveInfo(t)})}get world(){return super.world}set world(e){var t;super.world=e,e&&((t=this.planHighlighter)==null||t.dispose(),this.planHighlighter=new U3(this.components,e.scene.three,e))}};Y(B3,"uuid","3096dea0-5bc2-41c7-abce-9089b6c9431b");const z3=class q1 extends K1{constructor(e){super(e),Y(this,"enabled",!0),Y(this,"view","vertical"),this.components.add(q1.uuid,this)}get world(){return super.world}set world(e){this.world!==e&&(super.world=e,this._highlighter&&this._highlighter.onSelect.add(t=>{if(!this.world)throw new Error("A world is needed to work with this component!");const s=this.components.get(ll);s.deleteByType(["Slope","Height","InitialKPV","FinalKPV"]);const{alignment:i}=t.curve,n=[];for(const h of i.vertical){const c=h.mesh.geometry.attributes.position.array;n.push(c)}const{defSegments:r,slope:o}=this.setDefSegments(n),a=this.world.scene.three;for(let h=0;h<i.vertical.length;h++){const c=i.vertical[h];s.addVerticalMarker(this.world,`S: ${o[h].slope}%`,c.mesh,"Slope",a),s.addVerticalMarker(this.world,`H: ${r[h].end.y.toFixed(2)}`,c.mesh,"Height",a)}s.addVerticalMarker(this.world,"KP: 0",i.vertical[0].mesh,"InitialKPV",a),s.addVerticalMarker(this.world,`KP: ${i.vertical.length}`,i.vertical[i.vertical.length-1].mesh,"FinalKPV",a)}))}};Y(z3,"uuid","097eea29-2d5a-431a-a247-204d44670621");const k3=class J1 extends ht{constructor(e){super(e),Y(this,"onHighlight",new we),Y(this,"onMarkerChange",new we),Y(this,"onMarkerHidden",new we),Y(this,"enabled",!0),Y(this,"mouseMarkers"),Y(this,"_highlighter"),Y(this,"_curves",[]),Y(this,"_world",null),Y(this,"updateLinesResolution",t=>{var s;(s=this.highlighter)==null||s.setResolution(t)}),Y(this,"onClick",t=>{if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;const s=this.world.renderer.three.domElement,i=this.world.camera.three,n=this._highlighter.castRay(t,i,s,this._curves);if(n){const r=n.object;this._highlighter.select(r),this.updateMarker(n,"select");const{point:o,index:a}=n;a!==void 0&&this.onHighlight.trigger({curve:r,point:o,index:a});return}this._highlighter.unSelect(),this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),this.onMarkerHidden.trigger({type:"hover"})}),Y(this,"onMouseMove",async t=>{if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;const s=this.world.renderer.three.domElement,i=this.world.camera.three,n=this._highlighter.castRay(t,i,s,this._curves);if(n){this._highlighter.hover(n.object),this.updateMarker(n,"hover");return}this._highlighter.unHover()}),this.components.add(J1.uuid,this)}get world(){return this._world}set world(e){var t,s,i;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._highlighter)==null||t.dispose(),(s=this.mouseMarkers)==null||s.hover.dispose(),(i=this.mouseMarkers)==null||i.select.dispose(),!e))return;const n=e.scene.three;this._highlighter=new N1(n,"absolute"),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}get highlighter(){if(!this._highlighter)throw new Error("Navigator not initialized!");return this._highlighter}draw(e){if(!e.civilData)throw new Error("Model must have civil data!");if(!this.world)throw new Error("A world must be given before drawing an alignment!");const t=this.world.scene.three;for(const[s,i]of e.civilData.alignments)for(const{mesh:n}of i.absolute)t.add(n),this._curves.push(n)}setMarker(e,t,s){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const i=e.getPointAt(t,"absolute");this.mouseMarkers[s].visible=!0,this.mouseMarkers[s].three.position.copy(i)}hideMarker(e){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const t=this.mouseMarkers[e].three;t.visible=!1}newMouseMarker(e,t){const s=t.scene.three,i=document.createElement("div");i.style.backgroundColor=e,i.style.width="1rem",i.style.height="1rem",i.style.borderRadius="1rem";const n=new Bs(t,i,s);return n.visible=!1,n}setupEvents(e){var t,s;if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const i=this.world.renderer.three.domElement;(t=this.world.renderer)==null||t.onResize.remove(this.updateLinesResolution),i.removeEventListener("click",this.onClick),i.removeEventListener("pointermove",this.onMouseMove),e&&(i.addEventListener("click",this.onClick),i.addEventListener("pointermove",this.onMouseMove),(s=this.world.renderer)==null||s.onResize.add(this.updateLinesResolution))}updateMarker(e,t){if(!this.mouseMarkers)return;const{point:s,object:i}=e,n=i,r=n.curve,o=n.curve.alignment,a=o.getPercentageAt(s,"absolute");this.mouseMarkers[t].visible=!0,this.mouseMarkers[t].three.position.copy(s),a!==null&&this.onMarkerChange.trigger({alignment:o,percentage:a,type:t,curve:r})}};Y(k3,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");const V3=class $1 extends ht{constructor(e){super(e),Y(this,"enabled",!0),Y(this,"world",null),Y(this,"plane"),Y(this,"_world3D",null),this.components.add($1.uuid,this)}get world3D(){return this._world3D}set world3D(e){var t;if(this._world3D=e,(t=this.plane)==null||t.dispose(),!e)return;const s=this.components.get(zo),i=s.Type;s.Type=Fc,this.plane=s.createFromNormalAndCoplanarPoint(e,new U(1,0,0),new U),s.Type=i,this.plane.visible=!1,this.plane.enabled=!1}async set(e,t){if(!this.world||!this.plane)throw new Error("You must set a world before using this component");this.plane.enabled=!0;const s=e.curve.getPercentageAt(t);if(s===null)return;const{startPoint:i,endPoint:n}=e.curve.getSegmentAt(s);if(e.geometry.index===null)throw new Error("Geometry must be indexed!");const r=new U;r.subVectors(n,i),r.normalize(),this.plane.setFromNormalAndCoplanarPoint(r,t),this.plane.edges.update();const o=this.plane.helper.matrix.clone();o.invert();const a=this.world.scene.three,h=this.plane.edges.get();for(const c in h){const{mesh:d}=h[c];d.position.set(0,0,0),d.rotation.set(0,0,0),d.updateMatrix(),d.applyMatrix4(o),d.parent!==a&&a.add(d)}this.plane.enabled=!1}};Y(V3,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");function Zn(){const l=document.createElement("div");return l.style.backgroundColor="black",l.style.color="white",l.style.padding="8px",l.style.borderRadius="8px",l.style.fontFamily="sans-serif",l}const wc=class Cc{constructor(e,t,s){Y(this,"label"),Y(this,"boundingBox",new ye),Y(this,"world"),Y(this,"components"),Y(this,"_length"),Y(this,"_visible",!0),Y(this,"_start"),Y(this,"_end"),Y(this,"_root",new hl),Y(this,"_endpoints",[]),Y(this,"_line"),this.components=e,this.world=t,this._start=s.start,this._end=s.end,this._length=this.getLength(),this._line=this.createLine(s),this.newEndpointElement(s.endpointElement),this.newEndpointElement(s.endpointElement.cloneNode(!0)),this.label=this.newText(),this._root.renderOrder=2,this.world.scene.three.add(this._root)}get visible(){return this._visible}set visible(e){this._visible=e,this.label.visible=e,this._endpoints[0].visible=e,this._endpoints[1].visible=e;const[t,s]=this._endpoints,i=t.three,n=s.three,r=this.label.three;e?(this.world.scene.three.add(this._root),this._root.add(r,i,n)):(r.removeFromParent(),i.removeFromParent(),n.removeFromParent(),this._root.removeFromParent())}get endPoint(){return this._end}set endPoint(e){this._end=e;const t=this._line.geometry.attributes.position;t.setXYZ(1,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[1].three.position.copy(e),this.updateLabel()}get startPoint(){return this._start}set startPoint(e){this._start=e;const t=this._line.geometry.attributes.position;t.setXYZ(0,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[0].three.position.copy(e),this.updateLabel()}get _center(){let e=this._end.clone().sub(this._start);const t=e.length()*.5;return e=e.normalize().multiplyScalar(t),this._start.clone().add(e)}dispose(){const e=this.components.get(ji);this.visible=!1,e.destroy(this._root),e.destroy(this._line);for(const t of this._endpoints)t.dispose();this._endpoints.length=0,this.label.dispose(),this.boundingBox&&e.destroy(this.boundingBox),this.components=null}createBoundingBox(){this.boundingBox.geometry=new pt(1,1,this._length),this.boundingBox.position.copy(this._center),this.boundingBox.lookAt(this._end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}toggleLabel(){this.label.toggleVisibility()}newEndpointElement(e){const t=this._endpoints.length===0?this._start:this._end,s=new Bs(this.world,e);s.three.position.copy(t),this._endpoints.push(s),this._root.add(s.three)}updateLabel(){this._length=this.getLength(),this.label.three.element.textContent=this.getTextContent(),this.label.three.position.copy(this._center),this._line.computeLineDistances()}createLine(e){const t=new ft;t.setFromPoints([e.start,e.end]);const s=new xt(t,e.lineMaterial);return this._root.add(s),s}newText(){const e=Zn();e.textContent=this.getTextContent();const t=new Bs(this.world,e);return t.three.position.copy(this._center),this._root.add(t.three),t}getTextContent(){return`${(this._length/Cc.scale).toFixed(Cc.rounding)} ${Cc.units}`}getLength(){return this._start.distanceTo(this._end)}};Y(wc,"scale",1),Y(wc,"units","m"),Y(wc,"rounding",2);let dp=wc;class Y3{constructor(e,t,s){Y(this,"enabled",!0),Y(this,"points",[]),Y(this,"workingPlane",null),Y(this,"labelMarker"),Y(this,"world"),Y(this,"components"),Y(this,"onDisposed",new we),Y(this,"onAreaComputed",new we),Y(this,"onWorkingPlaneComputed",new we),Y(this,"onPointAdded",new we),Y(this,"onPointRemoved",new we),Y(this,"_visible",!0),Y(this,"_rotationMatrix",null),Y(this,"_dimensionLines",[]),Y(this,"_defaultLineMaterial",new mi({color:"red"})),this.world=t,this.components=e;const i=Zn();this.labelMarker=new Bs(t,i),this.labelMarker.visible=!1,this.onPointAdded.add(n=>{this.points.length===3&&!this._dimensionLines[2]&&(this.addDimensionLine(n,this.points[0]),this.labelMarker.visible=!0)}),s?.forEach(n=>this.setPoint(n))}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this._dimensionLines)t.visible=e,t.label.visible=!1;this.labelMarker.visible=e}setPoint(e,t){let s;if(t?s=t:s=this.points.length===0?0:this.points.length,s===0){this.points[0]=e;return}if(s<0||s>this.points.length)return;const i=this.points.length>s;this.points[s]=e,this.onPointAdded.trigger(e),i||this.addDimensionLine(this.points[s-1],e);const{previousLine:n,nextLine:r}=this.getLinesBetweenIndex(s);n&&(n.endPoint=e),r&&(r.startPoint=e)}removePoint(e){if(this.points.length===3)return;this.points.splice(e,1);const{previousLine:t,nextLine:s}=this.getLinesBetweenIndex(e);s&&(t.endPoint=s.endPoint),s?.dispose(),this._dimensionLines.splice(e,1),this.onPointRemoved.trigger()}toggleLabel(){this.labelMarker.toggleVisibility()}addDimensionLine(e,t){const s=new dp(this.components,this.world,{start:e,end:t,lineMaterial:this._defaultLineMaterial,endpointElement:Zn()});return s.toggleLabel(),this._dimensionLines.length>1?this._dimensionLines.splice(this._dimensionLines.length-1,0,s):this._dimensionLines.push(s),s}getLinesBetweenIndex(e){const t=e===0?this._dimensionLines.length-1:e-1,s=this._dimensionLines[t],i=this._dimensionLines[e];return{previousLine:s,nextLine:i}}computeWorkingPlane(){this.workingPlane=new _s().setFromCoplanarPoints(this.points[0],this.points[1],this.points[2]);const e=new U(0,1,0),t=this.workingPlane.normal.angleTo(e),s=new U().crossVectors(this.workingPlane.normal,e).normalize();this._rotationMatrix=new Oe().makeRotationAxis(s,t),this.onWorkingPlaneComputed.trigger(this.workingPlane)}computeArea(){if(!(this._rotationMatrix&&this.workingPlane))return this.onAreaComputed.trigger(0),0;let e=0,t=0;const s=this._rotationMatrix,i=this.points.map(r=>{const o=r.clone().applyMatrix4(s),a=new lt(o.x,o.z);return e+=a.x,t+=a.y,a}),n=Math.abs(UI.area(i));return this.labelMarker.three.element.textContent=`${n.toFixed(2)} m²`,this.labelMarker.three.position.set(e/i.length,-this.workingPlane.constant,t/i.length).applyMatrix4(s.clone().invert()),this.onAreaComputed.trigger(n),n}dispose(){this.onAreaComputed.reset(),this.onWorkingPlaneComputed.reset(),this.onPointAdded.reset(),this.onPointRemoved.reset();for(const e of this._dimensionLines)e.dispose();this.labelMarker.dispose(),this._dimensionLines=[],this.points=[],this._rotationMatrix=null,this.workingPlane=null,this._defaultLineMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return{points:this.points,workingPlane:this.workingPlane,area:this.computeArea()}}}class fp extends j_{constructor(e,t){super(e,t),Y(this,"onDisposed",new we),Y(this,"marker",null),Y(this,"_className","default-vertex-picker"),this.onEnabled.add(s=>{this.marker&&(this.marker.visible=s)})}get className(){return this._className}set className(e){this._className=e,this.marker&&(this.marker.three.element.className=e)}dispose(){this.marker&&this.marker.dispose(),super.dispose()}get(e){const t=super.get(e);return t?(this.marker||(this.marker=new Bs(e),this.marker.three.element.className=this._className),this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.marker.visible=!0,this.marker.three.position.copy(t)):this.marker&&(this.marker.visible=!1),t}}const G3=class Mf extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"list",[]),Y(this,"world"),Y(this,"_enabled",!1),Y(this,"_visible",!0),Y(this,"_vertexPicker"),Y(this,"_currentAreaElement",null),Y(this,"_clickCount",0),Y(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World not defined for the area measurement!");const t=this._vertexPicker.get(this.world);if(t){if(!this._currentAreaElement){const s=new Y3(this.components,this.world);s.onPointAdded.add(()=>{this._clickCount===2&&!s.workingPlane&&(s.computeWorkingPlane(),this._vertexPicker.workingPlane=s.workingPlane)}),s.onPointRemoved.add(()=>this._clickCount--),this._currentAreaElement=s}this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea(),this._clickCount++}}),Y(this,"onMouseMove",()=>{if(!this.world){console.log("No world given for the area measurement!");return}const t=this._vertexPicker.get(this.world);t&&this._currentAreaElement&&(this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea())}),Y(this,"onKeydown",t=>{this.enabled&&(t.key==="z"&&t.ctrlKey&&this._currentAreaElement&&this._currentAreaElement.removePoint(this._clickCount-1),t.key==="Enter"&&this._currentAreaElement&&this.endCreation(),t.key==="Escape"&&(this._clickCount===0&&!this._currentAreaElement?this.enabled=!1:this.cancelCreation()))}),this.components.add(Mf.uuid,this),this._vertexPicker=new fp(e)}set enabled(e){this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}set workingPlane(e){this._vertexPicker.workingPlane=e}get workingPlane(){return this._vertexPicker.workingPlane}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}dispose(){this.setupEvents(!1),this._vertexPicker.dispose(),this._currentAreaElement&&this._currentAreaElement.dispose();for(const e of this.list)e.dispose();this.components=null,this.onDisposed.trigger(Mf.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAreaElement&&(this._currentAreaElement.points.length<3||(this._currentAreaElement&&(this.list.push(this._currentAreaElement),this._currentAreaElement.removePoint(this._clickCount),this._currentAreaElement.computeWorkingPlane(),this._currentAreaElement.computeArea(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0))}cancelCreation(){this._currentAreaElement&&(this._currentAreaElement.dispose(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("The area measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the area measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}};Y(G3,"uuid","c453a99e-f054-4781-9060-33df617db4a5");class H3{constructor(e,t){Y(this,"enabled",!0),Y(this,"visible",!0),Y(this,"points",[]),Y(this,"world"),Y(this,"onDisposed",new we),Y(this,"_lineMaterial",new El({color:6629591,linewidth:2})),Y(this,"_lineGeometry",new Ac),Y(this,"_line",new O1(this._lineGeometry,this._lineMaterial)),Y(this,"_labelMarker"),Y(this,"onAngleComputed",new we),Y(this,"onPointAdded",new we),this.world=e;const s=Zn();this._labelMarker=new Bs(e,s),this.labelMarker.visible=!0,this.onPointAdded.add(()=>{this.points.length===1&&e.scene.three.add(this._line),this.points.length===3&&(this.labelMarker.visible=!0)}),this.onAngleComputed.add(i=>{this.labelMarker.three.element.textContent=`${i.toFixed(2)}°`,this.labelMarker.three.position.copy(this.points[1]??new U)}),t?.forEach(i=>this.setPoint(i))}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._line.material=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get lineMaterial(){return this._lineMaterial}set labelMarker(e){this._labelMarker.dispose(),this._labelMarker=e}get labelMarker(){return this._labelMarker}get angle(){return{points:this.points,angle:this.computeAngle()}}setPoint(e,t){let s;if(t?s=t:s=this.points.length===0?0:this.points.length,![0,1,2].includes(s))return;this.points[s]=e,this.onPointAdded.trigger(e);const i=this.points.map(n=>[n.x,n.y,n.z]);this._lineGeometry.setPositions(i.flat())}toggleLabel(){this.labelMarker.toggleVisibility()}computeAngle(){const e=this.points[0],t=this.points[1],s=this.points[2];if(!(e&&t&&s))return 0;const i=new U().subVectors(t,e),n=new U().subVectors(t,s),r=xr.radToDeg(i.angleTo(n));return this.onAngleComputed.trigger(r),r}dispose(){this.points=[],this.labelMarker.dispose(),this.onAngleComputed.reset(),this.onPointAdded.reset(),this.labelMarker.dispose(),this._line.removeFromParent(),this._lineMaterial.dispose(),this._lineGeometry.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}}const W3=class Nf extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"world"),Y(this,"list",[]),Y(this,"_lineMaterial"),Y(this,"_enabled",!1),Y(this,"_vertexPicker"),Y(this,"_currentAngleElement",null),Y(this,"_clickCount",0),Y(this,"create",()=>{if(!this.enabled)return;if(!this.world){console.log("No world selected for angle measurement!");return}const t=this._vertexPicker.get(this.world);if(t){if(!this._currentAngleElement){const s=new H3(this.world);s.lineMaterial=this.lineMaterial,this._currentAngleElement=s}this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.setPoint(t,this._clickCount+1),this._currentAngleElement.setPoint(t,this._clickCount+2),this._currentAngleElement.computeAngle(),this._clickCount++,this._clickCount===3&&this.endCreation()}}),Y(this,"onMouseMove",()=>{if(!this.world){console.log("No world selected for angle measurement!");return}const t=this._vertexPicker.get(this.world);t&&this._currentAngleElement&&(this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.computeAngle())}),Y(this,"onKeyDown",t=>{this.enabled&&t.key==="Escape"&&this.cancelCreation()}),this.components.add(Nf.uuid,this),this._vertexPicker=new fp(e),this._lineMaterial=new El({color:6629591,linewidth:2})}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.setupEvents(e),this._vertexPicker.enabled=e,e||this.cancelCreation()}get lineMaterial(){return this._lineMaterial}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get workingPlane(){return this._vertexPicker.workingPlane}set workingPlane(e){this._vertexPicker.workingPlane=e}dispose(){this.setupEvents(!1),this._lineMaterial.dispose(),this._vertexPicker.dispose();for(const e of this.list)e.dispose();this._currentAngleElement&&this._currentAngleElement.dispose(),this.components=null,this.onDisposed.trigger(Nf.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAngleElement&&(this.list.push(this._currentAngleElement),this._currentAngleElement.computeAngle(),this._currentAngleElement=null),this._clickCount=0}cancelCreation(){this._currentAngleElement&&(this._currentAngleElement.dispose(),this._currentAngleElement=null),this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("No world selected for angle measurement!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeyDown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeyDown))}};Y(W3,"uuid","622fb2c9-528c-4b0a-8a0e-6a1375f0a3aa");const eI=class Df extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"onBeforeUpdate",new we),Y(this,"onAfterUpdate",new we),Y(this,"snapDistance",.25),Y(this,"list",[]),Y(this,"world"),Y(this,"_vertexPicker"),Y(this,"_lineMaterial",new mi({color:"#DC2626",linewidth:2,depthTest:!1})),Y(this,"_visible",!0),Y(this,"_enabled",!1),Y(this,"_temp",{isDragging:!1,start:new U,end:new U,dimension:void 0}),Y(this,"create",t=>{const s=t instanceof Wi?t:void 0;if(this._enabled){if(!this._temp.isDragging){this.drawStart(s);return}this.endCreation()}}),Y(this,"onMouseMove",()=>{this.world&&this._vertexPicker.get(this.world)}),this.components.add(Df.uuid,this),this._vertexPicker=new fp(e,{previewElement:Zn(),snapDistance:this.snapDistance})}get enabled(){return this._enabled}set enabled(e){e||this.cancelCreation(),this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e)}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get color(){return this._lineMaterial.color}set color(e){this._lineMaterial.color=e}dispose(){this.setupEvents(!1),this.enabled=!1;for(const e of this.list)e.dispose();this._lineMaterial.dispose(),this.list=[],this._vertexPicker.dispose(),this.onDisposed.trigger(Df.uuid),this.onDisposed.reset()}async update(e){this._enabled&&this._temp.isDragging&&this.drawInProcess()}createOnPoints(e,t){const s=this.drawDimension();s.startPoint=e,s.endPoint=t,s.createBoundingBox(),this.list.push(s)}delete(){if(!this.world)throw new Error("World is needed for Length Measurement!");if(!this._enabled||this.list.length===0)return;const e=this.getBoundingBoxes(),t=this.components.get(di).get(this.world).castRay(e);if(!t)return;const s=this.list.find(i=>i.boundingBox===t.object);if(s){const i=this.list.indexOf(s);this.list.splice(i,1),s.dispose()}}async deleteMeasurement(e){if(e){const t=this.list.indexOf(e);this.list.splice(t,1),e.dispose()}}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}cancelCreation(){var e;this._temp.dimension&&(this._temp.isDragging=!1,(e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0)}endCreation(){this._temp.dimension&&(this._temp.dimension.createBoundingBox(),this.list.push(this._temp.dimension),this._temp.dimension=void 0,this._temp.isDragging=!1)}drawStart(e){if(!this.world)throw new Error("The length measurement needs a world to work!");const t=e?[e]:void 0,s=this.components.get(di).get(this.world).castRay(t),i=this._vertexPicker.get(this.world);s&&i&&(this._temp.isDragging=!0,this._temp.start=e?s.point:i)}drawInProcess(){if(!this.world)throw new Error("The length measurement needs a world to work!");if(!this.components.get(di).get(this.world).castRay())return;const e=this._vertexPicker.get(this.world);e&&(this._temp.end=e,this._temp.dimension||(this._temp.dimension=this.drawDimension()),this._temp.dimension.endPoint=this._temp.end)}drawDimension(){if(!this.world)throw new Error("The length measurement needs a world to work!");return new dp(this.components,this.world,{start:this._temp.start,end:this._temp.end,lineMaterial:this._lineMaterial,endpointElement:Zn()})}getBoundingBoxes(){return this.list.map(e=>e.boundingBox).filter(e=>e!==void 0)}setupEvents(e){if(!this.world)throw new Error("The length measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the length measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t&&(t.removeEventListener("pointermove",this.onMouseMove),e&&t.addEventListener("pointermove",this.onMouseMove))}};Y(eI,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");let $a=eI;const j3=class tI extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"onVolumeFound",new we),Y(this,"label",null),Y(this,"world"),Y(this,"_enabled",!1),Y(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World is needed for Volume Measurement!");const t=this.components.get(di).get(this.world).castRay(),s=this.components.get(br);if(!t||!t.object)return;const{object:i}=t;if(i instanceof ye){const n=s.getVolumeFromMeshes([i]);this.onVolumeFound.trigger(n)}}),Y(this,"onMouseMove",()=>{}),Y(this,"onKeydown",t=>{}),this.components.add(tI.uuid,this)}set enabled(e){this._enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}async dispose(){var e;this.setupEvents(!1),(e=this.label)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){}async deleteAll(){}endCreation(){}cancelCreation(){}getVolumeFromFragments(e){const t=this.components.get(br).getVolumeFromFragments(e),s=this.components.get(xc);s.reset(),s.addFragmentIdMap(e);const i=s.getSphere();return this.setLabel(i,t),t}getVolumeFromMeshes(e){const t=this.components.get(br),s=this.components.get(xc);s.reset();for(const r of e)s.addMesh(r);const i=s.getSphere(),n=t.getVolumeFromMeshes(e);return this.setLabel(i,n),n}clear(){this.label&&(this.label.visible=!1)}newLabel(){if(!this.world)throw new Error("World is needed for Volume Measurement!");const e=Zn();return new Bs(this.world,e)}setupEvents(e){if(!this.world)throw new Error("The volume measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the volume measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}setLabel(e,t){if(!this.world)throw new Error("World is needed for Volume Measurement!");this.label||(this.label=this.newLabel(),this.label.three.removeFromParent()),this.label.visible=!0,this.world.scene.three.add(this.label.three),this.label.three.position.copy(e.center);const s=Math.trunc(t*100)/100;this.label.three.element.textContent=s.toString()}};Y(j3,"uuid","811da532-7af3-4635-b592-1c06ae494af5");const Z3=class sI extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"selection",[]),Y(this,"preview",new ye(new ft,new is({side:2,depthTest:!1,transparent:!0,opacity:.25,color:"#BCF124"}))),Y(this,"selectionMaterial",new is({side:2,depthTest:!1,transparent:!0,color:"#BCF124",opacity:.75})),Y(this,"world"),Y(this,"_enabled",!1),Y(this,"_currentSelelection",null),Y(this,"create",()=>{if(!this.world)throw new Error("No world given to the face measurement!");if(!this.enabled||!this._currentSelelection)return;const t=this.world.scene.three,s=new ft,i=new ye(s,this.selectionMaterial);s.setAttribute("position",this.preview.geometry.attributes.position),t.add(i),s.computeBoundingSphere();const{area:n,perimeter:r}=this._currentSelelection,o=this.newLabel(s,n);i.add(o.three),this.selection.push({area:n,perimeter:r,mesh:i,label:o})}),Y(this,"onMouseMove",()=>{if(!this.world)throw new Error("The face measurement needs a world to work!");if(!this.enabled){this.unselect();return}const t=this.components.get(di).get(this.world).castRay();if(!t||!t.object||t.faceIndex===void 0){this.unselect();return}const{object:s,faceIndex:i}=t;s instanceof ye||s instanceof ss?this.updateSelection(s,i,t.instanceId):this.unselect()}),Y(this,"onKeydown",t=>{}),this.components.add(sI.uuid,this),this.preview.frustumCulled=!1}set enabled(e){if(!this.world)throw new Error("No world given for the Face measurement!");this._enabled=e,this.setupEvents(e),e?this.world.scene.three.add(this.preview):(this.preview.removeFromParent(),this.cancelCreation()),this.setVisibility(e)}get enabled(){return this._enabled}dispose(){this.setupEvents(!1),this.deleteAll(),this.preview.removeFromParent(),this.preview.material.dispose(),this.preview.geometry.dispose(),this.selectionMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.world)throw new Error("No world given to the face measurement!");const e=this.selection.map(n=>n.mesh),t=this.components.get(di).get(this.world).castRay(e);if(!t||!t.object)return;const s=this.selection.find(n=>n.mesh===t.object);if(!s)return;s.mesh.removeFromParent(),s.mesh.geometry.dispose(),s.label.dispose();const i=this.selection.indexOf(s);this.selection.splice(i,1)}deleteAll(){for(const e of this.selection)e.mesh.removeFromParent(),e.mesh.geometry.dispose(),e.label.dispose();this.selection=[]}endCreation(){}cancelCreation(){}get(){const e=[];for(const t of this.selection){const s=t.mesh.geometry,{area:i,perimeter:n}=t,r=s.attributes.position.array;e.push({position:r,area:i,perimeter:n})}return e}set(e){if(!this.world)throw new Error("No world given to the face measurement!");const t=this.world.scene.three;for(const s of e){const i=new ft,n=new ye(i,this.selectionMaterial);t.add(n);const r=new Rt(s.position,3);i.setAttribute("position",r),i.computeBoundingSphere();const{area:o,perimeter:a}=s,h=this.newLabel(i,o);n.add(h.three),this.selection.push({area:o,perimeter:a,mesh:n,label:h})}}setupEvents(e){if(!this.world)throw new Error("The face measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the face measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown),e&&(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown))}setVisibility(e){if(!this.world)throw new Error("The face measurement needs a world to work!");if(this.world.isDisposing)return;const t=this.world.scene.three;for(const s of this.selection){const i=s.label.three;e?(t.add(s.mesh),s.mesh.add(i)):(s.mesh.removeFromParent(),i.removeFromParent())}}unselect(){this.preview.removeFromParent(),this._currentSelelection=null}updateSelection(e,t,s){if(!this.world)throw new Error("The face measurement needs a world to work!");this.world.scene.three.add(this.preview);const i=this.components.get(br).getFace(e,t,s);if(i===null)return;const n=this.regenerateHighlight(e,i.indices,s);let r=0;for(const{distance:o}of i.edges)r+=o;this._currentSelelection={perimeter:r,area:n}}newLabel(e,t){if(!e.boundingSphere)throw new Error("Error computing area geometry");if(!this.world)throw new Error("The face measurement needs a world to work!");const{center:s}=e.boundingSphere,i=Zn(),n=Math.trunc(t*100)/100;i.textContent=n.toString();const r=new Bs(this.world,i);return r.three.position.copy(s),r}regenerateHighlight(e,t,s){const i=[],n=[];let r=0,o=0;const a=new cs,h=this.components.get(br);for(const u of t){const{p1:f,p2:m,p3:p}=h.getVerticesAndNormal(e,u,s);i.push(f.x,f.y,f.z),i.push(m.x,m.y,m.z),i.push(p.x,p.y,p.z),a.set(f,m,p),o+=a.getArea(),n.push(r,r+1,r+2),r+=3}this.preview.position.set(0,0,0),this.preview.rotation.set(0,0,0),this.preview.scale.set(1,1,1),this.preview.updateMatrix(),this.preview.applyMatrix4(e.matrixWorld);const c=new Float32Array(i),d=new Rt(c,3);return this.preview.geometry.setAttribute("position",d),this.preview.geometry.setIndex(n),o}};Y(Z3,"uuid","30279548-1309-44f6-aa97-ce26eed73522");const X3=class iI extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"preview"),Y(this,"tolerance",.3),Y(this,"world"),Y(this,"_enabled",!1),Y(this,"_lineMaterial",new mi({color:"#DC2626",linewidth:2,depthTest:!1,transparent:!0})),Y(this,"create",async()=>{if(!this.preview||!this.enabled||!this.preview.visible)return;const t=this.components.get($a);t.world=this.world;const s=this.preview.startPoint.clone(),i=this.preview.endPoint.clone();t.createOnPoints(s,i)}),Y(this,"onMouseMove",()=>{if(!this.preview)return;if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.enabled){this.preview.visible=!1;return}const t=this.components.get(di).get(this.world).castRay();if(!t||!t.object){this.preview.visible=!1;return}const{object:s,faceIndex:i,point:n}=t;if(i===void 0){this.preview.visible=!1;return}s instanceof ye||s instanceof ss?this.updateSelection(s,n,i,t.instanceId):this.preview.visible=!1}),Y(this,"onKeydown",t=>{}),this.components.add(iI.uuid,this)}set enabled(e){if(this._enabled=e,this.setupEvents(e),e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.preview){const t=document.createElement("div");t.className="w-2 h-2 bg-red-600 rounded-full",this.preview=new dp(this.components,this.world,{start:new U,end:new U,lineMaterial:this._lineMaterial,endpointElement:t}),this.preview.visible=!1}}else this.cancelCreation()}get enabled(){return this._enabled}dispose(){this.preview&&this.preview.dispose(),this._lineMaterial.dispose(),this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.enabled)return;const e=this.components.get($a),t=e.enabled;e.enabled=!0,e.delete(),e.enabled=t}deleteAll(){this.components.get($a).deleteAll()}endCreation(){}cancelCreation(){}get(){const e=this.components.get($a).list,t=[];for(const s of e){const i=s.startPoint,n=s.endPoint,r=[i.x,i.y,i.z,n.x,n.y,n.z];t.push(r)}return t}set(e){const t=this.components.get($a);t.world=this.world;for(const s of e){const[i,n,r,o,a,h]=s,c=new U(i,n,r),d=new U(o,a,h);t.createOnPoints(c,d)}}setupEvents(e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the edge measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}updateSelection(e,t,s,i){if(!this.preview||!e.geometry.index)return;const n=this.components.get(br).getFace(e,s,i);if(!n)return;const{edges:r}=n;let o=Number.MAX_VALUE,a=[];for(const d of r){const[u,f]=d.points,m=br.distanceFromPointToLine(t,u,f,!0);m<this.tolerance&&m<o&&(o=m,a=d.points)}if(!a.length){this.preview.visible=!1;return}const[h,c]=a;this.preview.startPoint=h,this.preview.endPoint=c,this.preview.visible=!0}};Y(X3,"uuid","e7be5749-89df-4514-8d25-83aa38ce12d8");class K3 extends WE{constructor(e,t,s){super(e,t,s),Y(this,"threshold",50),Y(this,"bboxThreshold",200),Y(this,"maxLostTime",3e4),Y(this,"maxHiddenTime",5e3),Y(this,"boxes",new Map),Y(this,"_staticGeometries",{culled:{},unculled:{}}),Y(this,"_geometry"),Y(this,"_material",new is({transparent:!0,side:2,opacity:1})),Y(this,"onViewUpdated",new al),Y(this,"_modelIDIndex",new Map),Y(this,"_indexModelID",new Map),Y(this,"_nextModelID",0),Y(this,"_geometries",new Map),Y(this,"_geometriesGroups",new Map),Y(this,"_geometriesInMemory",new Set),Y(this,"_intervalID",null),Y(this,"codes",new Map),Y(this,"handleWorkerMessage",async n=>{const r=n.data.colors,o={},a={},h={},c={},d=performance.now();let u=!1;const f=new Set(this._geometriesInMemory);for(const[m,p]of r){const g=this._geometries.get(m);if(!g||!(p>this.threshold))continue;f.delete(m);const{exists:E}=g,I=this._indexModelID.get(g.modelIndex);E?(g.time=d,c[I]||(c[I]=new Set),c[I].add(g.geometryID),this._geometriesInMemory.add(m),u=!0):(o[I]||(o[I]=new Map),g.time=d,g.exists=!0,o[I].has(p)||o[I].set(p,new Set),o[I].get(p).add(g.geometryID),this._geometriesInMemory.add(m),u=!0)}for(const m of f){const p=this._geometries.get(m);p&&(this.handleLostGeometries(d,m,p,a,h),u=!0)}u&&await this.onViewUpdated.trigger({toLoad:o,toRemove:a,toHide:h,toShow:c}),this._isWorkerBusy=!1}),this.updateInterval=500,this._geometry=new pt(1,1,1),this._geometry.groups=[],this._geometry.deleteAttribute("uv");const i=this._geometry.attributes.position.array;for(let n=0;n<i.length;n++)i[n]+=.5;this._geometry.attributes.position.needsUpdate=!0,this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._intervalID=window.setInterval(this.updateVisibility,this.updateInterval))}dispose(){super.dispose(),this.onViewUpdated.reset(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null);for(const[e,t]of this._geometriesGroups){t.removeFromParent();const s=[...t.children];for(const i of s)i.removeFromParent()}this._geometriesGroups.clear();for(const[e,t]of this.boxes)t.dispose(!0);this.boxes.clear();for(const[e,t]of this._geometries)t.fragment&&(t.fragment.dispose(!0),t.fragment=void 0);this._geometries.clear(),this._staticGeometries={culled:{},unculled:{}},this._geometry.dispose(),this._material.dispose(),this._modelIDIndex.clear(),this._indexModelID.clear(),this.codes.clear()}add(e,t,s){const i=this.createModelIndex(e),n=$s.enabled;$s.enabled=!1;const r=new Map,o=new Oe,a=new wr(this._geometry,this._material,10);this.boxes.set(i,a),this.scene.add(a.mesh);const h=new hl;this.scene.add(h),this._geometriesGroups.set(i,h);const c=new Map;for(const u of t)for(const f of u.geometries){const{geometryID:m,transformation:p,color:g}=f,E=new mt;E.setRGB(g[0],g[1],g[2],"srgb");const I=this.getInstanceID(u.id,m),v=s[m];if(!v){console.log(`Geometry not found: ${m}`);continue}const{boundingBox:b}=v;let C;r.has(m)?C=r.get(m):(C=this.getAvailableColor(),this.increaseColor(),r.set(m,C));const{r:F,g:A,b:R,code:O}=C,L=new mt;L.setRGB(F/255,A/255,R/255,"srgb"),this.codes.has(i)||this.codes.set(i,new Map),this.codes.get(i).set(m,O);const k=new Oe,x=Object.values(b);if(k.fromArray(p),o.fromArray(x),k.multiply(o),c.has(I)){const M=c.get(I);if(M===void 0||!M.colors)throw new Error("Malformed item!");M.colors.push(L),M.geometryColors.push(E),M.transforms.push(k)}else c.set(I,{id:I,colors:[L],geometryColors:[E],transforms:[k]});if(this._geometries.has(O))this._geometries.get(O).assetIDs.add(u.id);else{const M=new Set([u.id]);this._geometries.set(O,{modelIndex:i,geometryID:m,assetIDs:M,exists:!1,hidden:!1,time:0})}}const d=Array.from(c.values());a.add(d),$s.enabled=n}remove(e){const t=this._modelIDIndex.get(e);if(t===void 0)throw new Error("Model doesn't exist!");const s=this._geometriesGroups.get(t);s.removeFromParent();const i=[...s.children];for(const r of i)r.removeFromParent();this._geometriesGroups.delete(t),this.boxes.get(t).dispose(!1),this.boxes.delete(t);const n=this.codes.get(t);this.codes.delete(t);for(const[r,o]of n){const a=this._geometries.get(o);a&&a.fragment&&(a.fragment.dispose(!1),a.fragment=void 0),this._geometries.delete(o)}this._modelIDIndex.delete(e),this._indexModelID.delete(t),this._geometriesInMemory.clear()}addFragment(e,t,s){const i=$s.enabled;$s.enabled=!1;const n=this._modelIDIndex.get(e),r=this.codes.get(n).get(t),o=this._geometries.get(r);if(this.setGeometryVisibility(o,!1,!1),!o.fragment){o.fragment=new wr(s.mesh.geometry,this._material,s.capacity);const u=this._geometriesGroups.get(n);if(!u)throw new Error("Group not found!");u.add(o.fragment.mesh)}const[a,h,c]=r.split("-").map(u=>parseInt(u,10)),d=[];for(const u of s.ids){const f=s.get(u);if(!f.colors)throw new Error("Malformed fragments!");for(const m of f.colors)m.setRGB(a/255,h/255,c/255,"srgb");d.push(f)}o.fragment.add(d),$s.enabled=i,this.needsUpdate=!0}removeFragment(e,t){const s=this._modelIDIndex.get(e),i=this.codes.get(s).get(t),n=this._geometries.get(i);if(n.hidden||this.setGeometryVisibility(n,!0,!1),n.fragment){const{fragment:r}=n;r.dispose(!1),n.fragment=void 0}}setModelTransformation(e,t){const s=this._modelIDIndex.get(e);if(s===void 0)throw new Error("Model not found!");const i=this.boxes.get(s);i&&(i.mesh.position.set(0,0,0),i.mesh.rotation.set(0,0,0),i.mesh.scale.set(1,1,1),i.mesh.applyMatrix4(t));const n=this._geometriesGroups.get(s);n&&(n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),n.applyMatrix4(t))}setVisibility(e,t,s){const i=this._modelIDIndex.get(t);if(i!==void 0)for(const[n,r]of s){const o=this.codes.get(i);if(o===void 0)throw new Error("Map not found!");const a=o.get(n),h=this._geometries.get(a);if(h===void 0)throw new Error("Geometry not found!");h.hidden=!e,this.setGeometryVisibility(h,e,!0,r)}}updateTransformations(e){const t=this._modelIDIndex.get(e);if(t===void 0)return;const s=this.components.get(at).groups.get(e);if(s){s.updateWorldMatrix(!0,!1),s.updateMatrix();const i=this.boxes.get(t);i&&(i.mesh.position.set(0,0,0),i.mesh.rotation.set(0,0,0),i.mesh.scale.set(1,1,1),i.mesh.updateMatrix(),i.mesh.applyMatrix4(s.matrixWorld),i.mesh.updateMatrix());const n=this._geometriesGroups.get(t);n&&(n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),n.updateMatrix(),n.applyMatrix4(s.matrixWorld),n.updateMatrix())}}async addStaticGeometries(e,t=!0){const s={data:{colors:new Map}},i=this.threshold+1e3;for(const n in e){const r=this._modelIDIndex.get(n);if(r===void 0)continue;const o=this.codes.get(r);if(!o)continue;const a=e[n];for(const h of a){const c=o.get(h);if(!c)continue;const d=this._geometries.get(c);if(!d)continue;d.exists=!0,t||(d.hidden=!1,d.time=performance.now(),s.data.colors.set(c,i)),this._geometriesInMemory.add(c);const u=t?this._staticGeometries.culled:this._staticGeometries.unculled;u[n]||(u[n]=new Set),u[n].add(h)}}t||await this.handleWorkerMessage(s)}removeStaticGeometries(e,t){const s=[];t===void 0?s.push("culled","unculled"):t===!0?s.push("culled"):s.push("unculled");for(const i in e){const n=e[i];for(const r of s){const o=this._staticGeometries[r][i];if(o)for(const a of n)o.delete(a)}}}setGeometryVisibility(e,t,s,i){const{modelIndex:n,geometryID:r,assetIDs:o}=e,a=this.boxes.get(n);if(a===void 0)throw new Error("Model not found!");const h=i||o;if(s&&e.fragment)e.fragment.setVisibility(t,h);else{const c=new Set;for(const d of h){const u=this.getInstanceID(d,r);c.add(u)}a.setVisibility(t,c)}}handleLostGeometries(e,t,s,i,n){var r,o,a;const h=this._indexModelID.get(s.modelIndex),c=e-s.time,{culled:d,unculled:u}=this._staticGeometries;if(c>this.maxLostTime){if((r=d[h])!=null&&r.has(s.geometryID)||(o=u[h])!=null&&o.has(s.geometryID))return;i[h]||(i[h]=new Set),s.exists=!1,i[h].add(s.geometryID),this._geometriesInMemory.delete(t)}else if(c>this.maxHiddenTime){if((a=u[h])!=null&&a.has(s.geometryID))return;n[h]||(n[h]=new Set),n[h].add(s.geometryID)}}createModelIndex(e){if(this._modelIDIndex.has(e))throw new Error("Can't load the same model twice!");const t=this._nextModelID;return this._nextModelID++,this._modelIDIndex.set(e,t),this._indexModelID.set(t,e),t}getInstanceID(e,t){const s=10**(Math.log(t)*Math.LOG10E+1|0);return e+t/s}}var nI={exports:{}};(function(l,e){(function(t,s){l.exports=s()})(t0,function(){var t=function(y,T){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,D){S.__proto__=D}||function(S,D){for(var B in D)Object.prototype.hasOwnProperty.call(D,B)&&(S[B]=D[B])})(y,T)},s=function(){return(s=Object.assign||function(y){for(var T,S=1,D=arguments.length;S<D;S++)for(var B in T=arguments[S])Object.prototype.hasOwnProperty.call(T,B)&&(y[B]=T[B]);return y}).apply(this,arguments)};function i(y,T,S){for(var D,B=0,H=T.length;B<H;B++)!D&&B in T||((D=D||Array.prototype.slice.call(T,0,B))[B]=T[B]);return y.concat(D||Array.prototype.slice.call(T))}var n=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:t0,r=Object.keys,o=Array.isArray;function a(y,T){return typeof T!="object"||r(T).forEach(function(S){y[S]=T[S]}),y}typeof Promise>"u"||n.Promise||(n.Promise=Promise);var h=Object.getPrototypeOf,c={}.hasOwnProperty;function d(y,T){return c.call(y,T)}function u(y,T){typeof T=="function"&&(T=T(h(y))),(typeof Reflect>"u"?r:Reflect.ownKeys)(T).forEach(function(S){m(y,S,T[S])})}var f=Object.defineProperty;function m(y,T,S,D){f(y,T,a(S&&d(S,"get")&&typeof S.get=="function"?{get:S.get,set:S.set,configurable:!0}:{value:S,configurable:!0,writable:!0},D))}function p(y){return{from:function(T){return y.prototype=Object.create(T.prototype),m(y.prototype,"constructor",y),{extend:u.bind(null,y.prototype)}}}}var g=Object.getOwnPropertyDescriptor,E=[].slice;function I(y,T,S){return E.call(y,T,S)}function v(y,T){return T(y)}function b(y){if(!y)throw new Error("Assertion Failed")}function C(y){n.setImmediate?setImmediate(y):setTimeout(y,0)}function F(y,T){if(typeof T=="string"&&d(y,T))return y[T];if(!T)return y;if(typeof T!="string"){for(var S=[],D=0,B=T.length;D<B;++D){var H=F(y,T[D]);S.push(H)}return S}var q=T.indexOf(".");if(q!==-1){var te=y[T.substr(0,q)];return te==null?void 0:F(te,T.substr(q+1))}}function A(y,T,S){if(y&&T!==void 0&&!("isFrozen"in Object&&Object.isFrozen(y)))if(typeof T!="string"&&"length"in T){b(typeof S!="string"&&"length"in S);for(var D=0,B=T.length;D<B;++D)A(y,T[D],S[D])}else{var H,q,te=T.indexOf(".");te!==-1?(H=T.substr(0,te),(q=T.substr(te+1))===""?S===void 0?o(y)&&!isNaN(parseInt(H))?y.splice(H,1):delete y[H]:y[H]=S:A(te=!(te=y[H])||!d(y,H)?y[H]={}:te,q,S)):S===void 0?o(y)&&!isNaN(parseInt(T))?y.splice(T,1):delete y[T]:y[T]=S}}function R(y){var T,S={};for(T in y)d(y,T)&&(S[T]=y[T]);return S}var O=[].concat;function L(y){return O.apply([],y)}var Qi="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(L([8,16,32,64].map(function(y){return["Int","Uint","Float"].map(function(T){return T+y+"Array"})}))).filter(function(y){return n[y]}),k=new Set(Qi.map(function(y){return n[y]})),x=null;function M(y){return x=new WeakMap,y=function T(S){if(!S||typeof S!="object")return S;var D=x.get(S);if(D)return D;if(o(S)){D=[],x.set(S,D);for(var B=0,H=S.length;B<H;++B)D.push(T(S[B]))}else if(k.has(S.constructor))D=S;else{var q,te=h(S);for(q in D=te===Object.prototype?{}:Object.create(te),x.set(S,D),S)d(S,q)&&(D[q]=T(S[q]))}return D}(y),x=null,y}var w={}.toString;function G(y){return w.call(y).slice(8,-1)}var J=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Z=typeof J=="symbol"?function(y){var T;return y!=null&&(T=y[J])&&T.apply(y)}:function(){return null};function le(y,T){return T=y.indexOf(T),0<=T&&y.splice(T,1),0<=T}var ee={};function xe(y){var T,S,D,B;if(arguments.length===1){if(o(y))return y.slice();if(this===ee&&typeof y=="string")return[y];if(B=Z(y)){for(S=[];!(D=B.next()).done;)S.push(D.value);return S}if(y==null)return[y];if(typeof(T=y.length)!="number")return[y];for(S=new Array(T);T--;)S[T]=y[T];return S}for(T=arguments.length,S=new Array(T);T--;)S[T]=arguments[T];return S}var X=typeof Symbol<"u"?function(y){return y[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},pe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Qs=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(pe),j={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function be(y,T){this.name=y,this.message=T}function fe(y,T){return y+". Errors: "+Object.keys(T).map(function(S){return T[S].toString()}).filter(function(S,D,B){return B.indexOf(S)===D}).join(`
`)}function ue(y,T,S,D){this.failures=T,this.failedKeys=D,this.successCount=S,this.message=fe(y,T)}function He(y,T){this.name="BulkError",this.failures=Object.keys(T).map(function(S){return T[S]}),this.failuresByPos=T,this.message=fe(y,this.failures)}p(be).from(Error).extend({toString:function(){return this.name+": "+this.message}}),p(ue).from(be),p(He).from(be);var Xe=Qs.reduce(function(y,T){return y[T]=T+"Error",y},{}),Se=be,_e=Qs.reduce(function(y,T){var S=T+"Error";function D(B,H){this.name=S,B?typeof B=="string"?(this.message="".concat(B).concat(H?`
 `+H:""),this.inner=H||null):typeof B=="object"&&(this.message="".concat(B.name," ").concat(B.message),this.inner=B):(this.message=j[T]||S,this.inner=null)}return p(D).from(Se),y[T]=D,y},{});_e.Syntax=SyntaxError,_e.Type=TypeError,_e.Range=RangeError;var Le=pe.reduce(function(y,T){return y[T+"Error"]=_e[T],y},{}),Ge=Qs.reduce(function(y,T){return["Syntax","Type","Range"].indexOf(T)===-1&&(y[T+"Error"]=_e[T]),y},{});function Ze(){}function $e(y){return y}function _(y,T){return y==null||y===$e?T:function(S){return T(y(S))}}function $(y,T){return function(){y.apply(this,arguments),T.apply(this,arguments)}}function Q(y,T){return y===Ze?T:function(){var S=y.apply(this,arguments);S!==void 0&&(arguments[0]=S);var D=this.onsuccess,B=this.onerror;this.onsuccess=null,this.onerror=null;var H=T.apply(this,arguments);return D&&(this.onsuccess=this.onsuccess?$(D,this.onsuccess):D),B&&(this.onerror=this.onerror?$(B,this.onerror):B),H!==void 0?H:S}}function N(y,T){return y===Ze?T:function(){y.apply(this,arguments);var S=this.onsuccess,D=this.onerror;this.onsuccess=this.onerror=null,T.apply(this,arguments),S&&(this.onsuccess=this.onsuccess?$(S,this.onsuccess):S),D&&(this.onerror=this.onerror?$(D,this.onerror):D)}}function P(y,T){return y===Ze?T:function(S){var D=y.apply(this,arguments);a(S,D);var B=this.onsuccess,H=this.onerror;return this.onsuccess=null,this.onerror=null,S=T.apply(this,arguments),B&&(this.onsuccess=this.onsuccess?$(B,this.onsuccess):B),H&&(this.onerror=this.onerror?$(H,this.onerror):H),D===void 0?S===void 0?void 0:S:a(D,S)}}function W(y,T){return y===Ze?T:function(){return T.apply(this,arguments)!==!1&&y.apply(this,arguments)}}function se(y,T){return y===Ze?T:function(){var S=y.apply(this,arguments);if(S&&typeof S.then=="function"){for(var D=this,B=arguments.length,H=new Array(B);B--;)H[B]=arguments[B];return S.then(function(){return T.apply(D,H)})}return T.apply(this,arguments)}}Ge.ModifyError=ue,Ge.DexieError=be,Ge.BulkError=He;var ie=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function K(y){ie=y}var de={},Te=100,Qi=typeof Promise>"u"?[]:function(){var y=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[y,h(y),y];var T=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[T,h(T),y]}(),pe=Qi[0],Qs=Qi[1],Qi=Qi[2],Qs=Qs&&Qs.then,Pe=pe&&pe.constructor,Ke=!!Qi,Ye=function(y,T){Pt.push([y,T]),gs&&(queueMicrotask(hI),gs=!1)},_t=!0,gs=!0,Tt=[],Es=[],et=$e,ns={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ze,pgp:!1,env:{},finalize:Ze},je=ns,Pt=[],ks=0,mn=[];function Ve(y){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var T=this._PSD=je;if(typeof y!="function"){if(y!==de)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ts(this,this._value))}this._state=null,this._value=null,++T.ref,function S(D,B){try{B(function(H){if(D._state===null){if(H===D)throw new TypeError("A promise cannot be resolved with itself.");var q=D._lib&&Sr();H&&typeof H.then=="function"?S(D,function(te,ae){H instanceof Ve?H._then(te,ae):H.then(te,ae)}):(D._state=!0,D._value=H,Ks(D)),q&&Or()}},Ts.bind(null,D))}catch(H){Ts(D,H)}}(this,y)}var Qn={get:function(){var y=je,T=Cl;function S(D,B){var H=this,q=!y.global&&(y!==je||T!==Cl),te=q&&!In(),ae=new Ve(function(re,me){jc(H,new gn(mp(D,y,q,te),mp(B,y,q,te),re,me,y))});return this._consoleTask&&(ae._consoleTask=this._consoleTask),ae}return S.prototype=de,S},set:function(y){m(this,"then",y&&y.prototype===de?Qn:{get:function(){return y},set:Qn.set})}};function gn(y,T,S,D,B){this.onFulfilled=typeof y=="function"?y:null,this.onRejected=typeof T=="function"?T:null,this.resolve=S,this.reject=D,this.psd=B}function Ts(y,T){var S,D;Es.push(T),y._state===null&&(S=y._lib&&Sr(),T=et(T),y._state=!1,y._value=T,D=y,Tt.some(function(B){return B._value===D._value})||Tt.push(D),Ks(y),S&&Or())}function Ks(y){var T=y._listeners;y._listeners=[];for(var S=0,D=T.length;S<D;++S)jc(y,T[S]);var B=y._PSD;--B.ref||B.finalize(),ks===0&&(++ks,Ye(function(){--ks==0&&Zc()},[]))}function jc(y,T){if(y._state!==null){var S=y._state?T.onFulfilled:T.onRejected;if(S===null)return(y._state?T.resolve:T.reject)(y._value);++T.psd.ref,++ks,Ye(lI,[S,y,T])}else y._listeners.push(T)}function lI(y,T,S){try{var D,B=T._value;!T._state&&Es.length&&(Es=[]),D=ie&&T._consoleTask?T._consoleTask.run(function(){return y(B)}):y(B),T._state||Es.indexOf(B)!==-1||function(H){for(var q=Tt.length;q;)if(Tt[--q]._value===H._value)return Tt.splice(q,1)}(T),S.resolve(D)}catch(H){S.reject(H)}finally{--ks==0&&Zc(),--S.psd.ref||S.psd.finalize()}}function hI(){qn(ns,function(){Sr()&&Or()})}function Sr(){var y=_t;return gs=_t=!1,y}function Or(){var y,T,S;do for(;0<Pt.length;)for(y=Pt,Pt=[],S=y.length,T=0;T<S;++T){var D=y[T];D[0].apply(null,D[1])}while(0<Pt.length);gs=_t=!0}function Zc(){var y=Tt;Tt=[],y.forEach(function(D){D._PSD.onunhandled.call(null,D._value,D)});for(var T=mn.slice(0),S=T.length;S;)T[--S]()}function bl(y){return new Ve(de,!1,y)}function Ut(y,T){var S=je;return function(){var D=Sr(),B=je;try{return bn(S,!0),y.apply(this,arguments)}catch(H){T&&T(H)}finally{bn(B,!1),D&&Or()}}}u(Ve.prototype,{then:Qn,_then:function(y,T){jc(this,new gn(null,null,y,T,je))},catch:function(y){if(arguments.length===1)return this.then(null,y);var T=y,S=arguments[1];return typeof T=="function"?this.then(null,function(D){return(D instanceof T?S:bl)(D)}):this.then(null,function(D){return(D&&D.name===T?S:bl)(D)})},finally:function(y){return this.then(function(T){return Ve.resolve(y()).then(function(){return T})},function(T){return Ve.resolve(y()).then(function(){return bl(T)})})},timeout:function(y,T){var S=this;return y<1/0?new Ve(function(D,B){var H=setTimeout(function(){return B(new _e.Timeout(T))},y);S.then(D,B).finally(clearTimeout.bind(null,H))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&m(Ve.prototype,Symbol.toStringTag,"Dexie.Promise"),ns.env=pp(),u(Ve,{all:function(){var y=xe.apply(null,arguments).map(vl);return new Ve(function(T,S){y.length===0&&T([]);var D=y.length;y.forEach(function(B,H){return Ve.resolve(B).then(function(q){y[H]=q,--D||T(y)},S)})})},resolve:function(y){return y instanceof Ve?y:y&&typeof y.then=="function"?new Ve(function(T,S){y.then(T,S)}):new Ve(de,!0,y)},reject:bl,race:function(){var y=xe.apply(null,arguments).map(vl);return new Ve(function(T,S){y.map(function(D){return Ve.resolve(D).then(T,S)})})},PSD:{get:function(){return je},set:function(y){return je=y}},totalEchoes:{get:function(){return Cl}},newPSD:En,usePSD:qn,scheduler:{get:function(){return Ye},set:function(y){Ye=y}},rejectionMapper:{get:function(){return et},set:function(y){et=y}},follow:function(y,T){return new Ve(function(S,D){return En(function(B,H){var q=je;q.unhandleds=[],q.onunhandled=H,q.finalize=$(function(){var te,ae=this;te=function(){ae.unhandleds.length===0?B():H(ae.unhandleds[0])},mn.push(function re(){te(),mn.splice(mn.indexOf(re),1)}),++ks,Ye(function(){--ks==0&&Zc()},[])},q.finalize),y()},T,S,D)})}}),Pe&&(Pe.allSettled&&m(Ve,"allSettled",function(){var y=xe.apply(null,arguments).map(vl);return new Ve(function(T){y.length===0&&T([]);var S=y.length,D=new Array(S);y.forEach(function(B,H){return Ve.resolve(B).then(function(q){return D[H]={status:"fulfilled",value:q}},function(q){return D[H]={status:"rejected",reason:q}}).then(function(){return--S||T(D)})})})}),Pe.any&&typeof AggregateError<"u"&&m(Ve,"any",function(){var y=xe.apply(null,arguments).map(vl);return new Ve(function(T,S){y.length===0&&S(new AggregateError([]));var D=y.length,B=new Array(D);y.forEach(function(H,q){return Ve.resolve(H).then(function(te){return T(te)},function(te){B[q]=te,--D||S(new AggregateError(B))})})})}));var rs={awaits:0,echoes:0,id:0},cI=0,yl=[],wl=0,Cl=0,uI=0;function En(y,T,S,D){var B=je,H=Object.create(B);return H.parent=B,H.ref=0,H.global=!1,H.id=++uI,ns.env,H.env=Ke?{Promise:Ve,PromiseProp:{value:Ve,configurable:!0,writable:!0},all:Ve.all,race:Ve.race,allSettled:Ve.allSettled,any:Ve.any,resolve:Ve.resolve,reject:Ve.reject}:{},T&&a(H,T),++B.ref,H.finalize=function(){--this.parent.ref||this.parent.finalize()},D=qn(H,y,S,D),H.ref===0&&H.finalize(),D}function Pr(){return rs.id||(rs.id=++cI),++rs.awaits,rs.echoes+=Te,rs.id}function In(){return!!rs.awaits&&(--rs.awaits==0&&(rs.id=0),rs.echoes=rs.awaits*Te,!0)}function vl(y){return rs.echoes&&y&&y.constructor===Pe?(Pr(),y.then(function(T){return In(),T},function(T){return In(),Zt(T)})):y}function dI(){var y=yl[yl.length-1];yl.pop(),bn(y,!1)}function bn(y,T){var S,D=je;(T?!rs.echoes||wl++&&y===je:!wl||--wl&&y===je)||queueMicrotask(T?function(B){++Cl,rs.echoes&&--rs.echoes!=0||(rs.echoes=rs.awaits=rs.id=0),yl.push(je),bn(B,!0)}.bind(null,y):dI),y!==je&&(je=y,D===ns&&(ns.env=pp()),Ke&&(S=ns.env.Promise,T=y.env,(D.global||y.global)&&(Object.defineProperty(n,"Promise",T.PromiseProp),S.all=T.all,S.race=T.race,S.resolve=T.resolve,S.reject=T.reject,T.allSettled&&(S.allSettled=T.allSettled),T.any&&(S.any=T.any))))}function pp(){var y=n.Promise;return Ke?{Promise:y,PromiseProp:Object.getOwnPropertyDescriptor(n,"Promise"),all:y.all,race:y.race,allSettled:y.allSettled,any:y.any,resolve:y.resolve,reject:y.reject}:{}}function qn(y,T,S,D,B){var H=je;try{return bn(y,!0),T(S,D,B)}finally{bn(H,!1)}}function mp(y,T,S,D){return typeof y!="function"?y:function(){var B=je;S&&Pr(),bn(T,!0);try{return y.apply(this,arguments)}finally{bn(B,!1),D&&queueMicrotask(In)}}}function Xc(y){Promise===Pe&&rs.echoes===0?wl===0?y():enqueueNativeMicroTask(y):setTimeout(y,0)}(""+Qs).indexOf("[native code]")===-1&&(Pr=In=Ze);var Zt=Ve.reject,Jn="￿",Ki="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",gp="String expected.",Mr=[],_l="__dbnames",Kc="readonly",Qc="readwrite";function $n(y,T){return y?T?function(){return y.apply(this,arguments)&&T.apply(this,arguments)}:y:T}var Ep={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Tl(y){return typeof y!="string"||/\./.test(y)?function(T){return T}:function(T){return T[y]===void 0&&y in T&&delete(T=M(T))[y],T}}function Ip(){throw _e.Type()}function gt(y,T){try{var S=bp(y),D=bp(T);if(S!==D)return S==="Array"?1:D==="Array"?-1:S==="binary"?1:D==="binary"?-1:S==="string"?1:D==="string"?-1:S==="Date"?1:D!=="Date"?NaN:-1;switch(S){case"number":case"Date":case"string":return T<y?1:y<T?-1:0;case"binary":return function(B,H){for(var q=B.length,te=H.length,ae=q<te?q:te,re=0;re<ae;++re)if(B[re]!==H[re])return B[re]<H[re]?-1:1;return q===te?0:q<te?-1:1}(yp(y),yp(T));case"Array":return function(B,H){for(var q=B.length,te=H.length,ae=q<te?q:te,re=0;re<ae;++re){var me=gt(B[re],H[re]);if(me!==0)return me}return q===te?0:q<te?-1:1}(y,T)}}catch{}return NaN}function bp(y){var T=typeof y;return T!="object"?T:ArrayBuffer.isView(y)?"binary":(y=G(y),y==="ArrayBuffer"?"binary":y)}function yp(y){return y instanceof Uint8Array?y:ArrayBuffer.isView(y)?new Uint8Array(y.buffer,y.byteOffset,y.byteLength):new Uint8Array(y)}var wp=(Mt.prototype._trans=function(y,T,S){var D=this._tx||je.trans,B=this.name,H=ie&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(y==="readonly"?"read":"write"," ").concat(this.name));function q(re,me,ne){if(!ne.schema[B])throw new _e.NotFound("Table "+B+" not part of transaction");return T(ne.idbtrans,ne)}var te=Sr();try{var ae=D&&D.db._novip===this.db._novip?D===je.trans?D._promise(y,q,S):En(function(){return D._promise(y,q,S)},{trans:D,transless:je.transless||je}):function re(me,ne,ge,oe){if(me.idbdb&&(me._state.openComplete||je.letThrough||me._vip)){var he=me._createTransaction(ne,ge,me._dbSchema);try{he.create(),me._state.PR1398_maxLoop=3}catch(Ee){return Ee.name===Xe.InvalidState&&me.isOpen()&&0<--me._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),me.close({disableAutoOpen:!1}),me.open().then(function(){return re(me,ne,ge,oe)})):Zt(Ee)}return he._promise(ne,function(Ee,ce){return En(function(){return je.trans=he,oe(Ee,ce,he)})}).then(function(Ee){if(ne==="readwrite")try{he.idbtrans.commit()}catch{}return ne==="readonly"?Ee:he._completion.then(function(){return Ee})})}if(me._state.openComplete)return Zt(new _e.DatabaseClosed(me._state.dbOpenError));if(!me._state.isBeingOpened){if(!me._state.autoOpen)return Zt(new _e.DatabaseClosed);me.open().catch(Ze)}return me._state.dbReadyPromise.then(function(){return re(me,ne,ge,oe)})}(this.db,y,[this.name],q);return H&&(ae._consoleTask=H,ae=ae.catch(function(re){return console.trace(re),Zt(re)})),ae}finally{te&&Or()}},Mt.prototype.get=function(y,T){var S=this;return y&&y.constructor===Object?this.where(y).first(T):y==null?Zt(new _e.Type("Invalid argument to Table.get()")):this._trans("readonly",function(D){return S.core.get({trans:D,key:y}).then(function(B){return S.hook.reading.fire(B)})}).then(T)},Mt.prototype.where=function(y){if(typeof y=="string")return new this.db.WhereClause(this,y);if(o(y))return new this.db.WhereClause(this,"[".concat(y.join("+"),"]"));var T=r(y);if(T.length===1)return this.where(T[0]).equals(y[T[0]]);var S=this.schema.indexes.concat(this.schema.primKey).filter(function(ae){if(ae.compound&&T.every(function(me){return 0<=ae.keyPath.indexOf(me)})){for(var re=0;re<T.length;++re)if(T.indexOf(ae.keyPath[re])===-1)return!1;return!0}return!1}).sort(function(ae,re){return ae.keyPath.length-re.keyPath.length})[0];if(S&&this.db._maxKey!==Jn){var q=S.keyPath.slice(0,T.length);return this.where(q).equals(q.map(function(re){return y[re]}))}!S&&ie&&console.warn("The query ".concat(JSON.stringify(y)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(T.join("+"),"]"));var D=this.schema.idxByName,B=this.db._deps.indexedDB;function H(ae,re){return B.cmp(ae,re)===0}var te=T.reduce(function(ge,re){var me=ge[0],ne=ge[1],ge=D[re],oe=y[re];return[me||ge,me||!ge?$n(ne,ge&&ge.multi?function(he){return he=F(he,re),o(he)&&he.some(function(Ee){return H(oe,Ee)})}:function(he){return H(oe,F(he,re))}):ne]},[null,null]),q=te[0],te=te[1];return q?this.where(q.name).equals(y[q.keyPath]).filter(te):S?this.filter(te):this.where(T).equals("")},Mt.prototype.filter=function(y){return this.toCollection().and(y)},Mt.prototype.count=function(y){return this.toCollection().count(y)},Mt.prototype.offset=function(y){return this.toCollection().offset(y)},Mt.prototype.limit=function(y){return this.toCollection().limit(y)},Mt.prototype.each=function(y){return this.toCollection().each(y)},Mt.prototype.toArray=function(y){return this.toCollection().toArray(y)},Mt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Mt.prototype.orderBy=function(y){return new this.db.Collection(new this.db.WhereClause(this,o(y)?"[".concat(y.join("+"),"]"):y))},Mt.prototype.reverse=function(){return this.toCollection().reverse()},Mt.prototype.mapToClass=function(y){var T,S=this.db,D=this.name;function B(){return T!==null&&T.apply(this,arguments)||this}(this.schema.mappedClass=y).prototype instanceof Ip&&(function(ae,re){if(typeof re!="function"&&re!==null)throw new TypeError("Class extends value "+String(re)+" is not a constructor or null");function me(){this.constructor=ae}t(ae,re),ae.prototype=re===null?Object.create(re):(me.prototype=re.prototype,new me)}(B,T=y),Object.defineProperty(B.prototype,"db",{get:function(){return S},enumerable:!1,configurable:!0}),B.prototype.table=function(){return D},y=B);for(var H=new Set,q=y.prototype;q;q=h(q))Object.getOwnPropertyNames(q).forEach(function(ae){return H.add(ae)});function te(ae){if(!ae)return ae;var re,me=Object.create(y.prototype);for(re in ae)if(!H.has(re))try{me[re]=ae[re]}catch{}return me}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=te,this.hook("reading",te),y},Mt.prototype.defineClass=function(){return this.mapToClass(function(y){a(this,y)})},Mt.prototype.add=function(y,T){var S=this,D=this.schema.primKey,B=D.auto,H=D.keyPath,q=y;return H&&B&&(q=Tl(H)(y)),this._trans("readwrite",function(te){return S.core.mutate({trans:te,type:"add",keys:T!=null?[T]:null,values:[q]})}).then(function(te){return te.numFailures?Ve.reject(te.failures[0]):te.lastResult}).then(function(te){if(H)try{A(y,H,te)}catch{}return te})},Mt.prototype.update=function(y,T){return typeof y!="object"||o(y)?this.where(":id").equals(y).modify(T):(y=F(y,this.schema.primKey.keyPath),y===void 0?Zt(new _e.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(y).modify(T))},Mt.prototype.put=function(y,T){var S=this,D=this.schema.primKey,B=D.auto,H=D.keyPath,q=y;return H&&B&&(q=Tl(H)(y)),this._trans("readwrite",function(te){return S.core.mutate({trans:te,type:"put",values:[q],keys:T!=null?[T]:null})}).then(function(te){return te.numFailures?Ve.reject(te.failures[0]):te.lastResult}).then(function(te){if(H)try{A(y,H,te)}catch{}return te})},Mt.prototype.delete=function(y){var T=this;return this._trans("readwrite",function(S){return T.core.mutate({trans:S,type:"delete",keys:[y]})}).then(function(S){return S.numFailures?Ve.reject(S.failures[0]):void 0})},Mt.prototype.clear=function(){var y=this;return this._trans("readwrite",function(T){return y.core.mutate({trans:T,type:"deleteRange",range:Ep})}).then(function(T){return T.numFailures?Ve.reject(T.failures[0]):void 0})},Mt.prototype.bulkGet=function(y){var T=this;return this._trans("readonly",function(S){return T.core.getMany({keys:y,trans:S}).then(function(D){return D.map(function(B){return T.hook.reading.fire(B)})})})},Mt.prototype.bulkAdd=function(y,T,S){var D=this,B=Array.isArray(T)?T:void 0,H=(S=S||(B?void 0:T))?S.allKeys:void 0;return this._trans("readwrite",function(q){var re=D.schema.primKey,te=re.auto,re=re.keyPath;if(re&&B)throw new _e.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(B&&B.length!==y.length)throw new _e.InvalidArgument("Arguments objects and keys must have the same length");var ae=y.length,re=re&&te?y.map(Tl(re)):y;return D.core.mutate({trans:q,type:"add",keys:B,values:re,wantResults:H}).then(function(he){var ne=he.numFailures,ge=he.results,oe=he.lastResult,he=he.failures;if(ne===0)return H?ge:oe;throw new He("".concat(D.name,".bulkAdd(): ").concat(ne," of ").concat(ae," operations failed"),he)})})},Mt.prototype.bulkPut=function(y,T,S){var D=this,B=Array.isArray(T)?T:void 0,H=(S=S||(B?void 0:T))?S.allKeys:void 0;return this._trans("readwrite",function(q){var re=D.schema.primKey,te=re.auto,re=re.keyPath;if(re&&B)throw new _e.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(B&&B.length!==y.length)throw new _e.InvalidArgument("Arguments objects and keys must have the same length");var ae=y.length,re=re&&te?y.map(Tl(re)):y;return D.core.mutate({trans:q,type:"put",keys:B,values:re,wantResults:H}).then(function(he){var ne=he.numFailures,ge=he.results,oe=he.lastResult,he=he.failures;if(ne===0)return H?ge:oe;throw new He("".concat(D.name,".bulkPut(): ").concat(ne," of ").concat(ae," operations failed"),he)})})},Mt.prototype.bulkUpdate=function(y){var T=this,S=this.core,D=y.map(function(q){return q.key}),B=y.map(function(q){return q.changes}),H=[];return this._trans("readwrite",function(q){return S.getMany({trans:q,keys:D,cache:"clone"}).then(function(te){var ae=[],re=[];y.forEach(function(ne,ge){var oe=ne.key,he=ne.changes,Ee=te[ge];if(Ee){for(var ce=0,Ie=Object.keys(he);ce<Ie.length;ce++){var Ce=Ie[ce],ve=he[Ce];if(Ce===T.schema.primKey.keyPath){if(gt(ve,oe)!==0)throw new _e.Constraint("Cannot update primary key in bulkUpdate()")}else A(Ee,Ce,ve)}H.push(ge),ae.push(oe),re.push(Ee)}});var me=ae.length;return S.mutate({trans:q,type:"put",keys:ae,values:re,updates:{keys:D,changeSpecs:B}}).then(function(ne){var ge=ne.numFailures,oe=ne.failures;if(ge===0)return me;for(var he=0,Ee=Object.keys(oe);he<Ee.length;he++){var ce,Ie=Ee[he],Ce=H[Number(Ie)];Ce!=null&&(ce=oe[Ie],delete oe[Ie],oe[Ce]=ce)}throw new He("".concat(T.name,".bulkUpdate(): ").concat(ge," of ").concat(me," operations failed"),oe)})})})},Mt.prototype.bulkDelete=function(y){var T=this,S=y.length;return this._trans("readwrite",function(D){return T.core.mutate({trans:D,type:"delete",keys:y})}).then(function(q){var B=q.numFailures,H=q.lastResult,q=q.failures;if(B===0)return H;throw new He("".concat(T.name,".bulkDelete(): ").concat(B," of ").concat(S," operations failed"),q)})},Mt);function Mt(){}function aa(y){function T(q,te){if(te){for(var ae=arguments.length,re=new Array(ae-1);--ae;)re[ae-1]=arguments[ae];return S[q].subscribe.apply(null,re),y}if(typeof q=="string")return S[q]}var S={};T.addEventType=H;for(var D=1,B=arguments.length;D<B;++D)H(arguments[D]);return T;function H(q,te,ae){if(typeof q!="object"){var re;te=te||W;var me={subscribers:[],fire:ae=ae||Ze,subscribe:function(ne){me.subscribers.indexOf(ne)===-1&&(me.subscribers.push(ne),me.fire=te(me.fire,ne))},unsubscribe:function(ne){me.subscribers=me.subscribers.filter(function(ge){return ge!==ne}),me.fire=me.subscribers.reduce(te,ae)}};return S[q]=T[q]=me}r(re=q).forEach(function(ne){var ge=re[ne];if(o(ge))H(ne,re[ne][0],re[ne][1]);else{if(ge!=="asap")throw new _e.InvalidArgument("Invalid event config");var oe=H(ne,$e,function(){for(var he=arguments.length,Ee=new Array(he);he--;)Ee[he]=arguments[he];oe.subscribers.forEach(function(ce){C(function(){ce.apply(null,Ee)})})})}})}}function la(y,T){return p(T).from({prototype:y}),T}function Nr(y,T){return!(y.filter||y.algorithm||y.or)&&(T?y.justLimit:!y.replayFilter)}function qc(y,T){y.filter=$n(y.filter,T)}function Jc(y,T,S){var D=y.replayFilter;y.replayFilter=D?function(){return $n(D(),T())}:T,y.justLimit=S&&!D}function xl(y,T){if(y.isPrimKey)return T.primaryKey;var S=T.getIndexByKeyPath(y.index);if(!S)throw new _e.Schema("KeyPath "+y.index+" on object store "+T.name+" is not indexed");return S}function Cp(y,T,S){var D=xl(y,T.schema);return T.openCursor({trans:S,values:!y.keysOnly,reverse:y.dir==="prev",unique:!!y.unique,query:{index:D,range:y.range}})}function Al(y,T,S,D){var B=y.replayFilter?$n(y.filter,y.replayFilter()):y.filter;if(y.or){var H={},q=function(te,ae,re){var me,ne;B&&!B(ae,re,function(ge){return ae.stop(ge)},function(ge){return ae.fail(ge)})||((ne=""+(me=ae.primaryKey))=="[object ArrayBuffer]"&&(ne=""+new Uint8Array(me)),d(H,ne)||(H[ne]=!0,T(te,ae,re)))};return Promise.all([y.or._iterate(q,S),vp(Cp(y,D,S),y.algorithm,q,!y.keysOnly&&y.valueMapper)])}return vp(Cp(y,D,S),$n(y.algorithm,B),T,!y.keysOnly&&y.valueMapper)}function vp(y,T,S,D){var B=Ut(D?function(H,q,te){return S(D(H),q,te)}:S);return y.then(function(H){if(H)return H.start(function(){var q=function(){return H.continue()};T&&!T(H,function(te){return q=te},function(te){H.stop(te),q=Ze},function(te){H.fail(te),q=Ze})||B(H.value,H,function(te){return q=te}),q()})})}var Qi=Symbol(),ha=(_p.prototype.execute=function(y){if(this.add!==void 0){var T=this.add;if(o(T))return i(i([],o(y)?y:[],!0),T).sort();if(typeof T=="number")return(Number(y)||0)+T;if(typeof T=="bigint")try{return BigInt(y)+T}catch{return BigInt(0)+T}throw new TypeError("Invalid term ".concat(T))}if(this.remove!==void 0){var S=this.remove;if(o(S))return o(y)?y.filter(function(D){return!S.includes(D)}).sort():[];if(typeof S=="number")return Number(y)-S;if(typeof S=="bigint")try{return BigInt(y)-S}catch{return BigInt(0)-S}throw new TypeError("Invalid subtrahend ".concat(S))}return T=(T=this.replacePrefix)===null||T===void 0?void 0:T[0],T&&typeof y=="string"&&y.startsWith(T)?this.replacePrefix[1]+y.substring(T.length):y},_p);function _p(y){Object.assign(this,y)}var fI=(It.prototype._read=function(y,T){var S=this._ctx;return S.error?S.table._trans(null,Zt.bind(null,S.error)):S.table._trans("readonly",y).then(T)},It.prototype._write=function(y){var T=this._ctx;return T.error?T.table._trans(null,Zt.bind(null,T.error)):T.table._trans("readwrite",y,"locked")},It.prototype._addAlgorithm=function(y){var T=this._ctx;T.algorithm=$n(T.algorithm,y)},It.prototype._iterate=function(y,T){return Al(this._ctx,y,T,this._ctx.table.core)},It.prototype.clone=function(y){var T=Object.create(this.constructor.prototype),S=Object.create(this._ctx);return y&&a(S,y),T._ctx=S,T},It.prototype.raw=function(){return this._ctx.valueMapper=null,this},It.prototype.each=function(y){var T=this._ctx;return this._read(function(S){return Al(T,y,S,T.table.core)})},It.prototype.count=function(y){var T=this;return this._read(function(S){var D=T._ctx,B=D.table.core;if(Nr(D,!0))return B.count({trans:S,query:{index:xl(D,B.schema),range:D.range}}).then(function(q){return Math.min(q,D.limit)});var H=0;return Al(D,function(){return++H,!1},S,B).then(function(){return H})}).then(y)},It.prototype.sortBy=function(y,T){var S=y.split(".").reverse(),D=S[0],B=S.length-1;function H(ae,re){return re?H(ae[S[re]],re-1):ae[D]}var q=this._ctx.dir==="next"?1:-1;function te(ae,re){return ae=H(ae,B),re=H(re,B),ae<re?-q:re<ae?q:0}return this.toArray(function(ae){return ae.sort(te)}).then(T)},It.prototype.toArray=function(y){var T=this;return this._read(function(S){var D=T._ctx;if(D.dir==="next"&&Nr(D,!0)&&0<D.limit){var B=D.valueMapper,H=xl(D,D.table.core.schema);return D.table.core.query({trans:S,limit:D.limit,values:!0,query:{index:H,range:D.range}}).then(function(te){return te=te.result,B?te.map(B):te})}var q=[];return Al(D,function(te){return q.push(te)},S,D.table.core).then(function(){return q})},y)},It.prototype.offset=function(y){var T=this._ctx;return y<=0||(T.offset+=y,Nr(T)?Jc(T,function(){var S=y;return function(D,B){return S===0||(S===1?--S:B(function(){D.advance(S),S=0}),!1)}}):Jc(T,function(){var S=y;return function(){return--S<0}})),this},It.prototype.limit=function(y){return this._ctx.limit=Math.min(this._ctx.limit,y),Jc(this._ctx,function(){var T=y;return function(S,D,B){return--T<=0&&D(B),0<=T}},!0),this},It.prototype.until=function(y,T){return qc(this._ctx,function(S,D,B){return!y(S.value)||(D(B),T)}),this},It.prototype.first=function(y){return this.limit(1).toArray(function(T){return T[0]}).then(y)},It.prototype.last=function(y){return this.reverse().first(y)},It.prototype.filter=function(y){var T;return qc(this._ctx,function(S){return y(S.value)}),(T=this._ctx).isMatch=$n(T.isMatch,y),this},It.prototype.and=function(y){return this.filter(y)},It.prototype.or=function(y){return new this.db.WhereClause(this._ctx.table,y,this)},It.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},It.prototype.desc=function(){return this.reverse()},It.prototype.eachKey=function(y){var T=this._ctx;return T.keysOnly=!T.isMatch,this.each(function(S,D){y(D.key,D)})},It.prototype.eachUniqueKey=function(y){return this._ctx.unique="unique",this.eachKey(y)},It.prototype.eachPrimaryKey=function(y){var T=this._ctx;return T.keysOnly=!T.isMatch,this.each(function(S,D){y(D.primaryKey,D)})},It.prototype.keys=function(y){var T=this._ctx;T.keysOnly=!T.isMatch;var S=[];return this.each(function(D,B){S.push(B.key)}).then(function(){return S}).then(y)},It.prototype.primaryKeys=function(y){var T=this._ctx;if(T.dir==="next"&&Nr(T,!0)&&0<T.limit)return this._read(function(D){var B=xl(T,T.table.core.schema);return T.table.core.query({trans:D,values:!1,limit:T.limit,query:{index:B,range:T.range}})}).then(function(D){return D.result}).then(y);T.keysOnly=!T.isMatch;var S=[];return this.each(function(D,B){S.push(B.primaryKey)}).then(function(){return S}).then(y)},It.prototype.uniqueKeys=function(y){return this._ctx.unique="unique",this.keys(y)},It.prototype.firstKey=function(y){return this.limit(1).keys(function(T){return T[0]}).then(y)},It.prototype.lastKey=function(y){return this.reverse().firstKey(y)},It.prototype.distinct=function(){var y=this._ctx,y=y.index&&y.table.schema.idxByName[y.index];if(!y||!y.multi)return this;var T={};return qc(this._ctx,function(B){var D=B.primaryKey.toString(),B=d(T,D);return T[D]=!0,!B}),this},It.prototype.modify=function(y){var T=this,S=this._ctx;return this._write(function(D){var B,H,q;q=typeof y=="function"?y:(B=r(y),H=B.length,function(ce){for(var Ie=!1,Ce=0;Ce<H;++Ce){var ve=B[Ce],Re=y[ve],Ne=F(ce,ve);Re instanceof ha?(A(ce,ve,Re.execute(Ne)),Ie=!0):Ne!==Re&&(A(ce,ve,Re),Ie=!0)}return Ie});function te(ce,ve){var Ce=ve.failures,ve=ve.numFailures;he+=ce-ve;for(var Re=0,Ne=r(Ce);Re<Ne.length;Re++){var ze=Ne[Re];oe.push(Ce[ze])}}var ae=S.table.core,re=ae.schema.primaryKey,me=re.outbound,ne=re.extractKey,ge=T.db._options.modifyChunkSize||200,oe=[],he=0,Ee=[];return T.clone().primaryKeys().then(function(ce){function Ie(ve){var Re=Math.min(ge,ce.length-ve);return ae.getMany({trans:D,keys:ce.slice(ve,ve+Re),cache:"immutable"}).then(function(Ne){for(var ze=[],De=[],Be=me?[]:null,ke=[],Me=0;Me<Re;++Me){var it=Ne[Me],nt={value:M(it),primKey:ce[ve+Me]};q.call(nt,nt.value,nt)!==!1&&(nt.value==null?ke.push(ce[ve+Me]):me||gt(ne(it),ne(nt.value))===0?(De.push(nt.value),me&&Be.push(ce[ve+Me])):(ke.push(ce[ve+Me]),ze.push(nt.value)))}return Promise.resolve(0<ze.length&&ae.mutate({trans:D,type:"add",values:ze}).then(function(dt){for(var ct in dt.failures)ke.splice(parseInt(ct),1);te(ze.length,dt)})).then(function(){return(0<De.length||Ce&&typeof y=="object")&&ae.mutate({trans:D,type:"put",keys:Be,values:De,criteria:Ce,changeSpec:typeof y!="function"&&y,isAdditionalChunk:0<ve}).then(function(dt){return te(De.length,dt)})}).then(function(){return(0<ke.length||Ce&&y===$c)&&ae.mutate({trans:D,type:"delete",keys:ke,criteria:Ce,isAdditionalChunk:0<ve}).then(function(dt){return te(ke.length,dt)})}).then(function(){return ce.length>ve+Re&&Ie(ve+ge)})})}var Ce=Nr(S)&&S.limit===1/0&&(typeof y!="function"||y===$c)&&{index:S.index,range:S.range};return Ie(0).then(function(){if(0<oe.length)throw new ue("Error modifying one or more objects",oe,he,Ee);return ce.length})})})},It.prototype.delete=function(){var y=this._ctx,T=y.range;return Nr(y)&&(y.isPrimKey||T.type===3)?this._write(function(S){var D=y.table.core.schema.primaryKey,B=T;return y.table.core.count({trans:S,query:{index:D,range:B}}).then(function(H){return y.table.core.mutate({trans:S,type:"deleteRange",range:B}).then(function(q){var te=q.failures;if(q.lastResult,q.results,q=q.numFailures,q)throw new ue("Could not delete some values",Object.keys(te).map(function(ae){return te[ae]}),H-q);return H-q})})}):this.modify($c)},It);function It(){}var $c=function(y,T){return T.value=null};function pI(y,T){return y<T?-1:y===T?0:1}function mI(y,T){return T<y?-1:y===T?0:1}function Vs(y,T,S){return y=y instanceof xp?new y.Collection(y):y,y._ctx.error=new(S||TypeError)(T),y}function Dr(y){return new y.Collection(y,function(){return Tp("")}).limit(0)}function Fl(y,T,S,D){var B,H,q,te,ae,re,me,ne=S.length;if(!S.every(function(he){return typeof he=="string"}))return Vs(y,gp);function ge(he){B=he==="next"?function(ce){return ce.toUpperCase()}:function(ce){return ce.toLowerCase()},H=he==="next"?function(ce){return ce.toLowerCase()}:function(ce){return ce.toUpperCase()},q=he==="next"?pI:mI;var Ee=S.map(function(ce){return{lower:H(ce),upper:B(ce)}}).sort(function(ce,Ie){return q(ce.lower,Ie.lower)});te=Ee.map(function(ce){return ce.upper}),ae=Ee.map(function(ce){return ce.lower}),me=(re=he)==="next"?"":D}ge("next"),y=new y.Collection(y,function(){return yn(te[0],ae[ne-1]+D)}),y._ondirectionchange=function(he){ge(he)};var oe=0;return y._addAlgorithm(function(he,Ee,ce){var Ie=he.key;if(typeof Ie!="string")return!1;var Ce=H(Ie);if(T(Ce,ae,oe))return!0;for(var ve=null,Re=oe;Re<ne;++Re){var Ne=function(ze,De,Be,ke,Me,it){for(var nt=Math.min(ze.length,ke.length),dt=-1,ct=0;ct<nt;++ct){var Ei=De[ct];if(Ei!==ke[ct])return Me(ze[ct],Be[ct])<0?ze.substr(0,ct)+Be[ct]+Be.substr(ct+1):Me(ze[ct],ke[ct])<0?ze.substr(0,ct)+ke[ct]+Be.substr(ct+1):0<=dt?ze.substr(0,dt)+De[dt]+Be.substr(dt+1):null;Me(ze[ct],Ei)<0&&(dt=ct)}return nt<ke.length&&it==="next"?ze+Be.substr(ze.length):nt<ze.length&&it==="prev"?ze.substr(0,Be.length):dt<0?null:ze.substr(0,dt)+ke[dt]+Be.substr(dt+1)}(Ie,Ce,te[Re],ae[Re],q,re);Ne===null&&ve===null?oe=Re+1:(ve===null||0<q(ve,Ne))&&(ve=Ne)}return Ee(ve!==null?function(){he.continue(ve+me)}:ce),!1}),y}function yn(y,T,S,D){return{type:2,lower:y,upper:T,lowerOpen:S,upperOpen:D}}function Tp(y){return{type:1,lower:y,upper:y}}var xp=(Object.defineProperty(os.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),os.prototype.between=function(y,T,S,D){S=S!==!1,D=D===!0;try{return 0<this._cmp(y,T)||this._cmp(y,T)===0&&(S||D)&&(!S||!D)?Dr(this):new this.Collection(this,function(){return yn(y,T,!S,!D)})}catch{return Vs(this,Ki)}},os.prototype.equals=function(y){return y==null?Vs(this,Ki):new this.Collection(this,function(){return Tp(y)})},os.prototype.above=function(y){return y==null?Vs(this,Ki):new this.Collection(this,function(){return yn(y,void 0,!0)})},os.prototype.aboveOrEqual=function(y){return y==null?Vs(this,Ki):new this.Collection(this,function(){return yn(y,void 0,!1)})},os.prototype.below=function(y){return y==null?Vs(this,Ki):new this.Collection(this,function(){return yn(void 0,y,!1,!0)})},os.prototype.belowOrEqual=function(y){return y==null?Vs(this,Ki):new this.Collection(this,function(){return yn(void 0,y)})},os.prototype.startsWith=function(y){return typeof y!="string"?Vs(this,gp):this.between(y,y+Jn,!0,!0)},os.prototype.startsWithIgnoreCase=function(y){return y===""?this.startsWith(y):Fl(this,function(T,S){return T.indexOf(S[0])===0},[y],Jn)},os.prototype.equalsIgnoreCase=function(y){return Fl(this,function(T,S){return T===S[0]},[y],"")},os.prototype.anyOfIgnoreCase=function(){var y=xe.apply(ee,arguments);return y.length===0?Dr(this):Fl(this,function(T,S){return S.indexOf(T)!==-1},y,"")},os.prototype.startsWithAnyOfIgnoreCase=function(){var y=xe.apply(ee,arguments);return y.length===0?Dr(this):Fl(this,function(T,S){return S.some(function(D){return T.indexOf(D)===0})},y,Jn)},os.prototype.anyOf=function(){var y=this,T=xe.apply(ee,arguments),S=this._cmp;try{T.sort(S)}catch{return Vs(this,Ki)}if(T.length===0)return Dr(this);var D=new this.Collection(this,function(){return yn(T[0],T[T.length-1])});D._ondirectionchange=function(H){S=H==="next"?y._ascending:y._descending,T.sort(S)};var B=0;return D._addAlgorithm(function(H,q,te){for(var ae=H.key;0<S(ae,T[B]);)if(++B===T.length)return q(te),!1;return S(ae,T[B])===0||(q(function(){H.continue(T[B])}),!1)}),D},os.prototype.notEqual=function(y){return this.inAnyRange([[-1/0,y],[y,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},os.prototype.noneOf=function(){var y=xe.apply(ee,arguments);if(y.length===0)return new this.Collection(this);try{y.sort(this._ascending)}catch{return Vs(this,Ki)}var T=y.reduce(function(S,D){return S?S.concat([[S[S.length-1][1],D]]):[[-1/0,D]]},null);return T.push([y[y.length-1],this.db._maxKey]),this.inAnyRange(T,{includeLowers:!1,includeUppers:!1})},os.prototype.inAnyRange=function(Ie,T){var S=this,D=this._cmp,B=this._ascending,H=this._descending,q=this._min,te=this._max;if(Ie.length===0)return Dr(this);if(!Ie.every(function(Ce){return Ce[0]!==void 0&&Ce[1]!==void 0&&B(Ce[0],Ce[1])<=0}))return Vs(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",_e.InvalidArgument);var ae=!T||T.includeLowers!==!1,re=T&&T.includeUppers===!0,me,ne=B;function ge(Ce,ve){return ne(Ce[0],ve[0])}try{(me=Ie.reduce(function(Ce,ve){for(var Re=0,Ne=Ce.length;Re<Ne;++Re){var ze=Ce[Re];if(D(ve[0],ze[1])<0&&0<D(ve[1],ze[0])){ze[0]=q(ze[0],ve[0]),ze[1]=te(ze[1],ve[1]);break}}return Re===Ne&&Ce.push(ve),Ce},[])).sort(ge)}catch{return Vs(this,Ki)}var oe=0,he=re?function(Ce){return 0<B(Ce,me[oe][1])}:function(Ce){return 0<=B(Ce,me[oe][1])},Ee=ae?function(Ce){return 0<H(Ce,me[oe][0])}:function(Ce){return 0<=H(Ce,me[oe][0])},ce=he,Ie=new this.Collection(this,function(){return yn(me[0][0],me[me.length-1][1],!ae,!re)});return Ie._ondirectionchange=function(Ce){ne=Ce==="next"?(ce=he,B):(ce=Ee,H),me.sort(ge)},Ie._addAlgorithm(function(Ce,ve,Re){for(var Ne,ze=Ce.key;ce(ze);)if(++oe===me.length)return ve(Re),!1;return!he(Ne=ze)&&!Ee(Ne)||(S._cmp(ze,me[oe][1])===0||S._cmp(ze,me[oe][0])===0||ve(function(){ne===B?Ce.continue(me[oe][0]):Ce.continue(me[oe][1])}),!1)}),Ie},os.prototype.startsWithAnyOf=function(){var y=xe.apply(ee,arguments);return y.every(function(T){return typeof T=="string"})?y.length===0?Dr(this):this.inAnyRange(y.map(function(T){return[T,T+Jn]})):Vs(this,"startsWithAnyOf() only works with strings")},os);function os(){}function Ri(y){return Ut(function(T){return ca(T),y(T.target.error),!1})}function ca(y){y.stopPropagation&&y.stopPropagation(),y.preventDefault&&y.preventDefault()}var ua="storagemutated",eu="x-storagemutated-1",wn=aa(null,ua),gI=(Si.prototype._lock=function(){return b(!je.global),++this._reculock,this._reculock!==1||je.global||(je.lockOwnerFor=this),this},Si.prototype._unlock=function(){if(b(!je.global),--this._reculock==0)for(je.global||(je.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var y=this._blockedFuncs.shift();try{qn(y[1],y[0])}catch{}}return this},Si.prototype._locked=function(){return this._reculock&&je.lockOwnerFor!==this},Si.prototype.create=function(y){var T=this;if(!this.mode)return this;var S=this.db.idbdb,D=this.db._state.dbOpenError;if(b(!this.idbtrans),!y&&!S)switch(D&&D.name){case"DatabaseClosedError":throw new _e.DatabaseClosed(D);case"MissingAPIError":throw new _e.MissingAPI(D.message,D);default:throw new _e.OpenFailed(D)}if(!this.active)throw new _e.TransactionInactive;return b(this._completion._state===null),(y=this.idbtrans=y||(this.db.core||S).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ut(function(B){ca(B),T._reject(y.error)}),y.onabort=Ut(function(B){ca(B),T.active&&T._reject(new _e.Abort(y.error)),T.active=!1,T.on("abort").fire(B)}),y.oncomplete=Ut(function(){T.active=!1,T._resolve(),"mutatedParts"in y&&wn.storagemutated.fire(y.mutatedParts)}),this},Si.prototype._promise=function(y,T,S){var D=this;if(y==="readwrite"&&this.mode!=="readwrite")return Zt(new _e.ReadOnly("Transaction is readonly"));if(!this.active)return Zt(new _e.TransactionInactive);if(this._locked())return new Ve(function(H,q){D._blockedFuncs.push([function(){D._promise(y,T,S).then(H,q)},je])});if(S)return En(function(){var H=new Ve(function(q,te){D._lock();var ae=T(q,te,D);ae&&ae.then&&ae.then(q,te)});return H.finally(function(){return D._unlock()}),H._lib=!0,H});var B=new Ve(function(H,q){var te=T(H,q,D);te&&te.then&&te.then(H,q)});return B._lib=!0,B},Si.prototype._root=function(){return this.parent?this.parent._root():this},Si.prototype.waitFor=function(y){var T,S=this._root(),D=Ve.resolve(y);S._waitingFor?S._waitingFor=S._waitingFor.then(function(){return D}):(S._waitingFor=D,S._waitingQueue=[],T=S.idbtrans.objectStore(S.storeNames[0]),function H(){for(++S._spinCount;S._waitingQueue.length;)S._waitingQueue.shift()();S._waitingFor&&(T.get(-1/0).onsuccess=H)}());var B=S._waitingFor;return new Ve(function(H,q){D.then(function(te){return S._waitingQueue.push(Ut(H.bind(null,te)))},function(te){return S._waitingQueue.push(Ut(q.bind(null,te)))}).finally(function(){S._waitingFor===B&&(S._waitingFor=null)})})},Si.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new _e.Abort))},Si.prototype.table=function(y){var T=this._memoizedTables||(this._memoizedTables={});if(d(T,y))return T[y];var S=this.schema[y];if(!S)throw new _e.NotFound("Table "+y+" not part of transaction");return S=new this.db.Table(y,S,this),S.core=this.db.core.table(y),T[y]=S},Si);function Si(){}function tu(y,T,S,D,B,H,q){return{name:y,keyPath:T,unique:S,multi:D,auto:B,compound:H,src:(S&&!q?"&":"")+(D?"*":"")+(B?"++":"")+Ap(T)}}function Ap(y){return typeof y=="string"?y:y?"["+[].join.call(y,"+")+"]":""}function su(y,T,S){return{name:y,primKey:T,indexes:S,mappedClass:null,idxByName:(D=function(B){return[B.name,B]},S.reduce(function(B,H,q){return q=D(H,q),q&&(B[q[0]]=q[1]),B},{}))};var D}var da=function(y){try{return y.only([[]]),da=function(){return[[]]},[[]]}catch{return da=function(){return Jn},Jn}};function iu(y){return y==null?function(){}:typeof y=="string"?(T=y).split(".").length===1?function(S){return S[T]}:function(S){return F(S,T)}:function(S){return F(S,y)};var T}function Fp(y){return[].slice.call(y)}var EI=0;function fa(y){return y==null?":id":typeof y=="string"?y:"[".concat(y.join("+"),"]")}function II(y,T,ae){function D(ce){if(ce.type===3)return null;if(ce.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var oe=ce.lower,he=ce.upper,Ee=ce.lowerOpen,ce=ce.upperOpen;return oe===void 0?he===void 0?null:T.upperBound(he,!!ce):he===void 0?T.lowerBound(oe,!!Ee):T.bound(oe,he,!!Ee,!!ce)}function B(ge){var oe,he=ge.name;return{name:he,schema:ge,mutate:function(Ee){var ce=Ee.trans,Ie=Ee.type,Ce=Ee.keys,ve=Ee.values,Re=Ee.range;return new Promise(function(Ne,ze){Ne=Ut(Ne);var De=ce.objectStore(he),Be=De.keyPath==null,ke=Ie==="put"||Ie==="add";if(!ke&&Ie!=="delete"&&Ie!=="deleteRange")throw new Error("Invalid operation type: "+Ie);var Me,it=(Ce||ve||{length:1}).length;if(Ce&&ve&&Ce.length!==ve.length)throw new Error("Given keys array must have same length as given values array.");if(it===0)return Ne({numFailures:0,failures:{},results:[],lastResult:void 0});function nt(As){++Ei,ca(As)}var dt=[],ct=[],Ei=0;if(Ie==="deleteRange"){if(Re.type===4)return Ne({numFailures:Ei,failures:ct,results:[],lastResult:void 0});Re.type===3?dt.push(Me=De.clear()):dt.push(Me=De.delete(D(Re)))}else{var Be=ke?Be?[ve,Ce]:[ve,null]:[Ce,null],ut=Be[0],Is=Be[1];if(ke)for(var bs=0;bs<it;++bs)dt.push(Me=Is&&Is[bs]!==void 0?De[Ie](ut[bs],Is[bs]):De[Ie](ut[bs])),Me.onerror=nt;else for(bs=0;bs<it;++bs)dt.push(Me=De[Ie](ut[bs])),Me.onerror=nt}function Vl(As){As=As.target.result,dt.forEach(function(sr,wu){return sr.error!=null&&(ct[wu]=sr.error)}),Ne({numFailures:Ei,failures:ct,results:Ie==="delete"?Ce:dt.map(function(sr){return sr.result}),lastResult:As})}Me.onerror=function(As){nt(As),Vl(As)},Me.onsuccess=Vl})},getMany:function(Ee){var ce=Ee.trans,Ie=Ee.keys;return new Promise(function(Ce,ve){Ce=Ut(Ce);for(var Re,Ne=ce.objectStore(he),ze=Ie.length,De=new Array(ze),Be=0,ke=0,Me=function(dt){dt=dt.target,De[dt._pos]=dt.result,++ke===Be&&Ce(De)},it=Ri(ve),nt=0;nt<ze;++nt)Ie[nt]!=null&&((Re=Ne.get(Ie[nt]))._pos=nt,Re.onsuccess=Me,Re.onerror=it,++Be);Be===0&&Ce(De)})},get:function(Ee){var ce=Ee.trans,Ie=Ee.key;return new Promise(function(Ce,ve){Ce=Ut(Ce);var Re=ce.objectStore(he).get(Ie);Re.onsuccess=function(Ne){return Ce(Ne.target.result)},Re.onerror=Ri(ve)})},query:(oe=re,function(Ee){return new Promise(function(ce,Ie){ce=Ut(ce);var Ce,ve,Re,Be=Ee.trans,Ne=Ee.values,ze=Ee.limit,Me=Ee.query,De=ze===1/0?void 0:ze,ke=Me.index,Me=Me.range,Be=Be.objectStore(he),ke=ke.isPrimaryKey?Be:Be.index(ke.name),Me=D(Me);if(ze===0)return ce({result:[]});oe?((De=Ne?ke.getAll(Me,De):ke.getAllKeys(Me,De)).onsuccess=function(it){return ce({result:it.target.result})},De.onerror=Ri(Ie)):(Ce=0,ve=!Ne&&"openKeyCursor"in ke?ke.openKeyCursor(Me):ke.openCursor(Me),Re=[],ve.onsuccess=function(it){var nt=ve.result;return nt?(Re.push(Ne?nt.value:nt.primaryKey),++Ce===ze?ce({result:Re}):void nt.continue()):ce({result:Re})},ve.onerror=Ri(Ie))})}),openCursor:function(Ee){var ce=Ee.trans,Ie=Ee.values,Ce=Ee.query,ve=Ee.reverse,Re=Ee.unique;return new Promise(function(Ne,ze){Ne=Ut(Ne);var ke=Ce.index,De=Ce.range,Be=ce.objectStore(he),Be=ke.isPrimaryKey?Be:Be.index(ke.name),ke=ve?Re?"prevunique":"prev":Re?"nextunique":"next",Me=!Ie&&"openKeyCursor"in Be?Be.openKeyCursor(D(De),ke):Be.openCursor(D(De),ke);Me.onerror=Ri(ze),Me.onsuccess=Ut(function(it){var nt,dt,ct,Ei,ut=Me.result;ut?(ut.___id=++EI,ut.done=!1,nt=ut.continue.bind(ut),dt=(dt=ut.continuePrimaryKey)&&dt.bind(ut),ct=ut.advance.bind(ut),Ei=function(){throw new Error("Cursor not stopped")},ut.trans=ce,ut.stop=ut.continue=ut.continuePrimaryKey=ut.advance=function(){throw new Error("Cursor not started")},ut.fail=Ut(ze),ut.next=function(){var Is=this,bs=1;return this.start(function(){return bs--?Is.continue():Is.stop()}).then(function(){return Is})},ut.start=function(Is){function bs(){if(Me.result)try{Is()}catch(As){ut.fail(As)}else ut.done=!0,ut.start=function(){throw new Error("Cursor behind last entry")},ut.stop()}var Vl=new Promise(function(As,sr){As=Ut(As),Me.onerror=Ri(sr),ut.fail=sr,ut.stop=function(wu){ut.stop=ut.continue=ut.continuePrimaryKey=ut.advance=Ei,As(wu)}});return Me.onsuccess=Ut(function(As){Me.onsuccess=bs,bs()}),ut.continue=nt,ut.continuePrimaryKey=dt,ut.advance=ct,bs(),Vl},Ne(ut)):Ne(null)},ze)})},count:function(Ee){var ce=Ee.query,Ie=Ee.trans,Ce=ce.index,ve=ce.range;return new Promise(function(Re,Ne){var ze=Ie.objectStore(he),De=Ce.isPrimaryKey?ze:ze.index(Ce.name),ze=D(ve),De=ze?De.count(ze):De.count();De.onsuccess=Ut(function(Be){return Re(Be.target.result)}),De.onerror=Ri(Ne)})}}}var H,q,te,me=(q=ae,te=Fp((H=y).objectStoreNames),{schema:{name:H.name,tables:te.map(function(ge){return q.objectStore(ge)}).map(function(ge){var oe=ge.keyPath,ce=ge.autoIncrement,he=o(oe),Ee={},ce={name:ge.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:oe==null,compound:he,keyPath:oe,autoIncrement:ce,unique:!0,extractKey:iu(oe)},indexes:Fp(ge.indexNames).map(function(Ie){return ge.index(Ie)}).map(function(Re){var Ce=Re.name,ve=Re.unique,Ne=Re.multiEntry,Re=Re.keyPath,Ne={name:Ce,compound:o(Re),keyPath:Re,unique:ve,multiEntry:Ne,extractKey:iu(Re)};return Ee[fa(Re)]=Ne}),getIndexByKeyPath:function(Ie){return Ee[fa(Ie)]}};return Ee[":id"]=ce.primaryKey,oe!=null&&(Ee[fa(oe)]=ce.primaryKey),ce})},hasGetAll:0<te.length&&"getAll"in q.objectStore(te[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),ae=me.schema,re=me.hasGetAll,me=ae.tables.map(B),ne={};return me.forEach(function(ge){return ne[ge.name]=ge}),{stack:"dbcore",transaction:y.transaction.bind(y),table:function(ge){if(!ne[ge])throw new Error("Table '".concat(ge,"' not found"));return ne[ge]},MIN_KEY:-1/0,MAX_KEY:da(T),schema:ae}}function bI(y,T,S,D){var B=S.IDBKeyRange;return S.indexedDB,{dbcore:(D=II(T,B,D),y.dbcore.reduce(function(H,q){return q=q.create,s(s({},H),q(H))},D))}}function Rl(y,D){var S=D.db,D=bI(y._middlewares,S,y._deps,D);y.core=D.dbcore,y.tables.forEach(function(B){var H=B.name;y.core.schema.tables.some(function(q){return q.name===H})&&(B.core=y.core.table(H),y[H]instanceof y.Table&&(y[H].core=B.core))})}function Sl(y,T,S,D){S.forEach(function(B){var H=D[B];T.forEach(function(q){var te=function ae(re,me){return g(re,me)||(re=h(re))&&ae(re,me)}(q,B);(!te||"value"in te&&te.value===void 0)&&(q===y.Transaction.prototype||q instanceof y.Transaction?m(q,B,{get:function(){return this.table(B)},set:function(ae){f(this,B,{value:ae,writable:!0,configurable:!0,enumerable:!0})}}):q[B]=new y.Table(B,H))})})}function nu(y,T){T.forEach(function(S){for(var D in S)S[D]instanceof y.Table&&delete S[D]})}function yI(y,T){return y._cfg.version-T._cfg.version}function wI(y,T,S,D){var B=y._dbSchema;S.objectStoreNames.contains("$meta")&&!B.$meta&&(B.$meta=su("$meta",Sp("")[0],[]),y._storeNames.push("$meta"));var H=y._createTransaction("readwrite",y._storeNames,B);H.create(S),H._completion.catch(D);var q=H._reject.bind(H),te=je.transless||je;En(function(){return je.trans=H,je.transless=te,T!==0?(Rl(y,S),re=T,((ae=H).storeNames.includes("$meta")?ae.table("$meta").get("version").then(function(me){return me??re}):Ve.resolve(re)).then(function(me){return ge=me,oe=H,he=S,Ee=[],me=(ne=y)._versions,ce=ne._dbSchema=Pl(0,ne.idbdb,he),(me=me.filter(function(Ie){return Ie._cfg.version>=ge})).length!==0?(me.forEach(function(Ie){Ee.push(function(){var Ce=ce,ve=Ie._cfg.dbschema;Ml(ne,Ce,he),Ml(ne,ve,he),ce=ne._dbSchema=ve;var Re=ru(Ce,ve);Re.add.forEach(function(ke){ou(he,ke[0],ke[1].primKey,ke[1].indexes)}),Re.change.forEach(function(ke){if(ke.recreate)throw new _e.Upgrade("Not yet support for changing primary key");var Me=he.objectStore(ke.name);ke.add.forEach(function(it){return Ol(Me,it)}),ke.change.forEach(function(it){Me.deleteIndex(it.name),Ol(Me,it)}),ke.del.forEach(function(it){return Me.deleteIndex(it)})});var Ne=Ie._cfg.contentUpgrade;if(Ne&&Ie._cfg.version>ge){Rl(ne,he),oe._memoizedTables={};var ze=R(ve);Re.del.forEach(function(ke){ze[ke]=Ce[ke]}),nu(ne,[ne.Transaction.prototype]),Sl(ne,[ne.Transaction.prototype],r(ze),ze),oe.schema=ze;var De,Be=X(Ne);return Be&&Pr(),Re=Ve.follow(function(){var ke;(De=Ne(oe))&&Be&&(ke=In.bind(null,null),De.then(ke,ke))}),De&&typeof De.then=="function"?Ve.resolve(De):Re.then(function(){return De})}}),Ee.push(function(Ce){var ve,Re,Ne=Ie._cfg.dbschema;ve=Ne,Re=Ce,[].slice.call(Re.db.objectStoreNames).forEach(function(ze){return ve[ze]==null&&Re.db.deleteObjectStore(ze)}),nu(ne,[ne.Transaction.prototype]),Sl(ne,[ne.Transaction.prototype],ne._storeNames,ne._dbSchema),oe.schema=ne._dbSchema}),Ee.push(function(Ce){ne.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(ne.idbdb.version/10)===Ie._cfg.version?(ne.idbdb.deleteObjectStore("$meta"),delete ne._dbSchema.$meta,ne._storeNames=ne._storeNames.filter(function(ve){return ve!=="$meta"})):Ce.objectStore("$meta").put(Ie._cfg.version,"version"))})}),function Ie(){return Ee.length?Ve.resolve(Ee.shift()(oe.idbtrans)).then(Ie):Ve.resolve()}().then(function(){Rp(ce,he)})):Ve.resolve();var ne,ge,oe,he,Ee,ce}).catch(q)):(r(B).forEach(function(me){ou(S,me,B[me].primKey,B[me].indexes)}),Rl(y,S),void Ve.follow(function(){return y.on.populate.fire(H)}).catch(q));var ae,re})}function CI(y,T){Rp(y._dbSchema,T),T.db.version%10!=0||T.objectStoreNames.contains("$meta")||T.db.createObjectStore("$meta").add(Math.ceil(T.db.version/10-1),"version");var S=Pl(0,y.idbdb,T);Ml(y,y._dbSchema,T);for(var D=0,B=ru(S,y._dbSchema).change;D<B.length;D++){var H=function(q){if(q.change.length||q.recreate)return console.warn("Unable to patch indexes of table ".concat(q.name," because it has changes on the type of index or primary key.")),{value:void 0};var te=T.objectStore(q.name);q.add.forEach(function(ae){ie&&console.debug("Dexie upgrade patch: Creating missing index ".concat(q.name,".").concat(ae.src)),Ol(te,ae)})}(B[D]);if(typeof H=="object")return H.value}}function ru(y,T){var S,D={del:[],add:[],change:[]};for(S in y)T[S]||D.del.push(S);for(S in T){var B=y[S],H=T[S];if(B){var q={name:S,def:H,recreate:!1,del:[],add:[],change:[]};if(""+(B.primKey.keyPath||"")!=""+(H.primKey.keyPath||"")||B.primKey.auto!==H.primKey.auto)q.recreate=!0,D.change.push(q);else{var te=B.idxByName,ae=H.idxByName,re=void 0;for(re in te)ae[re]||q.del.push(re);for(re in ae){var me=te[re],ne=ae[re];me?me.src!==ne.src&&q.change.push(ne):q.add.push(ne)}(0<q.del.length||0<q.add.length||0<q.change.length)&&D.change.push(q)}}else D.add.push([S,H])}return D}function ou(y,T,S,D){var B=y.db.createObjectStore(T,S.keyPath?{keyPath:S.keyPath,autoIncrement:S.auto}:{autoIncrement:S.auto});return D.forEach(function(H){return Ol(B,H)}),B}function Rp(y,T){r(y).forEach(function(S){T.db.objectStoreNames.contains(S)||(ie&&console.debug("Dexie: Creating missing table",S),ou(T,S,y[S].primKey,y[S].indexes))})}function Ol(y,T){y.createIndex(T.name,T.keyPath,{unique:T.unique,multiEntry:T.multi})}function Pl(y,T,S){var D={};return I(T.objectStoreNames,0).forEach(function(B){for(var H=S.objectStore(B),q=tu(Ap(re=H.keyPath),re||"",!0,!1,!!H.autoIncrement,re&&typeof re!="string",!0),te=[],ae=0;ae<H.indexNames.length;++ae){var me=H.index(H.indexNames[ae]),re=me.keyPath,me=tu(me.name,re,!!me.unique,!!me.multiEntry,!1,re&&typeof re!="string",!1);te.push(me)}D[B]=su(B,q,te)}),D}function Ml(y,T,S){for(var D=S.db.objectStoreNames,B=0;B<D.length;++B){var H=D[B],q=S.objectStore(H);y._hasGetAll="getAll"in q;for(var te=0;te<q.indexNames.length;++te){var ae=q.indexNames[te],re=q.index(ae).keyPath,me=typeof re=="string"?re:"["+I(re).join("+")+"]";!T[H]||(re=T[H].idxByName[me])&&(re.name=ae,delete T[H].idxByName[me],T[H].idxByName[ae]=re)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&n.WorkerGlobalScope&&n instanceof n.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(y._hasGetAll=!1)}function Sp(y){return y.split(",").map(function(T,S){var D=(T=T.trim()).replace(/([&*]|\+\+)/g,""),B=/^\[/.test(D)?D.match(/^\[(.*)\]$/)[1].split("+"):D;return tu(D,B||null,/\&/.test(T),/\*/.test(T),/\+\+/.test(T),o(B),S===0)})}var vI=(Nl.prototype._parseStoresSpec=function(y,T){r(y).forEach(function(S){if(y[S]!==null){var D=Sp(y[S]),B=D.shift();if(B.unique=!0,B.multi)throw new _e.Schema("Primary key cannot be multi-valued");D.forEach(function(H){if(H.auto)throw new _e.Schema("Only primary key can be marked as autoIncrement (++)");if(!H.keyPath)throw new _e.Schema("Index must have a name and cannot be an empty string")}),T[S]=su(S,B,D)}})},Nl.prototype.stores=function(S){var T=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,S):S;var S=T._versions,D={},B={};return S.forEach(function(H){a(D,H._cfg.storesSource),B=H._cfg.dbschema={},H._parseStoresSpec(D,B)}),T._dbSchema=B,nu(T,[T._allTables,T,T.Transaction.prototype]),Sl(T,[T._allTables,T,T.Transaction.prototype,this._cfg.tables],r(B),B),T._storeNames=r(B),this},Nl.prototype.upgrade=function(y){return this._cfg.contentUpgrade=se(this._cfg.contentUpgrade||Ze,y),this},Nl);function Nl(){}function au(y,T){var S=y._dbNamesDB;return S||(S=y._dbNamesDB=new qi(_l,{addons:[],indexedDB:y,IDBKeyRange:T})).version(1).stores({dbnames:"name"}),S.table("dbnames")}function lu(y){return y&&typeof y.databases=="function"}function hu(y){return En(function(){return je.letThrough=!0,y()})}function cu(y){return!("from"in y)}var xs=function(y,T){if(!this){var S=new xs;return y&&"d"in y&&a(S,y),S}a(this,arguments.length?{d:1,from:y,to:1<arguments.length?T:y}:{d:0})};function pa(y,T,S){var D=gt(T,S);if(!isNaN(D)){if(0<D)throw RangeError();if(cu(y))return a(y,{from:T,to:S,d:1});var B=y.l,D=y.r;if(gt(S,y.from)<0)return B?pa(B,T,S):y.l={from:T,to:S,d:1,l:null,r:null},Pp(y);if(0<gt(T,y.to))return D?pa(D,T,S):y.r={from:T,to:S,d:1,l:null,r:null},Pp(y);gt(T,y.from)<0&&(y.from=T,y.l=null,y.d=D?D.d+1:1),0<gt(S,y.to)&&(y.to=S,y.r=null,y.d=y.l?y.l.d+1:1),S=!y.r,B&&!y.l&&ma(y,B),D&&S&&ma(y,D)}}function ma(y,T){cu(T)||function S(D,ae){var H=ae.from,q=ae.to,te=ae.l,ae=ae.r;pa(D,H,q),te&&S(D,te),ae&&S(D,ae)}(y,T)}function Op(y,T){var S=Dl(T),D=S.next();if(D.done)return!1;for(var B=D.value,H=Dl(y),q=H.next(B.from),te=q.value;!D.done&&!q.done;){if(gt(te.from,B.to)<=0&&0<=gt(te.to,B.from))return!0;gt(B.from,te.from)<0?B=(D=S.next(te.from)).value:te=(q=H.next(B.from)).value}return!1}function Dl(y){var T=cu(y)?null:{s:0,n:y};return{next:function(S){for(var D=0<arguments.length;T;)switch(T.s){case 0:if(T.s=1,D)for(;T.n.l&&gt(S,T.n.from)<0;)T={up:T,n:T.n.l,s:1};else for(;T.n.l;)T={up:T,n:T.n.l,s:1};case 1:if(T.s=2,!D||gt(S,T.n.to)<=0)return{value:T.n,done:!1};case 2:if(T.n.r){T.s=3,T={up:T,n:T.n.r,s:0};continue}case 3:T=T.up}return{done:!0}}}}function Pp(y){var T,S,D=(((T=y.r)===null||T===void 0?void 0:T.d)||0)-(((S=y.l)===null||S===void 0?void 0:S.d)||0),B=1<D?"r":D<-1?"l":"";B&&(T=B=="r"?"l":"r",S=s({},y),D=y[B],y.from=D.from,y.to=D.to,y[B]=D[B],S[B]=D[T],(y[T]=S).d=Mp(S)),y.d=Mp(y)}function Mp(S){var T=S.r,S=S.l;return(T?S?Math.max(T.d,S.d):T.d:S?S.d:0)+1}function Ll(y,T){return r(T).forEach(function(S){y[S]?ma(y[S],T[S]):y[S]=function D(B){var H,q,te={};for(H in B)d(B,H)&&(q=B[H],te[H]=!q||typeof q!="object"||k.has(q.constructor)?q:D(q));return te}(T[S])}),y}function uu(y,T){return y.all||T.all||Object.keys(y).some(function(S){return T[S]&&Op(T[S],y[S])})}u(xs.prototype,((Qs={add:function(y){return ma(this,y),this},addKey:function(y){return pa(this,y,y),this},addKeys:function(y){var T=this;return y.forEach(function(S){return pa(T,S,S)}),this},hasKey:function(y){var T=Dl(this).next(y).value;return T&&gt(T.from,y)<=0&&0<=gt(T.to,y)}})[J]=function(){return Dl(this)},Qs));var er={},du={},fu=!1;function Ul(y){Ll(du,y),fu||(fu=!0,setTimeout(function(){fu=!1,pu(du,!(du={}))},0))}function pu(y,T){T===void 0&&(T=!1);var S=new Set;if(y.all)for(var D=0,B=Object.values(er);D<B.length;D++)Np(q=B[D],y,S,T);else for(var H in y){var q,te=/^idb\:\/\/(.*)\/(.*)\//.exec(H);te&&(H=te[1],te=te[2],(q=er["idb://".concat(H,"/").concat(te)])&&Np(q,y,S,T))}S.forEach(function(ae){return ae()})}function Np(y,T,S,D){for(var B=[],H=0,q=Object.entries(y.queries.query);H<q.length;H++){for(var te=q[H],ae=te[0],re=[],me=0,ne=te[1];me<ne.length;me++){var ge=ne[me];uu(T,ge.obsSet)?ge.subscribers.forEach(function(ce){return S.add(ce)}):D&&re.push(ge)}D&&B.push([ae,re])}if(D)for(var oe=0,he=B;oe<he.length;oe++){var Ee=he[oe],ae=Ee[0],re=Ee[1];y.queries.query[ae]=re}}function _I(y){var T=y._state,S=y._deps.indexedDB;if(T.isBeingOpened||y.idbdb)return T.dbReadyPromise.then(function(){return T.dbOpenError?Zt(T.dbOpenError):y});T.isBeingOpened=!0,T.dbOpenError=null,T.openComplete=!1;var D=T.openCanceller,B=Math.round(10*y.verno),H=!1;function q(){if(T.openCanceller!==D)throw new _e.DatabaseClosed("db.open() was cancelled")}function te(){return new Ve(function(ge,oe){if(q(),!S)throw new _e.MissingAPI;var he=y.name,Ee=T.autoSchema||!B?S.open(he):S.open(he,B);if(!Ee)throw new _e.MissingAPI;Ee.onerror=Ri(oe),Ee.onblocked=Ut(y._fireOnBlocked),Ee.onupgradeneeded=Ut(function(ce){var Ie;me=Ee.transaction,T.autoSchema&&!y._options.allowEmptyDB?(Ee.onerror=ca,me.abort(),Ee.result.close(),(Ie=S.deleteDatabase(he)).onsuccess=Ie.onerror=Ut(function(){oe(new _e.NoSuchDatabase("Database ".concat(he," doesnt exist")))})):(me.onerror=Ri(oe),ce=ce.oldVersion>Math.pow(2,62)?0:ce.oldVersion,ne=ce<1,y.idbdb=Ee.result,H&&CI(y,me),wI(y,ce/10,me,oe))},oe),Ee.onsuccess=Ut(function(){me=null;var ce,Ie,Ce,ve,Re,Ne=y.idbdb=Ee.result,ze=I(Ne.objectStoreNames);if(0<ze.length)try{var De=Ne.transaction((ve=ze).length===1?ve[0]:ve,"readonly");if(T.autoSchema)Ie=Ne,Ce=De,(ce=y).verno=Ie.version/10,Ce=ce._dbSchema=Pl(0,Ie,Ce),ce._storeNames=I(Ie.objectStoreNames,0),Sl(ce,[ce._allTables],r(Ce),Ce);else if(Ml(y,y._dbSchema,De),((Re=ru(Pl(0,(Re=y).idbdb,De),Re._dbSchema)).add.length||Re.change.some(function(Be){return Be.add.length||Be.change.length}))&&!H)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Ne.close(),B=Ne.version+1,H=!0,ge(te());Rl(y,De)}catch{}Mr.push(y),Ne.onversionchange=Ut(function(Be){T.vcFired=!0,y.on("versionchange").fire(Be)}),Ne.onclose=Ut(function(Be){y.on("close").fire(Be)}),ne&&(Re=y._deps,De=he,Ne=Re.indexedDB,Re=Re.IDBKeyRange,lu(Ne)||De===_l||au(Ne,Re).put({name:De}).catch(Ze)),ge()},oe)}).catch(function(ge){switch(ge?.name){case"UnknownError":if(0<T.PR1398_maxLoop)return T.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),te();break;case"VersionError":if(0<B)return B=0,te()}return Ve.reject(ge)})}var ae,re=T.dbReadyResolve,me=null,ne=!1;return Ve.race([D,(typeof navigator>"u"?Ve.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(ge){function oe(){return indexedDB.databases().finally(ge)}ae=setInterval(oe,100),oe()}).finally(function(){return clearInterval(ae)}):Promise.resolve()).then(te)]).then(function(){return q(),T.onReadyBeingFired=[],Ve.resolve(hu(function(){return y.on.ready.fire(y.vip)})).then(function ge(){if(0<T.onReadyBeingFired.length){var oe=T.onReadyBeingFired.reduce(se,Ze);return T.onReadyBeingFired=[],Ve.resolve(hu(function(){return oe(y.vip)})).then(ge)}})}).finally(function(){T.openCanceller===D&&(T.onReadyBeingFired=null,T.isBeingOpened=!1)}).catch(function(ge){T.dbOpenError=ge;try{me&&me.abort()}catch{}return D===T.openCanceller&&y._close(),Zt(ge)}).finally(function(){T.openComplete=!0,re()}).then(function(){var ge;return ne&&(ge={},y.tables.forEach(function(oe){oe.schema.indexes.forEach(function(he){he.name&&(ge["idb://".concat(y.name,"/").concat(oe.name,"/").concat(he.name)]=new xs(-1/0,[[[]]]))}),ge["idb://".concat(y.name,"/").concat(oe.name,"/")]=ge["idb://".concat(y.name,"/").concat(oe.name,"/:dels")]=new xs(-1/0,[[[]]])}),wn(ua).fire(ge),pu(ge,!0)),y})}function mu(y){function T(H){return y.next(H)}var S=B(T),D=B(function(H){return y.throw(H)});function B(H){return function(ae){var te=H(ae),ae=te.value;return te.done?ae:ae&&typeof ae.then=="function"?ae.then(S,D):o(ae)?Promise.all(ae).then(S,D):S(ae)}}return B(T)()}function Bl(y,T,S){for(var D=o(y)?y.slice():[y],B=0;B<S;++B)D.push(T);return D}var TI={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(y){return s(s({},y),{table:function(T){var S=y.table(T),D=S.schema,B={},H=[];function q(ne,ge,oe){var he=fa(ne),Ee=B[he]=B[he]||[],ce=ne==null?0:typeof ne=="string"?1:ne.length,Ie=0<ge,Ie=s(s({},oe),{name:Ie?"".concat(he,"(virtual-from:").concat(oe.name,")"):oe.name,lowLevelIndex:oe,isVirtual:Ie,keyTail:ge,keyLength:ce,extractKey:iu(ne),unique:!Ie&&oe.unique});return Ee.push(Ie),Ie.isPrimaryKey||H.push(Ie),1<ce&&q(ce===2?ne[0]:ne.slice(0,ce-1),ge+1,oe),Ee.sort(function(Ce,ve){return Ce.keyTail-ve.keyTail}),Ie}T=q(D.primaryKey.keyPath,0,D.primaryKey),B[":id"]=[T];for(var te=0,ae=D.indexes;te<ae.length;te++){var re=ae[te];q(re.keyPath,0,re)}function me(ne){var ge,oe=ne.query.index;return oe.isVirtual?s(s({},ne),{query:{index:oe.lowLevelIndex,range:(ge=ne.query.range,oe=oe.keyTail,{type:ge.type===1?2:ge.type,lower:Bl(ge.lower,ge.lowerOpen?y.MAX_KEY:y.MIN_KEY,oe),lowerOpen:!0,upper:Bl(ge.upper,ge.upperOpen?y.MIN_KEY:y.MAX_KEY,oe),upperOpen:!0})}}):ne}return s(s({},S),{schema:s(s({},D),{primaryKey:T,indexes:H,getIndexByKeyPath:function(ne){return(ne=B[fa(ne)])&&ne[0]}}),count:function(ne){return S.count(me(ne))},query:function(ne){return S.query(me(ne))},openCursor:function(ne){var ge=ne.query.index,oe=ge.keyTail,he=ge.isVirtual,Ee=ge.keyLength;return he?S.openCursor(me(ne)).then(function(Ie){return Ie&&ce(Ie)}):S.openCursor(ne);function ce(Ie){return Object.create(Ie,{continue:{value:function(Ce){Ce!=null?Ie.continue(Bl(Ce,ne.reverse?y.MAX_KEY:y.MIN_KEY,oe)):ne.unique?Ie.continue(Ie.key.slice(0,Ee).concat(ne.reverse?y.MIN_KEY:y.MAX_KEY,oe)):Ie.continue()}},continuePrimaryKey:{value:function(Ce,ve){Ie.continuePrimaryKey(Bl(Ce,y.MAX_KEY,oe),ve)}},primaryKey:{get:function(){return Ie.primaryKey}},key:{get:function(){var Ce=Ie.key;return Ee===1?Ce[0]:Ce.slice(0,Ee)}},value:{get:function(){return Ie.value}}})}}})}})}};function gu(y,T,S,D){return S=S||{},D=D||"",r(y).forEach(function(B){var H,q,te;d(T,B)?(H=y[B],q=T[B],typeof H=="object"&&typeof q=="object"&&H&&q?(te=G(H))!==G(q)?S[D+B]=T[B]:te==="Object"?gu(H,q,S,D+B+"."):H!==q&&(S[D+B]=T[B]):H!==q&&(S[D+B]=T[B])):S[D+B]=void 0}),r(T).forEach(function(B){d(y,B)||(S[D+B]=T[B])}),S}function Eu(y,T){return T.type==="delete"?T.keys:T.keys||T.values.map(y.extractKey)}var xI={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(y){return s(s({},y),{table:function(T){var S=y.table(T),D=S.schema.primaryKey;return s(s({},S),{mutate:function(B){var H=je.trans,q=H.table(T).hook,te=q.deleting,ae=q.creating,re=q.updating;switch(B.type){case"add":if(ae.fire===Ze)break;return H._promise("readwrite",function(){return me(B)},!0);case"put":if(ae.fire===Ze&&re.fire===Ze)break;return H._promise("readwrite",function(){return me(B)},!0);case"delete":if(te.fire===Ze)break;return H._promise("readwrite",function(){return me(B)},!0);case"deleteRange":if(te.fire===Ze)break;return H._promise("readwrite",function(){return function ne(ge,oe,he){return S.query({trans:ge,values:!1,query:{index:D,range:oe},limit:he}).then(function(Ee){var ce=Ee.result;return me({type:"delete",keys:ce,trans:ge}).then(function(Ie){return 0<Ie.numFailures?Promise.reject(Ie.failures[0]):ce.length<he?{failures:[],numFailures:0,lastResult:void 0}:ne(ge,s(s({},oe),{lower:ce[ce.length-1],lowerOpen:!0}),he)})})}(B.trans,B.range,1e4)},!0)}return S.mutate(B);function me(ne){var ge,oe,he,Ee=je.trans,ce=ne.keys||Eu(D,ne);if(!ce)throw new Error("Keys missing");return(ne=ne.type==="add"||ne.type==="put"?s(s({},ne),{keys:ce}):s({},ne)).type!=="delete"&&(ne.values=i([],ne.values)),ne.keys&&(ne.keys=i([],ne.keys)),ge=S,he=ce,((oe=ne).type==="add"?Promise.resolve([]):ge.getMany({trans:oe.trans,keys:he,cache:"immutable"})).then(function(Ie){var Ce=ce.map(function(ve,Re){var Ne,ze,De,Be=Ie[Re],ke={onerror:null,onsuccess:null};return ne.type==="delete"?te.fire.call(ke,ve,Be,Ee):ne.type==="add"||Be===void 0?(Ne=ae.fire.call(ke,ve,ne.values[Re],Ee),ve==null&&Ne!=null&&(ne.keys[Re]=ve=Ne,D.outbound||A(ne.values[Re],D.keyPath,ve))):(Ne=gu(Be,ne.values[Re]),(ze=re.fire.call(ke,Ne,ve,Be,Ee))&&(De=ne.values[Re],Object.keys(ze).forEach(function(Me){d(De,Me)?De[Me]=ze[Me]:A(De,Me,ze[Me])}))),ke});return S.mutate(ne).then(function(ve){for(var Re=ve.failures,Ne=ve.results,ze=ve.numFailures,ve=ve.lastResult,De=0;De<ce.length;++De){var Be=(Ne||ce)[De],ke=Ce[De];Be==null?ke.onerror&&ke.onerror(Re[De]):ke.onsuccess&&ke.onsuccess(ne.type==="put"&&Ie[De]?ne.values[De]:Be)}return{failures:Re,results:Ne,numFailures:ze,lastResult:ve}}).catch(function(ve){return Ce.forEach(function(Re){return Re.onerror&&Re.onerror(ve)}),Promise.reject(ve)})})}}})}})}};function Dp(y,T,S){try{if(!T||T.keys.length<y.length)return null;for(var D=[],B=0,H=0;B<T.keys.length&&H<y.length;++B)gt(T.keys[B],y[H])===0&&(D.push(S?M(T.values[B]):T.values[B]),++H);return D.length===y.length?D:null}catch{return null}}var AI={stack:"dbcore",level:-1,create:function(y){return{table:function(T){var S=y.table(T);return s(s({},S),{getMany:function(D){if(!D.cache)return S.getMany(D);var B=Dp(D.keys,D.trans._cache,D.cache==="clone");return B?Ve.resolve(B):S.getMany(D).then(function(H){return D.trans._cache={keys:D.keys,values:D.cache==="clone"?M(H):H},H})},mutate:function(D){return D.type!=="add"&&(D.trans._cache=null),S.mutate(D)}})}}}};function Lp(y,T){return y.trans.mode==="readonly"&&!!y.subscr&&!y.trans.explicit&&y.trans.db._options.cache!=="disabled"&&!T.schema.primaryKey.outbound}function Up(y,T){switch(y){case"query":return T.values&&!T.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var FI={stack:"dbcore",level:0,name:"Observability",create:function(y){var T=y.schema.name,S=new xs(y.MIN_KEY,y.MAX_KEY);return s(s({},y),{transaction:function(D,B,H){if(je.subscr&&B!=="readonly")throw new _e.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(je.querier));return y.transaction(D,B,H)},table:function(D){var B=y.table(D),H=B.schema,q=H.primaryKey,ne=H.indexes,te=q.extractKey,ae=q.outbound,re=q.autoIncrement&&ne.filter(function(oe){return oe.compound&&oe.keyPath.includes(q.keyPath)}),me=s(s({},B),{mutate:function(oe){function he(Me){return Me="idb://".concat(T,"/").concat(D,"/").concat(Me),ve[Me]||(ve[Me]=new xs)}var Ee,ce,Ie,Ce=oe.trans,ve=oe.mutatedParts||(oe.mutatedParts={}),Re=he(""),Ne=he(":dels"),ze=oe.type,ke=oe.type==="deleteRange"?[oe.range]:oe.type==="delete"?[oe.keys]:oe.values.length<50?[Eu(q,oe).filter(function(Me){return Me}),oe.values]:[],De=ke[0],Be=ke[1],ke=oe.trans._cache;return o(De)?(Re.addKeys(De),(ke=ze==="delete"||De.length===Be.length?Dp(De,ke):null)||Ne.addKeys(De),(ke||Be)&&(Ee=he,ce=ke,Ie=Be,H.indexes.forEach(function(Me){var it=Ee(Me.name||"");function nt(ct){return ct!=null?Me.extractKey(ct):null}function dt(ct){return Me.multiEntry&&o(ct)?ct.forEach(function(Ei){return it.addKey(Ei)}):it.addKey(ct)}(ce||Ie).forEach(function(ct,Is){var ut=ce&&nt(ce[Is]),Is=Ie&&nt(Ie[Is]);gt(ut,Is)!==0&&(ut!=null&&dt(ut),Is!=null&&dt(Is))})}))):De?(Be={from:De.lower,to:De.upper},Ne.add(Be),Re.add(Be)):(Re.add(S),Ne.add(S),H.indexes.forEach(function(Me){return he(Me.name).add(S)})),B.mutate(oe).then(function(Me){return!De||oe.type!=="add"&&oe.type!=="put"||(Re.addKeys(Me.results),re&&re.forEach(function(it){var nt=oe.values.map(function(ct){return it.extractKey(ct)}),dt=it.keyPath.findIndex(function(ct){return ct===q.keyPath});Me.results.forEach(function(ct){return nt[dt]=ct}),he(it.name).addKeys(nt)})),Ce.mutatedParts=Ll(Ce.mutatedParts||{},ve),Me})}}),ne=function(he){var Ee=he.query,he=Ee.index,Ee=Ee.range;return[he,new xs((he=Ee.lower)!==null&&he!==void 0?he:y.MIN_KEY,(Ee=Ee.upper)!==null&&Ee!==void 0?Ee:y.MAX_KEY)]},ge={get:function(oe){return[q,new xs(oe.key)]},getMany:function(oe){return[q,new xs().addKeys(oe.keys)]},count:ne,query:ne,openCursor:ne};return r(ge).forEach(function(oe){me[oe]=function(he){var Ee=je.subscr,ce=!!Ee,Ie=Lp(je,B)&&Up(oe,he)?he.obsSet={}:Ee;if(ce){var Ce=function(Be){return Be="idb://".concat(T,"/").concat(D,"/").concat(Be),Ie[Be]||(Ie[Be]=new xs)},ve=Ce(""),Re=Ce(":dels"),Ee=ge[oe](he),ce=Ee[0],Ee=Ee[1];if((oe==="query"&&ce.isPrimaryKey&&!he.values?Re:Ce(ce.name||"")).add(Ee),!ce.isPrimaryKey){if(oe!=="count"){var Ne=oe==="query"&&ae&&he.values&&B.query(s(s({},he),{values:!1}));return B[oe].apply(this,arguments).then(function(Be){if(oe==="query"){if(ae&&he.values)return Ne.then(function(nt){return nt=nt.result,ve.addKeys(nt),Be});var ke=he.values?Be.result.map(te):Be.result;(he.values?ve:Re).addKeys(ke)}else if(oe==="openCursor"){var Me=Be,it=he.values;return Me&&Object.create(Me,{key:{get:function(){return Re.addKey(Me.primaryKey),Me.key}},primaryKey:{get:function(){var nt=Me.primaryKey;return Re.addKey(nt),nt}},value:{get:function(){return it&&ve.addKey(Me.primaryKey),Me.value}}})}return Be})}Re.add(S)}}return B[oe].apply(this,arguments)}}),me}})}};function Bp(y,T,S){if(S.numFailures===0)return T;if(T.type==="deleteRange")return null;var D=T.keys?T.keys.length:"values"in T&&T.values?T.values.length:1;return S.numFailures===D?null:(T=s({},T),o(T.keys)&&(T.keys=T.keys.filter(function(B,H){return!(H in S.failures)})),"values"in T&&o(T.values)&&(T.values=T.values.filter(function(B,H){return!(H in S.failures)})),T)}function Iu(y,T){return S=y,((D=T).lower===void 0||(D.lowerOpen?0<gt(S,D.lower):0<=gt(S,D.lower)))&&(y=y,(T=T).upper===void 0||(T.upperOpen?gt(y,T.upper)<0:gt(y,T.upper)<=0));var S,D}function zp(y,T,ge,D,B,H){if(!ge||ge.length===0)return y;var q=T.query.index,te=q.multiEntry,ae=T.query.range,re=D.schema.primaryKey.extractKey,me=q.extractKey,ne=(q.lowLevelIndex||q).extractKey,ge=ge.reduce(function(oe,he){var Ee=oe,ce=[];if(he.type==="add"||he.type==="put")for(var Ie=new xs,Ce=he.values.length-1;0<=Ce;--Ce){var ve,Re=he.values[Ce],Ne=re(Re);Ie.hasKey(Ne)||(ve=me(Re),(te&&o(ve)?ve.some(function(ke){return Iu(ke,ae)}):Iu(ve,ae))&&(Ie.addKey(Ne),ce.push(Re)))}switch(he.type){case"add":Ee=oe.concat(T.values?ce:ce.map(function(Me){return re(Me)}));break;case"put":var ze=new xs().addKeys(he.values.map(function(Me){return re(Me)})),Ee=oe.filter(function(Me){return!ze.hasKey(T.values?re(Me):Me)}).concat(T.values?ce:ce.map(function(Me){return re(Me)}));break;case"delete":var De=new xs().addKeys(he.keys);Ee=oe.filter(function(Me){return!De.hasKey(T.values?re(Me):Me)});break;case"deleteRange":var Be=he.range;Ee=oe.filter(function(Me){return!Iu(re(Me),Be)})}return Ee},y);return ge===y?y:(ge.sort(function(oe,he){return gt(ne(oe),ne(he))||gt(re(oe),re(he))}),T.limit&&T.limit<1/0&&(ge.length>T.limit?ge.length=T.limit:y.length===T.limit&&ge.length<T.limit&&(B.dirty=!0)),H?Object.freeze(ge):ge)}function kp(y,T){return gt(y.lower,T.lower)===0&&gt(y.upper,T.upper)===0&&!!y.lowerOpen==!!T.lowerOpen&&!!y.upperOpen==!!T.upperOpen}function RI(y,T){return function(S,D,B,H){if(S===void 0)return D!==void 0?-1:0;if(D===void 0)return 1;if((D=gt(S,D))===0){if(B&&H)return 0;if(B)return 1;if(H)return-1}return D}(y.lower,T.lower,y.lowerOpen,T.lowerOpen)<=0&&0<=function(S,D,B,H){if(S===void 0)return D!==void 0?1:0;if(D===void 0)return-1;if((D=gt(S,D))===0){if(B&&H)return 0;if(B)return-1;if(H)return 1}return D}(y.upper,T.upper,y.upperOpen,T.upperOpen)}function SI(y,T,S,D){y.subscribers.add(S),D.addEventListener("abort",function(){var B,H;y.subscribers.delete(S),y.subscribers.size===0&&(B=y,H=T,setTimeout(function(){B.subscribers.size===0&&le(H,B)},3e3))})}var OI={stack:"dbcore",level:0,name:"Cache",create:function(y){var T=y.schema.name;return s(s({},y),{transaction:function(S,D,B){var H,q,te=y.transaction(S,D,B);return D==="readwrite"&&(q=(H=new AbortController).signal,B=function(ae){return function(){if(H.abort(),D==="readwrite"){for(var re=new Set,me=0,ne=S;me<ne.length;me++){var ge=ne[me],oe=er["idb://".concat(T,"/").concat(ge)];if(oe){var he=y.table(ge),Ee=oe.optimisticOps.filter(function(it){return it.trans===te});if(te._explicit&&ae&&te.mutatedParts)for(var ce=0,Ie=Object.values(oe.queries.query);ce<Ie.length;ce++)for(var Ce=0,ve=(ze=Ie[ce]).slice();Ce<ve.length;Ce++)uu((De=ve[Ce]).obsSet,te.mutatedParts)&&(le(ze,De),De.subscribers.forEach(function(it){return re.add(it)}));else if(0<Ee.length){oe.optimisticOps=oe.optimisticOps.filter(function(it){return it.trans!==te});for(var Re=0,Ne=Object.values(oe.queries.query);Re<Ne.length;Re++)for(var ze,De,Be,ke=0,Me=(ze=Ne[Re]).slice();ke<Me.length;ke++)(De=Me[ke]).res!=null&&te.mutatedParts&&(ae&&!De.dirty?(Be=Object.isFrozen(De.res),Be=zp(De.res,De.req,Ee,he,De,Be),De.dirty?(le(ze,De),De.subscribers.forEach(function(it){return re.add(it)})):Be!==De.res&&(De.res=Be,De.promise=Ve.resolve({result:Be}))):(De.dirty&&le(ze,De),De.subscribers.forEach(function(it){return re.add(it)})))}}}re.forEach(function(it){return it()})}}},te.addEventListener("abort",B(!1),{signal:q}),te.addEventListener("error",B(!1),{signal:q}),te.addEventListener("complete",B(!0),{signal:q})),te},table:function(S){var D=y.table(S),B=D.schema.primaryKey;return s(s({},D),{mutate:function(H){var q=je.trans;if(B.outbound||q.db._options.cache==="disabled"||q.explicit)return D.mutate(H);var te=er["idb://".concat(T,"/").concat(S)];return te?(q=D.mutate(H),H.type!=="add"&&H.type!=="put"||!(50<=H.values.length||Eu(B,H).some(function(ae){return ae==null}))?(te.optimisticOps.push(H),H.mutatedParts&&Ul(H.mutatedParts),q.then(function(ae){0<ae.numFailures&&(le(te.optimisticOps,H),(ae=Bp(0,H,ae))&&te.optimisticOps.push(ae),H.mutatedParts&&Ul(H.mutatedParts))}),q.catch(function(){le(te.optimisticOps,H),H.mutatedParts&&Ul(H.mutatedParts)})):q.then(function(ae){var re=Bp(0,s(s({},H),{values:H.values.map(function(oe,ne){var ge,oe=(ge=B.keyPath)!==null&&ge!==void 0&&ge.includes(".")?M(oe):s({},oe);return A(oe,B.keyPath,ae.results[ne]),oe})}),ae);te.optimisticOps.push(re),queueMicrotask(function(){return H.mutatedParts&&Ul(H.mutatedParts)})}),q):D.mutate(H)},query:function(H){if(!Lp(je,D)||!Up("query",H))return D.query(H);var q=((re=je.trans)===null||re===void 0?void 0:re.db._options.cache)==="immutable",ne=je,te=ne.requery,ae=ne.signal,re=function(he,Ee,ce,Ie){var Ce=er["idb://".concat(he,"/").concat(Ee)];if(!Ce)return[];if(!(Ee=Ce.queries[ce]))return[null,!1,Ce,null];var ve=Ee[(Ie.query?Ie.query.index.name:null)||""];if(!ve)return[null,!1,Ce,null];switch(ce){case"query":var Re=ve.find(function(Ne){return Ne.req.limit===Ie.limit&&Ne.req.values===Ie.values&&kp(Ne.req.query.range,Ie.query.range)});return Re?[Re,!0,Ce,ve]:[ve.find(function(Ne){return("limit"in Ne.req?Ne.req.limit:1/0)>=Ie.limit&&(!Ie.values||Ne.req.values)&&RI(Ne.req.query.range,Ie.query.range)}),!1,Ce,ve];case"count":return Re=ve.find(function(Ne){return kp(Ne.req.query.range,Ie.query.range)}),[Re,!!Re,Ce,ve]}}(T,S,"query",H),me=re[0],ne=re[1],ge=re[2],oe=re[3];return me&&ne?me.obsSet=H.obsSet:(ne=D.query(H).then(function(he){var Ee=he.result;if(me&&(me.res=Ee),q){for(var ce=0,Ie=Ee.length;ce<Ie;++ce)Object.freeze(Ee[ce]);Object.freeze(Ee)}else he.result=M(Ee);return he}).catch(function(he){return oe&&me&&le(oe,me),Promise.reject(he)}),me={obsSet:H.obsSet,promise:ne,subscribers:new Set,type:"query",req:H,dirty:!1},oe?oe.push(me):(oe=[me],(ge=ge||(er["idb://".concat(T,"/").concat(S)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[H.query.index.name||""]=oe)),SI(me,oe,te,ae),me.promise.then(function(he){return{result:zp(he.result,H,ge?.optimisticOps,D,me,q)}})}})}})}};function zl(y,T){return new Proxy(y,{get:function(S,D,B){return D==="db"?T:Reflect.get(S,D,B)}})}var qi=(Xt.prototype.version=function(y){if(isNaN(y)||y<.1)throw new _e.Type("Given version is not a positive number");if(y=Math.round(10*y)/10,this.idbdb||this._state.isBeingOpened)throw new _e.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,y);var T=this._versions,S=T.filter(function(D){return D._cfg.version===y})[0];return S||(S=new this.Version(y),T.push(S),T.sort(yI),S.stores({}),this._state.autoSchema=!1,S)},Xt.prototype._whenReady=function(y){var T=this;return this.idbdb&&(this._state.openComplete||je.letThrough||this._vip)?y():new Ve(function(S,D){if(T._state.openComplete)return D(new _e.DatabaseClosed(T._state.dbOpenError));if(!T._state.isBeingOpened){if(!T._state.autoOpen)return void D(new _e.DatabaseClosed);T.open().catch(Ze)}T._state.dbReadyPromise.then(S,D)}).then(y)},Xt.prototype.use=function(y){var T=y.stack,S=y.create,D=y.level,B=y.name;return B&&this.unuse({stack:T,name:B}),y=this._middlewares[T]||(this._middlewares[T]=[]),y.push({stack:T,create:S,level:D??10,name:B}),y.sort(function(H,q){return H.level-q.level}),this},Xt.prototype.unuse=function(y){var T=y.stack,S=y.name,D=y.create;return T&&this._middlewares[T]&&(this._middlewares[T]=this._middlewares[T].filter(function(B){return D?B.create!==D:!!S&&B.name!==S})),this},Xt.prototype.open=function(){var y=this;return qn(ns,function(){return _I(y)})},Xt.prototype._close=function(){var y=this._state,T=Mr.indexOf(this);if(0<=T&&Mr.splice(T,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}y.isBeingOpened||(y.dbReadyPromise=new Ve(function(S){y.dbReadyResolve=S}),y.openCanceller=new Ve(function(S,D){y.cancelOpen=D}))},Xt.prototype.close=function(S){var T=(S===void 0?{disableAutoOpen:!0}:S).disableAutoOpen,S=this._state;T?(S.isBeingOpened&&S.cancelOpen(new _e.DatabaseClosed),this._close(),S.autoOpen=!1,S.dbOpenError=new _e.DatabaseClosed):(this._close(),S.autoOpen=this._options.autoOpen||S.isBeingOpened,S.openComplete=!1,S.dbOpenError=null)},Xt.prototype.delete=function(y){var T=this;y===void 0&&(y={disableAutoOpen:!0});var S=0<arguments.length&&typeof arguments[0]!="object",D=this._state;return new Ve(function(B,H){function q(){T.close(y);var te=T._deps.indexedDB.deleteDatabase(T.name);te.onsuccess=Ut(function(){var ae,re,me;ae=T._deps,re=T.name,me=ae.indexedDB,ae=ae.IDBKeyRange,lu(me)||re===_l||au(me,ae).delete(re).catch(Ze),B()}),te.onerror=Ri(H),te.onblocked=T._fireOnBlocked}if(S)throw new _e.InvalidArgument("Invalid closeOptions argument to db.delete()");D.isBeingOpened?D.dbReadyPromise.then(q):q()})},Xt.prototype.backendDB=function(){return this.idbdb},Xt.prototype.isOpen=function(){return this.idbdb!==null},Xt.prototype.hasBeenClosed=function(){var y=this._state.dbOpenError;return y&&y.name==="DatabaseClosed"},Xt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Xt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Xt.prototype,"tables",{get:function(){var y=this;return r(this._allTables).map(function(T){return y._allTables[T]})},enumerable:!1,configurable:!0}),Xt.prototype.transaction=function(){var y=function(T,S,D){var B=arguments.length;if(B<2)throw new _e.InvalidArgument("Too few arguments");for(var H=new Array(B-1);--B;)H[B-1]=arguments[B];return D=H.pop(),[T,L(H),D]}.apply(this,arguments);return this._transaction.apply(this,y)},Xt.prototype._transaction=function(y,T,S){var D=this,B=je.trans;B&&B.db===this&&y.indexOf("!")===-1||(B=null);var H,q,te=y.indexOf("?")!==-1;y=y.replace("!","").replace("?","");try{if(q=T.map(function(re){if(re=re instanceof D.Table?re.name:re,typeof re!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return re}),y=="r"||y===Kc)H=Kc;else{if(y!="rw"&&y!=Qc)throw new _e.InvalidArgument("Invalid transaction mode: "+y);H=Qc}if(B){if(B.mode===Kc&&H===Qc){if(!te)throw new _e.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");B=null}B&&q.forEach(function(re){if(B&&B.storeNames.indexOf(re)===-1){if(!te)throw new _e.SubTransaction("Table "+re+" not included in parent transaction.");B=null}}),te&&B&&!B.active&&(B=null)}}catch(re){return B?B._promise(null,function(me,ne){ne(re)}):Zt(re)}var ae=function re(me,ne,ge,oe,he){return Ve.resolve().then(function(){var Ee=je.transless||je,ce=me._createTransaction(ne,ge,me._dbSchema,oe);if(ce.explicit=!0,Ee={trans:ce,transless:Ee},oe)ce.idbtrans=oe.idbtrans;else try{ce.create(),ce.idbtrans._explicit=!0,me._state.PR1398_maxLoop=3}catch(ve){return ve.name===Xe.InvalidState&&me.isOpen()&&0<--me._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),me.close({disableAutoOpen:!1}),me.open().then(function(){return re(me,ne,ge,null,he)})):Zt(ve)}var Ie,Ce=X(he);return Ce&&Pr(),Ee=Ve.follow(function(){var ve;(Ie=he.call(ce,ce))&&(Ce?(ve=In.bind(null,null),Ie.then(ve,ve)):typeof Ie.next=="function"&&typeof Ie.throw=="function"&&(Ie=mu(Ie)))},Ee),(Ie&&typeof Ie.then=="function"?Ve.resolve(Ie).then(function(ve){return ce.active?ve:Zt(new _e.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Ee.then(function(){return Ie})).then(function(ve){return oe&&ce._resolve(),ce._completion.then(function(){return ve})}).catch(function(ve){return ce._reject(ve),Zt(ve)})})}.bind(null,this,H,q,B,S);return B?B._promise(H,ae,"lock"):je.trans?qn(je.transless,function(){return D._whenReady(ae)}):this._whenReady(ae)},Xt.prototype.table=function(y){if(!d(this._allTables,y))throw new _e.InvalidTable("Table ".concat(y," does not exist"));return this._allTables[y]},Xt);function Xt(y,T){var S=this;this._middlewares={},this.verno=0;var D=Xt.dependencies;this._options=T=s({addons:Xt.addons,autoOpen:!0,indexedDB:D.indexedDB,IDBKeyRange:D.IDBKeyRange,cache:"cloned"},T),this._deps={indexedDB:T.indexedDB,IDBKeyRange:T.IDBKeyRange},D=T.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var B,H,q,te,ae,re={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ze,dbReadyPromise:null,cancelOpen:Ze,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:T.autoOpen};re.dbReadyPromise=new Ve(function(ne){re.dbReadyResolve=ne}),re.openCanceller=new Ve(function(ne,ge){re.cancelOpen=ge}),this._state=re,this.name=y,this.on=aa(this,"populate","blocked","versionchange","close",{ready:[se,Ze]}),this.on.ready.subscribe=v(this.on.ready.subscribe,function(ne){return function(ge,oe){Xt.vip(function(){var he,Ee=S._state;Ee.openComplete?(Ee.dbOpenError||Ve.resolve().then(ge),oe&&ne(ge)):Ee.onReadyBeingFired?(Ee.onReadyBeingFired.push(ge),oe&&ne(ge)):(ne(ge),he=S,oe||ne(function ce(){he.on.ready.unsubscribe(ge),he.on.ready.unsubscribe(ce)}))})}}),this.Collection=(B=this,la(fI.prototype,function(Ie,ce){this.db=B;var oe=Ep,he=null;if(ce)try{oe=ce()}catch(Ce){he=Ce}var Ee=Ie._ctx,ce=Ee.table,Ie=ce.hook.reading.fire;this._ctx={table:ce,index:Ee.index,isPrimKey:!Ee.index||ce.schema.primKey.keyPath&&Ee.index===ce.schema.primKey.name,range:oe,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:he,or:Ee.or,valueMapper:Ie!==$e?Ie:null}})),this.Table=(H=this,la(wp.prototype,function(ne,ge,oe){this.db=H,this._tx=oe,this.name=ne,this.schema=ge,this.hook=H._allTables[ne]?H._allTables[ne].hook:aa(null,{creating:[Q,Ze],reading:[_,$e],updating:[P,Ze],deleting:[N,Ze]})})),this.Transaction=(q=this,la(gI.prototype,function(ne,ge,oe,he,Ee){var ce=this;this.db=q,this.mode=ne,this.storeNames=ge,this.schema=oe,this.chromeTransactionDurability=he,this.idbtrans=null,this.on=aa(this,"complete","error","abort"),this.parent=Ee||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ve(function(Ie,Ce){ce._resolve=Ie,ce._reject=Ce}),this._completion.then(function(){ce.active=!1,ce.on.complete.fire()},function(Ie){var Ce=ce.active;return ce.active=!1,ce.on.error.fire(Ie),ce.parent?ce.parent._reject(Ie):Ce&&ce.idbtrans&&ce.idbtrans.abort(),Zt(Ie)})})),this.Version=(te=this,la(vI.prototype,function(ne){this.db=te,this._cfg={version:ne,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(ae=this,la(xp.prototype,function(ne,ge,oe){if(this.db=ae,this._ctx={table:ne,index:ge===":id"?null:ge,or:oe},this._cmp=this._ascending=gt,this._descending=function(he,Ee){return gt(Ee,he)},this._max=function(he,Ee){return 0<gt(he,Ee)?he:Ee},this._min=function(he,Ee){return gt(he,Ee)<0?he:Ee},this._IDBKeyRange=ae._deps.IDBKeyRange,!this._IDBKeyRange)throw new _e.MissingAPI})),this.on("versionchange",function(ne){0<ne.newVersion?console.warn("Another connection wants to upgrade database '".concat(S.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(S.name,"'. Closing db now to resume the delete request.")),S.close({disableAutoOpen:!1})}),this.on("blocked",function(ne){!ne.newVersion||ne.newVersion<ne.oldVersion?console.warn("Dexie.delete('".concat(S.name,"') was blocked")):console.warn("Upgrade '".concat(S.name,"' blocked by other connection holding version ").concat(ne.oldVersion/10))}),this._maxKey=da(T.IDBKeyRange),this._createTransaction=function(ne,ge,oe,he){return new S.Transaction(ne,ge,oe,S._options.chromeTransactionDurability,he)},this._fireOnBlocked=function(ne){S.on("blocked").fire(ne),Mr.filter(function(ge){return ge.name===S.name&&ge!==S&&!ge._state.vcFired}).map(function(ge){return ge.on("versionchange").fire(ne)})},this.use(AI),this.use(OI),this.use(FI),this.use(TI),this.use(xI);var me=new Proxy(this,{get:function(ne,ge,oe){if(ge==="_vip")return!0;if(ge==="table")return function(Ee){return zl(S.table(Ee),me)};var he=Reflect.get(ne,ge,oe);return he instanceof wp?zl(he,me):ge==="tables"?he.map(function(Ee){return zl(Ee,me)}):ge==="_createTransaction"?function(){return zl(he.apply(this,arguments),me)}:he}});this.vip=me,D.forEach(function(ne){return ne(S)})}var kl,Qs=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",PI=(bu.prototype.subscribe=function(y,T,S){return this._subscribe(y&&typeof y!="function"?y:{next:y,error:T,complete:S})},bu.prototype[Qs]=function(){return this},bu);function bu(y){this._subscribe=y}try{kl={indexedDB:n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB,IDBKeyRange:n.IDBKeyRange||n.webkitIDBKeyRange}}catch{kl={indexedDB:null,IDBKeyRange:null}}function Vp(y){var T,S=!1,D=new PI(function(B){var H=X(y),q,te=!1,ae={},re={},me={get closed(){return te},unsubscribe:function(){te||(te=!0,q&&q.abort(),ne&&wn.storagemutated.unsubscribe(oe))}};B.start&&B.start(me);var ne=!1,ge=function(){return Xc(he)},oe=function(Ee){Ll(ae,Ee),uu(re,ae)&&ge()},he=function(){var Ee,ce,Ie;!te&&kl.indexedDB&&(ae={},Ee={},q&&q.abort(),q=new AbortController,Ie=function(Ce){var ve=Sr();try{H&&Pr();var Re=En(y,Ce);return Re=H?Re.finally(In):Re}finally{ve&&Or()}}(ce={subscr:Ee,signal:q.signal,requery:ge,querier:y,trans:null}),Promise.resolve(Ie).then(function(Ce){S=!0,T=Ce,te||ce.signal.aborted||(ae={},function(ve){for(var Re in ve)if(d(ve,Re))return;return 1}(re=Ee)||ne||(wn(ua,oe),ne=!0),Xc(function(){return!te&&B.next&&B.next(Ce)}))},function(Ce){S=!1,["DatabaseClosedError","AbortError"].includes(Ce?.name)||te||Xc(function(){te||B.error&&B.error(Ce)})}))};return setTimeout(ge,0),me});return D.hasValue=function(){return S},D.getValue=function(){return T},D}var tr=qi;function yu(y){var T=Cn;try{Cn=!0,wn.storagemutated.fire(y),pu(y,!0)}finally{Cn=T}}u(tr,s(s({},Ge),{delete:function(y){return new tr(y,{addons:[]}).delete()},exists:function(y){return new tr(y,{addons:[]}).open().then(function(T){return T.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(y){try{return T=tr.dependencies,S=T.indexedDB,T=T.IDBKeyRange,(lu(S)?Promise.resolve(S.databases()).then(function(D){return D.map(function(B){return B.name}).filter(function(B){return B!==_l})}):au(S,T).toCollection().primaryKeys()).then(y)}catch{return Zt(new _e.MissingAPI)}var T,S},defineClass:function(){return function(y){a(this,y)}},ignoreTransaction:function(y){return je.trans?qn(je.transless,y):y()},vip:hu,async:function(y){return function(){try{var T=mu(y.apply(this,arguments));return T&&typeof T.then=="function"?T:Ve.resolve(T)}catch(S){return Zt(S)}}},spawn:function(y,T,S){try{var D=mu(y.apply(S,T||[]));return D&&typeof D.then=="function"?D:Ve.resolve(D)}catch(B){return Zt(B)}},currentTransaction:{get:function(){return je.trans||null}},waitFor:function(y,T){return T=Ve.resolve(typeof y=="function"?tr.ignoreTransaction(y):y).timeout(T||6e4),je.trans?je.trans.waitFor(T):T},Promise:Ve,debug:{get:function(){return ie},set:function(y){K(y)}},derive:p,extend:a,props:u,override:v,Events:aa,on:wn,liveQuery:Vp,extendObservabilitySet:Ll,getByKeyPath:F,setByKeyPath:A,delByKeyPath:function(y,T){typeof T=="string"?A(y,T,void 0):"length"in T&&[].map.call(T,function(S){A(y,S,void 0)})},shallowClone:R,deepClone:M,getObjectDiff:gu,cmp:gt,asap:C,minKey:-1/0,addons:[],connections:Mr,errnames:Xe,dependencies:kl,cache:er,semVer:"4.0.8",version:"4.0.8".split(".").map(function(y){return parseInt(y)}).reduce(function(y,T,S){return y+T/Math.pow(10,2*S)})})),tr.maxKey=da(tr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(wn(ua,function(y){Cn||(y=new CustomEvent(eu,{detail:y}),Cn=!0,dispatchEvent(y),Cn=!1)}),addEventListener(eu,function(y){y=y.detail,Cn||yu(y)}));var Lr,Cn=!1,Yp=function(){};return typeof BroadcastChannel<"u"&&((Yp=function(){(Lr=new BroadcastChannel(eu)).onmessage=function(y){return y.data&&yu(y.data)}})(),typeof Lr.unref=="function"&&Lr.unref(),wn(ua,function(y){Cn||Lr.postMessage(y)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(y){if(!qi.disableBfCache&&y.persisted){ie&&console.debug("Dexie: handling persisted pagehide"),Lr?.close();for(var T=0,S=Mr;T<S.length;T++)S[T].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(y){!qi.disableBfCache&&y.persisted&&(ie&&console.debug("Dexie: handling persisted pageshow"),Yp(),yu({all:new xs(-1/0,[[]])}))})),Ve.rejectionMapper=function(y,T){return!y||y instanceof be||y instanceof TypeError||y instanceof SyntaxError||!y.name||!Le[y.name]?y:(T=new Le[y.name](T||y.message,y),"stack"in y&&m(T,"stack",{get:function(){return this.inner.stack}}),T)},K(ie),s(qi,Object.freeze({__proto__:null,Dexie:qi,liveQuery:Vp,Entity:Ip,cmp:gt,PropModSymbol:Qi,PropModification:ha,replacePrefix:function(y,T){return new ha({replacePrefix:[y,T]})},add:function(y){return new ha({add:y})},remove:function(y){return new ha({remove:y})},default:qi,RangeSet:xs,mergeRanges:ma,rangesOverlap:Op}),{default:qi}),qi})})(nI);var Q3=nI.exports;const Lf=U1(Q3),n0=Symbol.for("Dexie"),Uf=globalThis[n0]||(globalThis[n0]=Lf);if(Lf.semVer!==Uf.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Lf.semVer} and ${Uf.semVer}`);class q3 extends Uf{constructor(){super("MyAppDatabase"),Y(this,"files"),this.version(1).stores({files:"id, file"})}}class J3{constructor(e){Y(this,"interval",1e4),Y(this,"maxTime",6e4),Y(this,"list",new Map),Y(this,"_enabled",!1),Y(this,"_intervalId",null),Y(this,"_fileCache"),this._fileCache=e}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e){if(this._enabled=e,!e){this._intervalId!==null&&clearInterval(this._intervalId),this._intervalId=null;return}this._intervalId=window.setInterval(()=>{const t=new Date().getTime();for(const[s,i]of this.list)t-i>this.maxTime&&this.clean(s)},this.interval)}}update(e){this.enabled&&this.list.set(e,new Date().getTime())}async clear(){for(const[e]of this.list)this.clean(e)}clean(e){try{this._fileCache.files.delete(e)}catch{console.log(`File not found in indexedDB: ${e}`)}this.list.delete(e)}}const rI=class Bf extends ht{constructor(e){super(e),Y(this,"enabled",!0),Y(this,"onFragmentsDeleted",new we),Y(this,"onFragmentsLoaded",new we),Y(this,"onDisposed",new we),Y(this,"models",{}),Y(this,"serializer",new Qf),Y(this,"maxRamTime",5e3),Y(this,"useCache",!0),Y(this,"dbCleaner"),Y(this,"fetch",async t=>fetch(t)),Y(this,"_culler",null),Y(this,"_world",null),Y(this,"_ramCache",new Map),Y(this,"_fileCache",new q3),Y(this,"_url",null),Y(this,"_isDisposing",!1),Y(this,"_geometryInstances",{}),Y(this,"_loadedFragments",{}),Y(this,"fragIDData",new Map),Y(this,"_baseMaterial",new kn),Y(this,"_baseMaterialT",new kn({transparent:!0,opacity:.5})),Y(this,"disposeStreamedGroup",t=>{this._isDisposing=!0;const{groupID:s,fragmentIDs:i}=t;if(this.models[s]){delete this.models[s],delete this._geometryInstances[s],delete this._loadedFragments[s];for(const n of i)this.fragIDData.delete(n);this.culler.remove(s),this._isDisposing=!1}}),this.components.add(Bf.uuid,this),this.dbCleaner=new J3(this._fileCache),this.components.get(at).onFragmentsDisposed.add(this.disposeStreamedGroup)}get url(){if(!this._url)throw new Error("url must be set before using the streaming service!");return this._url}set url(e){this._url=e}get world(){if(!this._world)throw new Error("You must set a world before using the streamer!");return this._world}set world(e){var t;this._world=e,(t=this._culler)==null||t.dispose(),this._culler=new K3(this.components,e),this._culler.onViewUpdated.add(async({toLoad:s,toRemove:i,toShow:n,toHide:r})=>{await this.loadFoundGeometries(s),await this.unloadLostGeometries(i),this.setMeshVisibility(n,!0),this.setMeshVisibility(r,!1)})}get culler(){if(!this._culler)throw new Error("You must set a world before using the streamer!");return this._culler}dispose(){var e;this._isDisposing=!0,this.onFragmentsLoaded.reset(),this.onFragmentsDeleted.reset(),this._ramCache.clear(),this.components.get(at).onFragmentsDisposed.remove(this.disposeStreamedGroup),this.models={},this._geometryInstances={},this._loadedFragments={},this.fragIDData.clear(),this._baseMaterial.dispose(),this._baseMaterialT.dispose(),(e=this._culler)==null||e.dispose(),this.onDisposed.trigger(Bf.uuid),this.onDisposed.reset(),this._isDisposing=!1}async load(e,t,s){const{assets:i,geometries:n,globalDataFileId:r}=e,o=this.url+r,a=await(await this.fetch(o)).arrayBuffer(),h=new Uint8Array(a),c=this.components.get(at).load(h,{coordinate:t,isStreamed:!0});c.name=r.replace("-processed-global",""),this.world.scene.three.add(c);const{opaque:d,transparent:u}=c.geometryIDs;for(const[m,p]of d){const g=c.keyFragments.get(p);if(g===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(g,[c,m,new Set])}for(const[m,p]of u){const g=c.keyFragments.get(p);if(g===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(g,[c,Math.abs(m),new Set])}this.culler.add(c.uuid,i,n),this.models[c.uuid]={assets:i,geometries:n};const f=new Map;for(const m of i){const p=m.id;for(const{transformation:g,geometryID:E,color:I}of m.geometries){f.has(E)||f.set(E,[]);const v=f.get(E);if(!v)throw new Error("Malformed instances");v.push({id:p,transformation:g,color:I})}}if(this._geometryInstances[c.uuid]=f,s){const m=new Map,p=new Map;for(const C in s.ids){const F=s.ids[C],A=parseInt(C,10);m.set(A,F)}for(const C in s.types){const F=s.types[C],A=parseInt(C,10);p.set(A,F)}const g=r.replace("-global","-properties");c.streamSettings={baseUrl:this.url,baseFileName:g,ids:m,types:p};const{indexesFile:E}=s,I=this.url+E,v=await(await this.fetch(I)).text(),b=this.components.get(ko);b.setRelationMap(c,b.getRelationsMapFromJSON(v))}return this.culler.updateTransformations(c.uuid),this.culler.needsUpdate=!0,c}remove(e){const t=this.components.get(at),s=t.groups.get(e);s&&t.disposeGroup(s)}setVisibility(e,t){const s=new Map;for(const i in t){const n=this.fragIDData.get(i);if(n===void 0)throw new Error("Geometry not found!");const[r,o,a]=n,h=r.uuid;s.has(h)||s.set(h,new Map);const c=s.get(h),d=t[i];for(const f of d)e?a.delete(f):a.add(f);c.get(o)||c.set(o,new Set);const u=c.get(o);for(const f of d)u.add(f)}for(const[i,n]of s){this.culler.setVisibility(e,i,n);for(const[r]of n){const o=this._loadedFragments[i];if(!o)continue;const a=o[r];if(a)for(const h of a){const c=t[h.id];c&&h.setVisibility(e,c)}}}this.culler.needsUpdate=!0}async clearCache(){await this._fileCache.delete()}async setStatic(e,t,s){const i={};for(const n of e){const r=this.fragIDData.get(n);if(!r){console.log(`Item not found: ${n}.`);continue}const[o,a]=r,h=o.uuid;i[h]||(i[h]=new Set),i[h].add(a)}if(t){const n={};for(const r in i){const o=new Map;o.set(1,i[r]),n[r]=o}await this.loadFoundGeometries(n,!1),await this.culler.addStaticGeometries(i,s)}else this.culler.removeStaticGeometries(i,s)}async loadFoundGeometries(e,t=!0){for(const s in e){if(this._isDisposing)return;const i=this.components.get(at).groups.get(s);if(!i)return;const{geometries:n}=this.models[s],r=new Map,o=new Set;for(const[d,u]of e[s])for(const f of u){o.add(f);const m=n[f];if(!m)throw new Error("Geometry not found");if(m.geometryFile){const p=m.geometryFile,g=r.get(p)||0;r.set(p,g+d)}}const a=Array.from(r).sort((d,u)=>u[1]-d[1]);for(const[d]of a){const u=this.url+d;if(!this._ramCache.has(u)){let p=new Uint8Array;if(this.useCache){this.dbCleaner.update(u);const E=await this._fileCache.files.get(u);if(E)p=E.file;else{const I=await(await this.fetch(u)).arrayBuffer();p=new Uint8Array(I),this._fileCache.files.add({file:p,id:u})}}else{const E=await(await this.fetch(u)).arrayBuffer();p=new Uint8Array(E)}const g=this.serializer.import(p);this._ramCache.set(u,{data:g,time:performance.now()})}const f=this._ramCache.get(u);if(!f)continue;f.time=performance.now();const m=[];if(f)for(const[p,{position:g,index:E,normal:I}]of f.data){if(this._isDisposing)return;if(!o.has(p)||!this._geometryInstances[s]||!this._geometryInstances[s].has(p))continue;const v=this._geometryInstances[s].get(p);if(!v)throw new Error("Instances not found!");const b=new ft,C=new Rt(g,3),F=new Rt(I,3);b.setAttribute("position",C),b.setAttribute("normal",F),b.setIndex(Array.from(E));const A=[],R=[];for(const O of v)O.color[3]===1?R.push(O):A.push(O);this.newFragment(i,p,b,A,!0,m,t),this.newFragment(i,p,b,R,!1,m,t)}m.length&&!this._isDisposing&&this.onFragmentsLoaded.trigger(m)}const h=new Set,c=performance.now();for(const[d,{time:u}]of this._ramCache)c-u>this.maxRamTime&&h.add(d);for(const d of h)this._ramCache.delete(d)}}async unloadLostGeometries(e){if(this._isDisposing)return;const t=[],s=this.components.get(at);for(const i in e){const n=s.groups.get(i);if(!n)throw new Error("Fragment group not found!");if(!this._loadedFragments[i])continue;const r=this._loadedFragments[i],o=e[i];for(const a of o){if(this.culler.removeFragment(n.uuid,a),!r[a])continue;const h=r[a];for(const c of h)n.items.splice(n.items.indexOf(c),1),t.push(c);delete r[a]}}t.length&&this.onFragmentsDeleted.trigger(t);for(const i of t)s.list.delete(i.id),this.world.meshes.delete(i.mesh),i.mesh.material=[],i.dispose(!0)}setMeshVisibility(e,t){for(const s in e)for(const i of e[s]){const n=this._loadedFragments[s];if(!n)continue;const r=n[i];if(r)for(const o of r)o.mesh.visible=t}}newFragment(e,t,s,i,n,r,o){if(i.length===0||this._isDisposing)return;const a=e.geometryIDs,h=n?a.transparent:a.opaque,c=t*(n?-1:1),d=h.get(c);if(d===void 0)return;const u=e.keyFragments.get(d);if(u===void 0)return;const f=this.components.get(at);if(f.list.has(u))return;const m=n?this._baseMaterialT:this._baseMaterial,p=new wr(s,m,i.length);p.mesh.visible=o,p.id=u,p.mesh.uuid=u,p.group=e,e.add(p.mesh),e.items.push(p),f.list.set(p.id,p),this.world.meshes.add(p.mesh),this._loadedFragments[e.uuid]||(this._loadedFragments[e.uuid]={});const g=this._loadedFragments[e.uuid];g[t]||(g[t]=[]),g[t].push(p);const E=new Map;for(let C=0;C<i.length;C++){const F=new Oe,A=new mt,{id:R,transformation:O,color:L}=i[C];F.fromArray(O);const[k,x,M]=L;if(A.setRGB(k,x,M,"srgb"),E.has(R)){const w=E.get(R);if(!w)continue;w.transforms.push(F),w.colors&&w.colors.push(A)}else E.set(R,{id:R,colors:[A],transforms:[F]})}const I=Array.from(E.values());p.add(I);const v=this.fragIDData.get(p.id);if(!v)throw new Error("Fragment data not found!");const b=v[2];b.size&&p.setVisibility(!1,b),this.culler.addFragment(e.uuid,t,p),r.push(p)}};Y(rI,"uuid","22437e8d-9dbc-4b99-a04f-d2da280d50c8");let Qx=rI;class $3{constructor(){Y(this,"_meshes",new Map)}highlight(e,t,s,i){if(!t.userData.indexFragmentMap||!t.geometry.index)return;const{userData:n}=t,r=n.indexFragmentMap,o=[],a=t.geometry.index.array;for(const[d,u]of r)for(const f in u)if(i[f]){for(const m of u[f])if(i[f].has(m)){const p=a[d*3],g=a[d*3+1],E=a[d*3+2];o.push(p,g,E)}}this._meshes.has(e)||this._meshes.set(e,new Map);const h=this._meshes.get(e);if(!h.has(t.uuid)){const d=new is({depthTest:!1,side:2,color:s}),u=new ft;u.attributes=t.geometry.attributes;const f=new ye(u,d);f.frustumCulled=!1,h.set(t.uuid,f)}const c=h.get(t.uuid);c.position.copy(t.position),t.parent&&t.parent!==c.parent&&t.parent.add(c),c.geometry.setIndex(o),c.material.color.copy(s)}clear(e){for(const[t,s]of this._meshes)if(!(e&&e!==t))for(const[i,n]of s)n.removeFromParent()}dispose(){for(const[e,t]of this._meshes)for(const[s,i]of t)i.removeFromParent(),i.geometry.attributes={},i.geometry.dispose(),i.material.dispose();this._meshes.clear()}}const oI=class zf extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"onBeforeUpdate",new we),Y(this,"onAfterUpdate",new we),Y(this,"onSetup",new we),Y(this,"isSetup",!1),Y(this,"enabled",!0),Y(this,"events",{}),Y(this,"multiple","ctrlKey"),Y(this,"zoomFactor",1.5),Y(this,"zoomToSelection",!1),Y(this,"backupColor",null),Y(this,"selection",{}),Y(this,"config",{selectName:"select",hoverName:"hover",selectionColor:new mt("#BCF124"),hoverColor:new mt("#6528D7"),autoHighlightOnClick:!0,world:null,selectEnabled:!0,hoverEnabled:!0}),Y(this,"colors",new Map),Y(this,"autoToggle",new Set),Y(this,"selectable",{}),Y(this,"_fills",new $3),Y(this,"_mouseState",{down:!1,moved:!1}),Y(this,"_colorsBeforeSelect",{}),Y(this,"saveHighlightersBeforeSelect",t=>{var s;const i=this.components.get(at);for(const n in t){const r=i.list.get(n);if(!r)continue;const o=(s=r.group)==null?void 0:s.uuid;if(o)for(const a in this.selection){if(a===this.config.selectName||a===this.config.hoverName)continue;const h=this.selection[a][n];if(h){a in this._colorsBeforeSelect||(this._colorsBeforeSelect[a]={}),o in this._colorsBeforeSelect[a]||(this._colorsBeforeSelect[a]={[o]:new Set});for(const c of h)this._colorsBeforeSelect[a][o].add(c)}}}}),Y(this,"restoreHighlightersAfterDeselect",()=>{const t=this.components.get(at);for(const s in this._colorsBeforeSelect){let i={};const n=this._colorsBeforeSelect[s];for(const r in n){const o=t.groups.get(r);if(!o)continue;const a=o.getFragmentMap(n[r]);i={...i,...a}}this.highlightByID(s,i,!1,!1)}this._colorsBeforeSelect={}}),Y(this,"clearHover",()=>{this.selection[this.config.hoverName]={}}),Y(this,"onMouseDown",()=>{this.enabled&&(this._mouseState.down=!0)}),Y(this,"onMouseUp",async t=>{if(!this.enabled)return;const{world:s,autoHighlightOnClick:i,selectEnabled:n}=this.config;if(!s)throw new Error("No world found!");if(!s.renderer)throw new Error("This world doesn't have a renderer!");if(t.target===s.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||t.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,i&&n){const r=this.multiple==="none"?!0:!t[this.multiple];await this.highlight(this.config.selectName,r,this.zoomToSelection)}}}),Y(this,"onMouseMove",async()=>{if(!this.enabled)return;const{hoverName:t,hoverEnabled:s}=this.config;if(this._mouseState.moved){this.clear(t);return}this._mouseState.moved=this._mouseState.down;const i={};for(const n in this.selection){if(n===t)continue;const r=this.selection[n];for(const o in r){o in i||(i[o]=new Set);const a=r[o];for(const h of a)i[o].add(h)}}s&&await this.highlight(this.config.hoverName,!0,!1,i)}),this.components.add(zf.uuid,this)}async dispose(){this.setupEvents(!1),this._fills.dispose(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={};for(const e in this.events)this.events[e].onClear.reset(),this.events[e].onHighlight.reset();this.onSetup.reset(),this.events={},this.onDisposed.trigger(zf.uuid),this.onDisposed.reset()}add(e,t){if(this.selection[e]||this.colors.has(e))throw new Error("A selection with that name already exists!");this.colors.set(e,t),this.selection[e]={},this.events[e]={onHighlight:new we,onClear:new we}}async highlight(e,t=!0,s=this.zoomToSelection,i={}){if(!this.enabled)return null;if(!this.config.world)throw new Error("No world found in config!");const n=this.config.world;if(!this.selection[e])throw new Error(`Selection ${e} does not exist.`);const r=[],o=this.components.get(at).meshes;for(const g of o)r.push(g);const a=this.components.get(zo);for(const g of a.list){const E=g;if(E.edges){const I=E.edges.fillMeshes;for(const v of I)r.push(v)}}const h=this.components.get(di).get(n).castRay(r);if(!h||!h.face)return this.clear(e),null;const c=h.object;if(!c.fragment&&c.userData.indexFragmentMap){if(h.faceIndex===void 0||!c.geometry.index)return null;const{userData:g}=c,E=g.indexFragmentMap.get(h.faceIndex);if(E){await this.highlightByID(e,E,t,s,i,c,!0);const I=Object.keys(E)[0];return{id:Array.from(E[I])[0],fragments:E}}return null}const d=c.geometry,u=h.instanceId;if(!d||u===void 0)return null;const f=c.fragment.getItemID(u);if(f===null)throw new Error("Item ID not found!");const m=c.fragment.group;if(!m)throw new Error("Fragment must belong to a FragmentsGroup!");const p=m.getFragmentMap([f]);return await this.highlightByID(e,p,t,s,i,void 0,!0),{id:f,fragments:p}}async highlightByID(e,t,s=!0,i=this.zoomToSelection,n={},r=void 0,o=!1){if(!this.enabled)return;s&&this.clear(e);const a=this.components.get(at),h=this.colors.get(e);if(!h)throw new Error("Color for selection not found!");const c={};for(const d in t){const u=t[d],f=n[d];for(const m of u)if(!(f&&f.has(m))){if(this.selectable[e]){const p=this.selectable[e];if(!p[d]||!p[d].has(m))continue}c[d]||(c[d]=new Set),c[d].add(m)}}for(const d in c){this.selection[e][d]||(this.selection[e][d]=new Set);const u=c[d],f=new Set,m=new Set;for(const g of u){const E=this.selection[e][d];o&&this.autoToggle.has(e)&&E.has(g)?(f.add(g),E.delete(g)):(E.add(g),m.add(g))}const p=a.list.get(d);if(p&&(f.size&&(this.backupColor?p.setColor(this.backupColor,f):p.resetColor(f)),m.size&&p.setColor(h,m),p.mesh.userData.fills))for(const g of p.mesh.userData.fills)this._fills.highlight(e,g,h,t)}this.events[e].onHighlight.trigger(this.selection[e]),r&&this._fills.highlight(e,r,h,t),i&&await this.zoomSelection(e)}clear(e){const t=e?[e]:Object.keys(this.selection);for(const s of t){this._fills.clear(s);const i=this.components.get(at),n=this.selection[s];for(const r in this.selection[s]){const o=i.list.get(r);if(!o)continue;const a=n[r];a&&(this.backupColor?o.setColor(this.backupColor,a):o.resetColor(a))}this.events[s].onClear.trigger(null),this.selection[s]={}}}setup(e){this.config={...this.config,...e},this.add(this.config.selectName,this.config.selectionColor),this.autoToggle.add(this.config.selectName),this.add(this.config.hoverName,this.config.hoverColor),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}updateFragments(e){for(const t of e)for(const s in this.selection){const i=this.selection[s][t.id],n=this.colors.get(s);i&&n&&t.setColor(n,i)}}async zoomSelection(e){if(!this.config.world)throw new Error("No world found in config!");const t=this.config.world;if(!t.camera.hasCameraControls())return;const s=this.components.get(xc),i=this.components.get(at);s.reset();const n=this.selection[e];if(!Object.keys(n).length)return;for(const p in n){const g=i.list.get(p);if(!g)continue;const E=n[p];s.addMesh(g.mesh,E)}const r=s.getSphere(),o=1/0,a=-1/0,{x:h,y:c,z:d}=r.center,u=r.radius===o||h===o||c===o||d===o,f=r.radius===a||h===a||c===a||d===a,m=r.radius===0;u||f||m||(r.radius*=this.zoomFactor,await t.camera.controls.fitToSphere(r,!0))}setupEvents(e){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.config.world.renderer.three.domElement,s=this.events[this.config.selectName].onHighlight;s.remove(this.clearHover),s.remove(this.saveHighlightersBeforeSelect);const i=this.events[this.config.selectName].onClear;i.remove(this.restoreHighlightersAfterDeselect),t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("pointermove",this.onMouseMove),e&&(s.add(this.clearHover),s.add(this.saveHighlightersBeforeSelect),i.add(this.restoreHighlightersAfterDeselect),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("pointermove",this.onMouseMove))}};Y(oI,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let qx=oI;class ex extends ht{constructor(){super(...arguments),Y(this,"onDisposed",new we),Y(this,"world")}get enabled(){return this.world?this.getRenderer().postproduction.customEffects.outlineEnabled:!1}set enabled(e){if(!this.world)throw new Error("Before enabling the outliner, provide a world!");const t=this.getRenderer();t.postproduction.customEffects.outlineEnabled=e}create(e,t){const s=this.getRenderer();if(s.postproduction.customEffects.outlinedMeshes[e]!==void 0)throw new Error(`There's already a style with the name ${e}.`);s.postproduction.customEffects.outlinedMeshes[e]={material:t,meshes:new Set}}add(e,t){const s=this.getRenderer(),i=this.getStyles()[e];if(!i)throw new Error(`The style ${e} does not exist`);const n=s.postproduction.customEffects.outlineScene,r=this.components.get(at);for(const o in t){const a=r.list.get(o);if(!a)continue;const h=t[o],c=a.clone(h);c.mesh.instanceColor=null,c.mesh.material=[i.material],i.meshes.add(c.mesh),n.add(c.mesh)}}clear(e){if(e){this.clearStyle(e,!1);return}const t=this.getStyles(),s=Object.keys(t);for(const i of s)this.clearStyle(i,!1);this.world=void 0}dispose(){const e=this.getStyles(),t=Object.keys(e);for(const s of t)this.clearStyle(s,!0);this.onDisposed.trigger(),this.onDisposed.reset()}clearStyle(e,t){const s=this.getStyles(),i=s[e];if(!i)return;const n=this.components.get(ji);for(const r of i.meshes){const o=r;o.fragment&&o.fragment.dispose(!1),n.destroy(r)}i.meshes.clear(),t&&(i.material.dispose(),delete s[e])}getStyles(){return this.getRenderer().postproduction.customEffects.outlinedMeshes}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");const e=this.world.renderer;if(!e.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return e}}Y(ex,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");class an extends ht{constructor(){super(...arguments),Y(this,"enabled",!1),Y(this,"onDisposed",new we),Y(this,"onNavigated",new we),Y(this,"onExited",new we),Y(this,"planeType","section"),Y(this,"offset",100),Y(this,"list",new Map),Y(this,"world"),Y(this,"current",null),Y(this,"cached3DCamera",{position:new U,target:new U,projection:"Perspective",zoom:1,top:10,bottom:-10,right:10,left:-10})}create(e){const t=this.getWorld(),{id:s,point:i,normal:n,type:r}=e;let{name:o,offset:a}=e;const h=this.components.get(zo),c=h.Type;h.Type=Fc;const d=h.createFromNormalAndCoplanarPoint(t,n,i);d.visible=!1,d.edges.visible=!1,d.enabled=!1,o=o||s,a=a||this.offset,d.type=r||this.planeType,d.updateFill();const u=n.clone().multiplyScalar(-a).add(i),f=i.clone(),m={id:s,name:o,plane:d,offset:a,cached:{position:u,target:f,zoom:1,size:10}};return this.list.set(s,m),h.Type=c,m}delete(e){const t=this.list.get(e);t&&(t.plane.dispose(),this.list.delete(e))}async goTo(e,t=!1){var s;const i=this.getCamera();if(((s=this.current)==null?void 0:s.id)===e)return;const n=this.list.get(e);if(!n)throw new Error(`There's no section with the ID: ${e}.`);this.cacheCameraPosition(),await this.hidePreviousClippingPlane(),await i.projection.set("Orthographic"),this.current=n;const r=new U,o=new U,{cached:a}=n,{position:h,target:c}=a;r.copy(c),o.copy(h),await i.controls.setLookAt(o.x,o.y,o.z,r.x,r.y,r.z,t);const d=n.cached.size,u=i.threePersp.aspect;i.threeOrtho.top=d,i.threeOrtho.bottom=-d,i.threeOrtho.left=-d*u,i.threeOrtho.right=d*u,i.threeOrtho.updateProjectionMatrix(),await i.controls.zoomTo(a.zoom,!1),i.set("Plan"),this.current.plane&&(this.current.plane.enabled=!0,this.current.plane.edges.fillNeedsUpdate=!0,this.current.plane.edges.visible=!0),this.enabled=!0,this.onNavigated.trigger({id:e})}async exit(e=!1){if(!this.enabled||!this.world)return;this.cacheCameraPosition();const t=this.getCamera();t.set("Orbit");const{position:s,target:i,projection:n}=this.cached3DCamera;await t.projection.set(n),this.current&&(this.current.plane.enabled=!1,this.current.plane.edges.enabled=!1,this.current.plane.edges.visible=!1),this.current=null;const{x:r,y:o,z:a}=s,{x:h,y:c,z:d}=i;await t.controls.setLookAt(r,o,a,h,c,d,e),t.projection.current==="Orthographic"&&(await t.controls.zoomTo(this.cached3DCamera.zoom,!1),t.threeOrtho.left=this.cached3DCamera.left,t.threeOrtho.right=this.cached3DCamera.right,t.threeOrtho.top=this.cached3DCamera.top,t.threeOrtho.bottom=this.cached3DCamera.bottom),this.enabled=!1,this.onExited.trigger()}dispose(){for(const[,{plane:e}]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}getWorld(){if(!this.world)throw new Error("World is needed to create sections!");return this.world}getCamera(){const e=this.getWorld().camera;if(!e.hasCameraControls()||!e.projection)throw new Error("The world given to sections must have an OrthoPerspective camera.");return e}cacheCameraPosition(){if(!this.world)throw new Error("World is needed to create clipping planes!");const e=this.getCamera();if(this.enabled){if(!this.current)throw new Error("Current section not found!");const{cached:t}=this.current,{position:s,target:i}=t;e.controls.getPosition(s),e.controls.getTarget(i),t.zoom=e.threeOrtho.zoom,t.size=e.threeOrtho.top}else{e.three.getWorldPosition(this.cached3DCamera.position),e.controls.getTarget(this.cached3DCamera.target),this.cached3DCamera.projection=e.projection.current,this.cached3DCamera.zoom=e.threeOrtho.zoom;const{top:t,bottom:s,left:i,right:n}=e.threeOrtho;this.cached3DCamera.top=t,this.cached3DCamera.bottom=s,this.cached3DCamera.left=i,this.cached3DCamera.right=n}}async hidePreviousClippingPlane(){if(this.current){const e=this.current.plane;e&&(e.enabled=!1),this.current.plane.edges.visible=!1}}}Y(an,"uuid","45b41ba3-7bb8-4e08-909f-e0fa87973965");const tx=class aI extends ht{constructor(e){super(e),Y(this,"onDisposed",new we),Y(this,"planeType","floorplan"),Y(this,"onNavigated",new we),Y(this,"onExited",new we),Y(this,"enabled",!1),Y(this,"currentPlan",null),Y(this,"offset",1.5),Y(this,"list",[]),Y(this,"_cachedPlanCamera",null),this.components.add(aI.uuid,this)}get world(){return this.components.get(an).world}set world(e){const t=this.components.get(an);t.world=e}get defaultCameraOffset(){return this.components.get(an).offset}set defaultCameraOffset(e){const t=this.components.get(an);t.offset=e}dispose(){this.onExited.reset(),this.onNavigated.reset();const e=this.components.get(an);for(const t of this.list)e.delete(t.id);this.list=[],this.onDisposed.trigger(),this.onDisposed.reset()}async generate(e){if(!e.hasProperties)throw new Error("Properties are needed to compute plan views!");const t=await e.getAllPropertiesOfType(Rr);if(!t)throw new Error("Floorplans not found!");const s=e.coordinationMatrix.elements[13],i=await Ir.getUnits(e);for(const n of Object.values(t)){const r={value:0};this.getAbsoluteFloorHeight(n.ObjectPlacement,r);const o=r.value*i+s+this.offset;this.create({name:n.Name.value,id:n.GlobalId.value,normal:new U(0,-1,0),point:new U(0,o,0)})}}create(e){const t=this.components.get(an);e.type=e.type||this.planeType;const s={...t.create(e),planOffset:this.offset};this.list.push(s)}async goTo(e,t=!1){this.enabled&&this.cachePlanCamera(),await this.components.get(an).goTo(e,t),await this.applyCachedPlanCamera(),this.enabled=!0}async exitPlanView(e=!1){this.enabled&&(this.cachePlanCamera(),await this.components.get(an).exit(e),this.enabled=!1,this.onExited.trigger())}cachePlanCamera(){var e;const t=(e=this.world)==null?void 0:e.camera,s=new U,i=new U;t.controls.getTarget(s),t.controls.getPosition(i),this._cachedPlanCamera={target:s,position:i,zoom:t.threeOrtho.zoom,top:t.threeOrtho.top,right:t.threeOrtho.right,bottom:t.threeOrtho.bottom,left:t.threeOrtho.left}}async applyCachedPlanCamera(){var e;if(!this._cachedPlanCamera)return;const t=(e=this.world)==null?void 0:e.camera,{position:s,target:i}=this._cachedPlanCamera,n=new U,r=new U;t.controls.getPosition(n),t.controls.getTarget(r);const o=n.y,a=r.y;await t.controls.setLookAt(s.x,o,s.z,i.x,a,i.z),await t.controls.zoomTo(this._cachedPlanCamera.zoom),t.threeOrtho.top=this._cachedPlanCamera.top,t.threeOrtho.bottom=this._cachedPlanCamera.bottom,t.threeOrtho.left=this._cachedPlanCamera.left,t.threeOrtho.right=this._cachedPlanCamera.right,t.threeOrtho.updateProjectionMatrix()}getAbsoluteFloorHeight(e,t){const s=e.RelativePlacement.Location.Coordinates;t.value+=s[2].value,e.PlacementRelTo&&this.getAbsoluteFloorHeight(e.PlacementRelTo,t)}};Y(tx,"uuid","a80874aa-1c93-43a4-80f2-df346da086b1");export{Pf as $,Ev as I,ZT as J,Ss as L,xx as M,qt as S,kt as _,Mw as a,Fw as b,lf as c,oC as d,zw as e,Aw as f,Ox as h,mv as m,iC as n,qx as o,Qx as r,cn as t,hC as u,dl as x,tE as z};
//# sourceMappingURL=components-B_QfFtKG.js.map
